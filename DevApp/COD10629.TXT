OBJECT Codeunit 10629 E-Invoice Check Common
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=NAVNO8.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      InvalidCurrencyExchangeRateErr@1080001 : TextConst 'ENU=The %1 field on the %2 page has an invalid value of %3. Microsoft Dynamics NAV is unable to calculate the exchange rate. The electronic invoice document cannot be created for document number %4.';

    PROCEDURE CheckCurrencyCode@1080002(CurrencyCode@1080001 : Code[10];DocumentNumber@1080000 : Code[20];PostingDate@1080010 : Date);
    VAR
      CurrencyExchangeRate@1080011 : Record 330;
      Currency@1080003 : Record 4;
      GeneralLedgerSetup@1080002 : Record 98;
    BEGIN
      // CurrencyCode is empty - ok (we'll use LCY later in the exported E-Invoice)
      IF CurrencyCode = '' THEN
        EXIT;

      // CurrencyCode is equal to LCY - ok
      GeneralLedgerSetup.GET;
      IF CurrencyCode = GeneralLedgerSetup."LCY Code" THEN
        EXIT;

      // CurrencyCode <> LCY - found in Currencies - the ExchangeRate function below will ensure we do have an exchange rate
      // for this currency
      IF CurrencyExchangeRate.ExchangeRate(PostingDate,CurrencyCode) = 0 THEN
        ERROR(InvalidCurrencyExchangeRateErr,Currency.FIELDCAPTION("Currency Factor"),
          Currency.TABLECAPTION,Currency."Currency Factor",DocumentNumber);
    END;

    BEGIN
    END.
  }
}

