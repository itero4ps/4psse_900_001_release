OBJECT Codeunit 11012001 Text Editor
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00,4PSSE;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      UserSetup@1210190008 : Record 91;
      SpecialFieldCaptionRec@1100485007 : Record 97;
      SpecialFieldCaptionAdv@1100409001 : Record 11072231;
      FileMgt@1100525004 : Codeunit 419;
      Window@1100485005 : Dialog;
      TextFile@1210190005 : File;
      InputStream@1100528700 : InStream;
      ShowStatus@1210190001 : Boolean;
      TextEditorAllowed@1100525001 : Boolean;
      LineBreakSkipped@1210190002 : Boolean;
      MaxLineLength@1210190000 : Integer;
      OldProgress@1210190010 : Integer;
      OldTime@1210190009 : Time;
      CurrDate@1210190006 : Date;
      CurrCode@1210190012 : Code[20];
      CurrTime@1100525000 : Time;
      CurrCmtCode@1100485008 : Code[20];
      CurrLanguageCode@1100525005 : Code[20];
      CurrCreatedBy@1100485009 : Code[50];
      CurrType@1100409000 : Integer;
      SpecialLineChar@1100485001 : Text[1];
      Filename@1100485002 : Text[250];
      TextLine@1100485004 : Text[1024];
      TextLine2@1100485003 : Text[1024];
      Text000@1100525002 : TextConst 'ENU=Text Editor only allowed if the filtering is based on only one entitty (document/order/invoice/etc.).';
      Text001@1100525003 : TextConst 'ENU=Text Editor only allowed if the filtering is based on only one entitty (beginning or Ending Text).';
      CurrPos@1100528701 : Integer;
      EndOfLine@1100528702 : Boolean;
      Text002@1100528301 : TextConst 'ENU=Error in saving the Text File.';

    PROCEDURE RlshpMgtComment@1210190007(VAR CommentLine@1210190000 : Record 5061);
    VAR
      lvCommentLine@1100525000 : Record 5061;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","No.","Sub No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Sub No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Sub No." <> "Sub No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Sub No." <> "Sub No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE SalesMgtComment@1210190008(VAR CommentLine@1210190000 : Record 44);
    VAR
      lvCommentLine@1100525000 : Record 44;
    BEGIN
      CommentLine.SETCURRENTKEY("Document Type","No.","Document Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Document Type", "No.", "Document Line No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Document Type" <> "Document Type") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Document Line No." <> "Document Line No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Document Type" <> "Document Type") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Document Line No." <> "Document Line No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break"); // jhoek.300611
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine; // jhoek.300611
          GetLine(Comment);
          Comment := DELCHR(Comment, '>'); // jhoek.300611
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE PurchMgtComment@1210190010(VAR CommentLine@1210190000 : Record 43);
    VAR
      lvCommentLine@1100525000 : Record 43;
    BEGIN
      CommentLine.SETCURRENTKEY("Document Type","No.","Document Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Document Type", "No.", "Document Line No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Document Type" <> "Document Type") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Document Line No." <> "Document Line No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Document Type" <> "Document Type") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Document Line No." <> "Document Line No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ShippingOrderMgtComment@1100525011(VAR CommentLine@1210190000 : Record 11071887);
    VAR
      lvCommentLine@1100525000 : Record 11071887;
    BEGIN
      CommentLine.SETCURRENTKEY("Document No.","Shipping Order Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Document No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Document No.", "Shipping Order Line No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Shipping Order Line No." <> "Shipping Order Line No.") OR
               (lvCommentLine."Document No." <> "Document No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Shipping Order Line No." <> "Shipping Order Line No.") OR
                   (lvCommentLine."Document No." <> "Document No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine; // jhoek.300611
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLine@1100485004(VAR CommentLine@1210190000 : Record 97);
    VAR
      lvCommentLine@1100525000 : Record 97;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code","Language Code","Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code","Language Code",USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrLanguageCode := '';  //db, 22-05-15
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Language Code" := CurrLanguageCode;  //db, 22-05-15
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineGroup@1100525007(VAR CommentLine@1210190000 : Record 11020595);
    VAR
      lvCommentLine@1100525000 : Record 11020595;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name",Group,"No.","Estimate No.","Sub-Estimate No.","Part Group",Part,"Estimate Line No.","Recipe Line No.","Part Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("No." = '') AND ("Estimate No." = '') AND (Part = '') THEN  //db, 17-02-15
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name",Group,"No.","Estimate No.","Sub-Estimate No.","Part Group",Part);  //db, 17-02-15
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR  (lvCommentLine.Group <> Group) OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Estimate No." <> "Estimate No.") OR  (lvCommentLine."Sub-Estimate No." <> "Sub-Estimate No.") OR
               (lvCommentLine."Part Group" <> "Part Group") OR (lvCommentLine.Part <> Part) OR
               (lvCommentLine."Estimate Line No." <> "Estimate Line No.") OR
               (lvCommentLine."Recipe Line No." <> "Recipe Line No.") OR
               (lvCommentLine."Part Line No." <> "Part Line No.") THEN  //db, 17-02-15
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR  (lvCommentLine.Group <> Group) OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Estimate No." <> "Estimate No.") OR  (lvCommentLine."Sub-Estimate No." <> "Sub-Estimate No.") OR
                   (lvCommentLine."Part Group" <> "Part Group") OR (lvCommentLine.Part <> Part) OR
                   (lvCommentLine."Estimate Line No." <> "Estimate Line No.") OR
                   (lvCommentLine."Recipe Line No." <> "Recipe Line No.") OR
                   (lvCommentLine."Part Line No." <> "Part Line No.") THEN  //db, 17-02-15t
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        //db.sn, 16-02-15
        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(0D,0T,Code,"Comment Code","Language Code",'');  //db, 16-02-15: skip change-log; check language code
            //WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code","Language Code","Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          //WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE BEGIN
          //WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code","Language Code",USERID);
        END;
        //db.en, 16-02-15

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrLanguageCode := '';  //db, 22-05-15
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Language Code" := CurrLanguageCode;  //db, 22-05-15
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o
            INSERT; //**4PS.n M16371
            //db.sn, 28-11-11: M29282
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Language Code" := CurrLanguageCode;  //db, 22-05-15
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            MODIFY(TRUE);  //activate Central Mgt
            //db.en, 28-11-11: M29282
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineRAW@1100519001(VAR CommentLine@1210190000 : Record 11125684);
    VAR
      lvCommentLine@1100525000 : Record 11125684;
    BEGIN
      //DP01086
      CommentLine.SETCURRENTKEY("Table No.","Part Group",Activity,"Estimate No.","Element No.","Estimate Element Line","Estimate Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Table No." = 0) OR ((Activity = '') AND ("Element No." = '')) THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table No.","Part Group",Activity,"Estimate No.","Element No.","Estimate Element Line","Estimate Line No.","Line No.");
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table No." <> "Table No.") OR  (lvCommentLine."Part Group" <> "Part Group") OR
               (lvCommentLine.Activity <> Activity) OR (lvCommentLine."Estimate No." <> "Estimate No.") OR (lvCommentLine."Element No." <> "Element No.") OR
               (lvCommentLine."Estimate Element Line" <> "Estimate Element Line") OR (lvCommentLine."Estimate Line No." <> "Estimate Line No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table No." <> "Table No.") OR  (lvCommentLine."Part Group" <> "Part Group") OR
                   (lvCommentLine.Activity <> Activity) OR (lvCommentLine."Estimate No." <> "Estimate No.") OR (lvCommentLine."Element No." <> "Element No.") OR
                    (lvCommentLine."Estimate Element Line" <> "Estimate Element Line") OR (lvCommentLine."Estimate Line No." <> "Estimate Line No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrLanguageCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            VALIDATE("Time Created", CurrTime);
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineBudget@1100529800(VAR CommentLine@1210190000 : Record 11020634);
    VAR
      lvCommentLine@1100525000 : Record 11020634;
    BEGIN
      // **4PS MVOS
      CommentLine.SETCURRENTKEY("Table Name","Record ID","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF (FORMAT("Record ID") = '') THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (FORMAT(lvCommentLine."Record ID") <> FORMAT("Record ID")) THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (FORMAT(lvCommentLine."Record ID") <> FORMAT("Record ID")) THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE GlazingServiceCommentLine@1100525010(VAR CommentLine@1100525000 : Record 11125782);
    VAR
      lvCommentLine@1100525001 : Record 11125782;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Created By");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            //"Comment Code" := CurrCmtCode;
            //"Created by" := CurrCreatedBy;
            //"Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE WarrantyDataCommentLine@1210190005(VAR CommentLine@1100525000 : Record 11020667);
    VAR
      lvCommentLine@1100525001 : Record 11020667;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","No.","Warranty Code","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Warranty Code", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Created By");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE PrognosisCommentLine@1100525000(VAR PrognosisCommentLine@1100525000 : Record 11020560);
    VAR
      PrognosisCommentLine2@1100525001 : Record 11020560;
    BEGIN
      PrognosisCommentLine.SETCURRENTKEY("Project No.","Prognosis Date","Line No.");
      WITH PrognosisCommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Project No." = '') OR ("Prognosis Date" = 0D) THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          PrognosisCommentLine2.COPY(PrognosisCommentLine);
          PrognosisCommentLine2.SETCURRENTKEY("Project No.", "Prognosis Date", "Line No.");  //* Key 1
          IF PrognosisCommentLine2.FINDFIRST THEN BEGIN
            IF (PrognosisCommentLine2."Project No." <> "Project No.") OR
               (PrognosisCommentLine2."Prognosis Date" <> "Prognosis Date")
      THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF PrognosisCommentLine2.FINDLAST THEN BEGIN
                IF (PrognosisCommentLine2."Project No." <> "Project No.") OR
                   (PrognosisCommentLine2."Prognosis Date" <> "Prognosis Date")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,Time,Code,"Comment Code",'',"Created By");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,Time,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,Time,Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created By" := CurrCreatedBy;
            Time := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLinePlant@1100529000(VAR CommentLine@1210190000 : Record 11072666);
    VAR
      lvCommentLine@1100525000 : Record 11072666;
    BEGIN
      //DP00183
      //C005461.c T11012669 -> T11072666
      CommentLine.SETCURRENTKEY("Table No.","No.","No. 2","Entry No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Table No." = 0) OR ("No." = '') THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table No." <> "Table No.") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."No. 2" <> "No. 2") OR (lvCommentLine."Entry No." <> "Entry No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table No." <> "Table No.") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."No. 2" <> "No. 2") OR (lvCommentLine."Entry No." <> "Entry No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ProvisionalWorkCommentLine@1100528701(VAR CommentLine@1210190000 : Record 11071940);
    VAR
      CommentLine2@1100525000 : Record 11071940;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","Provisional Work No.","Feature Group",Feature,"Specification Type","Specification Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Provisional Work No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          CommentLine2.COPY(CommentLine);
          CommentLine2.SETCURRENTKEY(
            "Table Name","Provisional Work No.","Feature Group",Feature,
            "Specification Type","Specification Line No.","Line No.");  //* Key 1
          IF CommentLine2.FINDFIRST THEN BEGIN
            IF (CommentLine2."Table Name" <> "Table Name") OR
               (CommentLine2."Provisional Work No." <> "Provisional Work No.") OR
               (CommentLine2."Feature Group" <> "Feature Group") OR
               (CommentLine2.Feature <> Feature) OR
               (CommentLine2."Specification Type" <> "Specification Type") OR
               (CommentLine2."Specification Line No." <> "Specification Line No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF CommentLine2.FINDLAST THEN BEGIN
                IF (CommentLine2."Table Name" <> "Table Name") OR
                   (CommentLine2."Provisional Work No." <> "Provisional Work No.") OR
                   (CommentLine2."Feature Group" <> "Feature Group") OR
                   (CommentLine2.Feature <> Feature) OR
                   (CommentLine2."Specification Type" <> "Specification Type") OR
                   (CommentLine2."Specification Line No." <> "Specification Line No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineExt@1100485019(VAR CommentLine@1210190000 : Record 11020314;iReadOnly@1100485000 : Boolean);
    VAR
      lvCommentLine@1100525000 : Record 11020314;
    BEGIN
      //copy of function CommentLine
      CommentLine.SETCURRENTKEY("Table1 Name","Table1 No.","Table2 Name","Table2 No.","Table3 Name","Table3 No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Table1 No." + "Table2 No." + "Table3 No.") = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY(
            "Table1 Name", "Table1 No.", "Table2 Name", "Table2 No.", "Table3 Name", "Table3 No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table1 Name" <> "Table1 Name") OR (lvCommentLine."Table1 No." <> "Table1 No.") OR
               (lvCommentLine."Table2 Name" <> "Table2 Name") OR (lvCommentLine."Table2 No." <> "Table2 No.") OR
               (lvCommentLine."Table3 Name" <> "Table3 Name") OR (lvCommentLine."Table3 No." <> "Table3 No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table1 Name" <> "Table1 Name") OR (lvCommentLine."Table1 No." <> "Table1 No.") OR
                   (lvCommentLine."Table2 Name" <> "Table2 Name") OR (lvCommentLine."Table2 No." <> "Table2 No.") OR
                   (lvCommentLine."Table3 Name" <> "Table3 Name") OR (lvCommentLine."Table3 No." <> "Table3 No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFileExt(Date,Code,"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFileExt(TODAY,'',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFileExt(Date,Code,USERID);

        TextFile.CLOSE;
        EditTempFile;

        IF NOT iReadOnly THEN BEGIN
          //* Read the temporary file and write the comment lines
          DELETEALL(TRUE);
          "Line No." := 0;
          ResetCurrDateAndCode;
          CurrCmtCode := '';
          CurrCreatedBy := '';

          Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
          WHILE NOT EndOfFile DO BEGIN
            CommentLine."Line Break" := ReadLine;
            GetLine(Comment);
            Comment := DELCHR(Comment, '>');
            IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
              "Line No." += 10000;
              Date := CurrDate;
              Code := CurrCode;
              "Created by" := CurrCreatedBy;
              //INSERT(TRUE); //**4PS.o M16371
              INSERT; //**4PS.n M16371
              ResetCurrDateAndCode;
            END;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineServ@1100485016(VAR CommentLine@1210190000 : Record 11012882);
    VAR
      lvCommentLine@1100525000 : Record 11012882;
    BEGIN
      CommentLine.SETCURRENTKEY("Table Name","No.","Table Field","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Table Field", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Table Field" <> "Table Field")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Table Field" <> "Table Field")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',"Created by");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o M16371
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE WorkOrderText@1100528601(VAR IWorkOrderText@1210190000 : Record 11229284);
    VAR
      WorkOrderText@1100525000 : Record 11229284;
    BEGIN
      IWorkOrderText.SETCURRENTKEY("Table Name","No.","Table Field","Line No.");
      WITH IWorkOrderText DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          WorkOrderText.COPY(IWorkOrderText);
          WorkOrderText.SETCURRENTKEY("Table Name", "No.", "Table Field", "Line No.");  //* Key 1
          IF WorkOrderText.FINDFIRST THEN BEGIN
            IF (WorkOrderText."Table Name" <> "Table Name") OR (WorkOrderText."No." <> "No.") OR
               (WorkOrderText."Table Field" <> "Table Field")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF WorkOrderText.FINDLAST THEN BEGIN
                IF (WorkOrderText."Table Name" <> "Table Name") OR (WorkOrderText."No." <> "No.") OR
                   (WorkOrderText."Table Field" <> "Table Field")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',"Created by");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o M16371
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CommentLineServCallWizText@1100528600(VAR CommentLine@1100528600 : Record 11071722);
    VAR
      lvCommentLine@1100528601 : Record 11071722;
    BEGIN
      CommentLine.SETCURRENTKEY("Created by","Table Name","No.","Table Field","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
      //    lvCommentLine.SETCURRENTKEY("Table Name", "No.", "Table Field", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Table Field" <> "Table Field")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Table Name" <> "Table Name") OR (lvCommentLine."No." <> "No.") OR
                   (lvCommentLine."Table Field" <> "Table Field")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FIND('-') THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',"Created by");  //C014534.c
            Write(Comment, FALSE);
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            //INSERT(TRUE); //**4PS.o M16371
            INSERT; //**4PS.n M16371
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE DebriefText@1100528603(VAR DebriefText@1210190000 : Record 11012886);
    VAR
      lvDebriefText@1100525000 : Record 11012886;
    BEGIN
      DebriefText.SETCURRENTKEY(Type,"No.","Line No.");
      WITH DebriefText DO BEGIN
        TextEditorAllowed := TRUE;
        IF "No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvDebriefText.COPY(DebriefText);
          lvDebriefText.SETCURRENTKEY(Type, "No.", "Line No.");  //* Key 1
          IF lvDebriefText.FINDFIRST THEN BEGIN
            IF lvDebriefText."No." <> "No." THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvDebriefText.FINDLAST THEN BEGIN
                IF lvDebriefText."No." <> "No." THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,'','','',"Modified by User");  //C014534.c
            Write(Comment, TRUE);
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,'','','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            "Modified by User" := CurrCreatedBy;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ComplaintNote@1100485005(VAR CommentLine@1210190000 : Record 11012454);
    VAR
      lvCommentLine@1100525000 : Record 11012454;
      Code@1100485000 : Code[20];
    BEGIN
      CommentLine.SETCURRENTKEY("Complaint No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Complaint No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Complaint No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Complaint No." <> "Complaint No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Complaint No." <> "Complaint No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Modified by");
            Write(Note, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Note),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Note);
          Note := DELCHR(Note, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Note) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ComplaintNoteBuyer@1100485006(VAR CommentLine@1210190000 : Record 11012455);
    VAR
      lvCommentLine@1100525000 : Record 11012455;
      Code@1100485000 : Code[20];
    BEGIN
      CommentLine.SETCURRENTKEY(Project,"Plot No.","Note Type","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF Project = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY(Project, "Plot No.", "Note Type", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Note Type" <> "Note Type") OR (lvCommentLine.Project <> Project) OR
               (lvCommentLine."Plot No." <> "Plot No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Note Type" <> "Note Type") OR (lvCommentLine.Project <> Project) OR
                   (lvCommentLine."Plot No." <> "Plot No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','','');
            Write(Note, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Note),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Note);
          Note := DELCHR(Note, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Note) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE TendElemText@1100485007(VAR CommentLine@1210190000 : Record 11012475);
    VAR
      lvCommentLine@1100525000 : Record 11012475;
    BEGIN
      CommentLine.SETCURRENTKEY("Project No.",Principal,"Contract No.","Tender Paragraph","Text Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Project No." = '') OR ("Tender Paragraph" = '') THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Project No.", Principal, "Contract No.", "Tender Paragraph", "Text Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine.Principal <> Principal) OR
               (lvCommentLine."Contract No." <> "Contract No.") OR (lvCommentLine."Tender Paragraph" <> "Tender Paragraph")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine.Principal <> Principal) OR
                   (lvCommentLine."Contract No." <> "Contract No.") OR (lvCommentLine."Tender Paragraph" <> "Tender Paragraph")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Text Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Text Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE BuyerMgtText@1100485000(VAR CommentLine@1210190000 : Record 11012511);
    VAR
      lvCommentLine@1100525000 : Record 11012511;
      lvTmpCommentLine@1100525001 : TEMPORARY Record 11012511;
      lvTmpCommentLine2@1100525002 : TEMPORARY Record 11012511;
      DoUpdateOption@1100525003 : Boolean;
    BEGIN
      CommentLine.SETCURRENTKEY(Table,"Text Type","Project No.","House Model","Option Main Group","Option Sub Group","Option Group","Plot No.",Option,"Quote No.","Quote Line No.","Text Line No.");
      WITH CommentLine DO BEGIN
        lvTmpCommentLine2 := CommentLine;  //* Save (key)fields
        TextEditorAllowed := TRUE;
        IF ("Project No." + "House Model" + "Option Main Group" +
            "Option Sub Group" + "Option Group" + "Plot No." + Option + "Quote No.") = ''
        THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY(
            Table, "Text Type", "Project No.", "House Model", "Option Main Group", "Option Sub Group",
            "Option Group", "Plot No.", Option, "Quote No.", "Quote Line No.", "Text Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine.Table <> Table) OR (lvCommentLine."Text Type" <> "Text Type") OR
               (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine."House Model" <> "House Model") OR
               (lvCommentLine."Option Main Group" <> "Option Main Group") OR
               (lvCommentLine."Option Sub Group" <> "Option Sub Group") OR (lvCommentLine."Option Group" <> "Option Group") OR
               (lvCommentLine."Plot No." <> "Plot No.") OR (lvCommentLine.Option <> Option) OR
               (lvCommentLine."Quote No." <> "Quote No.") OR (lvCommentLine."Quote Line No." <> "Quote Line No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine.Table <> Table) OR (lvCommentLine."Text Type" <> "Text Type") OR
                   (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine."House Model" <> "House Model") OR
                   (lvCommentLine."Option Main Group" <> "Option Main Group") OR
                   (lvCommentLine."Option Sub Group" <> "Option Sub Group") OR (lvCommentLine."Option Group" <> "Option Group") OR
                   (lvCommentLine."Plot No." <> "Plot No.") OR (lvCommentLine.Option <> Option) OR
                   (lvCommentLine."Quote No." <> "Quote No.") OR (lvCommentLine."Quote Line No." <> "Quote Line No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
            lvTmpCommentLine := CommentLine;
            lvTmpCommentLine.INSERT;
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Text Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Text Line No." += 10000;
          INSERT;
        END;
        IF (lvTmpCommentLine2.Table = Table::Option) AND
           (lvTmpCommentLine2."Text Type" = "Text Type"::Technical) AND
           (lvTmpCommentLine2."Plot No." <> '')
        THEN BEGIN
          DoUpdateOption := FALSE;
          IF COUNT <> lvTmpCommentLine.COUNT THEN
            DoUpdateOption := TRUE
          ELSE BEGIN
            IF FINDSET THEN BEGIN
              lvTmpCommentLine.FINDFIRST;
              REPEAT
                IF lvTmpCommentLine.Text <> Text THEN
                  DoUpdateOption := TRUE;
                IF lvTmpCommentLine.NEXT <> 0 THEN;
              UNTIL (NEXT = 0) OR DoUpdateOption;
            END;
          END;
        END;
        IF DoUpdateOption THEN
          lvTmpCommentLine2.UpdateOptionLog();

        DeleteTempFile;
      END;
    END;

    PROCEDURE PurchaseText@1100525001(VAR CommentLine@1100525000 : Record 11012067);
    VAR
      lvCommentLine@1100525001 : Record 11012067;
    BEGIN
      CommentLine.SETCURRENTKEY("Line Type","No.","Purchase Action","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Line Type" <> "Line Type"::"Purchase Action" THEN //C027844.n
          IF ("No.") = '' THEN
            TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Line Type","No.","Purchase Action","Line No.");
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Line Type" <> "Line Type") OR (lvCommentLine."No." <> "No.") OR
               (lvCommentLine."Purchase Action" <> "Purchase Action")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Line Type" <> "Line Type") OR (lvCommentLine."No." <> "No.") OR
                 (lvCommentLine."Purchase Action" <> "Purchase Action")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE GeneralText@1100485003(VAR CommentLine@1210190000 : Record 11020260);
    VAR
      lvCommentLine@1100485000 : Record 11020260;
    BEGIN
      CommentLine.SETCURRENTKEY(Table,Code,"Table Line No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF Code = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY(Table, Code, "Table Line No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine.Table <> Table) OR (lvCommentLine.Code <> Code) THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine.Table <> Table) OR (lvCommentLine.Code <> Code) THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        //C013139.so
        //IF FINDSET THEN BEGIN
        //  REPEAT
        //    WriteSpecialFieldsToFile(Date,"Time Created",'','','');
        //    Write(CharSetConversion.Ascii2Ansi(Text), "Line Break");
        //  UNTIL NEXT = 0;
        //  WriteSpecialFieldsToFile(TODAY,TIME,'','',USERID);  // 28509.n
        //END ELSE
        //  WriteSpecialFieldsToFile(Date,"Time Created",'','','');
        //C013139.eo

        //C013139.sn
        IF Table = Table::Job THEN BEGIN //Worksheet (small project)
          IF FINDSET THEN BEGIN
            REPEAT
              WriteSpecialFieldsToFile(Date,0T,'','','',"Created by");
              Write(Text, "Line Break");
            UNTIL NEXT = 0;
            WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
          END ELSE
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);
        END ELSE BEGIN
          IF FINDSET THEN BEGIN
            REPEAT
              WriteSpecialFieldsToFile(Date,"Time Created",'','','',"Created by");
              Write(Text, "Line Break");
            UNTIL NEXT = 0;
            WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
          END ELSE
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);
        END;
        //C013139.en

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Text) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE EstimateMgtText@1100485015(VAR CommentLine@1210190000 : Record 11012205);
    VAR
      lvCommentLine@1100525000 : Record 11012205;
    BEGIN
      CommentLine.SETCURRENTKEY("Recipe Group",Recipe,Type,"Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Recipe Group" = '') OR (Recipe = '') THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Recipe Group", Recipe, Type, "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine.Type <> Type) OR
               (lvCommentLine."Recipe Group" <> "Recipe Group") OR (lvCommentLine.Recipe <> Recipe)
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine.Type <> Type) OR
                   (lvCommentLine."Recipe Group" <> "Recipe Group") OR (lvCommentLine.Recipe <> Recipe)
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE CertificationReminderText@1100525005(VAR CertificationReminderText@1210190000 : Record 11020594);
    VAR
      lvCertificationReminderText@1100525000 : Record 11020594;
    BEGIN
      CertificationReminderText.SETCURRENTKEY(Position,"Line No.");
      WITH CertificationReminderText DO BEGIN
        TextEditorAllowed := TRUE;
        lvCertificationReminderText.COPY(CertificationReminderText);
        IF lvCertificationReminderText.FINDFIRST THEN BEGIN
          IF (lvCertificationReminderText.Position <> Position) THEN
            TextEditorAllowed := FALSE;
          IF TextEditorAllowed THEN BEGIN
            IF lvCertificationReminderText.FINDLAST THEN BEGIN
              IF (lvCertificationReminderText.Position <> Position) THEN
                TextEditorAllowed := FALSE;
            END;
          END;
        END;

        IF NOT TextEditorAllowed THEN
          ERROR(Text001);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename, MAXSTRLEN(Text), TRUE, 'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CertificationReminderText."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE AccidentQAText@1100525008(VAR AccidentTextLine@1100525000 : Record 11126007);
    VAR
      lvAccidentTextLine@1100525001 : Record 11126007;
    BEGIN
      AccidentTextLine.SETCURRENTKEY("Accident No.",Type,"Line No.");
      WITH AccidentTextLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Accident No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvAccidentTextLine.COPY(AccidentTextLine);
          lvAccidentTextLine.SETCURRENTKEY("Accident No.", Type, "Line No.");
          IF lvAccidentTextLine.FINDFIRST THEN BEGIN
            IF (lvAccidentTextLine."Accident No." <> "Accident No.") OR
               (lvAccidentTextLine.Type <> Type)
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvAccidentTextLine.FINDLAST THEN BEGIN
                IF (lvAccidentTextLine."Accident No." <> "Accident No.") OR
                   (lvAccidentTextLine.Type <> Type)
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the text lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          AccidentTextLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE QADeviationText@1100525006(VAR QADeviationTextLine@1100525000 : Record 11125987);
    VAR
      lvQADeviationTextLine@1100525001 : Record 11125987;
      lvQADeviation@1100525002 : Record 11125986;
    BEGIN
      QADeviationTextLine.SETCURRENTKEY("Deviation No.",Type,"Line No.");
      WITH QADeviationTextLine DO BEGIN
        lvQADeviation.CheckIfQADeviationCanBeChanged("Deviation No.");
        TextEditorAllowed := TRUE;
        IF "Deviation No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvQADeviationTextLine.COPY(QADeviationTextLine);
          lvQADeviationTextLine.SETCURRENTKEY("Deviation No.", Type, "Line No.");
          IF lvQADeviationTextLine.FINDFIRST THEN BEGIN
            IF (lvQADeviationTextLine."Deviation No." <> "Deviation No.") OR
               (lvQADeviationTextLine.Type <> Type)
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvQADeviationTextLine.FINDLAST THEN BEGIN
                IF (lvQADeviationTextLine."Deviation No." <> "Deviation No.") OR
                   (lvQADeviationTextLine.Type <> Type)
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the text lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          QADeviationTextLine."Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE TextLineSMF@1100525003(VAR CommentLine@1210190000 : Record 11125526);
    VAR
      lvCommentLine@1100525000 : Record 11125526;
      Code@1100485000 : Code[20];
    BEGIN
      CommentLine.SETCURRENTKEY(Type,"Project No.",Date,"Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF CommentLine."Project No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY(Type, "Project No.", Date, "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Project No." <> "Project No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Project No." <> "Project No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,'','',"Created by");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            INSERT;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE InspectionLineTextSMF@1100525009(VAR InspecTextline@1210190000 : Record 11125536);
    VAR
      lvInspecTextline@1100525000 : Record 11125536;
      Code@1100485000 : Code[20];
    BEGIN
      InspecTextline.SETCURRENTKEY("Project No.","Inspection Code",Date,"Sequence No.","Line No.");
      WITH InspecTextline DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Project No." = '') OR ("Inspection Code" = '') OR (Date = 0D) THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvInspecTextline.COPY(InspecTextline);
          lvInspecTextline.SETCURRENTKEY("Project No.", "Inspection Code", Date, "Line No.", "Sequence No.");  //* Key 1
          IF lvInspecTextline.FINDFIRST THEN BEGIN
            IF (lvInspecTextline."Project No." <> "Project No.") OR
               (lvInspecTextline."Inspection Code" <> "Inspection Code") OR
               (lvInspecTextline.Date <> Date) OR
               (lvInspecTextline."Sequence No." <> "Sequence No.")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvInspecTextline.FINDLAST THEN BEGIN
                IF (lvInspecTextline."Project No." <> "Project No.") OR
                   (lvInspecTextline."Inspection Code" <> "Inspection Code") OR
                   (lvInspecTextline.Date <> Date) OR
                   (lvInspecTextline."Sequence No." <> "Sequence No.")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(0D,0T,Code,"Comment Code",'',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(0D,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(0D,0T,Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          InspecTextline."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created by" := CurrCreatedBy;
            INSERT;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE PlotComment@1100485012(VAR CommentLine@1100485000 : Record 11012518);
    VAR
      lvCommentLine@1100525000 : Record 11012518;
    BEGIN
      CommentLine.SETCURRENTKEY("Project No.","Plot No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Project No." = '') OR ("Plot No." = '') THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Project No.", "Plot No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine."Plot No." <> "Plot No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Project No." <> "Project No.") OR (lvCommentLine."Plot No." <> "Plot No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE InwardProcComment@1100485014(VAR CommentLine@1100485000 : Record 11020354);
    VAR
      lvCommentLine@1100525000 : Record 11020354;
    BEGIN
      CommentLine.SETCURRENTKEY("Job No.",Element,"Receipt No.","Receipt Line","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Job No." + Element + "Receipt No.") = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Job No.", Element, "Receipt No.", "Receipt Line", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Job No." <> "Job No.") OR (lvCommentLine. Element <>  Element) OR
               (lvCommentLine."Receipt No." <> "Receipt No.") OR (lvCommentLine."Receipt Line" <> "Receipt Line")
            THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Job No." <> "Job No.") OR (lvCommentLine. Element <>  Element) OR
                   (lvCommentLine."Receipt No." <> "Receipt No.") OR (lvCommentLine."Receipt Line" <> "Receipt Line")
                    THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE InterActLogCommentLine@1100525004(VAR CommentLine@1210190000 : Record 11072067);
    BEGIN
      CommentLine.SETCURRENTKEY("Entry No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;

        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,Code,Code,'','');
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,0T,Code,Code,'','');

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;
        DeleteTempFile;
      END;
    END;

    PROCEDURE ImplIssueLine@1210190012(VAR CommentLine@1100525000 : Record 11125355);
    VAR
      lvCommentLine@1100525001 : Record 11125355;
    BEGIN
      // Call 19362
      CommentLine.SETCURRENTKEY("Issue No.","Line No.");
      WITH CommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Issue No." = 0 THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvCommentLine.COPY(CommentLine);
          lvCommentLine.SETCURRENTKEY("Issue No.", "Line No.");  //* Key 1
          IF lvCommentLine.FINDFIRST THEN BEGIN
            IF (lvCommentLine."Issue No." <> "Issue No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvCommentLine.FINDLAST THEN BEGIN
                IF (lvCommentLine."Issue No." <> "Issue No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,0T,'','','',"Modified By");
            Write(Description, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(TODAY,0T,'','','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Description),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          CommentLine."Line Break" := ReadLine;
          GetLine(Description);
          Description := DELCHR(Description, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Description) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            "Modified By" := CurrCreatedBy;
            "Last Date Modified" := TODAY;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ConstructionSpecBidFormText@1100528702(VAR ConstrSpecBidFormRAW@1210190000 : Record 11125672);
    VAR
      ConstrSpecBidFormRAW2@1100525000 : Record 11125672;
    BEGIN
      ConstrSpecBidFormRAW.SETCURRENTKEY("Specification No.",Type,"Line No.");
      WITH ConstrSpecBidFormRAW DO BEGIN
        TextEditorAllowed := TRUE;
        IF ConstrSpecBidFormRAW."Specification No." = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          ConstrSpecBidFormRAW2.COPY(ConstrSpecBidFormRAW);
          ConstrSpecBidFormRAW2.SETCURRENTKEY("Specification No.",Type,"Line No.");  //* Key 1
          IF ConstrSpecBidFormRAW2.FINDFIRST THEN BEGIN
            IF (ConstrSpecBidFormRAW2."Specification No." <> "Specification No.") OR
               (ConstrSpecBidFormRAW2.Type <> Type) THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF ConstrSpecBidFormRAW2.FINDLAST THEN BEGIN
                IF (ConstrSpecBidFormRAW2."Specification No." <> "Specification No.") OR
                   (ConstrSpecBidFormRAW2.Type <> Type) THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;

        Set(Filename, MAXSTRLEN(Text), TRUE, 'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');
          "Line No." += 10000;
          INSERT;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE ServiceUnitPriceLineText@1100525012(ServiceUnitPriceLineText@1100525000 : Record 11071957);
    BEGIN
      ServiceUnitPriceLineText.SETCURRENTKEY("Unit Price Type","Unit Price Code","Index Date",Code,"Line No.");
      WITH ServiceUnitPriceLineText DO BEGIN
        InitProcess();
        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',"Created by");  //C014534.c
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    LOCAL PROCEDURE InitProcess@1100485001();
    BEGIN
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Text Editor Path");

      CreateTempFile;

      ResetCurrDateAndCode;
      CurrCmtCode := '';
      CurrCreatedBy := '';
      SpecialLineChar := '#';
      LineBreakSkipped := FALSE;
    END;

    LOCAL PROCEDURE CreateTempFile@1210190004();
    BEGIN
      Filename := FileMgt.ServerTempFileName('TXT');

      CLEAR(TextFile);
      TextFile.TEXTMODE := TRUE;
      TextFile.CREATE(Filename, TEXTENCODING::Windows); //#T006571.c
    END;

    LOCAL PROCEDURE EditTempFile@1210190011();
    VAR
      OperatingSystemMgt@1100409000 : Codeunit 11012364;
      ReturnCde@1210190000 : Integer;
      ClientFileName@1100525000 : Text[250];
      TempFileName@1100525001 : Text[250];
    BEGIN
      ClientFileName := FileMgt.DownloadTempFile(Filename);
      FileMgt.CheckIfClientFileExists(UserSetup."Text Editor Path");
      ReturnCde := OperatingSystemMgt.ClientShell(
        STRSUBSTNO('"%1"', UserSetup."Text Editor Path"),
        STRSUBSTNO('"%1"', ClientFileName),
        TRUE);
      TempFileName := FileMgt.UploadFileSilent(ClientFileName);
      FILE.ERASE(Filename); // To prevent that RENAME will throw an error.
      FILE.RENAME(TempFileName, Filename);
      FileMgt.DeleteClientFile4PS(ClientFileName, TRUE);
    END;

    LOCAL PROCEDURE DeleteTempFile@1210190009();
    BEGIN
      CLEAR(InputStream);
      FILE.ERASE(Filename);
    END;

    LOCAL PROCEDURE ReadLine@1210190001() LineBreak : Boolean;
    VAR
      Length@1210190000 : Integer;
      TextLn@1100528700 : Text[1024];
      NumbRead@1100528701 : Integer;
      NumbToBeRead@1100528702 : Integer;
    BEGIN
      NumbToBeRead := ROUND(MAXSTRLEN(TextLine2) / 2, 1, '<');

      IF TextLine2 <> '' THEN BEGIN
        IF (STRLEN(TextLine2) < MaxLineLength) AND (NOT EndOfLine) THEN BEGIN
          NumbRead := InputStream.READTEXT(TextLn, NumbToBeRead);
          CurrPos := CurrPos + NumbRead;
          IF NumbRead < NumbToBeRead THEN
            EndOfLine := TRUE;
          TextLine2 := TextLine2 + TextLn;
        END;
        TextLine := TextLine2;
      END ELSE BEGIN
        NumbRead := InputStream.READTEXT(TextLine, NumbToBeRead);
        CurrPos := CurrPos + NumbRead;
        IF NumbRead < NumbToBeRead THEN
          EndOfLine := TRUE;
      END;

      LineBreak := TRUE; // jhoek.240511

      IF STRLEN(TextLine) > MaxLineLength THEN BEGIN
        Length := SplitLength(TextLine);
        IF Length < STRLEN(TextLine) THEN
          LineBreak := FALSE;
        TextLine2 := COPYSTR(TextLine, Length + 1);
        TextLine := COPYSTR(TextLine, 1, Length);
      END ELSE BEGIN
        TextLine2 := '';
        EndOfLine := FALSE;
      END;
    END;

    PROCEDURE Write@1100528700(Text@1100528700 : Text[1024];LineBreak@1100528701 : Boolean);
    BEGIN
      CASE LineBreak OF
        FALSE:
          BEGIN
            //TextFile.WRITE(CharSetConversion.Ascii2Ansi(Text) + ' ');
            TextFile.WRITE(Text + ' '); //#T006571.c
            TextFile.SEEK(TextFile.POS - 2);
            LineBreakSkipped := TRUE;
          END;
        TRUE:
          BEGIN
            //TextFile.WRITE(CharSetConversion.Ascii2Ansi(Text));
            TextFile.WRITE(Text); //#T006571.c
            LineBreakSkipped := FALSE;
          END;
      END;
    END;

    LOCAL PROCEDURE Set@1(FileName@1210190000 : Text[250];NewMaxLineLength@1210190001 : Integer;NewShowStatus@1210190002 : Boolean;StatusText@1210190003 : Text[30]);
    BEGIN
      ShowStatus := NewShowStatus;
      MaxLineLength := NewMaxLineLength;

      //TextFile.OPEN(FileName);
      WHILE NOT TextFile.OPEN(FileName, TEXTENCODING::Windows) DO SLEEP(50); //wait until editor has removed lock on file. //#T006571.c

      TextFile.TEXTMODE := TRUE;
      TextFile.CREATEINSTREAM(InputStream);
      CurrPos := 0;
      EndOfLine := FALSE;

      IF ShowStatus THEN BEGIN
        IF StatusText = '' THEN
          StatusText := 'Reading';
        InitWindow(StatusText);
      END;
    END;

    LOCAL PROCEDURE GetLine@5(VAR NewTextLine@1210190000 : Text[1024]);
    BEGIN
      //NewTextLine := CharSetConversion.Ansi2Ascii(TextLine);
      NewTextLine := TextLine; //#T006571.c
      IF ShowStatus THEN
        UpdateWindow(CurrPos / TextFile.LEN)
    END;

    LOCAL PROCEDURE EndOfFile@3() : Boolean;
    BEGIN
      IF (InputStream.EOS) AND (TextLine2 = '') THEN BEGIN
        TextFile.CLOSE;
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE SplitLength@7(Text@1210190000 : Text[1024]) : Integer;
    VAR
      Pos@1210190001 : Integer;
    BEGIN
      Text := Reverse(COPYSTR(Text,1,MaxLineLength));
      Pos := STRPOS(Text,' ');
      IF Pos = 0 THEN
        Pos := STRPOS(Text,';');
      IF Pos = 0 THEN
        Pos := STRPOS(Text,',');
      IF Pos = 0 THEN
        Pos := MaxLineLength
      ELSE
        Pos := MaxLineLength - Pos + 1;
      EXIT(Pos);
    END;

    LOCAL PROCEDURE Reverse@4(Text1@1210190000 : Text[1024]) : Text[1024];
    VAR
      Text2@1210190001 : Text[250];
      Length@1210190002 : Integer;
      i@1210190003 : Integer;
    BEGIN
      Length := STRLEN(Text1);
      Text2 := '';
      FOR i := 1 TO Length DO
        Text2[i] := Text1[Length - i + 1];
      EXIT(Text2);
    END;

    LOCAL PROCEDURE InitWindow@1210190003(Description@1210190000 : Text[250]);
    BEGIN
      OldTime := TIME;
      OldProgress := 0;
      IF STRLEN(Description) < 15 THEN
        Description := PADSTR(Description,15);
      Window.OPEN(Description + ' @1@@@@@@@@@@@@@');
    END;

    LOCAL PROCEDURE UpdateWindow@1210190002(Progress@1210190000 : Decimal);
    VAR
      NewTime@1210190001 : Time;
    BEGIN
      NewTime := TIME;
      IF NewTime < OldTime THEN
        OldTime := NewTime
      ELSE
        IF TIME - OldTime > 1000 THEN BEGIN
          Progress := ROUND(Progress * 100,1);
          IF Progress <> OldProgress THEN BEGIN
            OldProgress := Progress;
            Window.UPDATE(1,Progress * 100);
          END;
          OldTime := TIME;
        END;
    END;

    LOCAL PROCEDURE CloseWindow@1210190000();
    BEGIN
      Window.CLOSE;
    END;

    LOCAL PROCEDURE ResetCurrDateAndCode@1100485013();
    BEGIN
      //**4PS.so; M17195: text editor must not delete data
      //CurrDate := 0D;
      //CurrTime := 0T;
      //CurrCode := '';
      //**4PS.eo; M17195
      //* Do not make 'CurrCmtCode' empty because this should be filled in each record
      //* Do not make 'CurrCreatedBy' empty because this should be filled in each record
    END;

    PROCEDURE WriteSpecialFieldsToFile@1100485002(IDate@1100485000 : Date;ITime@1100525000 : Time;ICode@1100485001 : Code[20];ICmtCode@1100485004 : Code[20];ILanguageCode@1100525001 : Code[20];ICreatedBy@1100485005 : Code[50]);
    BEGIN
      IF LineBreakSkipped AND
         ((IDate <> CurrDate) OR
          (ITime <> CurrTime) OR
          (ICode <> CurrCode) OR
          (ICmtCode <> CurrCmtCode) OR
          (ILanguageCode <> CurrLanguageCode) OR  //db, 22-05-15
          (ICreatedBy <> CurrCreatedBy))
      THEN BEGIN
        TextFile.WRITE('');
        LineBreakSkipped := FALSE;
      END;
      IF (IDate <> CurrDate) THEN BEGIN
        TextFile.WRITE(
          SpecialLineChar + GetFieldCaption('DATE') + ':' + FORMAT(IDate, 0, 9));
          CurrDate := IDate;
      END;
      IF (ITime <> CurrTime) THEN BEGIN
        TextFile.WRITE(
          SpecialLineChar + GetFieldCaption('TIME CREATED') + ':' + FORMAT(ITime, 0, 9));
        CurrTime := ITime;
      END;
      IF (ICode <> CurrCode) THEN BEGIN
        TextFile.WRITE(SpecialLineChar + GetFieldCaption('CODE') + ':' + ICode);
        CurrCode := ICode;
      END;
      IF (ICmtCode <> CurrCmtCode) THEN BEGIN
        TextFile.WRITE(SpecialLineChar + GetFieldCaption('COMMENT CODE') + ':' + ICmtCode);
        CurrCmtCode := ICmtCode;
      END;
      IF (ILanguageCode <> CurrLanguageCode) THEN BEGIN  //db, 22-05-15
        TextFile.WRITE(SpecialLineChar + GetFieldCaption('LANGUAGE CODE') + ':' + ILanguageCode);
        CurrLanguageCode := ILanguageCode;
      END;
      IF (ICreatedBy <> CurrCreatedBy) THEN BEGIN
        IF ICreatedBy <> '' THEN
          TextFile.WRITE(SpecialLineChar + GetFieldCaption('CREATED BY') + ':' + ICreatedBy);
        CurrCreatedBy := ICreatedBy;
      END;
    END;

    PROCEDURE WriteSpecialFieldsToFileExt@1100485011(IDate@1100485000 : Date;ICode@1100485001 : Code[20];ICreatedBy@1100485005 : Code[50]);
    BEGIN
      IF LineBreakSkipped AND
         ((IDate <> CurrDate) OR
          (ICode <> CurrCode) OR
          (ICreatedBy <> CurrCreatedBy))
      THEN BEGIN
        TextFile.WRITE('');
        LineBreakSkipped := FALSE;
      END;
      IF (IDate <> CurrDate) THEN BEGIN
        IF IDate <> 0D THEN
          TextFile.WRITE(
            SpecialLineChar + GetFieldCaption('DATE') + ':' + FORMAT(IDate, 0, 9));
        CurrDate := IDate;
      END;
      IF (ICode <> CurrCode) THEN BEGIN
        IF ICode <> '' THEN
          TextFile.WRITE(SpecialLineChar + GetFieldCaption('CODE') + ':' + ICode);
        CurrCode := ICode;
      END;
      IF (ICreatedBy <> CurrCreatedBy) THEN BEGIN
        IF ICreatedBy <> '' THEN
          TextFile.WRITE(SpecialLineChar + GetFieldCaption('CREATED BY') + ':' + ICreatedBy);
        CurrCreatedBy := ICreatedBy;
      END;
    END;

    PROCEDURE WriteSpecialFieldsToFileAdv@1100409002(IDate@1100485000 : Date;ITime@1100525000 : Time;IStandardCode@1100485004 : Code[20];ICreatedBy@1100485005 : Code[50];IType@1100409000 : Integer);
    BEGIN
      IF LineBreakSkipped AND
         ((IDate <> CurrDate) OR
          (ITime <> CurrTime) OR
          (IStandardCode <> CurrCmtCode) OR
          (ICreatedBy <> CurrCreatedBy))
      THEN BEGIN
        TextFile.WRITE('');
        LineBreakSkipped := FALSE;
      END;
      IF (IDate <> CurrDate) THEN BEGIN
        TextFile.WRITE(
          SpecialLineChar + GetFieldCaptionAdv('DATE CREATED') + ':' + FORMAT(IDate, 0, 9));
          CurrDate := IDate;
      END;
      IF (ITime <> CurrTime) THEN BEGIN
        IF (ITime <> 0T) THEN
          TextFile.WRITE(
            SpecialLineChar + GetFieldCaptionAdv('TIME CREATED') + ':' + FORMAT(ITime, 0, 9));
        CurrTime := ITime;
      END;
      IF (IStandardCode <> CurrCmtCode) THEN BEGIN
        TextFile.WRITE(SpecialLineChar + GetFieldCaptionAdv('STANDARD TEXT') + ':' + IStandardCode);
        CurrCmtCode := IStandardCode;
      END;
      IF (ICreatedBy <> CurrCreatedBy) THEN BEGIN
        IF ICreatedBy <> '' THEN
          TextFile.WRITE(SpecialLineChar + GetFieldCaptionAdv('CREATED BY') + ':' + ICreatedBy);
        CurrCreatedBy := ICreatedBy;
      END;
      IF (IType <> CurrType) THEN BEGIN
        CASE IType OF
          1:
            TextFile.WRITE(SpecialLineChar + GetFieldCaptionAdv('Type') + ':Internal');
          ELSE
            TextFile.WRITE(SpecialLineChar + GetFieldCaptionAdv('Type') + ':External');
        END;
        CurrType := IType;
      END;
    END;

    PROCEDURE EvaluateSpecialFields@1100485009(VAR IODate@1100485000 : Date;VAR IOTime@1100525001 : Time;VAR IOCode@1100485001 : Code[20];VAR IOCmtCode@1100485009 : Code[20];VAR IOLanguageCode@1100525002 : Code[20];VAR IOCreatedBy@1100485008 : Code[50];IComment@1100485005 : Text[250]) : Boolean;
    VAR
      lvDate@1100485006 : Date;
      lvTime@1100525000 : Time;
      lvMaxFldLen@1100485010 : Integer;
      lvFldCaption@1100485002 : Text[30];
      lvText@1100485007 : Text[100];
    BEGIN
      lvFldCaption := GetFieldCaption('DATE');
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IF EVALUATE(lvDate, COPYSTR(lvText, 1, 10), 9) THEN
          IODate := lvDate;
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaption('TIME CREATED');
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
      //IOTime := TextToTime(COPYSTR(lvText, 1, 10));
        IF EVALUATE(lvTime, COPYSTR(lvText, 1, 10), 9) THEN
          IOTime := lvTime;
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaption('CODE');
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionRec.Code);
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOCode := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaption('COMMENT CODE');
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionRec."Comment Code");
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOCmtCode := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaption('LANGUAGE CODE');  //db, 22-05-15
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionRec."Language Code");
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOLanguageCode := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaption('CREATED BY');
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionRec."Created by");
      IF COPYSTR(IComment,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IComment, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOCreatedBy := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      IF IOCreatedBy = '' THEN IOCreatedBy := USERID;
      EXIT(FALSE);
    END;

    PROCEDURE EvaluateSpecialFieldsAdv@1100409004(VAR IODate@1100485000 : Date;VAR IOTime@1100525001 : Time;VAR IOStandardCode@1100485009 : Code[20];VAR IOCreatedBy@1100485008 : Code[50];VAR IOType@1100409000 : Integer;IText@1100485005 : Text[250]) : Boolean;
    VAR
      lvDate@1100485006 : Date;
      lvTime@1100525000 : Time;
      lvMaxFldLen@1100485010 : Integer;
      lvFldCaption@1100485002 : Text[30];
      lvText@1100485007 : Text[100];
    BEGIN
      lvFldCaption := GetFieldCaptionAdv('DATE CREATED');
      IF COPYSTR(IText,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IText, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IF EVALUATE(lvDate, COPYSTR(lvText, 1, 10), 9) THEN
          IODate := lvDate;
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaptionAdv('TIME CREATED');
      IF COPYSTR(IText,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IText, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IF EVALUATE(lvTime, COPYSTR(lvText, 1, 10), 9) THEN
          IOTime := lvTime;
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaptionAdv('STANDARD TEXT');
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionAdv."Standard Text");
      IF COPYSTR(IText,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IText, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOStandardCode := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaptionAdv('CREATED BY');
      lvMaxFldLen := MAXSTRLEN(SpecialFieldCaptionAdv."Created by");
      IF COPYSTR(IText,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IText, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        lvText := DELCHR(lvText, '<>', ' ');
        IOCreatedBy := COPYSTR(lvText, 1, lvMaxFldLen);
        EXIT(TRUE);
      END;

      lvFldCaption := GetFieldCaptionAdv('TYPE');
      IF COPYSTR(IText,1,(STRLEN(lvFldCaption)+2)) = (SpecialLineChar + lvFldCaption + ':') THEN BEGIN
        lvText := COPYSTR(IText, (STRLEN(lvFldCaption)+3), MAXSTRLEN(lvText));
        CASE lvText OF
          'Internal':
            IOType := 1;
          ELSE
            IOType := 0;
        END;
        EXIT(TRUE);
      END;

      IF IOCreatedBy = '' THEN IOCreatedBy := USERID;
      EXIT(FALSE);
    END;

    PROCEDURE GetFieldCaption@1100485010(IFieldName@1100485000 : Code[30]) : Text[30];
    VAR
      lvFldCaption@1100485001 : Text[30];
    BEGIN
      CASE IFieldName OF
        'DATE':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION(Date);
        'CODE':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION(Code);
        'COMMENT CODE':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION("Comment Code");
        'LANGUAGE CODE':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION("Language Code");  //db, 22-05-15
        'CREATED BY':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION("Created by");
        'TIME CREATED':
          lvFldCaption := SpecialFieldCaptionRec.FIELDCAPTION("Time Created");
      END;

      lvFldCaption := DELCHR(lvFldCaption, '<>', ' ');     //* Space in name goes wrong when testing. At Ansi->ASCII something happens with
      lvFldCaption := CONVERTSTR(lvFldCaption, ' ', '-');  //* space (is another character, but it still looks like a space).
      EXIT(lvFldCaption);
    END;

    PROCEDURE GetFieldCaptionAdv@1100409005(IFieldName@1100485000 : Code[30]) : Text[30];
    VAR
      lvFldCaption@1100485001 : Text[30];
    BEGIN
      CASE IFieldName OF
        'DATE CREATED':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION("Date Created");
        'CODE':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION(RecId);
        'COMMENT CODE':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION("Standard Text");
        'CREATED BY':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION("Created by");
        'TIME CREATED':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION("Time Created");
        'TYPE':
          lvFldCaption := SpecialFieldCaptionAdv.FIELDCAPTION(Type);
      END;

      lvFldCaption := DELCHR(lvFldCaption, '<>', ' ');     //* Space in name goes wrong when testing. At Ansi->ASCII something happens with
      lvFldCaption := CONVERTSTR(lvFldCaption, ' ', '-');  //* space (is another character, but it still looks like a space).
      EXIT(lvFldCaption);
    END;

    PROCEDURE TextToTime@19(VarText@1000 : Text[8]) : Time;
    VAR
      VarTime@1001 : Time;
      BaseVarTime@1002 : Time;
      TimeSeparator@1003 : Text[1];
    BEGIN
      BaseVarTime := 111111T;
      TimeSeparator := COPYSTR(FORMAT(BaseVarTime),3,1);
      EVALUATE(VarTime,CONVERTSTR(VarText,':',TimeSeparator));
      EXIT(VarTime);
    END;

    PROCEDURE SalesInvoiceTextLineExt@1100525002(VAR SalesInvoiceTextLineExt@1210190000 : Record 11071878;iReadOnly@1100485000 : Boolean);
    VAR
      lvSalesInvoiceTextLineExt@1100525000 : Record 11071878;
    BEGIN
      //copy of function CommentLine
      WITH SalesInvoiceTextLineExt DO BEGIN
        TextEditorAllowed := TRUE;
        IF ("Field 1" + "Field 2" + "Field 3") = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvSalesInvoiceTextLineExt.COPY(SalesInvoiceTextLineExt);
          lvSalesInvoiceTextLineExt.SETCURRENTKEY(
            "Table Name", "Field 1", "Field 2", "Field 3", "Invoice Type", "Line No.");  //* Key 1
          IF lvSalesInvoiceTextLineExt.FINDFIRST THEN BEGIN
            IF (lvSalesInvoiceTextLineExt."Table Name" <> "Table Name") OR
               (lvSalesInvoiceTextLineExt."Field 1" <> "Field 1") OR
               (lvSalesInvoiceTextLineExt."Field 2" <> "Field 2") OR
               (lvSalesInvoiceTextLineExt."Field 3" <> "Field 3") OR
               (lvSalesInvoiceTextLineExt."Invoice Type" <> "Invoice Type")
            THEN
              TextEditorAllowed := FALSE;

            IF TextEditorAllowed THEN BEGIN
              IF lvSalesInvoiceTextLineExt.FINDLAST THEN BEGIN
                IF (lvSalesInvoiceTextLineExt."Table Name" <> "Table Name") OR
                   (lvSalesInvoiceTextLineExt."Field 1" <> "Field 1") OR
                   (lvSalesInvoiceTextLineExt."Field 2" <> "Field 2") OR
                   (lvSalesInvoiceTextLineExt."Field 3" <> "Field 3") OR
                   (lvSalesInvoiceTextLineExt."Invoice Type" <> "Invoice Type")
                THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
        END;

        TextFile.CLOSE;
        EditTempFile;

        IF NOT iReadOnly THEN BEGIN
          //* Read the temporary file and write the text lines
          DELETEALL(TRUE);
          "Line No." := 0;

          Set(Filename,50,TRUE,'Making lines');
          WHILE NOT EndOfFile DO BEGIN
            SalesInvoiceTextLineExt."Line Break" := ReadLine;
            GetLine(Text);
            Text := DELCHR(Text, '>');
            "Line No." += 10000;
            Date := TODAY;
            "Created by" := USERID;
            INSERT;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE DocumentUpdateText@1100525013(VAR DocumentUpdateText@1100525000 : Record 11229803);
    VAR
      lvDocumentUpdateText@1100525001 : Record 11229803;
    BEGIN
      //Copy of CommentLine
      WITH DocumentUpdateText DO BEGIN
        TextEditorAllowed := TRUE;
        IF "Seq. No." = 0 THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          lvDocumentUpdateText.COPY(DocumentUpdateText);
          DocumentUpdateText.SETCURRENTKEY("Project No.", "Seq. No."); //Key1
          IF lvDocumentUpdateText.FINDFIRST THEN BEGIN
            IF (lvDocumentUpdateText."Project No." <> "Project No.") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvDocumentUpdateText.FINDLAST THEN BEGIN
                IF (lvDocumentUpdateText."Project No." <> "Project No.") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date, "Time Created", '', Code, '', "Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date, "Time Created", '', Code, '', USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;
        DeleteTempFile;
      END;
    END;

    PROCEDURE BreakDescription@1000000006(Description@1000000000 : Text[1024];Length@1000000004 : Integer;WordWrap@1000000002 : Boolean;VAR aDescription@1000000001 : ARRAY [10] OF Text[250]) : Integer;
    VAR
      descid@1000000008 : Integer;
      aWords@1000000009 : ARRAY [100] OF Text[255];
      word@1000000003 : Text[255];
      WordCount@1000000005 : Integer;
      i@1000000006 : Integer;
      p@1000000007 : Integer;
    BEGIN
      FOR i := 1 TO ARRAYLEN(aDescription) DO
        aDescription[i] := '';

      // divide line in words
      word := '';
      WordCount := 0;
      FOR i := 1 TO STRLEN(Description) DO
      BEGIN
        IF (Description[i] <> ' ') THEN
        BEGIN
          word += FORMAT(Description[i]);
        END
        ELSE
        BEGIN
          WordCount += 1;
          aWords[WordCount] := word;
          word := '';
        END;
      END;
      IF (word <> '') THEN
      BEGIN
        WordCount += 1;
        aWords[WordCount] := word;
      END;

      descid := 1;
      FOR i := 1 TO WordCount DO
      BEGIN
        word := aWords[i];
        IF ((aDescription[descid] = '') OR (STRLEN(aDescription[descid] + ' ' + word) < Length)) THEN
        BEGIN
          IF (aDescription[descid] <> '') THEN aDescription[descid] += ' ';
          aDescription[descid] += word;
        END
        ELSE
        BEGIN
          descid += 1;
          aDescription[descid] := word;
        END;

        IF (STRLEN(aDescription[descid]) > Length) THEN
        BEGIN
          p := 1;
          word := aDescription[descid];
          aDescription[descid] := COPYSTR(word, p, Length);
          p += Length;

          WHILE (p < STRLEN(word)) DO
          BEGIN
            descid += 1;
            aDescription[descid] := COPYSTR(word, p, Length);
            p += Length;
          END;
        END;
      END;
      EXIT(descid);
    END;

    PROCEDURE ProjectElementText@1100528602(VAR OProjectElementText@1100528600 : Record 11229796);
    VAR
      ProjectElementText@1100528601 : Record 11229796;
    BEGIN
      WITH OProjectElementText DO BEGIN
        TextEditorAllowed := TRUE;
        IF TextEditorAllowed THEN BEGIN
          ProjectElementText.COPY(OProjectElementText);
          IF ProjectElementText.FINDFIRST THEN BEGIN
            IF (ProjectElementText."Project No." <> "Project No.") OR (ProjectElementText.Element <> Element) THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF ProjectElementText.FINDLAST THEN BEGIN
                IF (ProjectElementText."Project No." <> "Project No.") OR (ProjectElementText.Element <> Element) THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',"Created by");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
          WriteSpecialFieldsToFile(Date,"Time Created",Code,'','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE HourPortalSetupText@1100409001(VAR HourPortalText@1210190000 : Record 11020455);
    VAR
      lvHourPortalText@1100485000 : Record 11020455;
    BEGIN
      WITH HourPortalText DO BEGIN
        TextEditorAllowed := TRUE;

        IF TextEditorAllowed THEN BEGIN
          lvHourPortalText.COPY(HourPortalText);
          lvHourPortalText.SETCURRENTKEY(Table, Code, "Table Line No.", "Line No.");  //* Key 1
          IF lvHourPortalText.FINDFIRST THEN BEGIN
            IF (lvHourPortalText.Table <> Table) OR (lvHourPortalText.Code <> Code) THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF lvHourPortalText.FINDLAST THEN BEGIN
                IF (lvHourPortalText.Table <> Table) OR (lvHourPortalText.Code <> Code) THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,"Time Created",'','','',"Created by");
            Write(Text, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);  // 28509.n
        END ELSE
        WriteSpecialFieldsToFile(TODAY,TIME,'','','',USERID);

        TextFile.CLOSE;
        EditTempFile;

        //* Read the temporary file and write the comment lines
        DELETEALL;
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Text),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Text);
          Text := DELCHR(Text, '>');

          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Text) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            "Created by" := CurrCreatedBy;
            "Time Created" := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
    END;

    PROCEDURE GeneralAdvancedText@1100409000(VAR OGeneralAdvancedText@1100409000 : Record 11072231);
    VAR
      GeneralAdvancedText@1100525000 : Record 11072231;
    BEGIN
      IF (OGeneralAdvancedText."Table No." <= 0) THEN
        EXIT;

      TextEditorAllowed := TRUE;
      GeneralAdvancedText.COPY(OGeneralAdvancedText);
      IF (GeneralAdvancedText.FINDFIRST) THEN BEGIN
        IF (GeneralAdvancedText."Table No." <> OGeneralAdvancedText."Table No.") OR
           (GeneralAdvancedText."Field No." <> OGeneralAdvancedText."Field No.")
        THEN
          TextEditorAllowed := FALSE;
      END;
      IF GeneralAdvancedText.FINDLAST THEN BEGIN
        IF (GeneralAdvancedText."Table No." <> OGeneralAdvancedText."Table No.") OR
           (GeneralAdvancedText."Field No." <> OGeneralAdvancedText."Field No.")
        THEN
          TextEditorAllowed := FALSE;
      END;
      IF (NOT TextEditorAllowed) THEN
        ERROR(Text000);

      InitProcess();

      IF (OGeneralAdvancedText.FINDSET) THEN BEGIN
        REPEAT
          WriteSpecialFieldsToFileAdv(OGeneralAdvancedText."Date Created", OGeneralAdvancedText."Time Created", OGeneralAdvancedText."Standard Text",
            OGeneralAdvancedText."Created by", OGeneralAdvancedText.Type);
          Write(OGeneralAdvancedText.Text, OGeneralAdvancedText."Line Break");
        UNTIL (OGeneralAdvancedText.NEXT = 0);
        WriteSpecialFieldsToFileAdv(TODAY, TIME, '', USERID, 0);
      END ELSE
        WriteSpecialFieldsToFileAdv(OGeneralAdvancedText."Date Created", OGeneralAdvancedText."Time Created", OGeneralAdvancedText."Standard Text",
          USERID, 0);

      TextFile.CLOSE;
      EditTempFile;

      //* Read the temporary file and write the comment lines
      OGeneralAdvancedText.DELETEALL(TRUE);
      OGeneralAdvancedText."Line No." := 0;
      ResetCurrDateAndCode;
      CurrCmtCode := '';
      CurrCreatedBy := '';

      Set(Filename, MAXSTRLEN(OGeneralAdvancedText.Text), TRUE, 'Making lines');
      WHILE (NOT EndOfFile) DO BEGIN
        OGeneralAdvancedText."Line Break" := ReadLine;
        GetLine(OGeneralAdvancedText.Text);
        OGeneralAdvancedText.Text := DELCHR(OGeneralAdvancedText.Text, '>');

        IF (NOT EvaluateSpecialFieldsAdv(CurrDate, CurrTime, CurrCmtCode, CurrCreatedBy, CurrType, OGeneralAdvancedText.Text)) THEN BEGIN
          OGeneralAdvancedText."Line No." += 10000;
          OGeneralAdvancedText."Date Created" := CurrDate;
          OGeneralAdvancedText."Standard Text" := CurrCode;
          OGeneralAdvancedText."Created by" := CurrCreatedBy;
          OGeneralAdvancedText.Type := CurrType;
          OGeneralAdvancedText.INSERT;
          OGeneralAdvancedText."Time Created" := CurrTime;
          OGeneralAdvancedText.MODIFY(TRUE); //Trigger must be fired
          ResetCurrDateAndCode;
        END;
      END;

      DeleteTempFile;
    END;

    PROCEDURE HourAccountingCommentLine@1100294000(VAR HourAccountingCommentLine@1100525000 : Record 11128234);
    VAR
      HourAccountingCommentLine2@1100525001 : Record 11128234;
    BEGIN
      // SESB.I039 ASH 05.07.2013 >>
      WITH HourAccountingCommentLine DO BEGIN
        TextEditorAllowed := TRUE;
        IF FORMAT("Record ID") = '' THEN
          TextEditorAllowed := FALSE;
        IF TextEditorAllowed THEN BEGIN
          HourAccountingCommentLine2.COPY(HourAccountingCommentLine);
          HourAccountingCommentLine2.SETCURRENTKEY("Table Name", "Record ID", "Line No.");
          IF HourAccountingCommentLine2.FINDFIRST THEN BEGIN
            IF FORMAT(HourAccountingCommentLine2."Record ID") <> FORMAT("Record ID") THEN
              TextEditorAllowed := FALSE;
            IF TextEditorAllowed THEN BEGIN
              IF HourAccountingCommentLine2.FINDLAST THEN BEGIN
                IF FORMAT(HourAccountingCommentLine2."Record ID") <> FORMAT("Record ID") THEN
                  TextEditorAllowed := FALSE;
              END;
            END;
          END;
        END;
        IF NOT TextEditorAllowed THEN
          ERROR(Text000);

        InitProcess();

        IF FINDSET THEN BEGIN
          REPEAT
            WriteSpecialFieldsToFile(Date,Time,Code,"Comment Code",'',"Created By");
            Write(Comment, "Line Break");
          UNTIL NEXT = 0;
          WriteSpecialFieldsToFile(TODAY,Time,'','','',USERID);
        END ELSE
          WriteSpecialFieldsToFile(Date,Time,Code,"Comment Code",'',USERID);

        TextFile.CLOSE;
        EditTempFile;

        DELETEALL(TRUE);
        "Line No." := 0;
        ResetCurrDateAndCode;
        CurrCmtCode := '';
        CurrCreatedBy := '';

        Set(Filename,MAXSTRLEN(Comment),TRUE,'Making lines');
        WHILE NOT EndOfFile DO BEGIN
          "Line Break" := ReadLine;
          GetLine(Comment);
          Comment := DELCHR(Comment, '>');
          IF NOT EvaluateSpecialFields(CurrDate,CurrTime,CurrCode,CurrCmtCode,CurrLanguageCode,CurrCreatedBy,Comment) THEN BEGIN
            "Line No." += 10000;
            Date := CurrDate;
            Code := CurrCode;
            "Comment Code" := CurrCmtCode;
            "Created By" := CurrCreatedBy;
            Time := CurrTime;
            INSERT;
            ResetCurrDateAndCode;
          END;
        END;

        DeleteTempFile;
      END;
      // SESB.I039 ASH 05.07.2013 <<
    END;

    PROCEDURE EditBLOBFieldText@1100528300(VAR TempBlob@1100528308 : TEMPORARY Record 99008535;Extension@1100528305 : Text[10]);
    VAR
      UserSetup@1100528300 : Record 91;
      FileManagement@1100528304 : Codeunit 419;
      OperatingSystemMgt@1100528307 : Codeunit 11012364;
      ClientFolderName@1100528302 : Text;
      ClientFileName@1100528303 : Text;
      RetVal@1100528306 : Integer;
    BEGIN
      UserSetup.GET(USERID);
      UserSetup.TESTFIELD("Text Editor Path");

      ClientFolderName := FileManagement.ClientTempFolderName + '\' + FORMAT(DELCHR(CREATEGUID, '<=>', '{}'));
      FileManagement.CreateClientDirectory(ClientFolderName);
      ClientFileName := ClientFolderName + '\' + FORMAT(DELCHR(CREATEGUID, '<=>', '{}')) + '.' + Extension;

      IF (TempBlob.Blob.HASVALUE) THEN
        FileManagement.BLOBExport4PS(TempBlob, ClientFileName, FALSE, TRUE)
      ELSE
        FileManagement.AppendTextLineToClientFile(ClientFileName, ' ');

      RetVal := OperatingSystemMgt.ClientShell(STRSUBSTNO('"%1"', UserSetup."Text Editor Path"),
        STRSUBSTNO('"%1"', ClientFileName), TRUE);
      IF (RetVal < 0) THEN
        ERROR(Text002);

      FileManagement.BLOBImport4PS(TempBlob, ClientFileName, FALSE);
    END;

    BEGIN
    {
      db, 15-09-03: Copy function init/open/close window from codeunit state-indicate (codeunit 101264, version W11.20)
      hs, 29-06-05: Create specific function for Buyer Management.
      db, 27-11-08: time created applied for editor
      hbk, 19-05-10: prevent that editor delete data M17195
      mvos, 12-08-2010: Added function CertificationReminderText
      kk, 05-11-2010: Added function QADeviationText (rfc369)
      db, 22-05-15: save field Language Code in text editor; initialy for CommentLine (Item) and CommentLineGroup (Estimate).

      SESB.I039 Extend no of characters in hour line
         ASH 05.07.2013 Trigger HourAccountingCommentLine added
      4PSSE 2013-12-17: Add the user listed in existing comments to avoid taking ownership of other lines
    }
    END.
  }
}

