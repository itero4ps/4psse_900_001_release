OBJECT Page 11012015 Project Principal
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Project Principal;
    SourceTable=Table11012005;
    DataCaptionFields=Project No.;
    PageType=Card;
    PromotedActionCategoriesML=ENU=New,Process,Report,Mail Documents;
    OnInit=BEGIN
             VATAmountLongLeaseEditable := TRUE;
             SpecificWKAEditable := TRUE;
             WKAEditable := TRUE;
             FixedPriceMethod := TRUE;
             NumberOfPointsEditable := TRUE;
             FixedInstallmentAmountEditable := TRUE;
             ContractAmountEditable := TRUE;
             GenerateInstallmentsEditable := TRUE;
             InstallmentSchemeEditable := TRUE;
           END;

    OnOpenPage=BEGIN
                 ProjSetUp.GET;
               END;

    OnAfterGetRecord=BEGIN
                       SETRANGE(Principal);
                     END;

    OnNewRecord=BEGIN
                  //*32583
                  IF AddFromExtContract THEN BEGIN
                    AddFromExtContract := FALSE;
                    IF (DefaultPrincipal <> '') AND (Principal = '') THEN BEGIN
                      SetSkipCopySalesSurcharges(TRUE);
                      VALIDATE(Principal, DefaultPrincipal);
                      SetSkipCopySalesSurcharges(FALSE);
                    END;
                    FILTERGROUP(7);
                    SETRANGE(Principal);  //* Reset filter in filtergroup 7. Was (extra) set before calling in T11012004 CheckProjectPrincipal
                    FILTERGROUP(0);
                  END;
                END;

    OnAfterGetCurrRecord=VAR
                           RecRef@1100409000 : RecordRef;
                         BEGIN
                           CALCFIELDS("Contact No.", "Bill-to Contact No.");
                           NumAdrs := AdrsRec.CheckAvailableAddress("Bill-to Customer No.", 3);

                           SetEditable;
                           RecRef.GETTABLE(Rec);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetRecordReference(RecRef);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetByCompany(TRUE);
                           CurrPage.RegisterExternalDocumentFB.PAGE.SetDepartmentCode('');
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 59      ;1   ;ActionGroup;
                      Name=PrincipalMenu;
                      CaptionML=ENU=Installments invoicing }
      { 62      ;2   ;Action    ;
                      ShortCutKey=Ctrl+I;
                      CaptionML=ENU=Installments;
                      RunObject=Page 11012025;
                      RunPageView=SORTING(Project No.,Principal,Installment No.);
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Promoted=Yes;
                      Image=AmountByPeriod;
                      PromotedCategory=Process }
      { 1100528800;2 ;Action    ;
                      CaptionML=ENU=Allocation Revenues;
                      RunObject=Page 11125025;
                      RunPageLink=No.=FIELD(Project No.);
                      Image=LedgerEntries }
      { 1100525015;1 ;ActionGroup;
                      CaptionML=ENU=Installment motivation }
      { 1210190012;2 ;Action    ;
                      CaptionML=ENU=Installment &Motivation;
                      RunObject=Page 11012474;
                      RunPageView=SORTING(Project No.,Principal,Production Date);
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Image=PaymentPeriod }
      { 1100525006;2 ;Action    ;
                      CaptionML=ENU=Tender Paragraphs;
                      RunObject=Page 11012470;
                      RunPageView=SORTING(Project No.,Principal,Contract No.,Tender Paragraph OLD,No.);
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal),
                                  Contract No.=FILTER('');
                      Image=Payment }
      { 63      ;2   ;Action    ;
                      CaptionML=ENU=Plots;
                      RunObject=Page 11012505;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Promoted=Yes;
                      Image=AddToHome;
                      PromotedCategory=Process }
      { 1100485024;2 ;Action    ;
                      CaptionML=ENU=Installment &Overview;
                      Image=AmountByPeriod;
                      OnAction=VAR
                                 lvInstOverviewFrm@1100485000 : Page 11020557;
                                 lvInstOverviewRec@1100485001 : Record 11012265;
                                 lvProjectRec@1100485003 : Record 11072003;
                               BEGIN
                                 IF lvProjectRec.GET("Project No.") THEN
                                   IF NOT lvProjectRec.RAW THEN
                                     ERROR(Text002);

                                 lvInstOverviewRec.SETRANGE("Project No.", "Project No.");
                                 lvInstOverviewRec.SETRANGE(Principal, Principal);
                                 IF lvInstOverviewRec.FINDLAST THEN;
                                 lvInstOverviewFrm.SETTABLEVIEW(lvInstOverviewRec);
                                 lvInstOverviewFrm.RUNMODAL;
                               END;
                                }
      { 1100525018;1 ;ActionGroup;
                      CaptionML=ENU=Cost Plus Invoicing }
      { 65      ;2   ;Action    ;
                      CaptionML=ENU=Commisions;
                      RunObject=Page 11012045;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Promoted=Yes;
                      Image=ServiceAgreement;
                      PromotedCategory=Process }
      { 1100525010;2 ;ActionGroup;
                      CaptionML=ENU=Hour Rates & Surcharges;
                      Image=SalesPrices }
      { 61      ;3   ;Action    ;
                      CaptionML=ENU=Hour Rates;
                      RunObject=Page 11012053;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Image=SalesPrices }
      { 1100485013;3 ;Action    ;
                      CaptionML=ENU=Cost Object Prices;
                      RunObject=Page 11020302;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal No.=FIELD(Principal);
                      Image=SalesPrices }
      { 1100485035;3 ;Action    ;
                      CaptionML=ENU=Surcharges;
                      RunObject=Page 11072426;
                      RunPageLink=Record Type=CONST(ProjCust),
                                  Customer No.=FIELD(Principal),
                                  Code=FIELD(Project No.);
                      Image=SalesPrices }
      { 1100525114;3 ;Action    ;
                      CaptionML=ENU=Project Cost Plus Surcharges;
                      Image=InsertStartingFee;
                      OnAction=VAR
                                 ProjSurchargeForm@1100525001 : Page 11072598;
                                 ProjectCostPlusSurcharge@1100525000 : Record 11020561;
                               BEGIN
                                 ProjectCostPlusSurcharge.FILTERGROUP(10);
                                 ProjectCostPlusSurcharge.SETRANGE(Level, ProjectCostPlusSurcharge.Level::"Project Principal");
                                 ProjectCostPlusSurcharge.SETRANGE("Project No.", "Project No.");
                                 ProjectCostPlusSurcharge.SETRANGE(Principal, Principal);
                                 ProjectCostPlusSurcharge.FILTERGROUP(0);
                                 ProjectCostPlusSurcharge.Level := ProjectCostPlusSurcharge.Level::"Project Principal";
                                 ProjSurchargeForm.SETTABLEVIEW(ProjectCostPlusSurcharge);
                                 ProjSurchargeForm.SETRECORD(ProjectCostPlusSurcharge);
                                 ProjSurchargeForm.RUNMODAL;
                               END;
                                }
      { 1100525021;1 ;ActionGroup;
                      CaptionML=ENU=Unit Price }
      { 1210190023;2 ;Action    ;
                      CaptionML=ENU=Unit Price Production Motivation;
                      Image=CostCenter;
                      OnAction=VAR
                                 ProdMot@1210190000 : Record 11020425;
                               BEGIN
                                 ProdMot.RunUnitPriceProdMotList("Project No.", Principal, 1);  //* Level 1=Project Principal
                               END;
                                }
      { 1100525020;1 ;ActionGroup;
                      CaptionML=ENU=Risk regulation;
                      Image=ApplyEntries }
      { 1100485026;2 ;Action    ;
                      CaptionML=ENU=Risk Regulation;
                      RunObject=Page 11071826;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Image=ApplyEntries }
      { 1100485025;2 ;Action    ;
                      CaptionML=ENU=Project Cost Components;
                      RunObject=Page 11071822;
                      RunPageLink=Project No.=FIELD(Project No.),
                                  Principal=FIELD(Principal);
                      Image=ItemTrackingLedger }
      { 1100525013;1 ;ActionGroup;
                      CaptionML=ENU=Documents;
                      Image=Documents }
      { 1210190021;2 ;Action    ;
                      CaptionML=ENU=&Documents;
                      Image=Documents;
                      OnAction=VAR
                                 RecRef@1210190001 : RecordRef;
                                 DocumentFilters@1210190000 : Codeunit 11012432;
                               BEGIN
                                 RecRef.GETTABLE(Rec);
                                 DocumentFilters.CreateTempFilterAndExecute1(RecRef, '', FALSE, TRUE);
                               END;
                                }
      { 1100525026;2 ;Action    ;
                      CaptionML=ENU=Text Lines Installment Invoice;
                      RunObject=Page 11126497;
                      RunPageView=SORTING(Table Name,Field 1,Field 2,Field 3,Invoice Type,Line No.)
                                  WHERE(Table Name=CONST(ProjectPrincipal),
                                        Invoice Type=CONST(Installment));
                      RunPageLink=Field 1=FIELD(Project No.),
                                  Field 2=FIELD(Principal);
                      Image=Text }
      { 1100525025;2 ;Action    ;
                      CaptionML=ENU=Text Lines Cost Plus Invoice;
                      RunObject=Page 11126497;
                      RunPageView=SORTING(Table Name,Field 1,Field 2,Field 3,Invoice Type,Line No.)
                                  WHERE(Table Name=CONST(ProjectPrincipal),
                                        Invoice Type=CONST(CostPlus));
                      RunPageLink=Field 1=FIELD(Project No.),
                                  Field 2=FIELD(Principal);
                      Image=Text }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 66      ;1   ;ActionGroup;
                      CaptionML=ENU=Invoice }
      { 67      ;2   ;Action    ;
                      CaptionML=ENU=Generate Installments;
                      Promoted=Yes;
                      Image=CopyFromTask;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 CLEAR(GenerateProjInstallm);
                                 GenerateProjInstallm.FromPrincipal("Project No.",Principal);
                               END;
                                }
      { 1100525023;2 ;Action    ;
                      CaptionML=ENU=Recalculate Contract Amount (LCY);
                      Image=Recalculate;
                      OnAction=VAR
                                 ProjPrincipRec@1100525000 : Record 11012005;
                                 ProjInstalmRec@1100525001 : Record 11012018;
                               BEGIN
                                 ProjInstalmRec.SETRANGE("Project No.", "Project No.");
                                 IF ProjInstalmRec.FINDSET THEN BEGIN
                                   REPEAT
                                     ProjInstalmRec.CALCFIELDS("Invoice in Process","Invoiced Price");
                                     IF (ProjInstalmRec."Installment Amount" <> 0) AND (ProjInstalmRec."Invoice in Process" = 0) AND
                                        (ProjInstalmRec."Invoiced Price" = 0) THEN
                                     ProjInstalmRec.VALIDATE("Installment Amount");
                                     ProjInstalmRec.MODIFY;
                                   UNTIL ProjInstalmRec.NEXT = 0;
                                 END;

                                 ProjPrincipRec.SETRANGE("Project No.", "Project No.");
                                 IF ProjPrincipRec.FINDSET THEN BEGIN
                                   REPEAT
                                     ProjPrincipRec.VALIDATE("Contract Amount");
                                     ProjPrincipRec.MODIFY;
                                   UNTIL ProjPrincipRec.NEXT = 0;
                                 END;
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100525011;2 ;Action    ;
                      CaptionML=ENU=Generate Tender Paragraphs by Principal;
                      Image=Payment;
                      OnAction=BEGIN
                                 GenerateTenderParagraphs;
                               END;
                                }
      { 1100528801;2 ;Action    ;
                      CaptionML=ENU=Generate Allocation Revenues;
                      Image=LedgerEntries;
                      OnAction=VAR
                                 Proj@1100528801 : Record 11072003;
                               BEGIN
                                 Proj.SETRANGE("No.","Project No.");
                                 REPORT.RUNMODAL(REPORT::"Divide Revenues by Allocation", TRUE, TRUE, Proj);
                               END;
                                }
      { 1100285502;2 ;Action    ;
                      Name=<Action1100285000>;
                      CaptionML=ENU=ROT Reduction;
                      Promoted=Yes;
                      Image=AmountByPeriod;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ROTInformation@1100285000 : Record 11128101;
                                 ROTInformationPage@1100285001 : Page 11128101;
                               BEGIN
                                 // Check if there is any ROT related to the current record
                                 ROTInformation.RESET();
                                 ROTInformation.SETRANGE(Type, ROTInformation.Type::Project);
                                 ROTInformation.SETRANGE("Document No.", "Project No.");
                                 ROTInformation.SETRANGE("Project Principle", Principal);

                                 // Set the page view and open ROT Information page.
                                 ROTInformationPage.SETTABLEVIEW(ROTInformation);
                                 ROTInformationPage.RUN;
                               END;
                                }
      { 1100294003;2 ;Action    ;
                      Name=<Action1100294003>;
                      CaptionML=ENU=Calculate Final Installment;
                      Promoted=Yes;
                      Image=CopyFromTask;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 // SESB.I022 KD 18.07.2013 >>
                                 CLEAR(GenerateProjInstallm);
                                 GenerateProjInstallm.CalcFinalInstalmentPrincipal("Project No.",Principal);
                                 // SESB.I022 KD 18.07.2013 <<
                               END;
                                }
      { 1100525008;1 ;ActionGroup;
                      CaptionML=ENU=Documents }
      { 68      ;2   ;ActionGroup;
                      CaptionML=ENU=Edit Word Documents;
                      Image=Word }
      { 1210190020;3 ;Action    ;
                      CaptionML=ENU=Installment Scheme;
                      Image=Word;
                      OnAction=VAR
                                 Contact@1210190002 : Record 5050;
                                 DocumentTemplate@1210190000 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::Installment), Contact."No.", "Contact Person No.", FALSE, '');
                               END;
                                }
      { 69      ;3   ;Action    ;
                      CaptionML=ENU=Congratulation Letter;
                      Image=Word;
                      OnAction=VAR
                                 Contact@1210190002 : Record 5050;
                                 DocumentTemplate@1210190001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::"Congratulation Letter"), Contact."No.", "Contact Person No.", FALSE, '');
                               END;
                                }
      { 70      ;3   ;Action    ;
                      CaptionML=ENU=Invitation;
                      Image=Word;
                      OnAction=VAR
                                 Contact@1210190002 : Record 5050;
                                 DocumentTemplate@1210190001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::"Invitation Meeting"), Contact."No.", "Contact Person No.", FALSE, '');
                               END;
                                }
      { 71      ;3   ;Action    ;
                      CaptionML=ENU=Delivery Form;
                      Image=Word;
                      OnAction=VAR
                                 Contact@1210190002 : Record 5050;
                                 DocumentTemplate@1210190001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::"Delivery Form"), Contact."No.", "Contact Person No.", FALSE, '');
                               END;
                                }
      { 1100525003;3 ;Action    ;
                      CaptionML=ENU=Project Documents;
                      Image=Word;
                      OnAction=VAR
                                 Contact@1210190002 : Record 5050;
                                 DocumentTemplate@1210190001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN
                                   EditDocuments(STRSUBSTNO('%1', DocumentTemplate.Type::Job), Contact."No.", "Contact Person No.", FALSE, '');
                               END;
                                }
      { 1100525000;2 ;ActionGroup;
                      CaptionML=ENU=Mail Documents;
                      ActionContainerType=NewDocumentItems;
                      Image=MailAttachment }
      { 1100525001;3 ;Action    ;
                      CaptionML=ENU=Principal;
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100525003 : Record 5050;
                                 Customer@1100525002 : Record 18;
                                 DocumentTemplate@1100525001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN BEGIN
                                   Customer.GET(Principal);
                                   EditDocuments(
                                     STRSUBSTNO('%1|%2|%3|%4|%5',
                                       DocumentTemplate.Type::Job,
                                       DocumentTemplate.Type::Installment,
                                       DocumentTemplate.Type::"Delivery Form",
                                       DocumentTemplate.Type::"Congratulation Letter",
                                       DocumentTemplate.Type::"Invitation Meeting"),
                                     Contact."No.", '', TRUE, Customer."E-Mail");
                                 END;
                               END;
                                }
      { 1100525004;3 ;Action    ;
                      CaptionML=ENU=Contact Person;
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100525003 : Record 5050;
                                 Contact2@1100525002 : Record 5050;
                                 DocumentTemplate@1100525001 : Record 11012401;
                               BEGIN
                                 TESTFIELD(Principal);
                                 TESTFIELD("Contact Person No.");
                                 IF Contact.GetContactByCustomer(Principal, Contact, TRUE) THEN BEGIN
                                   IF Contact2.GET("Contact Person No.") THEN
                                     EditDocuments(
                                       STRSUBSTNO('%1|%2|%3|%4|%5',
                                         DocumentTemplate.Type::Job,
                                         DocumentTemplate.Type::Installment,
                                         DocumentTemplate.Type::"Delivery Form",
                                         DocumentTemplate.Type::"Congratulation Letter",
                                         DocumentTemplate.Type::"Invitation Meeting"),
                                       Contact."No.", Contact2."No.", TRUE, Contact2."E-Mail");
                                 END;
                               END;
                                }
      { 1100525005;3 ;Action    ;
                      CaptionML=ENU=Bill-to Customer;
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100525003 : Record 5050;
                                 Customer@1100525002 : Record 18;
                                 DocumentTemplate@1100525001 : Record 11012401;
                               BEGIN
                                 TESTFIELD("Bill-to Customer No.");
                                 IF Contact.GetContactByCustomer("Bill-to Customer No.", Contact, TRUE) THEN BEGIN
                                   Customer.GET("Bill-to Customer No.");
                                   EditDocuments(
                                     STRSUBSTNO('%1|%2|%3|%4|%5',
                                       DocumentTemplate.Type::Job,
                                       DocumentTemplate.Type::Installment,
                                       DocumentTemplate.Type::"Delivery Form",
                                       DocumentTemplate.Type::"Congratulation Letter",
                                       DocumentTemplate.Type::"Invitation Meeting"),
                                     Contact."No.", '', TRUE, Customer."E-Mail");
                                 END;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=ENU=General }

    { 2   ;2   ;Field     ;
                SourceExpr=Principal;
                OnValidate=BEGIN
                             PrincipalOnAfterValidate;
                           END;
                            }

    { 10  ;2   ;Field     ;
                SourceExpr="Principal Name";
                Importance=Promoted;
                OnValidate=BEGIN
                             CALCFIELDS("Contact No.", "Bill-to Contact No.");
                           END;
                            }

    { 1100485010;2;Field  ;
                SourceExpr="Contact Person No." }

    { 1100485014;2;Field  ;
                SourceExpr="Contact Person Name";
                Importance=Standard }

    { 1100525017;2;Field  ;
                SourceExpr="Order No. Customer" }

    { 1100485006;2;Field  ;
                SourceExpr="Order Date" }

    { 6   ;2   ;Field     ;
                SourceExpr="Settlement Method";
                Importance=Promoted;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 1100525019;2;Field  ;
                SourceExpr="Currency Code";
                Importance=Additional }

    { 5   ;2   ;Field     ;
                SourceExpr="Contract Amount";
                Importance=Promoted;
                Editable=ContractAmountEditable }

    { 4   ;2   ;Field     ;
                SourceExpr="Contract Amount (LCY)";
                Importance=Additional;
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Plot Price";
                Importance=Additional;
                Editable=ContractAmountEditable }

    { 1100525031;2;Field  ;
                SourceExpr="Estimated Amount";
                Importance=Additional;
                Editable=EstimatedAmountEditable }

    { 1100525033;2;Field  ;
                SourceExpr="Estimate Date";
                Importance=Additional;
                Editable=EstimateDateEditable }

    { 52  ;2   ;Field     ;
                SourceExpr="Installments per Plot";
                Importance=Additional;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 11  ;2   ;Field     ;
                SourceExpr="Meeting Date";
                Importance=Additional }

    { 13  ;2   ;Field     ;
                SourceExpr="Meeting Time";
                Importance=Additional }

    { 15  ;2   ;Field     ;
                SourceExpr="Principal Reference";
                Importance=Additional;
                OnLookup=VAR
                           lvCommissionRec@1100485000 : Record 11012020;
                         BEGIN
                           //**4PS01.sn
                           lvCommissionRec.FILTERGROUP(6);
                           lvCommissionRec.SETRANGE("Project No.", "Project No.");
                           lvCommissionRec.SETRANGE(Principal, Principal);
                           lvCommissionRec.FILTERGROUP(0);
                           lvCommissionRec."Project No." := "Project No.";
                           lvCommissionRec.Principal := Principal;
                           IF (STRLEN("Principal Reference") <= MAXSTRLEN(lvCommissionRec."No.")) THEN
                             lvCommissionRec."No." := "Principal Reference";
                           IF PAGE.RUNMODAL(PAGE::"Commission List", lvCommissionRec) = ACTION::LookupOK THEN
                             "Principal Reference" := lvCommissionRec."No.";
                           //**4PS01.en
                         END;
                          }

    { 1100485029;2;Field  ;
                SourceExpr=Adviser;
                Importance=Additional }

    { 1100525002;2;Field  ;
                SourceExpr="Name Adviser";
                Importance=Additional;
                Editable=FALSE }

    { 1905885101;1;Group  ;
                CaptionML=ENU=Invoicing }

    { 50  ;2   ;Field     ;
                SourceExpr="Generate Installments";
                Editable=GenerateInstallmentsEditable;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 46  ;2   ;Field     ;
                SourceExpr="Installment Scheme";
                Editable=InstallmentSchemeEditable }

    { 48  ;2   ;Field     ;
                SourceExpr="Installments Generated";
                Editable=FALSE }

    { 44  ;2   ;Field     ;
                SourceExpr="Generation Date";
                Importance=Additional;
                Editable=FALSE }

    { 1100294000;2;Field  ;
                OptionCaptionML=ENU=" ,,,Final Instalment";
                SourceExpr="Method Last Installment";
                OnValidate=BEGIN
                             SetWithheldPercEditable; // SESB.I022 KD 17.07.2013
                           END;
                            }

    { 1100294001;2;Field  ;
                SourceExpr="Withheld Perc. Final Installm.";
                Editable=WithheldPercEditable }

    { 1100294002;2;Field  ;
                SourceExpr="Withheld Perc. Contract Amount";
                Editable=WithheldPercEditable }

    { 42  ;2   ;Field     ;
                SourceExpr="Cost Plus Customer";
                Importance=Additional;
                OnValidate=BEGIN
                             CurrPage.SAVERECORD;
                           END;
                            }

    { 1100485008;2;Field  ;
                SourceExpr="VAT Bus. Posting Group";
                Importance=Standard }

    { 40  ;2   ;Field     ;
                SourceExpr="VAT Prod. Posting Group";
                Importance=Standard }

    { 1100485033;2;Field  ;
                SourceExpr="VAT Amount Long Lease";
                Importance=Additional;
                Editable=VATAmountLongLeaseEditable }

    { 38  ;2   ;Field     ;
                SourceExpr="Cost Object";
                LookupPageID=Cost Object List }

    { 1100525014;2;Field  ;
                SourceExpr="Bill-to Customer No.";
                Importance=Additional;
                OnValidate=BEGIN
                             NumAdrs := AdrsRec.CheckAvailableAddress("Bill-to Customer No.", 3);
                             CALCFIELDS("Contact No.", "Bill-to Contact No.");
                           END;
                            }

    { 1100485021;2;Field  ;
                CaptionML=ENU=Alternative invoice addresses;
                SourceExpr=NumAdrs;
                Importance=Additional;
                Editable=FALSE }

    { 25  ;2   ;Field     ;
                SourceExpr="Alternative Bill-to Address";
                Importance=Additional }

    { 1100485017;2;Field  ;
                SourceExpr="Bill-to Contact Person";
                Importance=Additional }

    { 1100485002;2;Field  ;
                SourceExpr="Specific WKA Percentages";
                Importance=Standard;
                Editable=WKAEditable;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 1100485003;2;Field  ;
                SourceExpr="% Labor";
                Importance=Standard;
                Editable=[SpecificWKAEditable ] }

    { 1100485004;2;Field  ;
                SourceExpr="% to B Account";
                Importance=Standard;
                Editable=[SpecificWKAEditable ] }

    { 1100485015;2;Field  ;
                SourceExpr="WKA Period";
                Importance=Additional;
                Editable=WKAEditable }

    { 1100485022;2;Field  ;
                SourceExpr="Collect Installment Invoice By";
                Importance=Additional }

    { 1210190013;2;Field  ;
                SourceExpr="Public notary";
                Importance=Additional }

    { 1100525016;2;Field  ;
                CaptionML=ENU=Do not delete;
                SourceExpr="Bill-to Contact No.";
                CaptionClass=FORMAT ("Bill-to Contact Person Name");
                Visible=FALSE }

    { 1210190024;2;Field  ;
                CaptionML=ENU=Special Payment Terms Code;
                SourceExpr="Payment Terms Code";
                Importance=Additional }

    { 1100485020;2;Field  ;
                SourceExpr="Bill-to Contact Person Name";
                Importance=Additional }

    { 1210190015;2;Field  ;
                SourceExpr="Withhold %";
                Importance=Additional }

    { 1210190017;2;Field  ;
                SourceExpr="Notary Case Number";
                Importance=Additional }

    { 1100485027;2;Field  ;
                SourceExpr="Raise % Settlement Price";
                Importance=Additional }

    { 1100525030;2;Field  ;
                SourceExpr="Price List" }

    { 1100525029;2;Field  ;
                SourceExpr="Ref. Date Unit Price" }

    { 1100409100;2;Field  ;
                SourceExpr="Payment Method Code (Inv.)" }

    { 1100529000;2;Field  ;
                SourceExpr="Direct Debit Mandate ID" }

    { 1100285000;2;Field  ;
                SourceExpr="Cost Price Behaviour" }

    { 37  ;2   ;Group     ;
                CaptionML=ENU=Sales Surcharges Cost Plus Entries;
                GroupType=Group }

    { 35  ;3   ;Field     ;
                SourceExpr="Surcharge % Labor";
                Importance=Additional }

    { 33  ;3   ;Field     ;
                SourceExpr="Surcharge % Material";
                Importance=Additional }

    { 31  ;3   ;Field     ;
                SourceExpr="Surcharge % Subcontr.";
                Importance=Additional }

    { 29  ;3   ;Field     ;
                SourceExpr="Surcharge % Plant";
                Importance=Additional }

    { 27  ;3   ;Field     ;
                SourceExpr="Surcharge % Sundry";
                Importance=Additional }

    { 1905680101;1;Group  ;
                CaptionML=ENU=Invoice Text }

    { 54  ;2   ;Field     ;
                SourceExpr="Invoice Text Installments";
                MultiLine=Yes }

    { 56  ;2   ;Field     ;
                SourceExpr="Invoice Text Cost Plus";
                MultiLine=Yes }

    { 1901849101;1;Group  ;
                CaptionML=ENU=Installment Motivation }

    { 1210190000;2;Field  ;
                SourceExpr="Installm.Motivation Method";
                Editable=FixedPriceMethod;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 1210190002;2;Field  ;
                SourceExpr="Number of Points";
                Editable=NumberOfPointsEditable }

    { 1210190004;2;Field  ;
                SourceExpr="Invoice Installm.Motivation as";
                Editable=FixedPriceMethod;
                OnValidate=BEGIN
                             SetEditable;
                           END;
                            }

    { 1210190006;2;Field  ;
                SourceExpr="Fixed Installment Amount (LCY)";
                Importance=Additional;
                Editable=FixedInstallmentAmountEditable }

    { 1100528700;2;Field  ;
                SourceExpr="Direct Settle Underrun Settlin" }

    { 1100525027;2;Field  ;
                SourceExpr="Direct Settle Underrun" }

    { 1100525028;2;Field  ;
                SourceExpr="Fictitious Amount Open (LCY)";
                Importance=Additional }

    { 1100525007;2;Field  ;
                SourceExpr="Tender Paragraph Scheme" }

    { 1100525009;2;Field  ;
                SourceExpr="Quantity (Tender Paragraph)" }

    { 1100525012;2;Field  ;
                SourceExpr="Unit of Measure (Tender Par)" }

    { 1100409000;1;Group  ;
                CaptionML=ENU=Cost prices;
                GroupType=Group }

    { 1100409003;2;Group  ;
                GroupType=Group }

    { 1100409001;3;Field  ;
                SourceExpr="CostSurcharge % Labor";
                Enabled="Cost Price Behaviour" }

    { 1100409002;3;Field  ;
                SourceExpr="CostSurcharge % Material";
                Enabled="Cost Price Behaviour" }

    { 1100409004;3;Field  ;
                SourceExpr="CostSurcharge % Subcontr.";
                Enabled="Cost Price Behaviour" }

    { 1100409005;3;Field  ;
                SourceExpr="CostSurcharge % Plant";
                Enabled="Cost Price Behaviour" }

    { 1100409006;3;Field  ;
                SourceExpr="CostSurcharge % Sundry";
                Enabled="Cost Price Behaviour" }

    { 1100525032;2;Field  ;
                SourceExpr="Fixed Installment Amount (FCY)";
                Editable=FixedInstallmentAmountEditable }

    { 1100525034;2;Field  ;
                SourceExpr="Fictitious Amount Open (FCY)" }

    { 1210190001;0;Container;
                ContainerType=FactBoxArea }

    { 1100529900;1;Part   ;
                Name=RegisterExternalDocumentFB;
                PagePartID=Page11125053;
                PartType=Page }

    { 1210190003;1;Part   ;
                SubPageLink=Project No.=FIELD(Project No.),
                            Principal=FIELD(Principal);
                PagePartID=Page11130104;
                PartType=Page }

    { 1100525024;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1100525022;1;Part   ;
                PartType=System;
                SystemPartID=Notes }

  }
  CODE
  {
    VAR
      ProjSetUp@11012000 : Record 315;
      GenerateProjInstallm@11012004 : Codeunit 11012007;
      AddFromExtContract@1210190000 : Boolean;
      AdrsRec@1100485000 : Record 222;
      DefaultPrincipal@1210190001 : Code[20];
      NumAdrs@1100485001 : Text[30];
      Text002@1100485002 : TextConst 'ENU=Installment Overview can only be used for RAW projects';
      InstallmentSchemeEditable@19016292 : Boolean INDATASET;
      GenerateInstallmentsEditable@19053430 : Boolean INDATASET;
      ContractAmountEditable@19002386 : Boolean INDATASET;
      FixedInstallmentAmountEditable@19012693 : Boolean INDATASET;
      NumberOfPointsEditable@19068569 : Boolean INDATASET;
      WKAEditable@19049375 : Boolean INDATASET;
      SpecificWKAEditable@1100525000 : Boolean INDATASET;
      FixedPriceMethod@1100525001 : Boolean INDATASET;
      VATAmountLongLeaseEditable@19069504 : Boolean INDATASET;
      WithheldPercEditable@1100294000 : Boolean INDATASET;
      EstimatedAmountEditable@1100525002 : Boolean INDATASET;
      EstimateDateEditable@1100525003 : Boolean INDATASET;

    PROCEDURE SetAddPrincipalFromExtContract@1210190000(NewPrincipal@1210190000 : Code[20]);
    BEGIN
      //*32583
      AddFromExtContract := TRUE;
      DefaultPrincipal := NewPrincipal;
    END;

    LOCAL PROCEDURE PrincipalOnAfterValidate@19057551();
    BEGIN
      CALCFIELDS("Principal Name");
    END;

    PROCEDURE SetEditable@1100525000();
    VAR
      lProjRec@1100525000 : Record 11072003;
    BEGIN
      IF lProjRec.GET("Project No.") THEN;

      IF lProjRec."Contract Type" = lProjRec."Contract Type"::Subcontracting THEN BEGIN
        WKAEditable := TRUE;
        SpecificWKAEditable := "Specific WKA Percentages";
      END ELSE BEGIN
        WKAEditable := FALSE;
        SpecificWKAEditable := FALSE;
      END;

      CALCFIELDS("Settlement Method");
      IF "Settlement Method" = "Settlement Method"::"Fixed Price" THEN BEGIN
        FixedPriceMethod := TRUE;
        FixedInstallmentAmountEditable :=
          ("Invoice Installm.Motivation as" = "Invoice Installm.Motivation as"::"Fixed Installment Amounts");
        NumberOfPointsEditable :=
          ("Installm.Motivation Method" = "Installm.Motivation Method"::Points);

        IF NOT "Installments per Plot" THEN BEGIN
          ContractAmountEditable := TRUE;
          InstallmentSchemeEditable := ("Generate Installments" AND NOT "Installments Generated");
          GenerateInstallmentsEditable := NOT "Installments Generated";
          VATAmountLongLeaseEditable := lProjRec."Long Lease";
        END;

      END ELSE BEGIN
        FixedPriceMethod := FALSE;
        FixedInstallmentAmountEditable := FALSE;
        NumberOfPointsEditable := FALSE;
        ContractAmountEditable := FALSE;
        InstallmentSchemeEditable := FALSE;
        GenerateInstallmentsEditable := FALSE;
        VATAmountLongLeaseEditable := FALSE;

      SetWithheldPercEditable; // SESB.I022 KD 17.07.2013
      END;
      EstimatedAmountEditable := ("Settlement Method" = "Settlement Method"::"Cost Plus");
      EstimateDateEditable := (("Settlement Method" = "Settlement Method"::"Cost Plus") OR ("Estimate Date" <> 0D));
    END;

    LOCAL PROCEDURE SetWithheldPercEditable@1100294000();
    BEGIN
      WithheldPercEditable := "Method Last Installment" = "Method Last Installment"::"Final Installment"; // SESB.I022 KD 22.07.2013
    END;

    BEGIN
    {
      SESB.I022 Final Instalment
         KD 17.07.2013 Control "Method Last Installment" added on tab Invoicicng
         KD 17.07.2013 Control "Withheld Perc. Final Instalm." added on tab Invoicicng
         KD 17.07.2013 Control "Withheld Perc. Contract Amount" added on tab Invoicicng
         KD 17.07.2013 Trigger SetEditable changed
         KD 18.07.2013 Action "Calculate Final Instalment" added
         KD 22.07.2013 Trigger SetWithheldPercEditable added

      140325 ITERO.DJ ENH020 added field ROT fixed amount
      140310 4PSSE.I012 ITERO.MH Deleted field "Rot Fixed Amount" and added action to "ROT Information" instead.
      141110 ITERO.DL IME-223 resave page -> checksum
      160317 ITERO.AC RFC082 Added group "Cost prices" with new CostSurcharge fields
    }
    END.
  }
}

