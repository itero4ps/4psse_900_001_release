OBJECT Page 11012533 Synchronise Option Data Out
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Synchronize Budget Data;
    PageType=Card;
    OnInit=BEGIN
             InvoicePlotInstallmentsEditabl := TRUE;
           END;

    OnOpenPage=BEGIN
                 UserSetup.GET(USERID);
                 ProjectSetup.GET;
                 CRMSetup.GET;

                 IF CRMSetup."Central Management" AND CRMSetup.Customers THEN
                   CentralManagement := TRUE
                 ELSE
                   CentralManagement := FALSE;

                 IF ProjectSetup."Company Type" <> ProjectSetup."Company Type"::"Development Company" THEN
                 //  CurrPage.CLOSE;  doesn't work in RTC
                   ERROR(Text019, COMPANYNAME);

                 CompanyDestiny := ProjectSetup."Related Company";

                 CheckLastUpdateCompany();
                 CheckLastUpdateProject();

                 IF ProjectSetup."Invoice Installments from" <>
                    ProjectSetup."Invoice Installments from"::"Development Company" THEN BEGIN
                   PlotInstallmentInvoice := FALSE;
                   InvoicePlotInstallmentsEditabl := (FALSE);
                 END;

                 PrintActivityDetails := TRUE;
               END;

    ActionList=ACTIONS
    {
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 9       ;1   ;Action    ;
                      CaptionML=ENU=&Process;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Start;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 lvDummyOptionSurchRec@1100485002 : Record 11012512;
                                 lvBuyerMgtCU@1100485001 : Codeunit 11012500;
                               BEGIN
                                 IF (ProjFromFilter = '') AND
                                    (Project OR
                                     ProjectModel OR
                                     ProjectAddit OR
                                     ProjPlot OR
                                     ProjPlotAddit OR
                                     ProjPlotDelivery OR
                                     PlotInstallmentInvoice) THEN
                                 BEGIN
                                   MESSAGE(Text009);
                                   EXIT;
                                 END;

                                 IF UpdateOptions THEN BEGIN
                                   //Doorrekenen toeslagen bij opties waar de begroting is aangepast vanuit de
                                   //integratie met bouw
                                   OptRec.SETRANGE("Budget Changed by Integration", TRUE);
                                   IF OptRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                     PlotRec."Project No." := '';
                                     PlotRec."Plot No." := '';
                                     REPEAT
                                       OptRec."Budget Changed by Integration" := FALSE;
                                       OptRec."Transaction Date In" := CURRENTDATETIME;
                                       OptRec.MODIFY;
                                       lvBuyerMgtCU.BmCalcSurchargesUpdateOption(OptRec."Project No.",
                                                                                 OptRec."Plot No.",
                                                                                 OptRec."House Model",
                                                                                 OptRec."Main Group",
                                                                                 OptRec.Group,
                                                                                 OptRec."Sub Group",
                                                                                 OptRec.Option,
                                                                                 FALSE,
                                                                                 lvDummyOptionSurchRec);
                                       IF (PlotRec."Project No." <> OptRec."Project No.") OR
                                          (PlotRec."Plot No." <> OptRec."Plot No.") THEN
                                       BEGIN
                                         AddMessage(COMPANYNAME,COMPANYNAME,
                                                    OptRec."Project No.", OptRec."Plot No.",
                                                    STRSUBSTNO(Text100,OptRec."Project No.",OptRec."Plot No."));

                                         PlotRec."Project No." := OptRec."Project No.";
                                         PlotRec."Plot No." := OptRec."Plot No.";
                                       END;
                                     UNTIL OptRec.NEXT = 0;
                                   END;
                                   OptRec.RESET;
                                 END;

                                 IF (Model = TRUE) OR (Addit = TRUE) THEN
                                   IF (CompanyDestiny <> '') AND
                                      (CompanyDestiny <> COMPANYNAME) THEN
                                   BEGIN
                                     //IF UPPERCASE(ProjectSetup."Resp.Person Exchange Procedure") <> UPPERCASE(USERID) THEN BEGIN
                                     IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                        [UserSetup."Buyers Mgt. Exchange"::"Company Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                                     THEN BEGIN
                                       MESSAGE(Text013);
                                       EXIT;
                                     END;
                                     CopyBase;
                                   END;

                                 IF Project OR
                                    ProjectModel OR
                                    ProjectAddit OR
                                    ProjPlot OR
                                    ProjPlotAddit OR
                                    ProjPlotDelivery OR
                                    PlotInstallmentInvoice THEN
                                 BEGIN
                                   IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                     [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                                   THEN BEGIN
                                     MESSAGE(Text200);
                                     EXIT;
                                   END;
                                   ProjectDataNewBool := FALSE;
                                   ProjectDataUpdBool := FALSE;
                                   ProjectDataDelBool := FALSE;
                                   CopyProject;
                                   IF (ProjectDataUpdBool = FALSE) AND (ProjectDataNewBool = FALSE) THEN
                                     MESSAGE(Text011);
                                   IF (ProjectDataUpdBool = TRUE) AND (ProjectDataNewBool = FALSE) THEN
                                     MESSAGE(Text010);
                                   IF (ProjectDataDelBool = TRUE) THEN
                                     MESSAGE(Text012);
                                 END;

                                 IF EmailActive THEN BEGIN
                                   IF WerknemerTempRec.FIND('-') THEN BEGIN
                                     REPEAT
                                       IF WerknemerTempRec."E-Mail"  <> '' THEN
                                         SendMail;
                                     UNTIL WerknemerTempRec.NEXT = 0;
                                   END;
                                 END;

                                 COMMIT;

                                 IF LinesPrinted AND PrintActivityDetails THEN BEGIN
                                   ActivityReport.RUNMODAL;
                                 END;

                                 CurrPage.CLOSE;
                               END;
                                }
      { 1100485004;1 ;Action    ;
                      CaptionML=ENU=&Checklist Installments;
                      Promoted=Yes;
                      Visible=false;
                      Enabled=false;
                      Image=CheckRulesSyntax;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 lPlotRec@1100485003 : Record 11012500;
                               BEGIN
                                 IF ProjFromFilter <> '' THEN
                                   lPlotRec.SETFILTER("Project No.",ProjFromFilter);

                                 {FIXME Report11012531
                                 lReport.SETTABLEVIEW(lPlotRec);
                                 lReport.RUNMODAL();
                                 }
                               END;
                                }
      { 1210190000;1 ;Action    ;
                      CaptionML=ENU=Over&view open Options;
                      Promoted=Yes;
                      Image=ListPage;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 lProjOptRec@1210190000 : Record 11012502;
                               BEGIN
                                 lProjOptRec.SETRANGE("Budget Changed by Integration", TRUE);
                                 PAGE.RUNMODAL(PAGE::"Project Option List", lProjOptRec);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 6   ;1   ;Group     ;
                CaptionML=ENU=To Company }

    { 1210190003;2;Field  ;
                SourceExpr=CompanyDestiny;
                Style=Strong;
                StyleExpr=TRUE;
                OnValidate=BEGIN
                             ValidateCompanyDestiny;
                           END;

                OnLookup=VAR
                           Company@1100528600 : Record 2000000006;
                         BEGIN
                           IF PAGE.RUNMODAL(PAGE::"Company List (NEW)", Company) = ACTION::LookupOK THEN BEGIN
                             CompanyDestiny := Company.Name;
                             ValidateCompanyDestiny;
                           END;
                         END;
                          }

    { 1210190002;1;Group  ;
                CaptionML=ENU=Standard }

    { 1210190005;2;Field  ;
                CaptionML=ENU=Copy;
                Style=Strong;
                StyleExpr=TRUE }

    { 1210190004;2;Field  ;
                CaptionML=ENU=Standard House Model;
                SourceExpr=Model;
                OnValidate=BEGIN
                             //IF (ProjectSetup."Resp.Person Exchange Procedure" <> UPPERCASE(USERID)) AND
                             //   (Model) THEN
                             //  ERROR(Text013);

                             IF (Model) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Company Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text013);
                           END;
                            }

    { 1210190010;2;Field  ;
                CaptionML=ENU=Standard Options;
                SourceExpr=Addit;
                OnValidate=BEGIN
                             //IF (ProjectSetup."Resp.Person Exchange Procedure" <> UPPERCASE(USERID)) AND
                             //   (Addit) THEN
                             //  ERROR(Text013);

                             IF (Addit) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Company Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text013);
                           END;
                            }

    { 1210190028;2;Field  ;
                CaptionML=ENU=Last Update;
                SourceExpr=LastUpdateStandardOptions;
                Editable=FALSE }

    { 1210190021;1;Group  ;
                CaptionML=ENU=Project }

    { 1210190001;2;Field  ;
                CaptionML=ENU=Project;
                Style=Strong;
                StyleExpr=TRUE }

    { 1210190014;2;Field  ;
                Lookup=Yes;
                CaptionML=ENU=From Project;
                SourceExpr=ProjFromFilter;
                TableRelation=Job;
                Importance=Promoted;
                OnValidate=BEGIN
                             CheckLastUpdateProject();
                           END;
                            }

    { 1100525001;2;Field  ;
                Lookup=Yes;
                CaptionML=ENU=House Model Filter;
                SourceExpr=HouseModelFilter;
                TableRelation="House Model".Model;
                OnLookup=VAR
                           lProjRec@1100525000 : Record 11072003;
                           lHouseModelRec@1100525001 : Record 11012501;
                         BEGIN
                           lHouseModelRec.SETRANGE("Project No.");
                           IF (STRLEN(ProjFromFilter) <= 20) AND (STRLEN(ProjFromFilter) > 0) THEN BEGIN
                             IF lProjRec.GET(ProjFromFilter) THEN
                               lHouseModelRec.SETRANGE("Project No.", ProjFromFilter);
                           END;

                           IF PAGE.RUNMODAL(0, lHouseModelRec) = ACTION::LookupOK THEN
                             HouseModelFilter := HouseModelFilter + lHouseModelRec.Model;
                         END;
                          }

    { 1210190025;2;Field  ;
                CaptionML=ENU=Copy;
                Style=Strong;
                StyleExpr=TRUE }

    { 11  ;2   ;Field     ;
                CaptionML=ENU=Jobs;
                SourceExpr=Project;
                OnValidate=BEGIN
                             IF (Project) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1210190007;2;Field  ;
                CaptionML=ENU=House Model;
                SourceExpr=ProjectModel;
                OnValidate=BEGIN
                             IF (ProjectModel) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1210190011;2;Field  ;
                CaptionML=ENU=Project Options;
                SourceExpr=ProjectAddit;
                OnValidate=BEGIN
                             IF (ProjectAddit) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1210190020;2;Field  ;
                CaptionML=ENU=Plot;
                SourceExpr=ProjPlot;
                Importance=Standard;
                OnValidate=BEGIN
                             IF (ProjPlot) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1210190013;2;Field  ;
                CaptionML=ENU=Plot Options;
                SourceExpr=ProjPlotAddit;
                OnValidate=BEGIN
                             IF (ProjPlotAddit) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1100485007;2;Field  ;
                CaptionML=ENU=Plot deliveries;
                SourceExpr=ProjPlotDelivery;
                OnValidate=BEGIN
                             IF (ProjPlotDelivery) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1100485000;2;Field  ;
                CaptionML=ENU=Email Active;
                SourceExpr=EmailActive;
                OnValidate=BEGIN
                             EmailActiveOnAfterValidate;
                           END;
                            }

    { 1100525004;2;Field  ;
                Name=MailToName;
                Lookup=Yes;
                CaptionML=ENU=Mail To Name;
                SourceExpr=MailToName;
                Editable=MailToNameEditable;
                OnLookup=VAR
                           lWerknemerRec@1100525000 : Record 5200;
                         BEGIN
                           lWerknemerRec.CHANGECOMPANY(CompanyDestiny);
                           lWerknemerRec.SETFILTER("E-Mail", '<>%1', '');
                           IF PAGE.RUNMODAL(0, lWerknemerRec) = ACTION::LookupOK THEN BEGIN
                             MailToName :=lWerknemerRec."Full Name";
                             MailToAddress :=lWerknemerRec."E-Mail";
                             MailToNumber := lWerknemerRec."No.";
                           END;
                         END;
                          }

    { 1100525005;2;Field  ;
                Name=MailToAddress;
                Lookup=Yes;
                CaptionML=ENU=Mail To Address;
                SourceExpr=MailToAddress;
                Editable=MailToAddressEditable;
                OnLookup=VAR
                           lWerknemerRec@1100525000 : Record 5200;
                         BEGIN
                           lWerknemerRec.CHANGECOMPANY(CompanyDestiny);
                           lWerknemerRec.SETFILTER("E-Mail", '<>%1', '');
                           IF PAGE.RUNMODAL(0, lWerknemerRec) = ACTION::LookupOK THEN BEGIN
                             MailToAddress :=lWerknemerRec."E-Mail";
                             MailToName :=lWerknemerRec."Full Name";
                             MailToNumber := lWerknemerRec."No.";
                           END;
                         END;
                          }

    { 1210190016;2;Field  ;
                CaptionML=ENU=Last update project options;
                SourceExpr=LastupdateProjectOptions;
                Editable=FALSE }

    { 1210190026;2;Field  ;
                CaptionML=ENU=Last update plot options;
                SourceExpr=LastUpdatePlotOptions;
                Editable=FALSE }

    { 1100485006;2;Field  ;
                CaptionML=ENU=Set to be Invoiced;
                Style=Strong;
                StyleExpr=TRUE }

    { 1100485002;2;Field  ;
                Name=InvoicePlotInstallments;
                CaptionML=ENU=Installments Plots;
                SourceExpr=PlotInstallmentInvoice;
                Editable=InvoicePlotInstallmentsEditabl;
                OnValidate=BEGIN
                             IF (PlotInstallmentInvoice) THEN
                               IF NOT (UserSetup."Buyers Mgt. Exchange" IN
                                  [UserSetup."Buyers Mgt. Exchange"::"Project Level",UserSetup."Buyers Mgt. Exchange"::"Both Levels"])
                               THEN
                                 ERROR(Text200);
                           END;
                            }

    { 1210190017;1;Group  ;
                CaptionML=ENU=Intern }

    { 1210190024;2;Field  ;
                CaptionML=ENU=Compute;
                Style=Strong;
                StyleExpr=TRUE }

    { 1210190022;2;Field  ;
                CaptionML=ENU=Options;
                SourceExpr=UpdateOptions }

    { 1210190030;2;Field  ;
                SourceExpr=StandardOptionsToProcess;
                Editable=FALSE }

    { 1210190032;2;Field  ;
                SourceExpr=ProjectOptionsToProcess;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      NoSeriesMngmntCU@1100525001 : Codeunit 396;
      UserSetup@1100525002 : Record 91;
      CRMSetup@1100485023 : Record 5079;
      ProjRecFrom@11012005 : Record 11072003;
      ProjRecTo@11012006 : Record 11072003;
      ProjectSetup@1210190039 : Record 315;
      ProjectSetupDest@1210190040 : Record 315;
      ProjElemOrig@11012009 : Record 11012010;
      ProjElemDest@11012010 : Record 11012010;
      ProjLocOrig@11012011 : Record 11012011;
      ProjLocDest@11012012 : Record 11012011;
      ProjModelOrig@11012013 : Record 11012501;
      ProjModelDest@11012014 : Record 11012501;
      ProjUnitOrig@1210190017 : Record 11012508;
      ProjUnitDest@1210190018 : Record 11012508;
      ProjPrinDest@11012016 : Record 11012005;
      OptRec@1210190002 : Record 11012502;
      OptOrig@11012017 : Record 11012502;
      OptDest@11012018 : Record 11012502;
      OptDest2@1210190012 : Record 11012502;
      ProjMainGrpOrig@1210190054 : Record 11012509;
      ProjMainGrpDest@1210190055 : Record 11012509;
      ProjGrpOrig@11012019 : Record 11012504;
      ProjGrpDest@11012020 : Record 11012504;
      ProjSubGrpOrig@1210190020 : Record 11012505;
      ProjSubGrpDest@1210190019 : Record 11012505;
      OptBudgSumDest@1210190022 : Record 11012064;
      OptBudgetOrig@11012025 : Record 11012503;
      OptBudgetDest@11012026 : Record 11012503;
      PlotRec@1100485009 : Record 11012500;
      PlotOrig@1210190023 : Record 11012500;
      PlotDest@1210190024 : Record 11012500;
      ContBusRel@1210190042 : Record 5054;
      ContactOrigRec@1210190001 : Record 5050;
      ContactDestRec@1210190000 : Record 5050;
      WerknemerDestRec@1210190029 : Record 5200;
      WerknemerTempRec@1210190028 : TEMPORARY Record 5200;
      DummyHrsLineTempRec@1210190058 : TEMPORARY Record 11012039;
      OptSurchRec@1210190057 : Record 11012512;
      BuyerMgtTextRec@1210190056 : Record 11012511;
      CustomerOrigRec@1100485005 : Record 18;
      CustomerDestRec@1210190013 : Record 18;
      OptionTextOrigRec@1100485001 : Record 11012511;
      OptionTextDestRec@1100485002 : Record 11012511;
      FromDefDim@1100485004 : Record 352;
      ToDefDim@1100485003 : Record 352;
      ProjInstalmRec@1100485008 : Record 11012018;
      ProjInstalmDestRec@1100485007 : Record 11012018;
      DeliveryOrig@1100485026 : Record 11012507;
      DeliveryDest@1100485027 : Record 11012507;
      CompanyDestiny@1210190008 : Text[30];
      ProjFromFilter@1210190007 : Text[250];
      HouseModelFilter@1100525000 : Text[250];
      Model@11012034 : Boolean;
      ProjectModel@1210190009 : Boolean;
      Addit@11012035 : Boolean;
      ProjectAddit@1210190010 : Boolean;
      Project@1210190011 : Boolean;
      ProjPlot@1210190014 : Boolean;
      ProjPlotAddit@1210190015 : Boolean;
      ProjPlotDelivery@1100485015 : Boolean;
      PlotInstallmentInvoice@1100485006 : Boolean;
      UpdateOptions@1210190006 : Boolean;
      ProjectDataNewBool@1210190046 : Boolean;
      ProjectDataUpdBool@1210190047 : Boolean;
      ProjectDataDelBool@1210190048 : Boolean;
      Text002@1210190027 : TextConst 'ENU=We have sent a collection of payment orders to our bank.';
      Text003@1210190026 : TextConst 'ENU=These have to be estimated';
      Text004@1210190025 : TextConst 'ENU=Added work options from project development.';
      EmailActive@1100485000 : Boolean;
      LinesPrinted@1100485011 : Boolean;
      lPlotInstallmentInvoicable@1100485020 : Boolean;
      PrintActivityDetails@1100485022 : Boolean;
      CentralManagement@1100485024 : Boolean;
      LastUpdateStandardOptions@1210190034 : DateTime;
      LastupdateProjectOptions@1210190035 : DateTime;
      LastUpdatePlotOptions@1210190036 : DateTime;
      StandardOptionsToProcess@1210190037 : 'In standaard geen nieuwe optiebegrotingen,In standaard nieuwe optiebegrotingen';
      ProjectOptionsToProcess@1210190038 : ' ,In project geen nieuwe optiebegrotingen,In project nieuwe optiebegrotingen';
      CustomerContactNo@1210190041 : Code[20];
      Text009@1210190043 : TextConst 'ENU=Select a Job';
      Text010@1210190044 : TextConst 'ENU="No new project data added to construction\Only rewrite on existing data "';
      Text011@1210190045 : TextConst 'ENU=No Project data exported to Construction';
      Text012@1210190049 : TextConst 'ENU=Superfluous options at construction are removed';
      Text013@1210190050 : TextConst 'ENU=User has no permissions for standard data';
      Text014@1210190051 : TextConst 'ENU=Type should be construction for %1.';
      Text015@1210190052 : TextConst 'ENU=No export allowed to current company';
      Text016@1210190060 : TextConst 'ENU=Project: %1   %2';
      Text018@1210190062 : TextConst 'ENU="              %1  %2"';
      Text100@1100485012 : TextConst 'ENU=Project %1 Plot %2 Option Surcharge Calculated.';
      Text110@1100485013 : TextConst 'ENU=Standard House Models are transferred.';
      Text120@1100485014 : TextConst 'ENU=Standard Options are transferred.';
      Text140@1100485016 : TextConst 'ENU=House Models are transferred for Project %.';
      Text150@1100485017 : TextConst 'ENU=Options are transferred for Project %.';
      Text160@1100485018 : TextConst 'ENU=Project %1 Plot %2 transferred.';
      Text170@1100485019 : TextConst 'ENU=Project %1 Plot %2 Options are transferred.';
      Text180@1100485021 : TextConst 'ENU=Project %1 Plot %2 Installments Set to Invoice.';
      Text190@1100485025 : TextConst 'ENU=Project %1 Plot %2 Deliveries are transferred.';
      ActivityReport@1100525007 : Report 11012530;
      MailToName@1100525003 : Text[250];
      MailToAddress@1100525004 : Text[250];
      MailToNumber@1100525005 : Code[20];
      MailToAddressEditable@19012020 : Boolean INDATASET;
      MailToNameEditable@19036679 : Boolean INDATASET;
      InvoicePlotInstallmentsEditabl@19028659 : Boolean INDATASET;
      Text200@1100525006 : TextConst 'ENU=User has no permissions for project data';
      Text019@1100525008 : TextConst 'ENU=Type should be development for %1.';
      Text020@1100525009 : TextConst 'ENU=Destination House Model %1 not found';
      Text021@1100525010 : TextConst 'ENU=Destination Project %1 House Model %2 not found';
      Text022@1100525011 : TextConst 'ENU=Source House Model %1 not present, incorrect source Option: %1, %2, %3, %4, %5';
      Text023@1100525012 : TextConst 'ENU=Source Project %1 House Model %2 not present, incorrect source Option: %1, %2, %3, %4, %5, %6';
      Text024@1100525013 : TextConst 'ENU=Destination Main Group %1 not found';
      Text025@1100525014 : TextConst 'ENU=Destination Project %1 Main Group %2 not found';
      Text026@1100525015 : TextConst 'ENU=Source Main Group %2 not present, incorrect source Option: %1, %2, %3, %4, %5';
      Text027@1100525016 : TextConst 'ENU=Source Project %1 Main Group %3 not present, incorrect source Option: %1, %2, %3, %4, %5, %6';
      Text028@1100525017 : TextConst 'ENU=Destination Group %1 not found';
      Text029@1100525018 : TextConst 'ENU=Destination Project %1 Group %2 not found';
      Text030@1100525019 : TextConst 'ENU=Source Group %3 not present, incorrect source Option: %1, %2, %3, %4, %5';
      Text031@1100525020 : TextConst 'ENU=Source Project %1 Group %4 not present, incorrect source Option: %1, %2, %3, %4, %5, %6';
      Text032@1100525021 : TextConst 'ENU=Destination Sub Group %1 not found';
      Text033@1100525022 : TextConst 'ENU=Destination Project %1 Sub Group %2 not found';
      Text034@1100525023 : TextConst 'ENU=Source Sub Group %4 not present, incorrect source Option: %1, %2, %3, %4, %5';
      Text035@1100525024 : TextConst 'ENU=Source Project %1 Sub Group %5 not present, incorrect source Option: %1, %2, %3, %4, %5, %6';

    PROCEDURE CopyBase@1210190001();
    BEGIN
      //**standard-house models + unites
      IF Model = TRUE THEN
        IF CopyHouseModels(CompanyDestiny,'','') THEN
          AddMessage(CompanyDestiny,COMPANYNAME,
                     '', '', Text110);

      //**standard-options and option groups
      IF Addit = TRUE THEN
        IF CopyOptions(CompanyDestiny,'','','') THEN
          AddMessage(CompanyDestiny,COMPANYNAME,
                      '', '', Text120);
    END;

    PROCEDURE CopyProject@2();
    BEGIN
      ProjRecFrom.SETFILTER("No.",ProjFromFilter );
      ProjRecFrom.SETFILTER("Joint Company", '<>%1', '');

      IF ProjRecFrom.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF ProjRecFrom."Joint Company" <> COMPANYNAME THEN BEGIN
            ProjRecTo.CHANGECOMPANY(ProjRecFrom."Joint Company");
            ProjPrinDest.CHANGECOMPANY(ProjRecFrom."Joint Company");
            ProjectSetupDest.CHANGECOMPANY(ProjRecFrom."Joint Company");
            ToDefDim.CHANGECOMPANY(ProjRecFrom."Joint Company");

            ProjectSetupDest.FINDFIRST;

      //      IF ProjRecFrom."Joint Job No." = '' THEN BEGIN
      //        ProjRecFrom."Joint Job No." := ProjRecFrom."No.";
      //        ProjRecFrom."One to One Join" := TRUE;
      //      END;

            IF Project THEN BEGIN
              //**general project data
              IF NOT ProjRecTo.GET(ProjRecFrom."Joint Job No.") THEN BEGIN
                ProjRecTo.TRANSFERFIELDS(ProjRecFrom);

                ProjRecTo."Joint Company" := COMPANYNAME;
                ProjRecTo."Joint Job No." := ProjRecFrom."No.";

                ProjRecTo."No." := ProjRecFrom."No.";

                IF ProjectSetup."Create Job No. From Related Cy" =
                   ProjectSetup."Create Job No. From Related Cy"::Generate THEN
                BEGIN
                  ProjRecTo."No. Series" := ProjectSetupDest."Job Nos.";
                  CLEAR(NoSeriesMngmntCU);
                  NoSeriesMngmntCU.SetFromOtherCompany(ProjRecFrom."Joint Company");
                  ProjRecTo."No." := NoSeriesMngmntCU.GetNextNo(ProjRecTo."No. Series",WORKDATE,TRUE);
                END;
                ProjRecFrom."Joint Job No." := ProjRecTo."No.";
      //          IF ProjRecFrom."No." = ProjRecTo."No." THEN
      //            ProjRecTo."One to One Join" := TRUE
      //          ELSE
      //            ProjRecTo."One to One Join" := FALSE;

      //  Transferfields?  ProjRecTo."Options Sold By" := ProjRecFrom."Options Sold By";

                ProjRecTo."Project Type" := '';
                ProjRecTo."Bill-to Customer No." := '';
                ProjRecTo."Site Manager" := '';
                ProjRecTo."Project Manager" := '';
                ProjRecTo."Project Engineer" := '';
                ProjRecTo.Supervisor := '';
                ProjRecTo.Buyercontact := '';

                ProjRecTo.INSERT;

                AddMessage(CompanyDestiny,COMPANYNAME,
                           ProjRecFrom."Joint Job No.",
                           '', Text120);

                //**dimensions
                //DimMgt.CopyDefaultDim(DATABASE::Job, ProjRecFrom."No.", DATABASE::Job, ProjRecTo."No.");
                //line above replaced by lines below
                WITH FromDefDim DO BEGIN
                  SETRANGE("Table ID",DATABASE::Job);
                  SETRANGE("No.",ProjRecFrom."No.");
                  IF FINDSET THEN BEGIN
                    REPEAT
                      ToDefDim := FromDefDim;
                      ToDefDim."No." := ProjRecTo."No.";
                      ToDefDim.INSERT;
                    UNTIL NEXT = 0;
                  END;
                END;
                ProjectDataNewBool := TRUE;

                //**Project principal
                IF ProjectSetupDest."Project Principal Related" <> '' THEN BEGIN
                  ProjPrinDest.INIT;
                  ProjPrinDest."Project No." := ProjRecTo."No.";
                  ProjPrinDest."Main Project No." := ProjRecTo."Main Project";
                  ProjPrinDest.Principal := ProjectSetupDest."Project Principal Related";
                  ProjPrinDest."Collect Installment Invoice By" := ProjectSetupDest."Default Collect Inst. Inv. By";
                  //ProjPrinDest."One Plot per Installm. Invoice" := ProjectSetupDest."Default One Plot p. Inst. Inv.";
                  ProjPrinDest.INSERT;
                  ProjRecTo."Bill-to Customer No." := ProjPrinDest.Principal;
                  ProjRecTo.MODIFY;
                END;
              END;
              //**project-locations
              ProjLocDest.CHANGECOMPANY(ProjRecFrom."Joint Company");
              ProjLocOrig.SETRANGE("Project No.", ProjRecFrom."No.");
              IF ProjLocOrig.FINDSET THEN BEGIN
                REPEAT
                  IF ProjLocDest.GET(ProjRecFrom."Joint Job No.", ProjLocOrig.Code) THEN BEGIN
                    ProjLocDest.TRANSFERFIELDS(ProjLocOrig, FALSE);
                    ProjLocDest."Project No." := ProjRecFrom."Joint Job No.";
                    ProjLocDest.MODIFY(TRUE);
                    ProjectDataUpdBool := TRUE;
                  END ELSE BEGIN
                    ProjLocDest.TRANSFERFIELDS(ProjLocOrig);
                    ProjLocDest."Project No." := ProjRecFrom."Joint Job No.";
                    ProjLocDest.INSERT(TRUE);
                    ProjectDataNewBool := TRUE;
                  END;
                UNTIL ProjLocOrig.NEXT = 0;
              END;
              //**project-elements
              ProjElemDest.CHANGECOMPANY(ProjRecFrom."Joint Company");
              ProjElemOrig.SETRANGE("Project No.", ProjRecFrom."No.");
              IF ProjElemOrig.FINDSET THEN BEGIN
                REPEAT
                  IF ProjElemDest.GET(ProjRecFrom."Joint Job No.", ProjElemOrig.Element) THEN BEGIN
                    ProjElemDest.TRANSFERFIELDS(ProjElemOrig, FALSE);
                    ProjElemDest."Project No." := ProjRecFrom."Joint Job No.";
                    ProjElemDest.MODIFY(TRUE);
                    ProjectDataUpdBool := TRUE;
                  END ELSE BEGIN
                    ProjElemDest.TRANSFERFIELDS(ProjElemOrig);
                    ProjElemDest."Project No." := ProjRecFrom."Joint Job No.";
                    ProjElemDest.INSERT(TRUE);
                    ProjectDataNewBool := TRUE;
                  END;
                UNTIL ProjElemOrig.NEXT = 0;
              END;
              ProjRecFrom."Joint Job No." := ProjRecTo."No.";
              ProjRecFrom.MODIFY;
            END;

            IF ProjRecTo.GET(ProjRecFrom."Joint Job No.") THEN BEGIN
              //**Project-house models + units
              IF ProjectModel = TRUE THEN
                IF CopyHouseModels(ProjRecFrom."Joint Company",ProjRecFrom."No.",ProjRecFrom."Joint Job No.") THEN
                  AddMessage(ProjRecFrom."Joint Company",
                             COMPANYNAME, ProjRecFrom."No.", '',
                             STRSUBSTNO(Text140,ProjRecFrom."No."));
              //**project-options and option groups
              IF ProjectAddit = TRUE THEN
                IF CopyOptions(ProjRecFrom."Joint Company",ProjRecFrom."No.",ProjRecFrom."Joint Job No.",'') THEN
                  AddMessage(ProjRecFrom."Joint Company",
                             COMPANYNAME, ProjRecFrom."No.", '',
                             STRSUBSTNO(Text150,ProjRecFrom."No."));

              //**project-plotnumbers and options per plotnumber
              IF (ProjPlot = TRUE) OR (ProjPlotAddit = TRUE) OR (ProjPlotDelivery = TRUE) THEN BEGIN
                PlotDest.CHANGECOMPANY(ProjRecFrom."Joint Company");
                PlotOrig.SETRANGE("Project No.", ProjRecFrom."No.");
                PlotOrig.SETFILTER("House Model", HouseModelFilter);        //22-10-2008

                IF PlotOrig.FINDSET THEN BEGIN
                  REPEAT
                    IF PlotDest.GET(ProjRecFrom."Joint Job No.", PlotOrig."Plot No.") THEN BEGIN
                      IF (ProjPlot = TRUE) THEN BEGIN
                        CustomerContactNo := '';
                        IF CustomerOrigRec.GET(PlotOrig.Principal) THEN BEGIN
                          ContBusRel.SETCURRENTKEY("Link to Table","No.");
                          ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Customer);
                          ContBusRel.SETRANGE("No.",CustomerOrigRec."No.");
                          IF ContBusRel.FINDFIRST THEN
                            CustomerContactNo := ContBusRel."Contact No.";
                        END;

                        PlotDest.Principal := ProjRecTo."Bill-to Customer No.";

                        //PlotDest.VALIDATE("Buyer = Principal",FALSE);
                        IF CentralManagement THEN BEGIN
                          PlotDest.Buyer := CustomerContactNo;
                          InsertBuyer();
                        END;


                        IF (ProjRecTo."Options Sold By" = ProjRecTo."Options Sold By"::"Building Company") AND
                           (CentralManagement) THEN BEGIN
                          PlotDest."Principal Options" := PlotOrig.Principal;
                          IF NOT ProjPrinDest.GET(ProjRecTo."No.",PlotDest."Principal Options") THEN BEGIN
                            InsertPlotPrincipalOptions();
                          END;
                        END ELSE BEGIN
                          IF (ProjRecTo."Options Sold By" = ProjRecTo."Options Sold By"::"Development Company") THEN
                            PlotDest."Principal Options" := ProjRecTo."Bill-to Customer No.";
                        END;

                        //Call - C-011892  24-04-2008
                        PlotDest."Building Seq." := PlotOrig."Building Seq.";
                        PlotDest."Block No." := PlotOrig."Block No.";
                        PlotDest."Seq. No. in Block" := PlotOrig."Seq. No. in Block";
                        PlotDest."Floor No." := PlotOrig."Floor No.";
                        PlotDest.Address := PlotOrig.Address;
                        PlotDest."Post Code" := PlotOrig."Post Code";
                        PlotDest.City := PlotOrig.City;
                        PlotDest."Plot Surface" := PlotOrig."Plot Surface";
                        PlotDest."Land Registry No." := PlotOrig."Land Registry No.";
                        PlotDest."Request EAN Code El. Before" := PlotOrig."Request EAN Code El. Before";
                        PlotDest."Request EAN Code Gas Before" := PlotOrig."Request EAN Code Gas Before";
                        PlotDest."EAN Code Electricity" := PlotOrig."EAN Code Electricity";
                        PlotDest."EAN Code Gas" := PlotOrig."EAN Code Gas";
                        PlotDest."GIW Certificate" :=  PlotOrig."GIW Certificate";
                        // 24-04-2008 en
                        PlotDest."Buy/Rent" := PlotOrig."Buy/Rent";

                        PlotDest.MODIFY(TRUE);
                        ProjectDataUpdBool := TRUE;
                      END;
                      IF ProjPlotAddit THEN BEGIN
                        IF CopyOptions(ProjRecFrom."Joint Company",ProjRecFrom."No.",
                                       ProjRecFrom."Joint Job No.",PlotOrig."Plot No.") THEN
                          AddMessage(ProjRecFrom."Joint Company",
                                     COMPANYNAME, ProjRecFrom."No.", PlotOrig."Plot No.",
                                     STRSUBSTNO(Text170,ProjRecFrom."No.",PlotOrig."Plot No."));
                      END;

                      IF ProjPlotDelivery THEN BEGIN
                        IF CopyDeliveries(ProjRecFrom."Joint Company",ProjRecFrom."No.",
                                          ProjRecFrom."Joint Job No.",PlotOrig."Plot No.") THEN
                          AddMessage(ProjRecFrom."Joint Company",
                                     COMPANYNAME, ProjRecFrom."No.", PlotOrig."Plot No.",
                                     STRSUBSTNO(Text190,ProjRecFrom."No.",PlotOrig."Plot No."));
                      END;

                    END ELSE BEGIN
                      IF (ProjPlot = TRUE) THEN BEGIN
                        CustomerContactNo := '';
                        IF CustomerOrigRec.GET(PlotOrig.Principal) THEN BEGIN
                          ContBusRel.SETCURRENTKEY("Link to Table","No.");
                          ContBusRel.SETRANGE("Link to Table",ContBusRel."Link to Table"::Customer);
                          ContBusRel.SETRANGE("No.",CustomerOrigRec."No.");
                          IF ContBusRel.FINDFIRST THEN
                            CustomerContactNo := ContBusRel."Contact No.";
                        END;
                        PlotDest.TRANSFERFIELDS(PlotOrig);
                        PlotDest."Project No." := ProjRecFrom."Joint Job No.";
                        PlotDest.Principal := ProjRecTo."Bill-to Customer No.";
                        //PlotDest."Principal Options" := ProjRecTo."Bill-to Customer No.";
                        //PlotDest.VALIDATE("Buyer = Principal",FALSE);
                        IF CentralManagement THEN BEGIN
                          PlotDest.Buyer := CustomerContactNo;
                          InsertBuyer();
                        END;
                        IF (ProjRecTo."Options Sold By" = ProjRecTo."Options Sold By"::"Building Company") AND
                           (CentralManagement) THEN BEGIN
                          PlotDest."Principal Options" := PlotOrig.Principal;
                          IF NOT ProjPrinDest.GET(ProjRecTo."No.",PlotDest."Principal Options") THEN BEGIN
                            InsertPlotPrincipalOptions();
                          END;
                        END ELSE BEGIN
                          IF (ProjRecTo."Options Sold By" = ProjRecTo."Options Sold By"::"Development Company") THEN
                            PlotDest."Principal Options" := ProjRecTo."Bill-to Customer No.";
                        END;

                        PlotDest."Installment Scheme" := '';

                        PlotDest.INSERT(TRUE);
                        AddMessage(ProjRecFrom."Joint Company",
                                   COMPANYNAME, ProjRecFrom."No.",PlotOrig."Plot No.",
                                   STRSUBSTNO(Text160,ProjRecFrom."No.",PlotOrig."Plot No."));

                        ProjectDataNewBool := TRUE;
                        IF ProjPlotAddit THEN BEGIN
                          IF CopyOptions(ProjRecFrom."Joint Company",
                                         ProjRecFrom."No.",ProjRecFrom."Joint Job No.",
                                         PlotOrig."Plot No.")
                          THEN
                            AddMessage(ProjRecFrom."Joint Company",
                                       COMPANYNAME, ProjRecFrom."No.", PlotOrig."Plot No.",
                                       STRSUBSTNO(Text170,ProjRecFrom."No.",PlotOrig."Plot No."));

                        END;

                        IF ProjPlotDelivery THEN BEGIN
                          IF CopyDeliveries(ProjRecFrom."Joint Company",ProjRecFrom."No.",
                                            ProjRecFrom."Joint Job No.",PlotOrig."Plot No.") THEN
                            AddMessage(ProjRecFrom."Joint Company",
                                       COMPANYNAME, ProjRecFrom."No.", PlotOrig."Plot No.",
                                       STRSUBSTNO(Text190,ProjRecFrom."No.",PlotOrig."Plot No."));
                        END;

                      END;
                    END;
                  UNTIL PlotOrig.NEXT = 0;
                END;
              END;

              IF (PlotInstallmentInvoice) THEN BEGIN
                //**Concerns installments of plot number.
                PlotRec.RESET;
                PlotRec.SETRANGE("Project No.", ProjRecFrom."No.");
                IF PlotRec.FINDSET THEN BEGIN
                  REPEAT
                    lPlotInstallmentInvoicable := FALSE;
                    ProjInstalmDestRec.CHANGECOMPANY(ProjRecFrom."Joint Company");
                    ProjInstalmRec.RESET;
                    ProjInstalmRec.SETRANGE("Project No.",ProjRecFrom."No.");
                    ProjInstalmRec.SETRANGE("Plot No.",PlotRec."Plot No.");
                    ProjInstalmRec.SETRANGE(Chargeable, TRUE);
                    ProjInstalmRec.SETFILTER("Main Group", '%1' , '');
                    ProjInstalmRec.SETFILTER(Group,  '%1' , '');
                    ProjInstalmRec.SETFILTER("Sub Group",  '%1' , '');
                    ProjInstalmRec.SETFILTER(Option,  '%1' , '');
                    IF ProjInstalmRec.FINDSET THEN BEGIN
                      REPEAT
                        ProjInstalmDestRec.SETRANGE("Project No.",ProjRecFrom."Joint Job No.");
                        ProjInstalmDestRec.SETRANGE("Plot No.", ProjInstalmRec."Plot No.");
                        ProjInstalmDestRec.SETRANGE("Installment Scheme SerNo.", ProjInstalmRec."Installment Scheme SerNo.");
                        ProjInstalmDestRec.SETRANGE(Chargeable, FALSE);
                        ProjInstalmDestRec.SETFILTER("Main Group", '%1' , '');
                        ProjInstalmDestRec.SETFILTER(Group, '%1' , '');
                        ProjInstalmDestRec.SETFILTER("Sub Group", '%1' , '');
                        ProjInstalmDestRec.SETFILTER(Option, '%1' , '');
                        IF ProjInstalmDestRec.FINDFIRST THEN BEGIN
                          ProjInstalmDestRec.Chargeable := TRUE;
                          ProjInstalmDestRec.MODIFY;
                          ProjectDataUpdBool := TRUE;
                          lPlotInstallmentInvoicable := TRUE;
                        END;
                      UNTIL ProjInstalmRec.NEXT = 0;
                    END;
                    IF lPlotInstallmentInvoicable THEN
                      AddMessage(ProjRecFrom."Joint Company",COMPANYNAME,ProjRecFrom."No.",PlotRec."Plot No.",
                                 STRSUBSTNO(Text180,ProjRecFrom."Joint Job No.",PlotRec."Plot No."));
                  UNTIL PlotRec.NEXT = 0;
                END;
              END;
            END;
          END;
        UNTIL ProjRecFrom.NEXT = 0;
      END;
    END;

    PROCEDURE CopyOptions@1210190006(iCompanyDest@1210190001 : Text[30];iProjectOrig@1210190003 : Code[20];iProjectDest@1210190000 : Code[20];iPlotDest@1210190002 : Code[10]) NewOptionsBool : Boolean;
    VAR
      NextLineNo@1210190004 : Integer;
    BEGIN
      NewOptionsBool := FALSE;

      OptOrig.RESET;

      //** Set Destiny Company
      ProjModelDest.CHANGECOMPANY(iCompanyDest);
      ProjMainGrpDest.CHANGECOMPANY(iCompanyDest);
      ProjGrpDest.CHANGECOMPANY(iCompanyDest);
      ProjSubGrpDest.CHANGECOMPANY(iCompanyDest);
      OptDest.CHANGECOMPANY(iCompanyDest);
      OptDest2.CHANGECOMPANY(iCompanyDest);
      OptBudgetDest.CHANGECOMPANY(iCompanyDest);
      OptBudgSumDest.CHANGECOMPANY(iCompanyDest);
      ContactDestRec.CHANGECOMPANY(iCompanyDest);
      WerknemerDestRec.CHANGECOMPANY(iCompanyDest);
      OptionTextDestRec.CHANGECOMPANY(iCompanyDest);

      //** add / overwrite optiongroups (also head- and subgroups)
      ProjMainGrpOrig.SETRANGE("Project No.", iProjectOrig);
      IF ProjMainGrpOrig.FINDSET THEN BEGIN
        REPEAT
          IF NOT ProjMainGrpDest.GET(iProjectDest,ProjMainGrpOrig.Code) THEN BEGIN
            ProjMainGrpDest.TRANSFERFIELDS(ProjMainGrpOrig);
            ProjMainGrpDest."Project No." := iProjectDest;
            ProjMainGrpDest.INSERT;
          END ELSE BEGIN
            ProjMainGrpDest.TRANSFERFIELDS(ProjMainGrpOrig, FALSE);
            ProjMainGrpDest."Project No." := iProjectDest;
            ProjMainGrpDest.MODIFY;
          END;
        UNTIL ProjMainGrpOrig.NEXT = 0;
      END;

      ProjGrpOrig.SETRANGE("Project No.", iProjectOrig);
      IF ProjGrpOrig.FINDSET THEN BEGIN
        REPEAT
          IF NOT ProjGrpDest.GET(iProjectDest,ProjGrpOrig.Code) THEN BEGIN
            ProjGrpDest.TRANSFERFIELDS(ProjGrpOrig);
            ProjGrpDest."Project No." := iProjectDest;
            ProjGrpDest.INSERT;
          END ELSE BEGIN
            ProjGrpDest.TRANSFERFIELDS(ProjGrpOrig, FALSE);
            ProjGrpDest."Project No." := iProjectDest;
            ProjGrpDest.MODIFY;
          END;
        UNTIL ProjGrpOrig.NEXT = 0;
      END;

      ProjSubGrpOrig.SETRANGE("Project No.", iProjectOrig);
      IF ProjSubGrpOrig.FINDSET THEN BEGIN
        REPEAT
          IF NOT ProjSubGrpDest.GET(iProjectDest, ProjSubGrpOrig.Code) THEN BEGIN
            ProjSubGrpDest.TRANSFERFIELDS(ProjSubGrpOrig);
            ProjSubGrpDest."Project No." := iProjectDest;
            ProjSubGrpDest.INSERT;
          END ELSE BEGIN
            ProjSubGrpDest.TRANSFERFIELDS(ProjSubGrpOrig, FALSE);
            ProjSubGrpDest."Project No." := iProjectDest;
            ProjSubGrpDest.MODIFY;
          END;
        UNTIL ProjSubGrpOrig.NEXT = 0;
      END;

      //**Options (level 1 = standard option; level 2 = project option; level 3 = project/plot no. option)
      OptOrig.SETRANGE("Project No.", iProjectOrig);
      OptOrig.SETRANGE("Plot No.", iPlotDest);
      IF iPlotDest <> '' THEN
        OptOrig.SETFILTER(OptOrig.Status, '%1..%2', OptOrig.Status::Order, OptOrig.Status::Expired)
      ELSE
        OptOrig.SETFILTER(OptOrig.Status, '');

      IF (iProjectOrig <> '') AND (iPlotDest = '') THEN           //22-10-2008 new
        OptOrig.SETFILTER("House Model", HouseModelFilter)        //
      ELSE                                                        //
        OptOrig.SETFILTER("House Model", '');                     //

      IF OptOrig.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF NOT OptDest.GET(iProjectDest,OptOrig."Plot No.",OptOrig."House Model",
                                 OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option) THEN
          BEGIN
            IF (OptOrig.Status <> OptOrig.Status::Expired) OR (iPlotDest = '') THEN BEGIN

              //Call C010728 changed start
              IF NOT ProjModelDest.GET(iProjectDest,OptOrig."House Model") THEN BEGIN
                IF ProjModelOrig.GET(iProjectOrig,OptOrig."House Model") THEN BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text020, OptOrig."House Model") //Destination House Model %1 not found
                  ELSE
                    ERROR(Text021, iProjectDest,OptOrig."House Model"); //Destination Project %1 House Model %2 not found
                END ELSE BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text022, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option)
                       //Source House Model %1 not present, incorrect source option: %1, %2, %3, %4, %5
                  ELSE
                    ERROR(Text023, iProjectOrig, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option);
                       //Source Project %1 House Model %2 not present, incorrect source option: %1, %2, %3, %4, %5, %6
                END;
              END;
              IF NOT ProjMainGrpDest.GET(iProjectDest,OptOrig."Main Group") THEN BEGIN
                IF ProjMainGrpOrig.GET(iProjectOrig,OptOrig."Main Group") THEN BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text024, OptOrig."Main Group") //Destination Main Group %1 not found
                  ELSE
                    ERROR(Text025, iProjectDest,OptOrig."Main Group"); //Destination Project %1 Main Group %2 not found
                END ELSE BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text026, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option)
                       //Source Main Group %2 not present, incorrect source option: %1, %2, %3, %4, %5
                  ELSE
                    ERROR(Text027, iProjectOrig, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option);
                       //Source Project %1 Main Group %3 not present, incorrect source option: %1, %2, %3, %4, %5, %6
                END;
              END;
              IF NOT ProjGrpDest.GET(iProjectDest,OptOrig.Group) THEN BEGIN
                IF ProjGrpOrig.GET(iProjectOrig,OptOrig.Group) THEN BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text028, OptOrig.Group) //Destination Group %1 not found
                  ELSE
                    ERROR(Text029, iProjectDest,OptOrig.Group); //Destinatation Project %1 Group %2 not found
                END ELSE BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text030, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option)
                       //Source Group %3 not present, incorrect source Option: %1, %2, %3, %4, %5
                  ELSE
                    ERROR(Text031, iProjectOrig, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option);
                       //Source Project %1 Group %4 not present, incorrect source Option: %1, %2, %3, %4, %5, %6
                END;
              END;

              IF NOT ProjSubGrpDest.GET(iProjectDest,OptOrig."Sub Group") THEN BEGIN
                IF ProjSubGrpOrig.GET(iProjectOrig,OptOrig."Sub Group") THEN BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text032, OptOrig."Sub Group") //Destination Sub Group %1 not found
                  ELSE
                    ERROR(Text033, iProjectDest,OptOrig."Sub Group"); //Destination Project %1 Sub Group %2 not found
                END ELSE BEGIN
                  IF iProjectDest = '' THEN
                    ERROR(Text034, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option)
                       //Source Sub Group %4 not present, incorrect source Option: %1, %2, %3, %4, %5
                  ELSE
                    ERROR(Text035, iProjectOrig, OptOrig."House Model", OptOrig."Main Group",OptOrig.Group,
                                 OptOrig."Sub Group",OptOrig.Option);
                       //Source Project %1 Sub Group %5 not present, incorrect source Option: %1, %2, %3, %4, %5, %6
                END;
              END;
              //Call C010728 changed end

              OptDest.TRANSFERFIELDS(OptOrig);
              OptDest."Project No." := iProjectDest;
              IF OptDest."Project No." <> '' THEN
                OptDest."Main Project No." := ProjRecTo."Main Project"
              ELSE
                OptDest."Main Project No." := '';

              OptDest."Installments Generated" := FALSE;
              OptDest."Installment Scheme" := '';
              OptDest."Generation Date" := 0D;
              OptDest."Last Date Printed on Opt.List" := 0D;
              OptDest."Last Time Printed on Opt.List" := 0T;
              OptDest."Nett Price" := 0;
              OptDest."Computed Sales Price Incl. VAT" := 0;
              OptDest."Sales Amount incl. VAT" := 0;
              OptDest."Sales Price incl. VAT" := 0;
              OptDest."Sales Price excl. VAT" := 0;
              OptDest."Computed VAT Amount" := 0;
              OptDest."VAT Amount" := 0;
              OptDest."Contract Amount" := 0;
              OptDest."Offered Amount" := 0;
              OptDest."VAT Prod. Posting Group" := '';
              OptDest."VAT Bus. Posting Group" := '';
              OptDest."Fixed Sales Price" := FALSE;
              OptDest."Transaction Date Out" := 0DT;

              IF OptDest."Plot No." <> '' THEN BEGIN
                OptDest.Status := OptOrig.Status::Order;
                OptDest."Order Date" := TODAY;
                IF OptDest2.GET(iProjectDest, '',OptOrig."House Model",
                                OptOrig."Main Group",OptOrig.Group,
                                OptOrig."Sub Group", OptOrig.Option) THEN
                BEGIN
                  OptDest."Nett Price" := OptDest2."Nett Price";
                  OptDest."Computed Sales Price Incl. VAT" := OptDest2."Computed Sales Price Incl. VAT";
                  OptDest."Sales Amount incl. VAT" := OptDest2."Sales Amount incl. VAT";
                  OptDest."Sales Price incl. VAT" := OptDest2."Sales Price incl. VAT";
                  OptDest."Sales Price excl. VAT" := OptDest2."Sales Price excl. VAT";
                  OptDest."Computed VAT Amount" := OptDest2."Computed VAT Amount";
                  OptDest."VAT Amount" := OptDest2."VAT Amount";
                  OptDest."Contract Amount" := OptDest2."Contract Amount";
                  OptDest."Offered Amount" := OptDest2."Offered Amount";
                  OptDest."Installment Scheme" := OptDest2."Installment Scheme";
                END;
                OptDest.Principal := PlotDest."Principal Options";   //Call C-015930 03-11-2009
              END;

              OptDest."Budget Changed by Integration" := TRUE;
              OptDest."Transaction Date In" := CURRENTDATETIME;

              OptDest.INSERT;

              NewOptionsBool := TRUE;

              //Copy texts
              OptionTextOrigRec.RESET;
              OptionTextOrigRec.SETRANGE(Table, OptionTextOrigRec.Table::Option);
              IF NOT ProjectSetup."Copy Tech Texts" THEN
                OptionTextOrigRec.SETRANGE("Text Type", OptionTextOrigRec."Text Type"::Sales);
              OptionTextOrigRec.SETRANGE("Project No.", OptOrig."Project No.");
              OptionTextOrigRec.SETRANGE("House Model", OptOrig."House Model");
              OptionTextOrigRec.SETRANGE("Option Main Group", OptOrig."Main Group");
              OptionTextOrigRec.SETRANGE("Option Sub Group", OptOrig."Sub Group");
              OptionTextOrigRec.SETRANGE("Option Group",OptOrig.Group);
              OptionTextOrigRec.SETRANGE("Plot No.", OptOrig."Plot No.");
              OptionTextOrigRec.SETRANGE(Option, OptOrig.Option);
              IF OptionTextOrigRec.FINDSET THEN BEGIN
                REPEAT
                  OptionTextDestRec.TRANSFERFIELDS(OptionTextOrigRec);
                  OptionTextDestRec."Project No." := iProjectDest;
                  IF OptionTextDestRec.INSERT THEN;
                UNTIL OptionTextOrigRec.NEXT = 0;
              END;

              //Surcharges in separate table, these are not transferred because surcharge percentage become zero in old situation
              ProjectDataNewBool := TRUE;

              IF (MailToNumber <> '') AND
                 (iPlotDest = '') AND
                 (iProjectDest <> '')  THEN
              BEGIN
                IF NOT WerknemerTempRec.GET(MailToNumber) THEN BEGIN
                  IF WerknemerDestRec.GET(MailToNumber) THEN BEGIN
                    WerknemerTempRec.TRANSFERFIELDS(WerknemerDestRec);
                    WerknemerTempRec.INSERT;
                  END;
                END;
                IF WerknemerTempRec.GET(MailToNumber) THEN BEGIN
                  DummyHrsLineTempRec.SETRANGE("Employee No.",MailToNumber);
                  DummyHrsLineTempRec.SETRANGE("Project No.", iProjectDest);
                  IF NOT DummyHrsLineTempRec.FIND('-') THEN BEGIN
                    NextLineNo := FindLineNoHrsTempRec(MailToNumber);
                    DummyHrsLineTempRec.RESET;
                    DummyHrsLineTempRec.INIT;
                    DummyHrsLineTempRec."Employee No." := MailToNumber;
                    DummyHrsLineTempRec."Project No."  := iProjectDest;
                    DummyHrsLineTempRec.Comment        := ProjRecTo.Description;
                    DummyHrsLineTempRec."Line No."     := NextLineNo;
                    DummyHrsLineTempRec.INSERT;
                  END;
                END;
              END;

              OptOrig."Transaction Date Out" := CURRENTDATETIME;
              OptOrig.MODIFY;

            END;

          END ELSE BEGIN
            IF (OptOrig.Status = OptOrig.Status::Expired) AND (iPlotDest <> '') THEN BEGIN
              IF (OptDest.Status <> OptDest.Status::Invoice) THEN
                OptDest.Status := OptOrig.Status;
            END;
            OptDest.Description := OptOrig.Description;  //Call C001564
            OptDest.MODIFY;
            //IF iPlotDest = '' THEN BEGIN //24-04-2008 sn Call: C-011692
              //(Sales) Delete texts.
              OptionTextDestRec.RESET;
              OptionTextDestRec.SETRANGE(Table, OptionTextOrigRec.Table::Option);
              IF NOT ProjectSetup."Copy Tech Texts" THEN
                OptionTextDestRec.SETRANGE("Text Type", OptionTextOrigRec."Text Type"::Sales);
              OptionTextDestRec.SETFILTER("Project No.", '%1', iProjectDest);
              OptionTextDestRec.SETFILTER("House Model", '%1', OptOrig."House Model");
              OptionTextDestRec.SETFILTER("Option Main Group", '%1', OptOrig."Main Group");
              OptionTextDestRec.SETFILTER("Option Sub Group", '%1', OptOrig."Sub Group");
              OptionTextDestRec.SETFILTER("Option Group", '%1', OptOrig.Group);
              OptionTextDestRec.SETFILTER("Plot No.", '%1', OptOrig."Plot No.");
              OptionTextDestRec.SETFILTER(Option, '%1', OptOrig.Option);
              OptionTextDestRec.DELETEALL;

              //Copy texts.
              OptionTextOrigRec.RESET;
              OptionTextOrigRec.SETRANGE(Table, OptionTextOrigRec.Table::Option);
              IF NOT ProjectSetup."Copy Tech Texts" THEN
                OptionTextOrigRec.SETRANGE("Text Type", OptionTextOrigRec."Text Type"::Sales);
              OptionTextOrigRec.SETRANGE("Project No.", OptOrig."Project No.");
              OptionTextOrigRec.SETRANGE("House Model", OptOrig."House Model");
              OptionTextOrigRec.SETRANGE("Option Main Group", OptOrig."Main Group");
              OptionTextOrigRec.SETRANGE("Option Sub Group", OptOrig."Sub Group");
              OptionTextOrigRec.SETRANGE("Option Group",OptOrig.Group);
              OptionTextOrigRec.SETRANGE("Plot No.", OptOrig."Plot No.");
              OptionTextOrigRec.SETRANGE(Option, OptOrig.Option);
              IF OptionTextOrigRec.FINDSET THEN BEGIN
                REPEAT
                  OptionTextDestRec.TRANSFERFIELDS(OptionTextOrigRec);
                  OptionTextDestRec."Project No." := iProjectDest;
                  IF OptionTextDestRec.INSERT THEN;
                UNTIL OptionTextOrigRec.NEXT = 0;
              END;
            //END; //24-04-2008
          END;
        UNTIL OptOrig.NEXT = 0;
      END;


      //REMOVE OLD:
      IF iProjectDest <> '' THEN BEGIN
        //**Delete option groups
        ProjMainGrpDest.RESET;
        ProjMainGrpOrig.RESET;
        ProjMainGrpDest.SETFILTER("Project No.",'%1', iProjectDest);
        IF ProjMainGrpDest.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            IF NOT ProjMainGrpOrig.GET(iProjectOrig,ProjMainGrpDest.Code) THEN BEGIN
              DeleteTextLines(iCompanyDest,
                BuyerMgtTextRec.Table::"Option Main Group",ProjMainGrpDest."Project No.",'','',ProjMainGrpDest.Code,'','','');
              ProjMainGrpDest.DELETE;
            END;
          UNTIL ProjMainGrpDest.NEXT = 0;
        END;

        ProjGrpDest.RESET;
        ProjGrpOrig.RESET;
        ProjGrpDest.SETFILTER("Project No.",'%1', iProjectDest);
        IF ProjGrpDest.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            IF NOT ProjGrpOrig.GET(iProjectOrig,ProjGrpDest.Code) THEN BEGIN
              DeleteTextLines(iCompanyDest,
                BuyerMgtTextRec.Table::"Option Group",ProjGrpDest."Project No.",'','','',ProjGrpDest.Code,'','');
              ProjGrpDest.DELETE;
            END;
          UNTIL ProjGrpDest.NEXT = 0;
        END;

        ProjSubGrpDest.RESET;
        ProjSubGrpOrig.RESET;
        ProjSubGrpDest.SETFILTER("Project No.",'%1', iProjectDest);
        IF ProjSubGrpDest.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            IF NOT ProjSubGrpOrig.GET(iProjectOrig,ProjSubGrpDest.Code) THEN BEGIN
              DeleteTextLines(iCompanyDest,
                BuyerMgtTextRec.Table::"Option Sub Group",ProjSubGrpDest."Project No.",'','','','',ProjSubGrpDest.Code,'');
              ProjSubGrpDest.DELETE;
            END;
          UNTIL ProjSubGrpDest.NEXT = 0;
        END;

        //**Delete options
        OptOrig.RESET;
        OptDest.RESET;
        OptBudgetDest.RESET;
        OptBudgetOrig.RESET;

        OptDest.SETFILTER("Project No.",'%1', iProjectDest);
        OptDest.SETFILTER("Plot No.", '%1', iPlotDest);
        IF OptDest.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            OptOrig.SETFILTER("Project No.",'%1', iProjectOrig);
            OptOrig.SETRANGE("Plot No.", OptDest."Plot No.");
            OptOrig.SETRANGE("House Model", OptDest."House Model");
            OptOrig.SETRANGE("Main Group", OptDest."Main Group");
            OptOrig.SETRANGE(Group, OptDest.Group);
            OptOrig.SETRANGE("Sub Group", OptDest."Sub Group");
            OptOrig.SETRANGE(Option, OptDest.Option);
            IF NOT OptOrig.FINDSET THEN BEGIN
              //**option budget + summary sheet
              OptBudgetDest.SETRANGE("Project No.", OptDest."Project No.");
              OptBudgetDest.SETRANGE("Plot No.", OptDest."Plot No.");
              OptBudgetDest.SETRANGE("House Model", OptDest."House Model");
              OptBudgetDest.SETRANGE("Main Group", OptDest."Main Group");
              OptBudgetDest.SETRANGE(Group, OptDest.Group);
              OptBudgetDest.SETRANGE("Sub Group", OptDest."Sub Group");
              OptBudgetDest.SETRANGE(Option, OptDest.Option);
              IF OptBudgetDest.FINDSET(TRUE, FALSE) THEN BEGIN
                REPEAT
                  OptBudgetDest.DELETE;
                UNTIL OptBudgetDest.NEXT = 0;
              END;
              //** Summary sheet option budget
              OptBudgSumDest.SETRANGE("Project No.", OptDest."Project No.");
              OptBudgSumDest.SETRANGE("Contract No.", '');
              OptBudgSumDest.SETRANGE("Plot No.", OptDest."Plot No.");
              OptBudgSumDest.SETRANGE("House Model", OptDest."House Model");
              OptBudgSumDest.SETRANGE("Main Group", OptDest."Main Group");
              OptBudgSumDest.SETRANGE(Group, OptDest.Group);
              OptBudgSumDest.SETRANGE("Sub Group", OptDest."Sub Group");
              OptBudgSumDest.SETRANGE(Option, OptDest.Option);
              IF OptBudgSumDest.FINDSET(TRUE, FALSE) THEN BEGIN
                REPEAT
                  OptBudgSumDest.DELETE;
                UNTIL OptBudgSumDest.NEXT = 0;
              END;
              DeleteTextLines(iCompanyDest,
                BuyerMgtTextRec.Table::Option,OptDest."Project No.",OptDest."Plot No.",OptDest."House Model",
                OptDest."Main Group",OptDest.Group,OptDest."Sub Group",OptDest.Option);
              DeleteSurcharges(iCompanyDest,
                OptDest."Project No.",OptDest."Plot No.",OptDest."House Model",
                OptDest."Main Group",OptDest.Group,OptDest."Sub Group",OptDest.Option);
              OptDest.DELETE;
              ProjectDataDelBool := TRUE;
            END;
          UNTIL OptDest.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE CopyDeliveries@1100485004(iCompanyDest@1210190001 : Text[30];iProjectOrig@1210190003 : Code[20];iProjectDest@1210190000 : Code[20];iPlotDest@1210190002 : Code[10]) NewDeliveriesBool : Boolean;
    BEGIN
      NewDeliveriesBool := FALSE;
      IF (iPlotDest = '') OR (iProjectDest = '')  THEN
        EXIT;

      DeliveryOrig.RESET;

      DeliveryDest.CHANGECOMPANY(iCompanyDest);
      DeliveryOrig.SETRANGE("Project No.", iProjectOrig);
      DeliveryOrig.SETRANGE("Plot No.", iPlotDest);

      IF DeliveryOrig.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          IF NOT DeliveryDest.GET(iProjectDest, DeliveryOrig."Plot No.", DeliveryOrig."Delivery No.") THEN BEGIN

              DeliveryDest.TRANSFERFIELDS(DeliveryOrig);
              DeliveryDest."Project No." := iProjectDest;
              DeliveryDest.INSERT;

              NewDeliveriesBool := TRUE;
              ProjectDataNewBool := TRUE;

          END;
        UNTIL DeliveryOrig.NEXT = 0;
      END;
    END;

    PROCEDURE InsertBuyer@4();
    BEGIN
      IF PlotDest.Buyer = '' THEN
        EXIT;
      IF ContactOrigRec.GET(PlotDest.Buyer) THEN BEGIN
        ContactDestRec.CHANGECOMPANY(ProjRecFrom."Joint Company");
        IF NOT ContactDestRec.GET(PlotDest.Buyer) THEN BEGIN
          ContactDestRec.TRANSFERFIELDS(ContactOrigRec);
          ContactDestRec.INSERT;
          ProjectDataNewBool := TRUE;
        END;
      END;
    END;

    PROCEDURE InsertPlotPrincipalOptions@1100485003();
    BEGIN
      IF CustomerOrigRec.GET(PlotDest."Principal Options") THEN BEGIN
        CustomerDestRec.CHANGECOMPANY(ProjRecFrom."Joint Company");
        IF NOT CustomerDestRec.GET(PlotDest."Principal Options") THEN BEGIN
          CustomerDestRec.TRANSFERFIELDS(CustomerOrigRec);
          CustomerDestRec.INSERT;
          ProjectDataNewBool := TRUE;
        END;
      END;
      ProjPrinDest.INIT;
      ProjPrinDest."Project No." := ProjRecTo."No.";
      ProjPrinDest.Principal := PlotDest."Principal Options";
      ProjPrinDest."Main Project No." := ProjRecTo."Main Project";
      ProjPrinDest."Collect Installment Invoice By" := ProjectSetupDest."Default Collect Inst. Inv. By";
      //ProjPrinDest."One Plot per Installm. Invoice" := ProjectSetupDest."Default One Plot p. Inst. Inv.";
      ProjPrinDest.INSERT;
    END;

    PROCEDURE CopyHouseModels@1210190000(iCompanyDest@1210190000 : Text[30];iProjectOrig@1210190002 : Code[20];iProjectDest@1210190001 : Code[20]) NewHouseModelsBool : Boolean;
    BEGIN
      NewHouseModelsBool := FALSE;
      ProjModelDest.CHANGECOMPANY(iCompanyDest);
      ProjUnitDest.CHANGECOMPANY(iCompanyDest);
      OptDest.CHANGECOMPANY(iCompanyDest);
      ProjModelOrig.SETFILTER("Project No.", '%1', iProjectOrig);

      IF iProjectOrig <> '' THEN                                        //22-10-2008 new
        ProjModelOrig.SETFILTER(Model, HouseModelFilter)                //
      ELSE                                                              //
        ProjModelOrig.SETFILTER(Model, '');                             //

      IF ProjModelOrig.FINDSET THEN BEGIN
        REPEAT
          IF ProjModelDest.GET(iProjectDest, ProjModelOrig.Model) THEN BEGIN
            ProjModelDest.TRANSFERFIELDS(ProjModelOrig, FALSE);
            ProjModelDest."Project No." := iProjectDest;
            ProjModelDest.MODIFY;
            ProjectDataUpdBool := TRUE;
          END ELSE BEGIN
            ProjModelDest.TRANSFERFIELDS(ProjModelOrig);
            ProjModelDest."Project No." := iProjectDest;
            ProjModelDest.INSERT;
            ProjectDataNewBool := TRUE;
            NewHouseModelsBool := TRUE;
          END;
          ProjUnitOrig.SETFILTER("Project No.", '%1', ProjModelOrig."Project No.");
          ProjUnitOrig.SETFILTER(Model, '%1', ProjModelOrig.Model);
          IF ProjUnitOrig.FINDSET THEN BEGIN
            REPEAT
              IF ProjUnitDest.GET(iProjectDest, ProjUnitOrig.Model,ProjUnitOrig.Unit) THEN BEGIN
                ProjUnitDest.TRANSFERFIELDS(ProjUnitOrig, FALSE);
                ProjUnitDest."Project No." := iProjectDest;
                ProjUnitDest.MODIFY;
                ProjectDataUpdBool := TRUE;
              END ELSE BEGIN
                ProjUnitDest.TRANSFERFIELDS(ProjUnitOrig);
                ProjUnitDest."Project No." := iProjectDest;
                ProjUnitDest.INSERT;
                ProjectDataNewBool := TRUE;
              END;
            UNTIL ProjUnitOrig.NEXT = 0;
          END;
        UNTIL ProjModelOrig.NEXT = 0;
      END;

      //** Delete redundant lines
      IF iProjectDest <> '' THEN BEGIN
        ProjModelOrig.RESET;
        ProjModelDest.RESET;
        ProjUnitOrig.RESET;
        ProjUnitDest.RESET;
        OptDest.RESET;
        ProjModelDest.SETFILTER("Project No.", '%1', iProjectDest);
        IF ProjModelDest.FINDSET(TRUE, FALSE) THEN BEGIN
          REPEAT
            IF ProjModelOrig.GET(iProjectOrig, ProjModelDest.Model) THEN BEGIN
              ProjUnitDest.SETFILTER("Project No.",'%1', iProjectDest);
              ProjUnitDest.SETFILTER(Model,'%1',ProjModelOrig.Model);
              IF ProjUnitDest.FINDSET(TRUE, FALSE) THEN BEGIN
                REPEAT
                  IF NOT ProjUnitOrig.GET(iProjectOrig,ProjUnitDest.Model,ProjUnitDest.Unit) THEN BEGIN
                    ProjUnitDest.DELETE;
                  END;
                UNTIL ProjUnitDest.NEXT = 0;
              END;
            END ELSE BEGIN
              OptDest.SETFILTER("Project No.",'%1', ProjModelDest."Project No.");
              OptDest.SETFILTER("House Model", '%1', ProjModelDest.Model);
              IF NOT OptDest.FINDFIRST THEN BEGIN
                ProjUnitDest.SETFILTER("Project No.",'%1', ProjModelDest."Project No.");
                ProjUnitDest.SETFILTER(Model,'%1',ProjModelDest.Model);
                ProjUnitDest.DELETEALL;
                DeleteTextLines(iCompanyDest,
                  BuyerMgtTextRec.Table::"House Model",ProjModelDest."Project No.",'',ProjModelDest.Model,'','','','');
                ProjModelDest.DELETE;
              END;
            END;
          UNTIL ProjModelDest.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE DeleteTextLines@1210190005(ICompany@1210190008 : Text[30];ITable@1210190000 : Option;IProject@1210190001 : Code[20];IPlot@1210190002 : Code[10];IModel@1210190003 : Code[20];IMGrp@1210190004 : Code[20];IGrp@1210190005 : Code[20];ISGrp@1210190006 : Code[20];IOption@1210190007 : Code[20]);
    BEGIN
      WITH BuyerMgtTextRec DO BEGIN
        CHANGECOMPANY(ICompany);
        RESET;
        SETRANGE(Table, ITable);
        SETRANGE("Project No.", IProject);
        CASE ITable OF
          Table::"House Model":
            SETRANGE("House Model", IModel);
          Table::"Option Main Group":
            SETRANGE("Option Main Group", IMGrp);
          Table::"Option Group":
            SETRANGE("Option Group", IGrp);
          Table::"Option Sub Group":
            SETRANGE("Option Sub Group", ISGrp);
          Table::Option:
            BEGIN
              SETRANGE("Plot No.", IPlot);
              SETRANGE("House Model", IModel);
              SETRANGE("Option Main Group", IMGrp);
              SETRANGE("Option Group", IGrp);
              SETRANGE("Option Sub Group", ISGrp);
              SETRANGE(Option, IOption);
            END;
        END;
        DELETEALL;
      END;
    END;

    PROCEDURE DeleteSurcharges@1210190013(ICompany@1210190008 : Text[30];IProject@1210190006 : Code[20];IPlot@1210190005 : Code[10];IModel@1210190004 : Code[20];IMGrp@1210190003 : Code[20];IGrp@1210190002 : Code[20];ISGrp@1210190001 : Code[20];IOption@1210190000 : Code[20]);
    BEGIN
      WITH OptSurchRec DO BEGIN
        CHANGECOMPANY(ICompany);
        RESET;
        SETRANGE("Project No.", IProject);
        SETRANGE("Plot No.", IPlot);
        SETRANGE("House Model", IModel);
        SETRANGE("Main Group", IMGrp);
        SETRANGE(Group, IGrp);
        SETRANGE("Sub Group", ISGrp);
        SETRANGE(Option, IOption);
        DELETEALL;
      END;
    END;

    PROCEDURE SendMail@1210190004();
    VAR
      OutlookAutomation@1210190002 : Codeunit 11012030;
      FirstLine@1210190000 : Boolean;
    BEGIN
      //** Function: SendMail

      OutlookAutomation.InitOutlook();
      OutlookAutomation.InitNewMail();
      OutlookAutomation.AddMailRecipient(WerknemerTempRec."E-Mail");
      OutlookAutomation.SetMailSubject(Text004);
      OutlookAutomation.AddLine('LS');
      OutlookAutomation.AddLine('');
      OutlookAutomation.AddLine(Text002);
      OutlookAutomation.AddLine(Text003);
      OutlookAutomation.AddLine('');
      OutlookAutomation.AddLine('');
      DummyHrsLineTempRec.RESET;
      DummyHrsLineTempRec.SETRANGE("Employee No.",WerknemerTempRec."No.");
      IF DummyHrsLineTempRec.FIND('-') THEN BEGIN
        FirstLine := TRUE;
        REPEAT
          IF FirstLine THEN BEGIN
            OutlookAutomation.AddLine(STRSUBSTNO(Text016,DummyHrsLineTempRec."Project No.",
                                                  DummyHrsLineTempRec.Comment));
            FirstLine := FALSE;
          END ELSE BEGIN
            OutlookAutomation.AddLine(STRSUBSTNO(Text018,DummyHrsLineTempRec."Project No.",
                                                  DummyHrsLineTempRec.Comment))
          END;
        UNTIL DummyHrsLineTempRec.NEXT = 0;
      END;
      OutlookAutomation.SetMailBody;
      //  OutlookAutomation.AddAttachment(lFileHTMLName);
      OutlookAutomation.SendMail();
      OutlookAutomation.TermNewMail();
      OutlookAutomation.TermOutlook();
      //  ERASE(lFileHTMLName);
    END;

    PROCEDURE CheckLastUpdateCompany@1210190007();
    BEGIN
      //Below could also be done with flowfields/flowfilters.
      OptOrig.RESET;
      OptOrig.SETFILTER("Project No.",'%1', '');
      OptOrig.SETFILTER("Plot No.", '%1', '');
      OptOrig.SETFILTER(OptOrig."Transaction Date Out", '>%1',0DT);
      LastUpdateStandardOptions := 0DT;
      IF OptOrig.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
        IF LastUpdateStandardOptions < OptOrig."Transaction Date Out" THEN
           LastUpdateStandardOptions := OptOrig."Transaction Date Out";
        UNTIL OptOrig.NEXT = 0;
      END;

      OptOrig.SETRANGE("Budget Changed by Integration", TRUE);
      OptOrig.SETFILTER(OptOrig."Transaction Date Out",'');
      IF OptOrig.FINDFIRST THEN
        StandardOptionsToProcess := StandardOptionsToProcess::"In standaard nieuwe optiebegrotingen"
      ELSE
        StandardOptionsToProcess := StandardOptionsToProcess::"In standaard geen nieuwe optiebegrotingen";

      OptOrig.RESET;
    END;

    PROCEDURE CheckLastUpdateProject@1210190008();
    BEGIN
      OptOrig.RESET;
      ProjRecFrom.RESET;
      LastupdateProjectOptions := 0DT;
      LastUpdatePlotOptions := 0DT;
      ProjectOptionsToProcess := ProjectOptionsToProcess::" ";

      IF (ProjFromFilter <> '') THEN BEGIN
        ProjRecFrom.SETFILTER("No.",ProjFromFilter);
        ProjRecFrom.SETFILTER("Joint Company", '<>%1', '');
        IF ProjRecFrom.FINDFIRST THEN BEGIN
          IF ProjFromFilter = ProjRecFrom."No." THEN BEGIN
            OptOrig.SETFILTER("Project No.",'%1', ProjRecFrom."No.");
            OptOrig.SETFILTER("Plot No.", '%1', '');
            OptOrig.SETFILTER(OptOrig."Transaction Date Out", '>%1',0DT);
            LastupdateProjectOptions := 0DT;
            IF OptOrig.FINDSET(FALSE, FALSE) THEN BEGIN
              REPEAT
                IF LastupdateProjectOptions < OptOrig."Transaction Date Out" THEN
                  LastupdateProjectOptions := OptOrig."Transaction Date Out";
              UNTIL OptOrig.NEXT = 0;
            END;

            OptOrig.SETFILTER("Plot No.", '<>%1', '');
            LastUpdatePlotOptions := 0DT;
            IF OptOrig.FINDSET(FALSE, FALSE) THEN BEGIN
              REPEAT
                IF LastUpdatePlotOptions < OptOrig."Transaction Date Out" THEN
                  LastUpdatePlotOptions := OptOrig."Transaction Date Out";
              UNTIL OptOrig.NEXT = 0;
            END;

            OptOrig.SETRANGE("Budget Changed by Integration", TRUE);
            OptOrig.SETFILTER(OptOrig."Transaction Date Out",'');
            OptOrig.SETFILTER("Plot No.", '%1', '');
            IF OptOrig.FINDFIRST THEN
              ProjectOptionsToProcess := ProjectOptionsToProcess::"In project nieuwe optiebegrotingen"
            ELSE
              ProjectOptionsToProcess := ProjectOptionsToProcess::"In project geen nieuwe optiebegrotingen";
            OptOrig.RESET;

            IF ProjRecFrom."Joint Company" <> COMPANYNAME THEN BEGIN
              ProjRecTo.CHANGECOMPANY(ProjRecFrom."Joint Company");
              WerknemerDestRec.CHANGECOMPANY(ProjRecFrom."Joint Company");
              IF ProjRecFrom."Joint Job No."  <> ''THEN BEGIN
                IF ProjRecTo.GET(ProjRecFrom."Joint Job No.") THEN BEGIN
                  IF WerknemerDestRec.GET(ProjRecTo."Project Engineer") THEN BEGIN
                    MailToName := WerknemerDestRec."Full Name";
                    MailToAddress := WerknemerDestRec."E-Mail";
                    MailToNumber := WerknemerDestRec."No.";
                  END;
                END;
              END;
            END;
          END;
        END;
      END;
    END;

    PROCEDURE FindLineNoHrsTempRec@1210190010(iEmployee@1210190000 : Code[20]) : Integer;
    BEGIN
      DummyHrsLineTempRec.RESET;
      DummyHrsLineTempRec.SETRANGE("Employee No.",iEmployee);
      IF DummyHrsLineTempRec.FIND('+') THEN
        EXIT(DummyHrsLineTempRec."Line No." + 1)
      ELSE
        EXIT(1);
    END;

    PROCEDURE AddMessage@1100485000(ToCompany@1100485000 : Text[50];FromCompany@1100485004 : Text[50];FromProject@1100485001 : Code[20];FromPlot@1100485002 : Code[20];lText@1100485003 : Text[250]);
    BEGIN
      ActivityReport.AddMessage(ToCompany,FromCompany,FromProject,FromPlot,lText);
      LinesPrinted := TRUE;
    END;

    LOCAL PROCEDURE EmailActiveOnAfterValidate@19030275();
    BEGIN
      IF EmailActive THEN BEGIN
        MailToAddressEditable := TRUE;
        MailToNameEditable := TRUE;
      END ELSE BEGIN
        MailToNumber := '';
        MailToName := '';
        MailToAddress := '';
        MailToAddressEditable := FALSE;
        MailToNameEditable := FALSE;
      END;
    END;

    LOCAL PROCEDURE ValidateCompanyDestiny@1100528600();
    VAR
      Company@1100525000 : Record 2000000006;
    BEGIN
      IF CompanyDestiny = COMPANYNAME THEN
        ERROR(Text015,CompanyDestiny);

      Company.GET(CompanyDestiny);

      ProjectSetupDest.CHANGECOMPANY(CompanyDestiny);
      ProjectSetupDest.FIND('-');

      IF ProjectSetupDest."Company Type" <> ProjectSetup."Company Type"::"Construction Company" THEN
        ERROR(Text014,CompanyDestiny);

      CheckLastUpdateCompany();
    END;

    BEGIN
    END.
  }
}

