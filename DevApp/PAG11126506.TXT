OBJECT Page 11126506 Approve Credit Memos DC
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    Permissions=TableData 124=rimd;
    CaptionML=ENU=Registered Credit Memo;
    InsertAllowed=No;
    DeleteAllowed=No;
    SourceTable=Table124;
    SourceTableView=WHERE(Credit Memo Approved=CONST(No));
    PageType=Document;
    RefreshOnActivate=Yes;
    PromotedActionCategoriesML=ENU=New,Process,Report,Mail Documents,4,Approval Administration,Approval;
    OnInit=BEGIN
             "Ext. Document IDEditable" := TRUE;
             "Ext. Document IDVisible" := TRUE;
             DropZoneContainerVisible := TRUE;
             "Remain On HoldEditable" := TRUE;
             PostingVisible := TRUE;
           END;

    OnOpenPage=VAR
                 JnlSelected@1100525001 : Boolean;
               BEGIN
                 //**4PS Generated Code. Do Not Change.sn01
                 DPA_IsHardFilter := DPA_SetFilters(CurrPage.OBJECTID(FALSE));
                 //**4PS Generated Code.en01

                 //DP00065.en
                 IF ApprJnlTemplate <> '' THEN BEGIN
                   FILTERGROUP(2);
                   SETRANGE("Journal Template", ApprJnlTemplate);
                   FILTERGROUP(0);
                   JnlSelected := TRUE;
                 END ELSE
                 //DP00065.en
                 //* There is not a special template for approve credit memos, so argument must be form "Approve Purchase Invoices"
                 //* instead of form "Approve Credit Memos". Call 16929
                 //RTC so
                 //this is executed in list 11130197 now
                 //GenJnlManagement.TemplateSelectPurchCrMemoAppr(FORM::"Approve Purchase Invoices",13,Rec,JnlSelected);
                 //IF NOT JnlSelected THEN
                 //  ERROR('');
                 //RTC eo

                 PurchSetup.GET;
                 IF PurchSetup."Scanning Application Purch.Inv" <> PurchSetup."Scanning Application Purch.Inv"::Other THEN BEGIN
                   "Ext. Document IDEditable" := FALSE;
                   "Ext. Document IDVisible" := FALSE;
                 END;

                 OnHoldEditable := PurchSetup."On Hold Maintainable"; // Call C-026615

                 RemainOnHoldEditable :=
                   (PurchSetup."Scanning Application Purch.Inv" <> PurchSetup."Scanning Application Purch.Inv"::Managemind) AND
                   "Remain On HoldEditable"; //This might be changed bij user
               END;

    OnAfterGetRecord=VAR
                       lVendLedgEntryRec@1100485000 : Record 25;
                       lvTmpDummyErrorRec@1100485002 : TEMPORARY Record 11012052;
                       lvWKACalcCU@1100485001 : Codeunit 11012020;
                     BEGIN
                       IF gFromReference THEN BEGIN
                         gFromReference := FALSE;
                         CurrPage.ApprovalLines.PAGE.InitSelectionFromReference(gApprLineNo);
                       END;

                       ApprovalFlowCode := PurchCrMemoHdrDCInfo.GetApprovalFlowCode(Rec);

                       gWKAPresent := FALSE;
                       IF "Subcontractor Credit Memo" = TRUE THEN BEGIN
                         lVendLedgEntryRec.SETRANGE("Document Type",lVendLedgEntryRec."Document Type"::"Credit Memo");
                         lVendLedgEntryRec.SETRANGE("Document No.","No.");
                         lVendLedgEntryRec.SETRANGE("Vendor No.","Buy-from Vendor No.");
                         IF lVendLedgEntryRec.FIND('-') THEN
                           gWKAPresent := lvWKACalcCU.CheckExternal(lVendLedgEntryRec, lvTmpDummyErrorRec);
                       END;
                     END;

    OnNewRecord=BEGIN
                  //**4PS Generated Code. Do Not Change.sn02
                  DPA_SetDefaultDepartment;
                  //**4PS Generated Code.en02
                END;

    OnInsertRecord=VAR
                     xRecRef@1100000999 : RecordRef;
                   BEGIN
                     //**4PS Generated Code. Do Not Change.sn05
                     xRecRef.GETTABLE(xRec);
                     DPA_SetDefaultDpmtFromNoSeries(xRecRef);
                     //**4PS Generated Code.en05
                   END;

    OnAfterGetCurrRecord=VAR
                           RecRef@1100525000 : RecordRef;
                         BEGIN
                           UpdateControls;
                           RecRef.GETTABLE(Rec);
                         END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 120     ;1   ;ActionGroup;
                      CaptionML=ENU=&Cr. Memo }
      { 122     ;2   ;Action    ;
                      ShortCutKey=F7;
                      CaptionML=ENU=Statistics;
                      RunObject=Page 401;
                      RunPageLink=No.=FIELD(No.);
                      Promoted=Yes;
                      Image=Statistics;
                      PromotedCategory=Process }
      { 123     ;2   ;Action    ;
                      CaptionML=ENU=Co&mments;
                      RunObject=Page 66;
                      RunPageLink=Document Type=CONST(Posted Credit Memo),
                                  No.=FIELD(No.);
                      Image=ViewComments }
      { 1000000001;2 ;Action    ;
                      CaptionML=ENU=Dimensions;
                      Image=Dimensions;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 1100528206;2 ;Action    ;
                      CaptionML=ENU=Approvals;
                      Image=Approvals;
                      OnAction=VAR
                                 ApprovalEntries@1001 : Page 658;
                               BEGIN
                                 ApprovalEntries.Setfilters(DATABASE::"Purch. Cr. Memo Hdr.",3,"No.");
                                 ApprovalEntries.RUN;
                               END;
                                }
      { 1100485005;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+S;
                      CaptionML=ENU=Scanned Document;
                      Image=Document;
                      OnAction=VAR
                                 lvPurchSetupRec@1100485003 : Record 312;
                               BEGIN
                                 lvPurchSetupRec.GET;
                                 lvPurchSetupRec.ShowScannedDocument(3, "No.","Buy-from Vendor No.","Ext. Document ID");
                               END;
                                }
      { 1100485006;2 ;Action    ;
                      CaptionML=ENU=Co&nsent Lines;
                      Visible=FALSE;
                      Enabled=FALSE;
                      Image=BOMLedger;
                      OnAction=VAR
                                 ConsentUserSetup@1100485002 : Record 11012229;
                                 ConsentManCU@1100485000 : Codeunit 11012132;
                               BEGIN
                                 IF ConsentUserSetup.READPERMISSION THEN
                                   ConsentManCU.HandleCreditMemoHeader(Rec,4,TRUE,FALSE);
                               END;
                                }
      { 1100528400;2 ;Action    ;
                      CaptionML=ENU=Consent;
                      Visible=FALSE;
                      Enabled=FALSE;
                      Image=BOMLedger;
                      OnAction=VAR
                                 ConsentManagement@1100528401 : Codeunit 11012132;
                                 ConsentLine@1100528400 : Record 11012226;
                               BEGIN
                                 ConsentManagement.ConsentDocumentConsentLines(
                                   TRUE,
                                   ConsentLine."Document Type"::"Posted Credit Memo",
                                   "No.");
                               END;
                                }
      { 1100528702;2 ;Action    ;
                      CaptionML=ENU=Documents;
                      Image=Documents;
                      OnAction=VAR
                                 RecRef@1100528700 : RecordRef;
                                 DocumentFilters@1100528701 : Codeunit 11012432;
                               BEGIN
                                 RecRef.GETTABLE(Rec);
                                 DocumentFilters.CreateTempFilterAndExecute1(RecRef, "Shortcut Dimension 1 Code", FALSE, TRUE);
                               END;
                                }
      { 1210190016;2 ;Action    ;
                      CaptionML=ENU=ICF Specifications;
                      Image=SetupList;
                      OnAction=BEGIN
                                 ShowICFInvoiceLines;
                               END;
                                }
      { 1100528220;2 ;ActionGroup;
                      CaptionML=ENU=&Approval;
                      Image=BOMLedger }
      { 1100528217;3 ;Action    ;
                      CaptionML=ENU=Approval Entries;
                      RunObject=Page 6085711;
                      RunPageView=WHERE(Table ID=CONST(124),
                                        Document Type=CONST(Credit Memo));
                      RunPageLink=Document No.=FIELD(No.);
                      Image=BOMLedger }
      { 1100528218;3 ;Action    ;
                      CaptionML=ENU=Approval Comments;
                      RunObject=Page 6085713;
                      RunPageView=WHERE(Table ID=CONST(124),
                                        Document Type=CONST(Credit Memo));
                      RunPageLink=Document No.=FIELD(No.) }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 112     ;1   ;Action    ;
                      CaptionML=ENU=&Navigate;
                      Promoted=Yes;
                      Image=Navigate;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Navigate;
                               END;
                                }
      { 1100528404;1 ;ActionGroup;
                      CaptionML=ENU=Release;
                      Image=Release }
      { 1100528403;2 ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=ENU=Re&lease;
                      Promoted=Yes;
                      Image=ReleaseDoc;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 Release;
                               END;
                                }
      { 1100528401;2 ;Action    ;
                      CaptionML=ENU=Re&open;
                      Image=ReOpen;
                      OnAction=BEGIN
                                 Reopen;
                               END;
                                }
      { 1210190008;1 ;ActionGroup;
                      CaptionML=ENU=F&unctions }
      { 1100525011;2 ;ActionGroup;
                      CaptionML=ENU=Get;
                      Image=Import }
      { 1210190009;3 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=ENU=Get Allo&cation;
                      Image=LedgerEntries;
                      OnAction=VAR
                                 GetAllocation@1210190000 : Codeunit 11012048;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 GetAllocation.PurchaseCrMemoApproval(Rec);
                               END;
                                }
      { 1210190010;3 ;Action    ;
                      ShortCutKey=Ctrl+F11;
                      Ellipsis=Yes;
                      CaptionML=ENU=&Get Receipt Lines;
                      Image=GetLines;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 CurrPage.ApprovalLines.PAGE.GetReceipt;
                               END;
                                }
      { 1100485094;3 ;Action    ;
                      CaptionML=ENU=Get Plant Rent Entries;
                      Image=GetLines;
                      OnAction=VAR
                                 GetPlantRentEntries@1100525000 : Report 11012589;
                               BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 TESTFIELD("No.");
                                 TESTFIELD("Buy-from Vendor No.");
                                 GetPlantRentEntries.SetSelections("No.", DATABASE::"Purch. Cr. Memo Hdr.", TRUE, FALSE);
                                 GetPlantRentEntries.RUNMODAL;
                               END;
                                }
      { 1100525002;2 ;Action    ;
                      CaptionML=ENU=Create Invoice Lines for Sub Projects;
                      Image=Split;
                      OnAction=BEGIN
                                 TESTFIELD("Status (Approval)", "Status (Approval)"::Open);
                                 DistrPurchLinesOverSubProjects(Rec);
                               END;
                                }
      { 1100528211;2 ;Action    ;
                      CaptionML=ENU=Send A&pproval Request;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=SendApprovalRequest;
                      PromotedCategory=Category6;
                      OnAction=VAR
                                 ConsentManagement@1100528200 : Codeunit 11012132;
                               BEGIN
                                 ConsentManagement.SendPurchInvHdrApprovalRequest(3,"No.",TRUE);
                               END;
                                }
      { 1100528210;2 ;Action    ;
                      CaptionML=ENU=Cancel Approval Re&quest;
                      Promoted=Yes;
                      Image=Cancel;
                      PromotedCategory=Category6;
                      OnAction=BEGIN
                                 //FIXME Approvals
                                 //ApprovalMgt.CancelPurchCrMApprovalRequest(Rec,TRUE,TRUE);
                               END;
                                }
      { 1100528209;2 ;Action    ;
                      CaptionML=ENU=&Force Approval;
                      Promoted=Yes;
                      Image=EncryptionKeys;
                      PromotedCategory=Category6;
                      OnAction=BEGIN
                                 DCApprovalMgnt.ForceApprovalCM4PS(Rec);
                               END;
                                }
      { 1100525015;2 ;Action    ;
                      ShortCutKey=Shift+Ctrl+W;
                      CaptionML=ENU=Start DMS Workflow;
                      RunObject=Codeunit 11012216;
                      Image=StepInto }
      { 1210190004;2 ;Action    ;
                      CaptionML=ENU=By-Pass DMS Workflow;
                      RunObject=Codeunit 11012213;
                      Image=StepOver }
      { 1100528216;1 ;ActionGroup;
                      CaptionML=ENU=&Approval }
      { 1100528215;2 ;Action    ;
                      CaptionML=ENU=&Approve;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Approve;
                      PromotedCategory=Category7;
                      OnAction=BEGIN
                                 DCApprovalMgnt.ApproveCM4PS(Rec);
                                 IF MARKEDONLY THEN
                                   MARK(FALSE);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100528214;2 ;Action    ;
                      CaptionML=ENU=&Reject;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Reject;
                      PromotedCategory=Category7;
                      OnAction=BEGIN
                                 DCApprovalMgnt.RejectPurchCrMemoHdr4PS(Rec);
                                 IF MARKEDONLY THEN
                                   MARK(FALSE);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100528213;2 ;Action    ;
                      CaptionML=ENU=&Forward;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Delegate;
                      PromotedCategory=Category7;
                      OnAction=BEGIN
                                 DCApprovalMgnt.DelegateCM4PS(Rec);
                                 IF MARKEDONLY THEN
                                   MARK(FALSE);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100528208;2 ;Action    ;
                      CaptionML=ENU=&On Hold;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Lock;
                      PromotedCategory=Category7;
                      OnAction=BEGIN
                                 DCApprovalMgnt.SwitchOnHold4PS(3, "No.",TRUE,TRUE);
                                 CurrPage.UPDATE;
                               END;
                                }
      { 1100525009;1 ;ActionGroup;
                      CaptionML=ENU=Subcontracting }
      { 124     ;2   ;Action    ;
                      CaptionML=ENU=&WKA Data;
                      RunObject=Page 11012060;
                      RunPageLink=Vendor No.=FIELD(Buy-from Vendor No.),
                                  Document No.=FIELD(No.);
                      Image=SubcontractingWorksheet;
                      PromotedCategory=Process }
      { 114     ;1   ;ActionGroup;
                      CaptionML=ENU=P&osting;
                      Visible=PostingVisible }
      { 115     ;2   ;Action    ;
                      CaptionML=ENU=Test Report;
                      RunObject=Report 11012045;
                      Visible=PostingVisible;
                      Image=TestReport }
      { 116     ;2   ;Action    ;
                      CaptionML=ENU=&Checklist;
                      RunObject=Report 11012065;
                      Visible=PostingVisible;
                      Image=CheckList }
      { 1210190002;2 ;Action    ;
                      ShortCutKey=F9;
                      CaptionML=ENU=Post;
                      Promoted=Yes;
                      Visible=PostingVisible;
                      PromotedIsBig=Yes;
                      Image=Post;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 IF NOT CONFIRM(Text000) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,FALSE);  //print=false; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1210190003;2 ;Action    ;
                      ShortCutKey=Shift+F9;
                      CaptionML=ENU=Post and Print;
                      Promoted=Yes;
                      Visible=PostingVisible;
                      PromotedIsBig=Yes;
                      Image=PostPrint;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE); //**4PS.n

                                 IF NOT CONFIRM(Text001) THEN
                                   EXIT;

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,FALSE);  //print=true; batch=false
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 117     ;2   ;Action    ;
                      ShortCutKey=Ctrl+F9;
                      CaptionML=ENU=Post &Batch;
                      Visible=PostingVisible;
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(FALSE,TRUE);  //print=false; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 118     ;2   ;Action    ;
                      ShortCutKey=Shift+F11;
                      CaptionML=ENU=Batch Post and &Print;
                      Visible=PostingVisible;
                      Image=PostBatch;
                      OnAction=VAR
                                 GenJournalTemplatePerRole@1100525001 : Record 11020419;
                               BEGIN
                                 IF NOT CONFIRM(Text001) THEN
                                   EXIT;

                                 GenJournalTemplatePerRole.CheckPermission(TABLECAPTION, "Journal Template",TRUE);

                                 CurrPage.ApprovalLines.PAGE.Post(TRUE,TRUE);  //print=true; batch=true
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1100409001;1 ;ActionGroup;
                      CaptionML=ENU=Mail Documents;
                      ActionContainerType=NewDocumentItems }
      { 1100409000;2 ;Action    ;
                      CaptionML=ENU=Buy-from Vendor;
                      Promoted=Yes;
                      Image=MailAttachment;
                      PromotedCategory=Category4;
                      OnAction=VAR
                                 Contact@1100409002 : Record 5050;
                                 Vendor@1100409001 : Record 23;
                               BEGIN
                                 TESTFIELD("Buy-from Vendor No.");
                                 IF Contact.GetContactByVendor("Buy-from Vendor No.", Contact, TRUE) THEN BEGIN
                                   Vendor.GET("Buy-from Vendor No.");
                                   EditDocuments(Contact."No.", '', TRUE, Vendor."E-Mail");
                                 END;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=ENU=General }

    { 2   ;2   ;Field     ;
                SourceExpr="No.";
                Editable=FALSE }

    { 6   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor No.";
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                SourceExpr="Buy-from Vendor Name";
                Editable=FALSE }

    { 10  ;2   ;Field     ;
                SourceExpr="Buy-from Address";
                Importance=Additional;
                Editable=FALSE }

    { 17  ;2   ;Field     ;
                SourceExpr="Buy-from Post Code";
                Importance=Additional;
                Editable=FALSE }

    { 12  ;2   ;Field     ;
                SourceExpr="Buy-from City";
                Importance=Additional;
                Editable=FALSE }

    { 13  ;2   ;Field     ;
                SourceExpr="Buy-from Contact";
                Editable=FALSE }

    { 1210190014;2;Field  ;
                SourceExpr="Pre-Assigned No.";
                Editable=FALSE }

    { 31  ;2   ;Field     ;
                SourceExpr="Vendor Cr. Memo No.";
                Editable=FALSE }

    { 1100485008;2;Field  ;
                SourceExpr="Ext. Document ID";
                Visible="Ext. Document IDVisible";
                Editable="Ext. Document IDEditable" }

    { 35  ;2   ;Field     ;
                SourceExpr="Subcontractor Credit Memo";
                Editable=FALSE }

    { 1100485002;2;Field  ;
                CaptionML=ENU=WKA Data present;
                SourceExpr=gWKAPresent;
                Editable=FALSE }

    { 1100485000;2;Field  ;
                SourceExpr="Amounts only" }

    { 1100525008;2;Field  ;
                Name=Consent Lines;
                SourceExpr="Consent Lines" }

    { 15  ;2   ;Field     ;
                SourceExpr="Posting Date";
                Editable=FALSE }

    { 19  ;2   ;Field     ;
                SourceExpr="Document Date";
                Editable=FALSE }

    { 29  ;2   ;Field     ;
                SourceExpr="On Hold";
                Editable=OnHoldEditable;
                OnValidate=BEGIN
                             OnHoldOnAfterValidate;
                           END;
                            }

    { 27  ;2   ;Field     ;
                SourceExpr="Approvement Initials";
                Editable=FALSE }

    { 33  ;2   ;Field     ;
                SourceExpr="Remain On Hold";
                Editable="Remain On HoldEditable" }

    { 1100528205;2;Field  ;
                CaptionML=ENU=Approval Flow Code;
                SourceExpr=ApprovalFlowCode;
                OnValidate=BEGIN
                             PurchCrMemoHdrDCInfo.UpdateApprovalFlowCode(Rec,ApprovalFlowCode);
                           END;

                OnLookup=BEGIN
                           EXIT(PurchCrMemoHdrDCInfo.LookupApprovalFlowCode(Text));
                         END;
                          }

    { 1100528201;2;Field  ;
                CaptionML=ENU=Approval by;
                SourceExpr=DCApprovalMgnt.GetNextApprover4PS(3, "No.") }

    { 1100528203;2;Field  ;
                CaptionML=ENU=Approval Entries;
                BlankZero=Yes;
                SourceExpr=DCApprovalMgnt.GetNoOfApprovalEntries4PS(3,"No.");
                OnDrillDown=BEGIN
                              DCApprovalMgnt.DrillDownApprovalEntries4PS(3, "No.");
                            END;
                             }

    { 1100528202;2;Field  ;
                CaptionML=ENU=Approval Comments;
                BlankZero=Yes;
                SourceExpr=DCApprovalMgnt.GetNoOfApprovalComments4PS(3, "No.");
                OnDrillDown=BEGIN
                              DCApprovalMgnt.DrillDownApprovalComments4PS(3, "No.");
                            END;
                             }

    { 1100528200;2;Field  ;
                CaptionML=ENU=No. of Documents;
                BlankZero=Yes;
                SourceExpr=DocMgt.GetNoOfDocForDoc(DATABASE::"Purchase Header",3,"No.",0);
                Editable=FALSE;
                OnDrillDown=BEGIN
                              DocMgt.LookupDocsForDoc(DATABASE::"Purchase Header",3,"No.",0)
                            END;
                             }

    { 1210190000;2;Field  ;
                SourceExpr="Job No.";
                OnValidate=BEGIN
                             JobNoOnAfterValidate;
                           END;
                            }

    { 1210190019;2;Field  ;
                SourceExpr="Purchaser Code" }

    { 1100485009;2;Field  ;
                SourceExpr="Service Order No.";
                OnValidate=BEGIN
                             ServiceOrderNoOnAfterValidate;
                           END;
                            }

    { 1210190007;2;Field  ;
                SourceExpr="Related Purch. Order No.";
                OnValidate=BEGIN
                             RelatedPurchOrderNoOnAfterVali;
                           END;
                            }

    { 1100528402;2;Field  ;
                SourceExpr="Status (Approval)" }

    { 111 ;1   ;Part      ;
                Name=ApprovalLines;
                SubPageLink=Journal Template Name=FIELD(Journal Template),
                            Document Type=CONST(Credit Memo),
                            Document No.=FIELD(No.);
                PagePartID=Page11012067 }

    { 1905885101;1;Group  ;
                CaptionML=ENU=Invoicing }

    { 37  ;2   ;Field     ;
                SourceExpr="Pay-to Vendor No.";
                Importance=Promoted;
                Editable=FALSE }

    { 39  ;2   ;Field     ;
                SourceExpr="Pay-to Name";
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                SourceExpr="Pay-to Address";
                Editable=FALSE }

    { 43  ;2   ;Field     ;
                SourceExpr="Pay-to Address 2";
                Editable=FALSE }

    { 60  ;2   ;Field     ;
                SourceExpr="Pay-to Post Code";
                Editable=FALSE }

    { 45  ;2   ;Field     ;
                SourceExpr="Pay-to City";
                Editable=FALSE }

    { 46  ;2   ;Field     ;
                SourceExpr="Pay-to Contact";
                Editable=FALSE }

    { 66  ;2   ;Field     ;
                SourceExpr="Your Reference";
                Editable=FALSE }

    { 1100525006;2;Field  ;
                SourceExpr="Journal Template";
                OnValidate=BEGIN
                             JournalTemplateOnAfterValidate;
                           END;
                            }

    { 56  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 1 Code";
                Editable=FALSE;
                OnValidate=BEGIN
                             //**4PS Generated Code. Do Not Change.sn03
                             DPA_ChkDepartmentCodeAllowed(DPA_IsHardFilter);
                             //**4PS Generated Code.en03
                           END;
                            }

    { 58  ;2   ;Field     ;
                SourceExpr="Shortcut Dimension 2 Code";
                Editable=FALSE }

    { 48  ;2   ;Field     ;
                SourceExpr="Payment Terms Code";
                Importance=Promoted;
                Editable=FALSE }

    { 50  ;2   ;Field     ;
                SourceExpr="Due Date";
                Editable=FALSE }

    { 52  ;2   ;Field     ;
                SourceExpr="Payment Discount %";
                Editable=FALSE }

    { 54  ;2   ;Field     ;
                SourceExpr="Pmt. Discount Date";
                Editable=FALSE }

    { 1100525004;2;Field  ;
                SourceExpr="Reason Code";
                Editable=FALSE }

    { 1906801201;1;Group  ;
                CaptionML=ENU=Shipping }

    { 68  ;2   ;Field     ;
                SourceExpr="Ship-to Name";
                Editable=FALSE }

    { 70  ;2   ;Field     ;
                SourceExpr="Ship-to Address";
                Editable=FALSE }

    { 72  ;2   ;Field     ;
                SourceExpr="Ship-to Address 2";
                Editable=FALSE }

    { 83  ;2   ;Field     ;
                SourceExpr="Ship-to Post Code";
                Editable=FALSE }

    { 74  ;2   ;Field     ;
                SourceExpr="Ship-to City";
                Editable=FALSE }

    { 75  ;2   ;Field     ;
                SourceExpr="Ship-to Contact";
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                SourceExpr="Location Code";
                Importance=Promoted;
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                SourceExpr="Shipment Method Code";
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                SourceExpr="Expected Receipt Date";
                Editable=FALSE }

    { 1907468901;1;Group  ;
                CaptionML=ENU=Foreign Trade }

    { 85  ;2   ;Field     ;
                SourceExpr="Currency Code";
                OnAssistEdit=BEGIN
                               ChangeExchangeRate.SetParameter("Currency Code","Currency Factor","Posting Date");
                               ChangeExchangeRate.EDITABLE(FALSE);
                               IF ChangeExchangeRate.RUNMODAL = ACTION::OK THEN BEGIN
                                 "Currency Factor" := ChangeExchangeRate.GetParameter;
                                 MODIFY;
                               END;
                               CLEAR(ChangeExchangeRate);
                             END;
                              }

    { 1905403901;1;Group  ;
                CaptionML=ENU=Subcontracting }

    { 87  ;2   ;Field     ;
                SourceExpr="Payment Agreement";
                Editable=FALSE }

    { 89  ;2   ;Field     ;
                SourceExpr="Actual Effective Date";
                Editable=FALSE }

    { 91  ;2   ;Field     ;
                SourceExpr="Actual End Date";
                Editable=FALSE }

    { 93  ;2   ;Field     ;
                SourceExpr="Number of Hours";
                Editable=FALSE }

    { 95  ;2   ;Field     ;
                SourceExpr="Avg. Wage Rate";
                Editable=FALSE }

    { 97  ;2   ;Field     ;
                SourceExpr="Labor Amount";
                Editable=FALSE }

    { 99  ;2   ;Field     ;
                SourceExpr="Contribution Percentage Labor";
                Editable=FALSE }

    { 1210190005;2;Field  ;
                SourceExpr="Contribution Percentage Total";
                Editable=FALSE }

    { 109 ;2   ;Field     ;
                SourceExpr="Pay To Tax Authority";
                Editable=FALSE }

    { 101 ;2   ;Field     ;
                SourceExpr="Wage Charge (to B Account)";
                Editable=FALSE }

    { 103 ;2   ;Field     ;
                SourceExpr="Wage Charge (to Tax Authority)";
                Editable=FALSE }

    { 107 ;2   ;Field     ;
                SourceExpr=Text;
                Editable=FALSE;
                MultiLine=Yes }

    { 1100528219;1;Part   ;
                CaptionML=ENU=Approval Comments;
                SubPageView=WHERE(Table ID=CONST(124),
                                  Document Type=CONST(Credit Memo));
                SubPageLink=Document No.=FIELD(No.);
                PagePartID=Page11126512;
                PartType=Page }

    { 1903447101;1;Group  ;
                CaptionML=ENU=DMS }

    { 1100525010;2;Field  ;
                SourceExpr="DMS Status";
                Importance=Promoted }

    { 1100525012;2;Field  ;
                SourceExpr="DMS Status Text" }

    { 1210190001;0;Container;
                ContainerType=FactBoxArea }

    { 1100528204;1;Part   ;
                Name=CaptureUI;
                CaptionML=ENU=Document;
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11126597 }

    { 1100409006;1;Part   ;
                Name=RegisterExternalDocumentFB;
                PagePartID=Page11125053;
                Visible=FALSE;
                PartType=Page }

    { 1100409005;1;Part   ;
                SubPageLink=No.=FIELD(No.);
                PagePartID=Page11130313;
                PartType=Page }

    { 1100409004;1;Part   ;
                SubPageLink=Journal Template Name=FIELD(Journal Template),
                            Document Type=CONST(Credit Memo),
                            Document No.=FIELD(No.);
                PagePartID=Page11130117;
                PartType=Page }

    { 1100409003;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=RecordLinks }

    { 1100409002;1;Part   ;
                Visible=FALSE;
                PartType=System;
                SystemPartID=Notes }

  }
  CODE
  {
    VAR
      Text000@11012004 : TextConst 'ENU=Post Credit Memo Approvals ?';
      Text001@11012005 : TextConst 'ENU=Post and Print Credit Memo Approvals ?';
      PurchSetup@1100485001 : Record 312;
      ChangeExchangeRate@11012001 : Page 511;
      gFromReference@1210190001 : Boolean;
      gApprLineNo@1210190000 : Integer;
      gWKAPresent@1100485000 : Boolean;
      RemainOnHoldEditable@1100525000 : Boolean;
      DPA_IsHardFilter@1100000999 : Boolean;
      ApprJnlTemplate@1100529000 : Code[10];
      DropZoneContainerVisible@19006404 : Boolean INDATASET;
      "Ext. Document IDVisible"@19068947 : Boolean INDATASET;
      "Remain On HoldEditable"@19040163 : Boolean INDATASET;
      "Ext. Document IDEditable"@19001168 : Boolean INDATASET;
      OnHoldEditable@1100525001 : Boolean INDATASET;
      "<DC>"@1100528206 : Boolean;
      Document@1100528205 : Record 6085590;
      PurchDocMgnt@1100528204 : Codeunit 6085709;
      DCApprovalMgnt@1100528203 : Codeunit 6085722;
      DocMgt@1100528202 : Codeunit 6085578;
      UserMgt@1100528201 : Codeunit 5700;
      "</DC>"@1100528200 : Integer;
      PostingVisible@1100528207 : Boolean INDATASET;
      PurchCrMemoHdrDCInfo@1100528208 : Record 6085770;
      ApprovalFlowCode@1100528209 : Code[10];

    PROCEDURE SetFilter@1(JournTempl@11012000 : Code[10]);
    BEGIN
    END;

    PROCEDURE InitSelectionFromReference@1210190002(IApprLineNo@1210190000 : Integer);
    BEGIN
      gFromReference := TRUE;
      gApprLineNo := IApprLineNo;
    END;

    PROCEDURE ShowICFInvoiceLines@1210190000();
    VAR
      ICFLineRec@1210190000 : Record 11012327;
    BEGIN
      ICFLineRec.RESET;
      ICFLineRec.SETRANGE(Vendor, "Pay-to Vendor No.");
      ICFLineRec.SETRANGE("Invoice No.", "Pre-Assigned No.");
      IF ICFLineRec.FIND('-') THEN
        PAGE.RUNMODAL(PAGE::"ICF Invoices", ICFLineRec);
    END;

    PROCEDURE DistrPurchLinesOverSubProjects@1100485003(PurchCrMemoHeader@1100485000 : Record 124);
    VAR
      InvApprovalLine@1100485004 : Record 11012032;
      MaxLine@1100485002 : Integer;
      Job@1100485003 : Record 11072003;
    BEGIN
      IF "DMS Status" > "DMS Status"::"Awaiting Line Entry" THEN
        FIELDERROR("DMS Status");

      PurchCrMemoHeader.TESTFIELD("Amounts only", TRUE);
      MaxLine := 0;

      InvApprovalLine.SETRANGE("Journal Template Name", PurchCrMemoHeader."Journal Template");
      InvApprovalLine.SETRANGE("Document Type", InvApprovalLine."Document Type"::"Credit Memo");
      InvApprovalLine.SETRANGE("Document No.", PurchCrMemoHeader."No.");
      IF InvApprovalLine.FINDLAST THEN
        MaxLine := InvApprovalLine."Line No.";
      InvApprovalLine.SETRANGE("Receiving Company", '');
      InvApprovalLine.SETFILTER("Project No.", '<>%1', '');
      IF InvApprovalLine.FINDSET(TRUE, FALSE) THEN
        REPEAT
          Job.GET(InvApprovalLine."Project No.");
          IF (Job."Single/Main/Sub Project" = Job."Single/Main/Sub Project"::"Main Project") THEN
            IF GenerateInvApprovalLines(
              PurchCrMemoHeader, Job."No.", InvApprovalLine."Shortcut Dimension 2 Code", MaxLine,
              InvApprovalLine.Amount)
            THEN
              InvApprovalLine.DELETE(TRUE);
        UNTIL InvApprovalLine.NEXT = 0;
    END;

    LOCAL PROCEDURE GenerateInvApprovalLines@1100498000(PurchCrMemoHeader@1100525000 : Record 124;JobNo@1100485003 : Code[20];ShortCutDimension2@1100485004 : Code[20];VAR PurchaseLineNo@1100485005 : Integer;LineAmount@1100485006 : Decimal) : Boolean;
    VAR
      InvApprovalLine@1100498001 : Record 11012032;
      BudgetLine@1100498002 : Record 11012001;
      Job@1100498003 : Record 11072003;
      TotalAmount@1100485000 : Decimal;
    BEGIN
      TotalAmount := 0;

      Job.RESET;
      Job.SETCURRENTKEY("Main Project");
      Job.SETRANGE("Main Project", JobNo);
      Job.SETRANGE("Single/Main/Sub Project", Job."Single/Main/Sub Project"::"Sub Project");
      Job.SETFILTER("Project Status", '<%1', Job."Project Status"::"Administrative Finished");
      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS(Amount);
          TotalAmount := TotalAmount + BudgetLine.Amount;
        UNTIL Job.NEXT = 0;
      IF TotalAmount = 0 THEN
        EXIT(FALSE);

      IF Job.FINDSET(FALSE, FALSE) THEN
        REPEAT
          BudgetLine.RESET;
          BudgetLine.SETCURRENTKEY("Project No.","Cost Object");
          BudgetLine.SETRANGE("Project No.", Job."No.");
          BudgetLine.SETRANGE("Cost Object",ShortCutDimension2);
          BudgetLine.CALCSUMS(Amount);

          PurchaseLineNo := PurchaseLineNo + 10000;
          InvApprovalLine.INIT;
          InvApprovalLine."Journal Template Name" := PurchCrMemoHeader."Journal Template";
          InvApprovalLine.VALIDATE("Document Type", InvApprovalLine."Document Type"::"Credit Memo");
          InvApprovalLine.VALIDATE("Document No.",PurchCrMemoHeader."No.");
          InvApprovalLine.VALIDATE("Line No." ,PurchaseLineNo);
          InvApprovalLine.Description := Job.Description;
          InvApprovalLine.INSERT(TRUE);
          InvApprovalLine.VALIDATE("Project No.", Job."No.");
          InvApprovalLine.VALIDATE("Shortcut Dimension 2 Code", ShortCutDimension2);
          InvApprovalLine.VALIDATE("Buy-from Vendor No.", PurchCrMemoHeader."Buy-from Vendor No.");
          InvApprovalLine.VALIDATE(Amount,LineAmount * (BudgetLine.Amount / TotalAmount));
          InvApprovalLine.MODIFY(TRUE);
        UNTIL Job.NEXT = 0;

      EXIT(TRUE);
    END;

    PROCEDURE UpdateControls@1210190001();
    BEGIN
      RemainOnHoldEditable := (RemainOnHoldEditable AND ("On Hold" <> ''));
      CurrPage.EDITABLE(
        ("DMS Status" < "DMS Status"::"Start Workflow") OR
        ("DMS Status" = "DMS Status"::Rejected) OR
        ("DMS Status" = "DMS Status"::Approved)); //call 28557
    END;

    PROCEDURE SetJournalTemplate@1100529000(JnlTemplate@1100529000 : Code[10]);
    BEGIN
      //DP00065
      ApprJnlTemplate := JnlTemplate;
    END;

    LOCAL PROCEDURE OnHoldOnAfterValidate@19064521();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JobNoOnAfterValidate@19070084();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE RelatedPurchOrderNoOnAfterVali@19002847();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE ServiceOrderNoOnAfterValidate@19042308();
    BEGIN
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE JournalTemplateOnAfterValidate@19059050();
    BEGIN
      CurrPage.UPDATE;
    END;

    BEGIN
    {
      Copy of 11012068
      4PS MVOS 20100810: Check permission Journal Template before posting.
    }
    END.
  }
}

