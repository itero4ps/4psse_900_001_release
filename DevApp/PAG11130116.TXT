OBJECT Page 11130116 Project Cost Plus Entry FB
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Project Cost;
    SourceTable=Table11012019;
    PageType=CardPart;
    OnOpenPage=BEGIN
                 CalcTotalsSheet;
               END;

    OnNextRecord=BEGIN
                   CalcTotalsSheet;
                 END;

    OnAfterGetRecord=BEGIN
                       CalcTotalsSheet;
                       IF "Employee No." = '' THEN BEGIN
                         CLEAR("Employee Hours");
                         CLEAR("Employee Amount");
                       END;
                     END;

  }
  CONTROLS
  {
    { 1210190000;0;Container;
                ContainerType=ContentArea }

    { 1210190004;1;Field  ;
                DrillDown=No;
                CaptionML=ENU=Employee;
                SourceExpr="Name Employee" }

    { 1210190003;1;Field  ;
                CaptionML=ENU=Total Cost Project;
                SourceExpr=TotalCostsProject;
                AutoFormatType=1;
                Editable=FALSE }

    { 1210190002;1;Field  ;
                DrillDown=No;
                CaptionML=ENU=Chargeable Hours;
                BlankZero=Yes;
                SourceExpr="Employee Hours" }

    { 1210190001;1;Field  ;
                DrillDown=No;
                CaptionML=ENU=Chargeable Amount;
                BlankZero=Yes;
                SourceExpr="Employee Amount" }

    { 1210190008;1;Field  ;
                CaptionML=ENU=Total Basic Price;
                SourceExpr=TotalCostsDec;
                AutoFormatType=1;
                Editable=FALSE }

    { 1210190007;1;Field  ;
                CaptionML=ENU=Margin;
                SourceExpr=MarginDec;
                AutoFormatType=1;
                Editable=FALSE }

    { 1210190006;1;Field  ;
                CaptionML=ENU=Invoiced;
                SourceExpr=SettlSheetRec.Invoiced;
                AutoFormatType=1;
                Editable=FALSE }

    { 1210190005;1;Field  ;
                CaptionML=ENU=Still to Invoice;
                SourceExpr=SettlSheetRec."To Invoice";
                AutoFormatType=1;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      TotalCostsProject@1210190000 : Decimal;
      TotalCostsDec@1210190001 : Decimal;
      MarginDec@1210190002 : Decimal;
      SettlSheetRec@1210190003 : Record 11012021;
      ProjRec@1210190004 : Record 11072003;

    PROCEDURE CalcTotalsSheet@1100485001();
    VAR
      DeterminePrognosisDate@1100525002 : Codeunit 11012029;
      CostContMgt@1100525001 : Codeunit 11012006;
      ProjFilter@1100525000 : Text[250];
    BEGIN
      //db, 20-08-07
      IF NOT SettlSheetRec.GET("Project No.", Principal, "Commission No.", "Settl.Sheet No.") THEN BEGIN
        SettlSheetRec.INIT;
        TotalCostsDec := 0;
        MarginDec := 0;
        TotalCostsProject := 0; //10-08-2010, M19913
      END ELSE BEGIN
        SettlSheetRec.CALCFIELDS(Invoiced,"To Invoice");
        TotalCostsDec := SettlSheetRec.CalcTotalBasicPrice;
        MarginDec := SettlSheetRec.Invoiced + SettlSheetRec."To Invoice" - TotalCostsDec;
        //10-08-2010, M19913.sn
        IF ProjRec.GET("Project No.") THEN BEGIN
          DeterminePrognosisDate.DetermineDate(ProjRec);

          ProjRec.FillProjectFilter(ProjFilter);
          ProjRec.SETFILTER("Project Filter", ProjFilter);

          TotalCostsProject := CostContMgt.TotCostProject(ProjRec,TRUE);
        END;
        //10-08-2010, M19913.en
      END;
    END;

    BEGIN
    END.
  }
}

