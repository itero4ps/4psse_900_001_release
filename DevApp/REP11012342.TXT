OBJECT Report 11012342 Replace Estimate Mgt
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Replace Estimate Data;
    ProcessingOnly=Yes;
  }
  DATASET
  {
    { 6102;    ;DataItem;                    ;
               DataItemTable=Table11072072;
               DataItemTableView=SORTING(Estimate No.,Sub-Estimate No.,Part Group,Part,Line No.);
               OnPreDataItem=BEGIN
                               StartUpdate;
                               CurrReport.BREAK;
                             END;

               ReqFilterFields=Estimate No.,Sub-Estimate No.,Part Group,Part }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      OnInit=BEGIN
               InitPageRequestOptions;
             END;

      OnOpenPage=BEGIN
                   InitRequestOptions;
                 END;

    }
    CONTROLS
    {
      { 1900000001;0;Container;
                  ContainerType=ContentArea }

      { 1900000002;1;Group  ;
                  CaptionML=ENU=Options }

      { 1100525002;2;Group  ;
                  CaptionML=ENU=Old;
                  GroupType=Group }

      { 1100485003;3;Field  ;
                  Name=OldRate;
                  CaptionML=ENU=Rate Code;
                  SourceExpr=OldRate;
                  Visible=OldRateEditable;
                  Editable=OldRateEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             EstRateRec.SETRANGE("Estimate No.", gvEst);
                             IF PAGE.RUNMODAL(0,EstRateRec) = ACTION::LookupOK THEN BEGIN  //db, 04-03-09
                               IF gvAction <> 1 THEN EXIT;
                               OldRate := EstRateRec."Rate Code";
                               OldRateTxt := EstRateRec.Description;
                               CheckRequestOptions(0);
                             END;
                           END;
                            }

      { 1100485008;3;Field  ;
                  Name=OldNormGroup;
                  CaptionML=ENU=Norm Group;
                  SourceExpr=OldNormGroup;
                  TableRelation="Norm Group";
                  Visible=OldNormGroupEditable;
                  Editable=OldNormGroupEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100525013;3;Field  ;
                  Name=OldNormGroupSales;
                  CaptionML=ENU=Norm Group (Sales);
                  SourceExpr=OldNormGroupSales;
                  TableRelation="Norm Group";
                  Visible=OldNormGroupSalesEditable;
                  Editable=OldNormGroupSalesEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100485040;3;Field  ;
                  Name=OldCondition;
                  CaptionML=ENU=Condition;
                  SourceExpr=OldCondition;
                  TableRelation=Condition;
                  Visible=OldConditionEditable;
                  Editable=OldConditionEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100525005;3;Field  ;
                  Name=OldDiscGroup1;
                  CaptionML=ENU=Discount Term Group (Customer);
                  SourceExpr=OldDiscGroup1;
                  Visible=OldDiscGroup1Editable;
                  Editable=OldDiscGroup1Editable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             DiscGrpRec.SETRANGE(Level, DiscGrpRec.Level::Customer);
                             PAGE.RUNMODAL(0, DiscGrpRec);
                           END;
                            }

      { 1100525010;3;Field  ;
                  Name=OldDiscGroup2;
                  CaptionML=ENU=Discount Term Group (Job);
                  SourceExpr=OldDiscGroup2;
                  Visible=OldDiscGroup2Editable;
                  Editable=OldDiscGroup2Editable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             DiscGrpRec.SETRANGE(Level, DiscGrpRec.Level::Job);
                             PAGE.RUNMODAL(0, DiscGrpRec);
                           END;
                            }

      { 1100525012;3;Field  ;
                  Name=OldRefDateItem;
                  CaptionML=ENU=Reference Date Item Prices;
                  SourceExpr=OldRefDateItem;
                  Visible=OldRefDateItemEditable;
                  Editable=OldRefDateItemEditable }

      { 1100525018;3;Field  ;
                  Name=OldItem;
                  CaptionML=ENU=Item No.;
                  SourceExpr=OldItem;
                  TableRelation=Item;
                  Visible=OldItemEditable;
                  Editable=OldItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100525023;3;Field  ;
                  Name=OldManufacturer;
                  CaptionML=ENU=Manufacturer;
                  SourceExpr=OldManufacturer;
                  TableRelation="ETIM Vendor (Central Mgt)";
                  Visible=OldManufacturerEditable;
                  Editable=OldManufacturerEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100525028;3;Field  ;
                  Name=OldBasicItem;
                  CaptionML=ENU=Basic Item;
                  SourceExpr=OldBasicItem;
                  Visible=OldBasicItemEditable;
                  Editable=OldBasicItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             BasicItemRec.SETRANGE(Manufacturer, OldManufacturer);
                             IF PAGE.RUNMODAL(0,BasicItemRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 6 THEN EXIT;
                               OldManufacturer := BasicItemRec.Manufacturer;
                               OldBasicItem := BasicItemRec."Product Code";
                               CheckRequestOptions(0);
                             END;
                           END;
                            }

      { 1100525038;3;Field  ;
                  Name=OldVendor;
                  CaptionML=ENU=Vendor;
                  SourceExpr=OldVendor;
                  TableRelation="ETIM Vendor (Central Mgt)";
                  Visible=OldVendorEditable;
                  Editable=OldVendorEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;
                              }

      { 1100525033;3;Field  ;
                  Name=OldTradeItem;
                  CaptionML=ENU=Trade Item;
                  SourceExpr=OldTradeItem;
                  Visible=OldTradeItemEditable;
                  Editable=OldTradeItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             TradeItemRec.SETRANGE(Vendor, OldVendor);
                             IF PAGE.RUNMODAL(0,TradeItemRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 6 THEN EXIT;
                               OldVendor := TradeItemRec.Vendor;
                               OldTradeItem := TradeItemRec."Item Code";
                               CheckRequestOptions(0);
                             END;
                           END;
                            }

      { 1100525041;3;Field  ;
                  Name=OldRecipeGroup;
                  CaptionML=ENU=Recipe Group;
                  SourceExpr=OldRecipeGroup;
                  Visible=OldRecipeGroupEditable;
                  Editable=OldRecipeGroupEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             IF PAGE.RUNMODAL(0, RcpGroupRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 7 THEN EXIT;
                               OldRecipeGroup := RcpGroupRec."No.";
                               OldRecipeGroupTxt := RcpGroupRec.Description;
                               CheckRequestOptions(0);
                             END;
                           END;
                            }

      { 1100525044;3;Field  ;
                  Name=OldRecipe;
                  CaptionML=ENU=Recipe;
                  SourceExpr=OldRecipe;
                  Visible=OldRecipeEditable;
                  Editable=OldRecipeEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(0);
                             END;

                  OnLookup=BEGIN
                             RecipeRec.SETRANGE("Recipe Group", OldRecipeGroup);
                             IF PAGE.RUNMODAL(0, RecipeRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 7 THEN EXIT;
                               IF RecipeRec."Recipe Group" <> OldRecipeGroup THEN BEGIN
                                 RecipeRec.CALCFIELDS("Recipe Group Description");
                                 OldRecipeGroup := RecipeRec."Recipe Group";
                                 OldRecipeGroupTxt := RecipeRec."Recipe Group Description";
                               END;
                               OldRecipe := RecipeRec."No.";
                               OldRecipeTxt := RecipeRec.Description;
                               CheckRequestOptions(0);
                             END;
                           END;
                            }

      { 1100528600;3;Field  ;
                  CaptionML=ENU=Currency Code;
                  SourceExpr=OldCurrencyCode;
                  TableRelation=Currency;
                  Visible=OldCurrencyCodeEditable;
                  Editable=OldCurrencyCodeEditable }

      { 1100525000;2;Group  ;
                  CaptionML=ENU=New;
                  GroupType=Group }

      { 1100485002;3;Field  ;
                  Name=NewRate;
                  CaptionML=ENU=New Rate;
                  SourceExpr=NewRate;
                  Visible=NewRateEditable;
                  Editable=NewRateEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             EstRateRec.SETRANGE("Estimate No.", gvEst);
                             IF PAGE.RUNMODAL(0,EstRateRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 1 THEN EXIT;
                               NewRate := EstRateRec."Rate Code";
                               NewRateTxt := EstRateRec.Description;
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100485009;3;Field  ;
                  Name=NewNormGroup;
                  CaptionML=ENU=New Norm Group;
                  SourceExpr=NewNormGroup;
                  TableRelation="Norm Group";
                  Visible=NewNormGroupEditable;
                  Editable=NewNormGroupEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100525024;3;Field  ;
                  Name=NewNormGroupSales;
                  CaptionML=ENU=New Norm Group (Sales);
                  SourceExpr=NewNormGroupSales;
                  TableRelation="Norm Group";
                  Visible=NewNormGroupSalesEditable;
                  Editable=NewNormGroupSalesEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100485038;3;Field  ;
                  Name=NewCondition;
                  CaptionML=ENU=New Condition;
                  SourceExpr=NewCondition;
                  TableRelation=Condition;
                  Visible=NewConditionEditable;
                  Editable=NewConditionEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100525003;3;Field  ;
                  Name=NewDiscGroup1;
                  CaptionML=ENU=New Discount Group 1;
                  SourceExpr=NewDiscGroup1;
                  Visible=NewDiscGroup1Editable;
                  Editable=NewDiscGroup1Editable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             DiscGrpRec.SETRANGE(Level, DiscGrpRec.Level::Customer);
                             IF PAGE.RUNMODAL(0, DiscGrpRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 5 THEN EXIT;
                               NewDiscGroup1 := DiscGrpRec.Code;
                               NewDiscGroup1Txt := DiscGrpRec.Description;
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100525008;3;Field  ;
                  Name=NewDiscGroup2;
                  CaptionML=ENU=New Discount Group 2;
                  SourceExpr=NewDiscGroup2;
                  Visible=NewDiscGroup2Editable;
                  Editable=NewDiscGroup2Editable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             DiscGrpRec.SETRANGE(Level, DiscGrpRec.Level::Job);
                             IF PAGE.RUNMODAL(0, DiscGrpRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 5 THEN EXIT;
                               NewDiscGroup2 := DiscGrpRec.Code;
                               NewDiscGroup2Txt := DiscGrpRec.Description;
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100525014;3;Field  ;
                  Name=NewRefDateItem;
                  CaptionML=ENU=Reference Date Item Prices;
                  SourceExpr=NewRefDateItem;
                  Visible=NewRefDateItemEditable;
                  Editable=NewRefDateItemEditable }

      { 1100525016;3;Field  ;
                  Name=NewItem;
                  CaptionML=ENU=New Item;
                  SourceExpr=NewItem;
                  TableRelation=Item;
                  Visible=NewItemEditable;
                  Editable=NewItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100525021;3;Field  ;
                  Name=NewManufacturer;
                  CaptionML=ENU=New manufacturerer;
                  SourceExpr=NewManufacturer;
                  TableRelation="ETIM Vendor (Central Mgt)";
                  Visible=NewManufacturerEditable;
                  Editable=NewManufacturerEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100525026;3;Field  ;
                  Name=NewBasicItem;
                  CaptionML=ENU=New Basic Item;
                  SourceExpr=NewBasicItem;
                  Visible=NewBasicItemEditable;
                  Editable=NewBasicItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             BasicItemRec.SETRANGE(Manufacturer, NewManufacturer);
                             IF PAGE.RUNMODAL(0,BasicItemRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 6 THEN EXIT;
                               NewManufacturer := BasicItemRec.Manufacturer;
                               NewBasicItem := BasicItemRec."Product Code";
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100525036;3;Field  ;
                  Name=NewVendor;
                  CaptionML=ENU=New Vendor;
                  SourceExpr=NewVendor;
                  TableRelation="ETIM Vendor (Central Mgt)";
                  Visible=NewVendorEditable;
                  Editable=NewVendorEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;
                              }

      { 1100525031;3;Field  ;
                  Name=NewTradeItem;
                  CaptionML=ENU=New Trade Item;
                  SourceExpr=NewTradeItem;
                  Visible=NewTradeItemEditable;
                  Editable=NewTradeItemEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             TradeItemRec.SETRANGE(Vendor, NewVendor);
                             IF PAGE.RUNMODAL(0,TradeItemRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 6 THEN EXIT;
                               NewVendor := TradeItemRec.Vendor;
                               NewTradeItem := TradeItemRec."Item Code";
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100525049;3;Field  ;
                  Name=NewRecipeGroup;
                  CaptionML=ENU=New Recipe Group;
                  SourceExpr=NewRecipeGroup;
                  Visible=NewRecipeGroupEditable;
                  Editable=NewRecipeGroupEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             IF PAGE.RUNMODAL(0, RcpGroupRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 7 THEN EXIT;
                               NewRecipeGroup := RcpGroupRec."No.";
                               NewRecipeGroupTxt := RcpGroupRec.Description;
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100525047;3;Field  ;
                  Name=NewRecipe;
                  CaptionML=ENU=New Recipe;
                  SourceExpr=NewRecipe;
                  Visible=NewRecipeEditable;
                  Editable=NewRecipeEditable;
                  OnValidate=BEGIN
                               CheckRequestOptions(1);
                             END;

                  OnLookup=BEGIN
                             RecipeRec.SETRANGE("Recipe Group", NewRecipeGroup);
                             IF PAGE.RUNMODAL(0, RecipeRec) = ACTION::LookupOK THEN BEGIN
                               IF gvAction <> 7 THEN EXIT;
                               IF RecipeRec."Recipe Group" <> NewRecipeGroup THEN BEGIN
                                 RecipeRec.CALCFIELDS("Recipe Group Description");
                                 NewRecipeGroup := RecipeRec."Recipe Group";
                                 NewRecipeGroupTxt := RecipeRec."Recipe Group Description";
                               END;
                               NewRecipe := RecipeRec."No.";
                               NewRecipeTxt := RecipeRec.Description;
                               CheckRequestOptions(1);
                             END;
                           END;
                            }

      { 1100528601;3;Field  ;
                  CaptionML=ENU=New Currency Code;
                  SourceExpr=NewCurrencyCode;
                  TableRelation=Currency;
                  Visible=NewCurrencyCodeEditable;
                  Editable=NewCurrencyCodeEditable }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      gvEst@1100485054 : Code[20];
      gvAction@1100485050 : Integer;
      EstRec@1100485045 : Record 11012151;
      EstRateRec@1100485040 : Record 11012160;
      NormGroupRec@1100485039 : Record 11012164;
      ConditionRec@1100485038 : Record 11020220;
      VendorRec@1100485037 : Record 11012304;
      DiscGrpRec@1100525004 : Record 11012338;
      ItemRec@1100525019 : Record 27;
      BasicItemRec@1100525028 : Record 11012316;
      TradeItemRec@1100525029 : Record 11012317;
      RcpGroupRec@1100525041 : Record 11020580;
      RecipeRec@1100525042 : Record 11020581;
      OldRate@1100485019 : Code[20];
      NewRate@1100485018 : Code[20];
      OldRateTxt@1100485017 : Text[50];
      NewRateTxt@1100485016 : Text[50];
      OldNormGroup@1100485015 : Code[20];
      NewNormGroup@1100485014 : Code[20];
      OldNormGroupTxt@1100485013 : Text[100];
      NewNormGroupTxt@1100485012 : Text[100];
      OldNormGroupSales@1100525048 : Code[20];
      NewNormGroupSales@1100525047 : Code[20];
      OldNormGroupSalesTxt@1100525046 : Text[100];
      NewNormGroupSalesTxt@1100525045 : Text[100];
      OldCondition@1100485011 : Code[20];
      NewCondition@1100485010 : Code[20];
      OldConditionTxt@1100485009 : Text[50];
      NewConditionTxt@1100485008 : Text[50];
      OldVendor@1100485007 : Code[20];
      NewVendor@1100485006 : Code[20];
      OldVendorTxt@1100485005 : Text[50];
      NewVendorTxt@1100485004 : Text[50];
      OldDiscGroup1@1100525003 : Code[20];
      NewDiscGroup1@1100525002 : Code[20];
      OldDiscGroup1Txt@1100525001 : Text[50];
      NewDiscGroup1Txt@1100525000 : Text[50];
      OldDiscGroup2@1100525008 : Code[20];
      NewDiscGroup2@1100525007 : Code[20];
      OldDiscGroup2Txt@1100525006 : Text[50];
      NewDiscGroup2Txt@1100525005 : Text[50];
      OldRefDateItem@1100525009 : Date;
      NewRefDateItem@1100525010 : Date;
      OldItem@1100525011 : Code[20];
      NewItem@1100525012 : Code[20];
      OldItemTxt@1100525017 : Text[50];
      NewItemTxt@1100525018 : Text[50];
      OldManufacturer@1100525020 : Code[20];
      NewManufacturer@1100525021 : Code[20];
      OldManufacturerTxt@1100525023 : Text[50];
      NewManufacturerTxt@1100525022 : Text[50];
      OldBasicItem@1100525013 : Code[20];
      NewBasicItem@1100525014 : Code[20];
      OldBasicItemTxt@1100525025 : Text[50];
      NewBasicItemTxt@1100525024 : Text[50];
      OldTradeItem@1100525015 : Code[20];
      NewTradeItem@1100525016 : Code[20];
      OldTradeItemTxt@1100525027 : Text[50];
      NewTradeItemTxt@1100525026 : Text[50];
      Text000@1100525030 : TextConst 'ENU=Replace Item by same Type';
      Text001@1100525031 : TextConst 'ENU=Please select 1 itemtype';
      OldRecipeGroup@1100525036 : Code[20];
      NewRecipeGroup@1100525035 : Code[20];
      OldRecipeGroupTxt@1100525034 : Text[50];
      NewRecipeGroupTxt@1100525033 : Text[50];
      OldRecipe@1100525040 : Code[20];
      NewRecipe@1100525039 : Code[20];
      OldRecipeTxt@1100525038 : Text[100];
      NewRecipeTxt@1100525037 : Text[100];
      OldCurrencyCode@1100528600 : Code[10];
      NewCurrencyCode@1100528601 : Code[10];
      CheckValidate@1100525032 : Boolean;
      OldRateEditable@19030217 : Boolean INDATASET;
      NewRateEditable@19074046 : Boolean INDATASET;
      OldNormGroupEditable@19045685 : Boolean INDATASET;
      NewNormGroupEditable@19024349 : Boolean INDATASET;
      OldNormGroupSalesEditable@1100525050 : Boolean INDATASET;
      NewNormGroupSalesEditable@1100525049 : Boolean INDATASET;
      OldConditionEditable@19065080 : Boolean INDATASET;
      NewConditionEditable@19067095 : Boolean INDATASET;
      OldDiscGroup1Editable@19062664 : Boolean INDATASET;
      NewDiscGroup1Editable@19008892 : Boolean INDATASET;
      OldDiscGroup2Editable@19061651 : Boolean INDATASET;
      NewDiscGroup2Editable@19007075 : Boolean INDATASET;
      OldRefDateItemEditable@19035707 : Boolean INDATASET;
      NewRefDateItemEditable@19001109 : Boolean INDATASET;
      OldItemEditable@19077106 : Boolean INDATASET;
      NewItemEditable@19075229 : Boolean INDATASET;
      OldManufacturerEditable@19062765 : Boolean INDATASET;
      NewManufacturerEditable@19033832 : Boolean INDATASET;
      OldBasicItemEditable@19053156 : Boolean INDATASET;
      NewBasicItemEditable@19034114 : Boolean INDATASET;
      OldTradeItemEditable@19010305 : Boolean INDATASET;
      NewTradeItemEditable@19076745 : Boolean INDATASET;
      OldRecipeGroupEditable@19024784 : Boolean INDATASET;
      NewRecipeGroupEditable@19045652 : Boolean INDATASET;
      OldRecipeEditable@19080001 : Boolean INDATASET;
      NewRecipeEditable@19068796 : Boolean INDATASET;
      OldVendorEditable@1100525043 : Boolean INDATASET;
      NewVendorEditable@1100525044 : Boolean INDATASET;
      OldCurrencyCodeEditable@1100528602 : Boolean INDATASET;
      NewCurrencyCodeEditable@1100528603 : Boolean INDATASET;

    PROCEDURE FillDefaults@1(lvEst@11012000 : Code[20];lvAction@1210190000 : Integer);
    BEGIN
      gvEst  := lvEst;
      gvAction := lvAction;

      IF EstRec.GET(gvEst) THEN BEGIN
        IF gvAction = 1 THEN BEGIN
          OldRate := EstRec."Rate Code";
          NewRate := EstRec."Rate Code";
        END;
        IF gvAction = 2 THEN BEGIN
          OldNormGroup := EstRec."Norm Group";
          NewNormGroup := EstRec."Norm Group";
          //DP00381.en
          OldNormGroupSales := EstRec."Norm Group (Sales)";
          NewNormGroupSales := EstRec."Norm Group (Sales)";
          //DP00381.en
        END;
        IF gvAction = 3 THEN BEGIN
          OldCondition := EstRec.Condition;
          NewCondition := EstRec.Condition;
        END;
        IF gvAction = 5 THEN BEGIN
          OldDiscGroup1 := EstRec."Purch Discount Term Group 1";
          OldDiscGroup2 := EstRec."Purch Discount Term Group 2";
          OldRefDateItem := EstRec."Reference Date (Item)";
          NewDiscGroup1 := EstRec."Purch Discount Term Group 1";
          NewDiscGroup2 := EstRec."Purch Discount Term Group 2";
          NewRefDateItem := EstRec."Reference Date (Item)";
        END;
        IF gvAction = 7 THEN BEGIN
          OldRecipeGroup := EstRec."Recipe Group";
          NewRecipeGroup := EstRec."Recipe Group";
        END;
        IF gvAction = 8 THEN BEGIN
          OldCurrencyCode := EstRec."Currency Code";
          NewCurrencyCode := EstRec."Currency Code";
        END;
      END;

      CheckValidate := FALSE;  //db, 17-08-09: T3807
      CheckRequestOptions(0);
      CheckRequestOptions(1);
      CheckValidate := TRUE;  //db, 17-08-09: T3807
    END;

    PROCEDURE InitRequestOptions@1100485000();
    BEGIN
      OldRateEditable := (gvAction = 1);
      NewRateEditable := (gvAction = 1);

      OldNormGroupEditable := (gvAction = 2);
      NewNormGroupEditable := (gvAction = 2);
      //DP00381.sn
      OldNormGroupSalesEditable := (gvAction = 2);
      NewNormGroupSalesEditable := (gvAction = 2);
      //DP00381.en

      OldConditionEditable := (gvAction = 3);
      NewConditionEditable := (gvAction = 3);

      OldDiscGroup1Editable := (gvAction = 5);
      NewDiscGroup1Editable := (gvAction = 5);
      OldDiscGroup2Editable := (gvAction = 5);
      NewDiscGroup2Editable := (gvAction = 5);
      OldRefDateItemEditable := (gvAction = 5);
      NewRefDateItemEditable := (gvAction = 5);

      OldItemEditable := (gvAction = 6);
      NewItemEditable := (gvAction = 6);
      OldManufacturerEditable := (gvAction = 6);
      NewManufacturerEditable := (gvAction = 6);
      OldBasicItemEditable := (gvAction = 6);
      NewBasicItemEditable := (gvAction = 6);
      OldVendorEditable := ((gvAction = 4) OR (gvAction = 6));
      NewVendorEditable := ((gvAction = 4) OR (gvAction = 6));
      OldTradeItemEditable := (gvAction = 6);
      NewTradeItemEditable := (gvAction = 6);

      OldRecipeGroupEditable := (gvAction = 7);
      NewRecipeGroupEditable := (gvAction = 7);
      OldRecipeEditable := (gvAction = 7);
      NewRecipeEditable := (gvAction = 7);

      OldCurrencyCodeEditable := (gvAction = 8);
      NewCurrencyCodeEditable := (gvAction = 8);
    END;

    PROCEDURE CheckRequestOptions@1100485002(lvField@1100485000 : Integer);
    BEGIN
      CASE gvAction OF
        1:
          BEGIN
           IF lvField = 0 THEN BEGIN
             IF OldRate = '' THEN
               EstRateRec.INIT
             ELSE
               EstRateRec.GET(gvEst, OldRate);
             OldRateTxt := EstRateRec.Description;
           END;
           IF lvField = 1 THEN BEGIN
             IF CheckValidate = FALSE THEN BEGIN  //db, 17-08-09: T3807
               IF NOT EstRateRec.GET(gvEst, NewRate) THEN
                 EstRateRec.INIT;
             END ELSE BEGIN
             //IF NewRate = '' THEN  //db, 04-03-09: M14651; empty code clears data for cost type labor
             //  EstRateRec.INIT
             //ELSE
               EstRateRec.GET(gvEst, NewRate);
               EstRateRec.TESTFIELD("Rate Code");  //db, 03-01-14: C011744
             END;
             NewRateTxt := EstRateRec.Description;
           END;
         END;
        2:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldNormGroup = '' THEN
                NormGroupRec.INIT
              ELSE
                NormGroupRec.GET(OldNormGroup);
              OldNormGroupTxt := NormGroupRec.Description;
              //DP00381.sn
              IF OldNormGroupSales = '' THEN
                NormGroupRec.INIT
              ELSE
                NormGroupRec.GET(OldNormGroupSales);
              OldNormGroupSalesTxt := NormGroupRec.Description;
              //DP00381.en
            END;
            IF lvField = 1 THEN BEGIN
              IF NewNormGroup = '' THEN
                NormGroupRec.INIT
              ELSE
                NormGroupRec.GET(NewNormGroup);
              NewNormGroupTxt := NormGroupRec.Description;
              //DP00381.sn
              IF NewNormGroupSales = '' THEN
                NormGroupRec.INIT
              ELSE
                NormGroupRec.GET(NewNormGroupSales);
              NewNormGroupSalesTxt := NormGroupRec.Description;
              //DP00381.en
            END;
          END;
        3:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldCondition = '' THEN
                ConditionRec.INIT
              ELSE
                ConditionRec.GET(OldCondition);
              OldConditionTxt := ConditionRec.Description;
            END;
            IF lvField = 1 THEN BEGIN
              IF NewCondition = '' THEN
                ConditionRec.INIT
              ELSE
                ConditionRec.GET(NewCondition);
              NewConditionTxt := ConditionRec.Description;
            END;
          END;
        4:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldVendor = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(OldVendor);
              OldVendorTxt := VendorRec.Name;
            END;
            IF lvField = 1 THEN BEGIN
              IF NewVendor = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(NewVendor);
              NewVendorTxt := VendorRec.Name;
            END;
          END;
        5:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldDiscGroup1 = '' THEN
                DiscGrpRec.INIT
              ELSE
                DiscGrpRec.GET(DiscGrpRec.Level::Customer, OldDiscGroup1);
              OldDiscGroup1Txt := DiscGrpRec.Description;

              IF OldDiscGroup2 = '' THEN
                DiscGrpRec.INIT
              ELSE
                DiscGrpRec.GET(DiscGrpRec.Level::Job, OldDiscGroup2);
              OldDiscGroup2Txt := DiscGrpRec.Description;
            END;
            IF lvField = 1 THEN BEGIN
              IF NewDiscGroup1 = '' THEN
                DiscGrpRec.INIT
              ELSE
                DiscGrpRec.GET(DiscGrpRec.Level::Customer, NewDiscGroup1);
              NewDiscGroup1Txt := DiscGrpRec.Description;

              IF NewDiscGroup2 = '' THEN
                DiscGrpRec.INIT
              ELSE
                DiscGrpRec.GET(DiscGrpRec.Level::Job, NewDiscGroup2);
              NewDiscGroup2Txt := DiscGrpRec.Description;
            END;
          END;
        6:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldItem = '' THEN
                ItemRec.INIT
              ELSE
                ItemRec.GET(OldItem);
              OldItemTxt := ItemRec.Description;

              IF OldManufacturer = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(OldManufacturer);
              OldManufacturerTxt := VendorRec.Name;

              IF OldBasicItem = '' THEN
                BasicItemRec.INIT
              ELSE
                BasicItemRec.GET(OldManufacturer, OldBasicItem);
              OldBasicItemTxt := BasicItemRec."Product Description";

              IF OldVendor = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(OldVendor);
              OldVendorTxt := VendorRec.Name;

              IF OldTradeItem = '' THEN
                TradeItemRec.INIT
              ELSE
                TradeItemRec.GET(OldVendor, OldTradeItem);
              OldTradeItemTxt := TradeItemRec."Item Description";
            END;
            IF lvField = 1 THEN BEGIN
              IF NewItem = '' THEN
                ItemRec.INIT
              ELSE
                ItemRec.GET(NewItem);
              NewItemTxt := ItemRec.Description;

              IF NewManufacturer = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(NewManufacturer);
              NewManufacturerTxt := VendorRec.Name;

              IF NewBasicItem = '' THEN
                BasicItemRec.INIT
              ELSE
                BasicItemRec.GET(NewManufacturer, NewBasicItem);
              NewBasicItemTxt := BasicItemRec."Product Description";

              IF NewVendor = '' THEN
                VendorRec.INIT
              ELSE
                VendorRec.GET(NewVendor);
              NewVendorTxt := VendorRec.Name;

              IF NewTradeItem = '' THEN
                TradeItemRec.INIT
              ELSE
                TradeItemRec.GET(NewVendor, NewTradeItem);
              NewTradeItemTxt := TradeItemRec."Item Description";
            END;
          END;
        7:
          BEGIN
            IF lvField = 0 THEN BEGIN
              IF OldRecipeGroup = '' THEN
                RcpGroupRec.INIT
              ELSE
                RcpGroupRec.GET(OldRecipeGroup);
              OldRecipeGroupTxt := RcpGroupRec.Description;

              IF OldRecipe = '' THEN
               RecipeRec.INIT
              ELSE
                RecipeRec.GET(OldRecipeGroup, OldRecipe);
              OldRecipeTxt := RecipeRec.Description;
            END;
            IF lvField = 1 THEN BEGIN
              IF NewRecipeGroup = '' THEN
                RcpGroupRec.INIT
              ELSE
                RcpGroupRec.GET(NewRecipeGroup);
              NewRecipeGroupTxt := RcpGroupRec.Description;

              IF NewRecipe = '' THEN
               RecipeRec.INIT
              ELSE
                RecipeRec.GET(NewRecipeGroup, NewRecipe);
              NewRecipeTxt := RecipeRec.Description;
            END;
          END;

      END;
    END;

    PROCEDURE CheckItemOptions@1100525000();
    BEGIN
      IF (((OldItem <> '') AND (NewItem = '')) OR
          ((OldItem = '') AND (NewItem <> '')) OR
          ((OldBasicItem <> '') AND (NewBasicItem = '')) OR
          ((OldBasicItem = '') AND (NewBasicItem <> '')) OR
          ((OldTradeItem <> '') AND (NewTradeItem = '')) OR
          ((OldTradeItem = '') AND (NewTradeItem <> ''))) THEN
        ERROR(Text000);

      IF (((OldItem <> '') AND (OldBasicItem + OldTradeItem <> '')) OR
          ((OldBasicItem <> '') AND (OldItem + OldTradeItem <> '')) OR
          ((OldTradeItem <> '') AND (OldItem + OldBasicItem <> '')) OR
          ((NewItem <> '') AND (NewBasicItem + NewTradeItem <> ''))) OR
          ((NewBasicItem <> '') AND (NewItem + NewTradeItem <> '')) OR
          ((NewTradeItem <> '') AND (NewItem + NewBasicItem <> '')) THEN
        ERROR(Text001);
    END;

    PROCEDURE StartUpdate@1100485001();
    VAR
      EstLineRec@1100525005 : Record 11072072;
      EstLineRec2@1100525006 : Record 11072072;
      RcpLineRec@1100525004 : Record 11072075;
      BaseRcpLineRec@1100525007 : Record 11020582;
      TmpConvRec@1100525001 : TEMPORARY Record 11012322;
      ItemRec@1100525000 : Record 27;
      BasicItemRec@1100525002 : Record 11012316;
      TradeItemRec@1100525003 : Record 11012317;
      UpdateMgt@1100528900 : Codeunit 11012229;
    BEGIN
      EstLineRec.COPY("Estimate Line NEW");
      CheckRequestOptions(1);
      CheckItemOptions;

      CASE gvAction OF
        1: UpdateMgt.ReplaceRateCode(EstLineRec, OldRate, NewRate);
        2:
          BEGIN
            UpdateMgt.ReplaceNormGroup(EstLineRec, OldNormGroup, NewNormGroup);
            UpdateMgt.ReplaceNormGroupSales(EstLineRec, OldNormGroupSales, NewNormGroupSales);  //DP00381
          END;
        3: UpdateMgt.ReplaceCondition(EstLineRec, OldCondition, NewCondition);
        4: UpdateMgt.ReplaceTradeVendor(EstLineRec, OldVendor, NewVendor);
        5:
          BEGIN
            EstRec.SETFILTER("No.", EstLineRec.GETFILTER("Estimate No."));
            IF EstRec.FINDSET(TRUE,FALSE) THEN BEGIN
              REPEAT
                EstRec."Purch Discount Term Group 1" := NewDiscGroup1;
                EstRec."Purch Discount Term Group 2" := NewDiscGroup2;
                EstRec."Reference Date (Item)" := NewRefDateItem;
                EstRec.MODIFY;
              UNTIL EstRec.NEXT = 0;
            END;
            COMMIT;
            UpdateMgt.UpdateActualPrice(EstLineRec,FALSE,TRUE,FALSE,FALSE,FALSE,FALSE,0,0);
          END;
        6:
          BEGIN
            IF OldItem <> '' THEN BEGIN
              ItemRec.SETFILTER("No.", OldItem);
              IF ItemRec.FINDSET THEN BEGIN
                REPEAT
                  TmpConvRec.INIT;
                  TmpConvRec."Item No. (Old)" := ItemRec."No.";
                  TmpConvRec."Item No. (New)" := NewItem;
                  TmpConvRec.MARK := TRUE;
                  IF TmpConvRec.INSERT THEN;
                UNTIL ItemRec.NEXT = 0;
              END;
            END;
            IF OldBasicItem <> '' THEN BEGIN
              IF OldManufacturer <> '' THEN
                BasicItemRec.SETFILTER(Manufacturer, OldManufacturer);
              IF OldBasicItem <> '' THEN
                BasicItemRec.SETFILTER("Product Code", OldBasicItem);
              IF BasicItemRec.FINDSET THEN BEGIN
                REPEAT
                  TmpConvRec.INIT;
                  TmpConvRec."Manufacturer (Old)" := BasicItemRec.Manufacturer;
                  TmpConvRec."Basic Item (Old)" := BasicItemRec."Product Code";
                  TmpConvRec."Manufacturer (New)" := NewManufacturer;
                  TmpConvRec."Basic Item (New)" := NewBasicItem;
                  TmpConvRec.MARK := TRUE;
                  IF TmpConvRec.INSERT THEN;
                UNTIL BasicItemRec.NEXT = 0;
              END;
            END;
            IF OldTradeItem <> '' THEN BEGIN
              IF OldVendor <> '' THEN
                TradeItemRec.SETFILTER(Vendor, OldVendor);
              IF OldTradeItem <> '' THEN
                TradeItemRec.SETFILTER("Item Code", OldTradeItem);
              IF TradeItemRec.FINDSET THEN BEGIN
                REPEAT
                  TmpConvRec.INIT;
                  TmpConvRec."Vendor (Old)" := TradeItemRec.Vendor;
                  TmpConvRec."Trade Item (Old)" := TradeItemRec."Item Code";
                  TmpConvRec."Vendor (New)" := NewVendor;
                  TmpConvRec."Trade Item (New)" := NewTradeItem;
                  TmpConvRec.MARK := TRUE;
                  IF TmpConvRec.INSERT THEN;
                UNTIL TradeItemRec.NEXT = 0;
              END;
            END;
            TmpConvRec.MARKEDONLY(TRUE);
            UpdateMgt.ReplaceItem(TmpConvRec, EstLineRec, RcpLineRec, BaseRcpLineRec,
              TRUE, TRUE, FALSE, TRUE, TRUE);  //db, 24-06-14: C014467 (skip base recipe)
          END;
        7:
          BEGIN
            EstLineRec.SETRANGE("Recipe Group", OldRecipeGroup);
            EstLineRec.SETRANGE(Recipe, OldRecipe);
            IF EstLineRec.FINDSET(TRUE, TRUE) THEN BEGIN
              REPEAT
                EstLineRec2 := EstLineRec;
                EstLineRec2."Recipe Group" := NewRecipeGroup;
                EstLineRec2.Recipe := '';  //db, 23-04-15: C022804 (required for check on xRec in validate Recipe)
                EstLineRec2.VALIDATE(Recipe, NewRecipe);
                EstLineRec2.MODIFY;
              UNTIL EstLineRec.NEXT = 0;
            END;
          END;
        8: UpdateMgt.ReplaceCurrencyCode(EstLineRec, OldCurrencyCode, NewCurrencyCode);
      END;
    END;

    PROCEDURE InitPageRequestOptions@1100528900();
    BEGIN
      NewRecipeEditable := TRUE;
      OldRecipeEditable := TRUE;
      NewRecipeGroupEditable := TRUE;
      OldRecipeGroupEditable := TRUE;
      NewTradeItemEditable := TRUE;
      OldTradeItemEditable := TRUE;
      NewBasicItemEditable := TRUE;
      OldBasicItemEditable := TRUE;
      NewManufacturerEditable := TRUE;
      OldManufacturerEditable := TRUE;
      NewItemEditable := TRUE;
      OldItemEditable := TRUE;
      NewRefDateItemEditable := TRUE;
      OldRefDateItemEditable := TRUE;
      NewDiscGroup2Editable := TRUE;
      OldDiscGroup2Editable := TRUE;
      NewDiscGroup1Editable := TRUE;
      OldDiscGroup1Editable := TRUE;
      NewConditionEditable := TRUE;
      OldConditionEditable := TRUE;
      NewNormGroupEditable := TRUE;
      OldNormGroupEditable := TRUE;
      //DP00381.sn
      NewNormGroupSalesEditable := TRUE;
      OldNormGroupSalesEditable := TRUE;
      //DP00381.en
      NewRateEditable := TRUE;
      OldRateEditable := TRUE;
      OldCurrencyCodeEditable := TRUE;
      NewCurrencyCodeEditable := TRUE;
    END;

    BEGIN
    {
      db, 07-10-08: M11811
      1: Rate Code
      2: Norm Group (Cost/Sales)
      3: Condition
      4: Vendor (Trade Item)
      5: Discount Term Groups + Reference Date (Item)
      6: Item Data
      7: Recipe
    }
    END.
  }
  RDLDATA
  {
  }
}

