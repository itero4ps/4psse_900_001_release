OBJECT Report 78895 ProMis (+NAS)
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS.IMINF-GB;
  }
  PROPERTIES
  {
    ProcessingOnly=Yes;
    OnInitReport=BEGIN

                   OnlyLastDayChanged := TRUE;      //08042015.GB Uitcommentarieren voor NAS
                   OnlyJobsLastDayChanged := TRUE;  //08042015.GB Uitcommentarieren voor NAS
                   GetFilterForFileConfig;
                   GetFilterForProjectType;
                 END;

    OnPreReport=VAR
                  CompRel@1100525000 : Record 11012059;
                BEGIN
                  CompRel.SETRANGE(Company, COMPANYNAME);
                  CompRel.SETRANGE("Company Finance Data", COMPANYNAME);
                  IF NOT CompRel.FINDFIRST THEN BEGIN
                    IF GUIALLOWED AND NOT ISSERVICETIER THEN
                      ERROR('Report mag alleen aangeroepen worden vanuit Centraal Beheer bedrijf');
                  END;
                  GetFilterForCostObjects;
                  GetFilter(DrempelwaardeFilter, DrempelwaardeFilter2);
                  GetFilterForNAVCompany;
                  GetFilterForCompanyStructure;
                END;

  }
  DATASET
  {
    { 1100525000;;DataItem;Aantal            ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number)
                                 WHERE(Number=FILTER(1..2));
               OnAfterGetRecord=BEGIN
                                  CASE Number OF
                                    1: BEGIN
                                         TempTryOut.RESET;
                                         TempTryOut.DELETEALL;
                                         TryOutFileName := GetDirAndFileName(1);
                                         KPAFileName := GetDirAndFileName(3);
                                         TryOutSuccFileName := GetDirAndFileName(5);
                                         JobFileName := GetDirAndFileName(7);
                                         JobFinFileName := GetDirAndFileName(9);
                                         WipFileName  := GetDirAndFileName(13);
                                       END;
                                    2: BEGIN
                                         IF CreateKPAFile THEN
                                           KPAFile.CLOSE;
                                         CreateKPAFile := FALSE;
                                         IF TryOutQtFileCreated THEN
                                           TryOutFile.CLOSE;
                                         TryOutQtFileCreated := FALSE;
                                         IF TryOutSuccFileCreated THEN
                                           TryOutSuccFile.CLOSE;
                                         TryOutSuccFileCreated := FALSE;
                                         IF JobFileCreated THEN
                                           JobFile.CLOSE;
                                         JobFileCreated := FALSE;
                                         IF CreateJobFinFile THEN
                                           JobFinFile.CLOSE;
                                         CreateJobFinFile := FALSE;
                                         IF WIPFileCreated THEN
                                           WIPFile.CLOSE;
                                         WIPFileCreated := FALSE;
                                         TempTryOut.RESET;
                                         TempTryOut.DELETEALL;
                                         TryOutFileName := GetDirAndFileName(2);
                                         KPAFileName := GetDirAndFileName(4);
                                         TryOutSuccFileName := GetDirAndFileName(6);
                                         JobFileName := GetDirAndFileName(8);
                                         JobFinFileName := GetDirAndFileName(10);
                                         CompFileName := GetDirAndFileName(12);
                                         WipFileName  := GetDirAndFileName(14);
                                       END;
                                  END;
                                END;

               OnPostDataItem=BEGIN
                                IF CreateJobFinFile THEN
                                  JobFinFile.CLOSE;
                              END;
                               }

    { 1100525001;1;DataItem;                 ;
               DataItemTable=Table2000000006;
               DataItemTableView=SORTING(Name);
               OnPreDataItem=BEGIN
                               IF gCompanyFilter <> '' THEN
                                 SETFILTER(Name, gCompanyFilter);
                             END;

               OnAfterGetRecord=BEGIN
                                  TempJobRec.RESET;
                                  TempJobRec.DELETEALL;
                                END;
                                 }

    { 1100525002;2;DataItem;                 ;
               DataItemTable=Table5200;
               DataItemTableView=SORTING(No.);
               OnPreDataItem=BEGIN
                               IF KPAFileName = '' THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               SETRANGE(Status, Status::Active);
                               IF FINDSET THEN BEGIN
                                 IF NOT CreateKPAFile THEN BEGIN
                                   CreateKPAFile := TRUE;
                                   FindKPALines := TRUE;
                                   KPAFile.TEXTMODE(TRUE);
                                   KPAFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     KPAFile.QUERYREPLACE := TRUE;
                                   KPAFile.CREATE(KPAFileName);
                                   RESET;
                                 END;
                               END ELSE
                                 CurrReport.BREAK;
                             END;

               OnAfterGetRecord=VAR
                                  User_ID@1100525001 : Code[20];
                                  UserSetup@1100525000 : Record 91;
                                BEGIN
                                  IF NOT UserIDExist("No.") THEN
                                    CurrReport.SKIP;

                                  IF NOT GetUserId("No.", User_ID) THEN
                                    CurrReport.SKIP;

                                  FillValue(KPAFile, FillWhiteSpaces(20, User_ID), TRUE, FALSE);
                                  FillValue(KPAFile, FillWhiteSpaces(20, "No."), FALSE, FALSE);
                                  FillValue(KPAFile, FillWhiteSpaces(50, CharConv.Ascii2Ansi("Full Name")), FALSE, FALSE);
                                  IF FileBool[6] THEN BEGIN
                                    IF COMPANYNAME <> Company.Name THEN
                                      UserSetup.CHANGECOMPANY(Company.Name);
                                    UserSetup.SETRANGE("Employee No.","No.");
                                    IF UserSetup.FINDFIRST THEN;
                                    FillValue(KPAFile, FillWhiteSpaces(10,FORMAT(UserSetup."Department Authoriz. Active")), FALSE, FALSE);
                                    FillValue(KPAFile, FillWhiteSpaces(20,FORMAT(UserSetup."Department Code")), FALSE, FALSE);
                                    FillValue(KPAFile, FillWhiteSpaces(100,FORMAT(UserSetup."Department Code Filter")), FALSE, FALSE);
                                  END ELSE BEGIN
                                    FillValue(KPAFile, FillWhiteSpaces(10, FORMAT('')), FALSE, FALSE);
                                    FillValue(KPAFile, FillWhiteSpaces(20, FORMAT('')), FALSE, FALSE);
                                    FillValue(KPAFile, FillWhiteSpaces(100, FORMAT('')), FALSE, FALSE);
                                  END;
                                  FillValue(KPAFile, FillWhiteSpaces(10, FORMAT("Language Code")), FALSE, FALSE);
                                  FillValue(KPAFile, FillWhiteSpaces(10, FORMAT('')), FALSE, TRUE);
                                END;
                                 }

    { 1100525003;2;DataItem;                 ;
               DataItemTable=Table11012758;
               DataItemTableView=SORTING(Code);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[1] THEN
                                 CurrReport.BREAK;

                               TempTryOut.RESET;         //08042015.GB
                               TempTryOut.DELETEALL;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);
                               SETRANGE(Leading, TRUE);
                               SETFILTER("Offered Amount (LCY)", '>%1', DrempelwaardeFilter2);
                               IF OnlyLastDayChanged THEN
                                 SETRANGE("Change Date", TodayOrNot); //TODAY);

                               IF NOT TryOutQtFileCreated THEN BEGIN
                                 IF FINDSET THEN BEGIN
                                   TryOutQtFileCreated := TRUE;
                                   FindTryOutLines := TRUE;
                                   TryOutFile.TEXTMODE(TRUE);
                                   TryOutFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     TryOutFile.QUERYREPLACE := TRUE;
                                   TryOutFile.CREATE(TryOutFileName);
                                 END ELSE
                                   CurrReport.BREAK;
                               END;
                             END;

               OnAfterGetRecord=VAR
                                  SalesPerson@1100525004 : Record 13;
                                  TryOutLine@1100525003 : Record 11125864;
                                  TryOutSucc@1100525002 : Record 11012761;
                                  TempText@1100525001 : Text[500];
                                  Tr@1100525000 : Record 11012750;
                                BEGIN
                                  IF DefineCompany("Global Dimension 1 Code") = '*' THEN
                                    CurrReport.SKIP;

                                  FillValue(TryOutFile, FillWhiteSpaces(20,Code), TRUE, FALSE);
                                  Description := DELCHR(Description, '=', ';');
                                  FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(Description)), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT("Offered Amount (LCY)")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Creation Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Register Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Expected Starting Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Expected End Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(Status)), FALSE, FALSE);

                                  IF COMPANYNAME <> Company.Name THEN
                                    TryOutLine.CHANGECOMPANY(Company.Name);
                                  TryOutLine.SETRANGE("Try-out Quote", Code);
                                  TryOutLine.SETRANGE("Contact Type", 'EG');
                                  IF TryOutLine.FINDFIRST THEN BEGIN
                                    TryOutLine.CALCFIELDS("Contact Name");
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(TryOutLine."Contact Name")), FALSE, FALSE)
                                  END ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT('')), FALSE, FALSE);

                                  IF COMPANYNAME <> Company.Name THEN
                                    TryOutLine.CHANGECOMPANY(Company.Name);
                                  TryOutLine.SETRANGE("Try-out Quote", Code);
                                  TryOutLine.SETRANGE("Contact Type", 'OG');
                                  IF TryOutLine.FINDSET THEN BEGIN
                                    REPEAT
                                      TryOutLine.CALCFIELDS("Contact Name");
                                      IF TempText = '' THEN
                                        TempText := TryOutLine."Contact Name"
                                      ELSE BEGIN
                                        IF (STRLEN(TempText) + STRLEN(TryOutLine."Contact Name") + 2) <= 500 THEN
                                        TempText := TempText + '|' + TryOutLine."Contact Name";
                                      END;
                                    UNTIL TryOutLine.NEXT = 0;
                                  END;
                                  FillValue(TryOutFile, FillWhiteSpaces(500, FORMAT(TempText)), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT("Global Dimension 1 Code")), FALSE, FALSE);

                                  IF IsHoofdTraject("Try-out No.") THEN BEGIN
                                    FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Deeltraject')), FALSE, FALSE);
                                    FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT("Try-out No.")), FALSE, FALSE);
                                    FillTempTryOut("Try-out No.");
                                  END ELSE BEGIN
                                    FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Deeltraject')), FALSE, FALSE);
                                    FillValue(TryOutFile, FillWhiteSpaces(20, GetRealMainTryOut("Try-out No.")), FALSE, FALSE);
                                    FillTempTryOut(GetRealMainTryOut("Try-out No."));
                                  END;

                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT("Salesperson Code")), FALSE, FALSE);
                                  IF COMPANYNAME <> Company.Name THEN
                                    SalesPerson.CHANGECOMPANY(Company.Name);
                                  SalesPerson.SETRANGE(Code,"Salesperson Code");
                                  IF SalesPerson.FINDFIRST THEN
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(SalesPerson.Name)), FALSE, FALSE)
                                  ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT("Salesperson Code")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces( 20, FORMAT(DefineCompany("Global Dimension 1 Code"))), FALSE, TRUE);
                                END;
                                 }

    { 1100525004;2;DataItem;                 ;
               DataItemTable=Table11012750;
               DataItemTableView=SORTING(Code);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[1] THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               SETRANGE("Single/Main/Sub Tryout", "Single/Main/Sub Tryout"::Single,
                                  "Single/Main/Sub Tryout"::Main);
                               SETFILTER("Order Amount (LCY)", '>%1', DrempelwaardeFilter);
                               IF OnlyLastDayChanged THEN
                                 SETRANGE("Change Date", TodayOrNot);

                               IF NOT TryOutQtFileCreated THEN BEGIN
                                 IF FINDSET THEN BEGIN
                                   TryOutQtFileCreated := TRUE;
                                   FindTryOutLines := TRUE;
                                   TryOutFile.TEXTMODE(TRUE);
                                   TryOutFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     TryOutFile.QUERYREPLACE := TRUE;
                                   TryOutFile.CREATE(TryOutFileName);
                                 END ELSE
                                   CurrReport.BREAK;
                               END;
                             END;

               OnAfterGetRecord=VAR
                                  SalesPerson@1100525005 : Record 13;
                                  TryOutLine@1100525004 : Record 11012755;
                                  TryOutSucc@1100525003 : Record 11012761;
                                  TempText@1100525002 : Text[500];
                                  Tr@1100525001 : Record 11012750;
                                  TRF@1100525000 : Record 11012758;
                                BEGIN
                                  IF DefineCompany("Global Dimension 1 Code") = '*' THEN
                                    CurrReport.SKIP;

                                  FillValue(TryOutFile, FillWhiteSpaces(20,Code), TRUE, FALSE);
                                  Description := DELCHR(Description, '=', ';');
                                  FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(Description)), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT("Order Amount (LCY)")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Creation Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT( '')), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Expected Starting Date")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT("Expected End Date")), FALSE, FALSE);

                                  IF COMPANYNAME <> Company.Name THEN
                                    TRF.CHANGECOMPANY(Company.Name);
                                  TRF.SETRANGE("Try-out No.", Code);
                                  TRF.SETRANGE(Leading, TRUE);
                                  TRF.SETFILTER("Offered Amount (LCY)", '>%1', DrempelwaardeFilter2);
                                  IF OnlyLastDayChanged THEN
                                    TRF.SETRANGE("Change Date", TodayOrNot);
                                  IF TRF.FINDFIRST THEN BEGIN
                                    IF DefineCompany(TRF."Global Dimension 1 Code") = '*' THEN
                                      FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(Status)), FALSE, FALSE)
                                    ELSE
                                      FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TRF.Status)), FALSE, FALSE);
                                  END ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(Status)), FALSE, FALSE);
                                  //16012015.GB.en

                                  IF COMPANYNAME <> Company.Name THEN
                                    TryOutLine.CHANGECOMPANY(Company.Name);
                                  TryOutLine.SETRANGE("Try-out No.", Code);
                                  TryOutLine.SETRANGE("Contact Type", 'EG');
                                  IF TryOutLine.FINDFIRST THEN BEGIN
                                    TryOutLine.CALCFIELDS("Contact Name");
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(TryOutLine."Contact Name")), FALSE, FALSE)
                                  END ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT('')), FALSE, FALSE);

                                  IF COMPANYNAME <> Company.Name THEN
                                    TryOutLine.CHANGECOMPANY(Company.Name);
                                  TryOutLine.SETRANGE("Try-out No.", Code);
                                  TryOutLine.SETRANGE("Contact Type", 'OG');
                                  IF TryOutLine.FINDSET THEN BEGIN
                                    REPEAT
                                      TryOutLine.CALCFIELDS("Contact Name");
                                      IF TempText = '' THEN
                                        TempText := TryOutLine."Contact Name"
                                      ELSE BEGIN
                                        IF (STRLEN(TempText) + STRLEN(TryOutLine."Contact Name") + 2) <= 500 THEN
                                        TempText := TempText + '|' + TryOutLine."Contact Name";
                                      END;
                                    UNTIL TryOutLine.NEXT = 0;
                                  END;
                                  FillValue(TryOutFile, FillWhiteSpaces(500, FORMAT(TempText)), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT("Global Dimension 1 Code")), FALSE, FALSE);
                                  CASE "Single/Main/Sub Tryout" OF
                                    "Single/Main/Sub Tryout"::Single:
                                      FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
                                    "Single/Main/Sub Tryout"::Main:
                                      FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
                                    "Single/Main/Sub Tryout"::"Sub Try-out":
                                      FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
                                  END;

                                  IF IsHoofdTraject(Code) THEN
                                    FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('')), FALSE, FALSE)
                                  ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('')), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT("Salesperson Code")), FALSE, FALSE);

                                  IF COMPANYNAME <> Company.Name THEN
                                    SalesPerson.CHANGECOMPANY(Company.Name);
                                  SalesPerson.SETRANGE(Code,"Salesperson Code");
                                  IF SalesPerson.FINDFIRST THEN
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(SalesPerson.Name)), FALSE, FALSE)
                                  ELSE
                                    FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT("Salesperson Code")), FALSE, FALSE);
                                  FillValue(TryOutFile, FillWhiteSpaces( 20, FORMAT(DefineCompany("Global Dimension 1 Code"))), FALSE, TRUE);
                                END;

               OnPostDataItem=VAR
                                Tr@1100525000 : Integer;
                              BEGIN
                                TempTryOut.RESET;
                                IF TempTryOut.COUNT > 0 THEN BEGIN
                                  REPEAT
                                    Tr += 1;
                                    IF Tr = 1 THEN
                                      TempTryOut.FINDFIRST
                                    ELSE
                                      TempTryOut.NEXT;
                                    ExportTryOutToFile(TempTryOut);
                                  UNTIL TempTryOut.NEXT = 0;
                                END;
                                TempTryOut.RESET;
                                TempTryOut.DELETEALL;
                              END;
                               }

    { 1100525005;2;DataItem;Vervolgtraject   ;
               DataItemTable=Table11012761;
               DataItemTableView=SORTING(Try-out No.,Try-out Quote,Line No.);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[2] THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               SETFILTER("Project No.", '<>%1','');

                               IF NOT TryOutSuccFileCreated THEN BEGIN
                                 IF FINDSET THEN BEGIN
                                   TryOutSuccFileCreated := TRUE;
                                   TryOutSuccFile.TEXTMODE(TRUE);
                                   TryOutSuccFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     TryOutSuccFile.QUERYREPLACE := TRUE;
                                   TryOutSuccFile.CREATE(TryOutSuccFileName);
                                 END ELSE
                                   CurrReport.BREAK;
                               END;
                             END;

               OnAfterGetRecord=BEGIN
                                  IF "Try-out Quote" <> '' THEN BEGIN
                                    FillValue(TryOutSuccFile, FillWhiteSpaces(20,"Try-out Quote"), TRUE, FALSE);
                                    FillValue(TryOutSuccFile, FillWhiteSpaces(20,"Project No."), FALSE, TRUE);
                                  END;
                                  IF "Try-out No." <> '' THEN BEGIN
                                    IF IsHoofdTraject("Try-out No.") THEN BEGIN
                                      FillValue(TryOutSuccFile, FillWhiteSpaces(20,"Try-out No."), TRUE, FALSE);
                                      FillValue(TryOutSuccFile, FillWhiteSpaces(20,"Project No."), FALSE, TRUE);
                                    END;
                                  END;
                                END;
                                 }

    { 1100525006;2;DataItem;                 ;
               DataItemTable=Table11072003;
               DataItemTableView=SORTING(No.);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[3] THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               TempJobRec.RESET;
                               TempJobRec.DELETEALL;

                               IF ProjectTypeFilter <> '' THEN
                                 SETFILTER("Project Type", ProjectTypeFilter);
                               IF OnlyLastDayChanged THEN
                                 SETFILTER("Last Date Modified", '%1', TodayOrNot);

                               IF NOT JobFileCreated THEN BEGIN
                                 IF FINDSET THEN BEGIN
                                   JobFileCreated := TRUE;
                                   FindJobs := TRUE;
                                   JobFile.TEXTMODE(TRUE);
                                   JobFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     JobFile.QUERYREPLACE := TRUE;
                                   JobFile.CREATE(JobFileName);
                                 END;
                               END;
                             END;

               OnAfterGetRecord=VAR
                                  ProjPrincipal@1100525002 : Record 11012005;
                                  TempNames@1100525001 : Text[510];
                                  DimVal@1100525000 : Record 349;
                                BEGIN
                                  IF OnlyJobsLastDayChanged THEN BEGIN
                                    IF ("Last Date Modified" < TodayOrNot) THEN
                                      CurrReport.SKIP
                                    ELSE
                                      IF (Job500K("No.")) THEN
                                        CurrReport.SKIP;
                                  END ELSE
                                    IF (Job500K("No.")) THEN
                                      CurrReport.SKIP;

                                  IF DefineCompany("Global Dimension 1 Code") = '*' THEN
                                    CurrReport.SKIP;

                                  //Als deelproject of hoofdproject dan gerelateerde projecten ook mee exporteren....
                                  //Deze eerst in tempJobRec vullen om dubbelingen te voorkomen.
                                  IF ("Single/Main/Sub Project" = "Single/Main/Sub Project"::"Main Project") OR
                                    ("Single/Main/Sub Project" = "Single/Main/Sub Project"::"Sub Project") THEN BEGIN
                                    InsertTempJobs("No.");
                                  END;

                                  IF TempJobRec.GET("No.") THEN
                                    TempJobRec.DELETE;

                                  SETFILTER("Project Filter", "No.");
                                  SETFILTER("Cumulation Filter", '..%1', TodayOrNot);

                                  CALCFIELDS("Name Project Manager", "Project Contract Amount", "Extension Contract Amount");
                                  FillValue(JobFile, FillWhiteSpaces(20, "No."), TRUE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(50, CharConv.Ascii2Ansi(Description)), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(20, "Project Manager"), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(50, "Name Project Manager"), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Project Status")), FALSE, FALSE);

                                  CLEAR(TempNames);
                                  IF COMPANYNAME <> Company.Name THEN
                                    ProjPrincipal.CHANGECOMPANY(Company.Name);
                                  ProjPrincipal.SETRANGE("Project No.", "No.");
                                  IF ProjPrincipal.FINDSET THEN BEGIN
                                    REPEAT
                                      ProjPrincipal.CALCFIELDS("Principal Name");
                                      IF TempNames = '' THEN
                                        TempNames := ProjPrincipal."Principal Name"
                                      ELSE BEGIN
                                        IF (STRLEN(TempNames) + 1 + STRLEN(ProjPrincipal."Principal Name")) < 450 THEN
                                          TempNames := TempNames + ',' + ProjPrincipal."Principal Name";
                                      END;
                                    UNTIL ProjPrincipal.NEXT = 0
                                  END;
                                  TempNames := DELCHR(TempNames,'=', ';/\');
                                  FillValue(JobFile, FillWhiteSpaces(500, FORMAT(TempNames)), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Project Contract Amount" + "Extension Contract Amount")), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Global Dimension 1 Code")), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(30, FORMAT("Single/Main/Sub Project")), FALSE, FALSE);
                                  IF "Single/Main/Sub Project" = "Single/Main/Sub Project"::"Sub Project" THEN
                                    FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Main Project")), FALSE, FALSE)
                                  ELSE
                                    FillValue(JobFile, FillWhiteSpaces(20, FORMAT(' ')), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Starting Date")), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Ending Date")), FALSE, FALSE);
                                  FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Last Date Modified")), FALSE, FALSE);
                                  FillValue(JobFile, DefineCompany("Global Dimension 1 Code"), FALSE, TRUE);
                                END;
                                 }

    { 1100525007;2;DataItem;OtherJobs        ;
               DataItemTable=Table2000000026;
               DataItemTableView=SORTING(Number);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[3] THEN
                                 CurrReport.BREAK;

                               TempJobRec.RESET;
                               SETRANGE(Number, 1, TempJobRec.COUNT);
                               IF TempJobRec.COUNT = 0 THEN
                                 CurrReport.SKIP;

                               IF NOT JobFileCreated THEN BEGIN
                                 IF TempJobRec.FINDSET THEN BEGIN
                                   JobFileCreated := TRUE;
                                   FindJobs := TRUE;
                                   JobFile.TEXTMODE(TRUE);
                                   JobFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     JobFile.QUERYREPLACE := TRUE;
                                   JobFile.CREATE(JobFileName);
                                 END ELSE
                                   CurrReport.BREAK;
                               END;
                             END;

               OnAfterGetRecord=VAR
                                  JobRec@1100525003 : Record 11072003;
                                  TempNames@1100525002 : Text[500];
                                  ProjPrincipal@1100525001 : Record 11012005;
                                  DimVal@1100525000 : Record 349;
                                BEGIN
                                  IF Number = 1 THEN
                                    TempJobRec.FINDFIRST
                                  ELSE
                                    TempJobRec.NEXT;

                                  IF COMPANYNAME <> Company.Name THEN
                                    JobRec.CHANGECOMPANY(Company.Name);
                                  JobRec.SETRANGE("No.", TempJobRec."No.");
                                  JobRec.FINDFIRST;
                                  WITH JobRec DO BEGIN
                                    IF DefineCompany("Global Dimension 1 Code") = '*' THEN
                                      CurrReport.SKIP;
                                    SETFILTER("Project Filter", "No.");
                                    SETFILTER("Cumulation Filter", '..%1', TodayOrNot);
                                    IF ProjectTypeFilter <> '' THEN
                                      SETFILTER("Project Type", ProjectTypeFilter);
                                    CALCFIELDS("Name Project Manager", "Project Contract Amount", "Extension Contract Amount");
                                    FillValue(JobFile, FillWhiteSpaces(20, "No."), TRUE, FALSE);
                                    Description := DELCHR(Description, '=', ';');
                                    FillValue(JobFile, FillWhiteSpaces(50, CharConv.Ascii2Ansi(Description)), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(20, "Project Manager"), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(50, "Name Project Manager"), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Project Status")), FALSE, FALSE);
                                    CLEAR(TempNames);
                                    IF COMPANYNAME <> Company.Name THEN
                                      ProjPrincipal.CHANGECOMPANY(Company.Name);
                                    ProjPrincipal.SETRANGE("Project No.", "No.");
                                    IF ProjPrincipal.FINDSET THEN BEGIN
                                      REPEAT
                                        ProjPrincipal.CALCFIELDS("Principal Name");
                                        IF TempNames = '' THEN
                                          TempNames := ProjPrincipal."Principal Name"
                                        ELSE BEGIN
                                          IF (STRLEN(TempNames) + 1 + STRLEN(ProjPrincipal."Principal Name")) < 450 THEN
                                            TempNames := TempNames + ',' + ProjPrincipal."Principal Name";
                                        END;
                                      UNTIL ProjPrincipal.NEXT = 0
                                    END;
                                    FillValue(JobFile, FillWhiteSpaces(500, FORMAT(CharConv.Ascii2Ansi(TempNames))), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Project Contract Amount" + "Extension Contract Amount")), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Global Dimension 1 Code")), FALSE, FALSE); //05032014.GB
                                    FillValue(JobFile, FillWhiteSpaces(30, FORMAT("Single/Main/Sub Project")), FALSE, FALSE);
                                    IF "Single/Main/Sub Project" = "Single/Main/Sub Project"::"Sub Project" THEN
                                      FillValue(JobFile, FillWhiteSpaces(20, FORMAT("Main Project")), FALSE, FALSE)
                                    ELSE
                                      FillValue(JobFile, FillWhiteSpaces(20, FORMAT(' ')), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Starting Date")), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Ending Date")), FALSE, FALSE);
                                    FillValue(JobFile, FillWhiteSpaces(10, FORMAT("Last Date Modified")), FALSE, FALSE);
                                    FillValue(JobFile, DefineCompany("Global Dimension 1 Code"), FALSE, TRUE);
                                  END;
                                END;
                                 }

    { 1100525008;2;DataItem;PrognoseGegevens ;
               DataItemTable=Table11072003;
               DataItemTableView=SORTING(No.)
                                 WHERE(Project Status=FILTER(<Finished));
               OnPreDataItem=BEGIN
                               IF NOT FileBool[4] THEN
                                 CurrReport.BREAK;

                               IF ExportAllPrognosis THEN
                                 CurrReport.BREAK;

                               IF JobFinFileName = '' THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);
                               IF ProjectTypeFilter <> '' THEN
                                 SETFILTER("Project Type", ProjectTypeFilter);

                               IF FINDSET THEN BEGIN
                                 IF NOT CreateJobFinFile THEN BEGIN
                                   CreateJobFinFile := TRUE;
                                   FindPrognJobs := TRUE;
                                   JobFinFile.TEXTMODE(TRUE);
                                   JobFinFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     JobFinFile.QUERYREPLACE := TRUE;
                                   JobFinFile.CREATE(JobFinFileName);
                                 END;
                               END ELSE
                                   CurrReport.BREAK;
                             END;

               OnAfterGetRecord=VAR
                                  PrognKop@1100525023 : Record 11012034;
                                  ValueDec@1100525022 : ARRAY [10] OF Decimal;
                                  TotWB@1100525021 : Integer;
                                  TCValueDec@1100525020 : ARRAY [10] OF Decimal;
                                  TotTC@1100525019 : Integer;
                                  PrognValueDec@1100525018 : ARRAY [10] OF Decimal;
                                  TotProgn@1100525017 : Integer;
                                  BestValueDec@1100525016 : ARRAY [10] OF Decimal;
                                  TotBest@1100525015 : Integer;
                                  TotPrValueDec@1100525014 : ARRAY [10] OF Decimal;
                                  TotPrognEndR@1100525013 : Integer;
                                  BudgetDec@1100525012 : ARRAY [10] OF Decimal;
                                  ExtBudgetDec@1100525011 : ARRAY [10] OF Decimal;
                                  AdjBudgetDec@1100525010 : ARRAY [10] OF Decimal;
                                  RemainingDec@1100525009 : Decimal;
                                  TotalInvoiced@1100525008 : Decimal;
                                  VervSaldoDec@1100525007 : Decimal;
                                  PrognDateMainProj@1100525006 : Date;
                                  MaxDateSubProj@1100525005 : Date;
                                  MainProjPrognLeading@1100525004 : Boolean;
                                  TotTotPrognEndR@1100525003 : Decimal;
                                  BegrootResultaat@1100525002 : Decimal;
                                  CostContMgt@1100525001 : Codeunit 11012006;
                                  JobRec@1100525000 : Record 11072003;
                                BEGIN

                                  IF NOT ExportAllPrognosis THEN BEGIN
                                    IF "Single/Main/Sub Project" = "Single/Main/Sub Project"::"Main Project" THEN BEGIN
                                      //Ophalen datum laatste prognose Hoofdproject
                                      PrognDateMainProj := GetLastPrognDate("No.");
                                      //Ophalen max data prognose deelprojecten
                                      MaxDateSubProj := GetLastDatePrognSubProj("No.");
                                      IF MaxDateSubProj > PrognDateMainProj THEN
                                        CurrReport.SKIP
                                      ELSE
                                        MainProjPrognLeading := TRUE;
                                    END;

                                    IF "Single/Main/Sub Project" = "Single/Main/Sub Project"::"Sub Project" THEN BEGIN
                                      //Ophalen datum laatste prognose Hoofdproject
                                      PrognDateMainProj := GetLastPrognDate("Main Project");
                                      //Ophalen max data prognose deelprojecten
                                      MaxDateSubProj := GetLastDatePrognSubProj("Main Project");
                                      IF PrognDateMainProj > MaxDateSubProj THEN
                                        CurrReport.SKIP; //Records niet weergeven
                                    END;
                                    IF COMPANYNAME <> Company.Name THEN
                                      PrognKop.CHANGECOMPANY(Company.Name);
                                    PrognKop.SETRANGE("Project No.", PrognoseGegevens."No.");
                                    PrognKop.SETRANGE("Fix Prognosis Line", TRUE);
                                    IF PrognKop.ISEMPTY THEN
                                      CurrReport.SKIP
                                    ELSE
                                      PrognKop.FINDLAST;
                                    IF NOT MainProjPrognLeading THEN
                                      SETRANGE("Project Filter", "No.")
                                    ELSE BEGIN
                                      SETRANGE("Project Filter");
                                    END;

                                  END;


                                  CLEAR(TotTotPrognEndR);
                                  FillValue(JobFinFile, FillWhiteSpaces(20, "No."), TRUE, FALSE);
                                  FillValue(JobFinFile, FillWhiteSpaces(10, FORMAT(PrognKop."Prognosis Date")), FALSE, FALSE);

                                  //Ophalen gegevens
                                  GetBudgetProj("No.", BudgetDec, MainProjPrognLeading, PrognKop."Prognosis Date");
                                  GetExtContrBudget("No.", ExtBudgetDec, MainProjPrognLeading, PrognKop."Prognosis Date");
                                  GetAdjustments("No.", AdjBudgetDec, MainProjPrognLeading);
                                  GetBudgetByType("No.", PrognKop."Prognosis Date", ValueDec, MainProjPrognLeading); // totale begroting;
                                  GetTotalCostsByTypeOld("No.", PrognKop."Prognosis Date", TCValueDec);// totale kosten Prognose
                                  GetPrognByType("No.", PrognKop."Prognosis Date", PrognValueDec);    // prognose
                                  GetBestByTypeOld("No.", PrognKop."Prognosis Date", BestValueDec); // bestedingen vanuit gefixeerde prognose
                                  GetPrognEndRByType("No.", PrognKop."Prognosis Date", TotPrValueDec);// prognose eindresultaat

                                  //Werkbegroting project
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegroting Meerwerk
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(ExtBudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegrotings correcties
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(AdjBudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegroting totaal
                                  FOR TotWB := 1 TO 8 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(ValueDec[TotWB])), FALSE, FALSE);
                                  END;
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BudgetDec[9] + ExtBudgetDec[9])), FALSE, FALSE);

                                  //Totalekosten
                                  FOR TotTC := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TCValueDec[TotTC])), FALSE, FALSE);
                                  END;
                                  //Prognose
                                  FOR TotProgn := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(PrognValueDec[TotProgn])), FALSE, FALSE);
                                  END;
                                  //Bestedingen
                                  FOR TotBest := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BestValueDec[TotBest])), FALSE, FALSE);
                                  END;
                                  //Prognose eindresultaat
                                  FOR TotPrognEndR := 1 TO 9 DO BEGIN
                                    TotTotPrognEndR += TotPrValueDec[TotPrognEndR];
                                    IF TotPrognEndR = 9 THEN
                                      FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotPrValueDec[TotPrognEndR])), FALSE, FALSE)
                                    ELSE
                                      FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotPrValueDec[TotPrognEndR])), FALSE, FALSE)
                                  END;
                                  IF COMPANYNAME <> Company.Name THEN
                                    JobRec.CHANGECOMPANY(Company.Name);
                                  JobRec.GET("No.");
                                  JobRec.SETRANGE("Period Filter", 0D, PrognKop."Prognosis Date");
                                  JobRec.SETFILTER("Cumulation Filter", '..%1', PrognKop."Prognosis Date");
                                  IF NOT MainProjPrognLeading THEN
                                    JobRec.SETRANGE("Project Filter", "No.")
                                  ELSE BEGIN
                                    JobRec.SETRANGE("Project Filter");
                                  END;
                                  BegrootResultaat := CostContMgt.BudgetResultProject(JobRec, TRUE);
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotTotPrognEndR + BegrootResultaat)), FALSE, FALSE);

                                  //Open verkoopfacturen
                                  CalcPayedAndToPay("No.",'',RemainingDec,TotalInvoiced, VervSaldoDec, PrognKop."Prognosis Date", MainProjPrognLeading);

                                  IF VervSaldoDec <> 0 THEN BEGIN  //aangepast op 30-09-2013 ovv JB was eerst Revenues - RemainingDec
                                    FillValue(JobFinFile, FillWhiteSpaces(5, 'Ja'), FALSE, FALSE);
                                  END ELSE
                                    FillValue(JobFinFile, FillWhiteSpaces(5, 'Nee'), FALSE, FALSE);
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(VervSaldoDec)), FALSE, TRUE);
                                END;
                                 }

    { 1100525009;2;DataItem;WIP              ;
               DataItemTable=Table11072003;
               DataItemTableView=SORTING(No.);
               OnPreDataItem=BEGIN
                               IF NOT FileBool[5] THEN
                                 CurrReport.BREAK;

                               IF WipFileName = '' THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               IF ProjectTypeFilter <> '' THEN
                                 SETFILTER("Project Type", ProjectTypeFilter);

                               SETFILTER("Project Status", '<>%1', WIP."Project Status"::Finished);

                               IF NOT WIPFileCreated THEN BEGIN
                                 IF FINDSET THEN BEGIN
                                   WIPFileCreated := TRUE;
                                   FindJobs := TRUE;
                                   WIPFile.TEXTMODE(TRUE);
                                   WIPFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     WIPFile.QUERYREPLACE := TRUE;
                                   WIPFile.CREATE(WipFileName);
                                 END ELSE
                                   CurrReport.BREAK;
                               END;
                             END;

               OnAfterGetRecord=VAR
                                  WipDec@1100525001 : Decimal;
                                  CostDec@1100525000 : Decimal;
                                BEGIN

                                  IF DefineCompany("Global Dimension 1 Code") = '*' THEN
                                    CurrReport.SKIP;

                                  SETFILTER("Project Filter", "No.");
                                  CALCFIELDS(Revenues, "Actual Costs", "Closed Costs", "Closed Revenues");
                                  FillValue(WIPFile, FillWhiteSpaces(20, "No."), TRUE, FALSE);
                                  FillValue(WIPFile, FillWhiteSpaces(10, FORMAT(TODAY)), FALSE, FALSE);
                                  FillValue(WIPFile, FillWhiteSpaces(50, Description), FALSE, FALSE);
                                  FillValue(WIPFile, FillWhiteSpaces(20, "Global Dimension 1 Code"), FALSE, FALSE);
                                  CostDec := "Actual Costs" + "Closed Costs";
                                  FillValue(WIPFile, FillWhiteSpaces(15, FORMAT(CostDec)), FALSE, FALSE);
                                  WipDec := ("Actual Costs" + "Closed Costs") - ( Revenues - "Closed Revenues");
                                  FillValue(WIPFile, FillWhiteSpaces(15, FORMAT(WipDec)), FALSE, FALSE);
                                  FillValue(WIPFile, FillWhiteSpaces(15, FORMAT(Revenues)), FALSE, TRUE);
                                END;
                                 }

    { 1100525010;2;DataItem;Progn            ;
               DataItemTable=Table11072003;
               DataItemTableView=SORTING(No.);
               OnPreDataItem=BEGIN
                               IF NOT ExportAllPrognosis THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);

                               SETFILTER("Project Status", '<>%1', "Project Status"::Finished);
                               IF ProjectTypeFilter <> '' THEN
                                 SETFILTER("Project Type", ProjectTypeFilter);

                               IF FINDSET THEN BEGIN
                                 IF NOT CreateJobFinFile THEN BEGIN
                                   CreateJobFinFile := TRUE;
                                   FindPrognJobs := TRUE;
                                   JobFinFile.TEXTMODE(TRUE);
                                   JobFinFile.WRITEMODE(TRUE);
                                   IF NOT ISSERVICETIER THEN
                                     JobFinFile.QUERYREPLACE := TRUE;
                                   JobFinFile.CREATE(JobFinFileName);
                                   //SETFILTER("No.", '130071/001');  //Just for debugging issues...
                                 END;
                               END ELSE
                                   CurrReport.BREAK;
                             END;

               OnAfterGetRecord=BEGIN

                                  IF "Single/Main/Sub Project" <> Progn."Single/Main/Sub Project"::"Main Project" THEN
                                    SETRANGE("Project Filter", "No.")
                                  ELSE BEGIN
                                    SETRANGE("Project Filter");
                                  END;
                                END;
                                 }

    { 1100525011;3;DataItem;                 ;
               DataItemTable=Table11012034;
               DataItemTableView=SORTING(Project No.,Prognosis Date);
               OnPreDataItem=BEGIN
                               IF NOT ExportAllPrognosis THEN
                                 CurrReport.BREAK;

                               IF JobFinFileName = '' THEN
                                 CurrReport.BREAK;

                               IF COMPANYNAME <> Company.Name THEN
                                 CHANGECOMPANY(Company.Name);
                             END;

               OnAfterGetRecord=VAR
                                  PrognKop@1100525023 : Record 11012034;
                                  ValueDec@1100525022 : ARRAY [10] OF Decimal;
                                  TotWB@1100525021 : Integer;
                                  TCValueDec@1100525020 : ARRAY [10] OF Decimal;
                                  TotTC@1100525019 : Integer;
                                  PrognValueDec@1100525018 : ARRAY [10] OF Decimal;
                                  TotProgn@1100525017 : Integer;
                                  BestValueDec@1100525016 : ARRAY [10] OF Decimal;
                                  TotBest@1100525015 : Integer;
                                  TotPrValueDec@1100525014 : ARRAY [10] OF Decimal;
                                  TotPrognEndR@1100525013 : Integer;
                                  BudgetDec@1100525012 : ARRAY [10] OF Decimal;
                                  ExtBudgetDec@1100525011 : ARRAY [10] OF Decimal;
                                  AdjBudgetDec@1100525010 : ARRAY [10] OF Decimal;
                                  RemainingDec@1100525009 : Decimal;
                                  TotalInvoiced@1100525008 : Decimal;
                                  VervSaldoDec@1100525007 : Decimal;
                                  PrognDateMainProj@1100525006 : Date;
                                  MaxDateSubProj@1100525005 : Date;
                                  MainProjPrognLeading@1100525004 : Boolean;
                                  TotTotPrognEndR@1100525003 : Decimal;
                                  BegrootResultaat@1100525002 : Decimal;
                                  CostContMgt@1100525001 : Codeunit 11012006;
                                  JobRec@1100525000 : Record 11072003;
                                BEGIN
                                  CLEAR(TotTotPrognEndR);
                                  FillValue(JobFinFile, FillWhiteSpaces(20, Progn."No."), TRUE, FALSE);
                                  FillValue(JobFinFile, FillWhiteSpaces(10, FORMAT(PrognKop."Prognosis Date")), FALSE, FALSE);

                                  //Ophalen gegevens
                                  GetBudgetProj(Progn."No.", BudgetDec, MainProjPrognLeading, "Prognosis Date");
                                  GetExtContrBudget(Progn."No.", ExtBudgetDec, MainProjPrognLeading, "Prognosis Date");
                                  GetAdjustments(Progn."No.", AdjBudgetDec, MainProjPrognLeading);
                                  GetBudgetByType(Progn."No.", "Prognosis Date", ValueDec, MainProjPrognLeading); // totale begroting;
                                  GetTotalCostsByType(Progn."No.", "Prognosis Date", TCValueDec);  // totale kosten
                                  GetPrognByType(Progn."No.", "Prognosis Date", PrognValueDec);    // prognose
                                  GetBestByType(Progn."No.", "Prognosis Date", BestValueDec);      // bestedingen
                                  GetPrognEndRByType(Progn."No.", "Prognosis Date", TotPrValueDec);// prognose eindresultaat

                                  //Werkbegroting project
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegroting Meerwerk
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(ExtBudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegrotings correcties
                                  FOR TotWB := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(AdjBudgetDec[TotWB])), FALSE, FALSE);
                                  END;

                                  //Werkbegroting totaal
                                  FOR TotWB := 1 TO 8 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(ValueDec[TotWB])), FALSE, FALSE);
                                  END;
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BudgetDec[9] + ExtBudgetDec[9])), FALSE, FALSE);

                                  //Totalekosten
                                  FOR TotTC := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TCValueDec[TotTC])), FALSE, FALSE);
                                  END;
                                  //Prognose
                                  FOR TotProgn := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(PrognValueDec[TotProgn])), FALSE, FALSE);
                                  END;
                                  //Bestedingen
                                  FOR TotBest := 1 TO 9 DO BEGIN
                                    FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(BestValueDec[TotBest])), FALSE, FALSE);
                                  END;
                                  //Prognose eindresultaat
                                  FOR TotPrognEndR := 1 TO 9 DO BEGIN
                                    TotTotPrognEndR += TotPrValueDec[TotPrognEndR];
                                    IF TotPrognEndR = 9 THEN
                                      FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotPrValueDec[TotPrognEndR])), FALSE, FALSE)
                                    ELSE
                                      FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotPrValueDec[TotPrognEndR])), FALSE, FALSE)
                                  END;
                                  IF COMPANYNAME <> Company.Name THEN
                                    JobRec.CHANGECOMPANY(Company.Name);
                                  JobRec.GET(Progn."No.");
                                  JobRec.SETRANGE("Period Filter", 0D, "Prognosis Date");
                                  JobRec.SETFILTER("Cumulation Filter", '..%1', "Prognosis Date");
                                  IF NOT MainProjPrognLeading THEN
                                    JobRec.SETRANGE("Project Filter", Progn."No.")
                                  ELSE BEGIN
                                    JobRec.SETRANGE("Project Filter");
                                  END;
                                  BegrootResultaat := CostContMgt.BudgetResultProject(JobRec, TRUE);
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(TotTotPrognEndR + BegrootResultaat)), FALSE, FALSE);

                                  //Open verkoopfacturen
                                  CalcPayedAndToPay(Progn."No.",'',RemainingDec,TotalInvoiced, VervSaldoDec, "Prognosis Date", MainProjPrognLeading);

                                  IF VervSaldoDec <> 0 THEN BEGIN  //aangepast op 30-09-2013 ovv JB was eerst Revenues - RemainingDec
                                    FillValue(JobFinFile, FillWhiteSpaces(5, 'Ja'), FALSE, FALSE);
                                  END ELSE
                                    FillValue(JobFinFile, FillWhiteSpaces(5, 'Nee'), FALSE, FALSE);
                                  FillValue(JobFinFile, FillWhiteSpaces(15, FORMAT(VervSaldoDec)), FALSE, TRUE);
                                END;

               DataItemLink=Project No.=FIELD(No.) }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      OnOpenPage=BEGIN

                   TryOutFileName := GetDirAndFileName(1);
                   KPAFileName := GetDirAndFileName(3);
                   TryOutSuccFileName := GetDirAndFileName(5);
                   JobFileName := GetDirAndFileName(7);
                   JobFinFileName := GetDirAndFileName(9);
                   CompFileName := GetDirAndFileName(11);
                   WipFileName := GetDirAndFileName(13);

                   trEDITABLE := (FALSE);
                   kpaEDITABLE := (FALSE);
                   jbEDITABLE := (FALSE);
                   jbfinEDITABLE := (FALSE);
                   compEDITABLE := (FALSE);
                   wipEDITABLE := (FALSE);
                   vervEDITABLE := (FALSE);
                 END;

    }
    CONTROLS
    {
      { 1100525000;;Container;
                  Name=Main;
                  ContainerType=ContentArea }

      { 1100525001;1;Group  ;
                  Name=Opties;
                  GroupType=Group }

      { 1100525002;2;Field  ;
                  Name=Exporteren;
                  SourceExpr=FileBool[1] }

      { 1100525019;2;Group  ;
                  Editable=trEDITABLE;
                  GroupType=Group }

      { 1100525003;3;Field  ;
                  Name=File trajectoffertes:;
                  SourceExpr=TryOutFileName }

      { 1100525004;2;Field  ;
                  Name=Alleen trajectoffertes vandaag gewijzigd;
                  SourceExpr=OnlyLastDayChanged }

      { 1100525005;2;Field  ;
                  Name=KPA-gegevens;
                  SourceExpr=FileBool[6] }

      { 1100525020;2;Group  ;
                  Editable=kpaEDITABLE;
                  GroupType=Group }

      { 1100525006;3;Field  ;
                  Name=File gebruikersgegevens:;
                  SourceExpr=KPAFileName }

      { 1100525007;2;Field  ;
                  Name=Exporteren1;
                  CaptionML=ENU=Exporteren;
                  SourceExpr=FileBool[2] }

      { 1100525025;2;Group  ;
                  Editable=vervEDITABLE;
                  GroupType=Group }

      { 1100525008;3;Field  ;
                  Name=File vervolgtrajecten;
                  SourceExpr=TryOutSuccFileName }

      { 1100525009;2;Field  ;
                  Name=Exporteren2;
                  CaptionML=ENU=Exporteren;
                  SourceExpr=FileBool[3] }

      { 1100525021;2;Group  ;
                  Editable=jbEDITABLE;
                  GroupType=Group }

      { 1100525010;3;Field  ;
                  Name=File projecten;
                  SourceExpr=JobFileName }

      { 1100525011;2;Field  ;
                  CaptionML=ENU=Alleen projecten vandaag gewijzigd, in trajectoffertefile en > drempelwaarde;
                  SourceExpr=OnlyJobsLastDayChanged }

      { 1100525012;2;Field  ;
                  Name=Exporteren3;
                  CaptionML=ENU=Exporteren;
                  SourceExpr=FileBool[4] }

      { 1100525022;2;Group  ;
                  Editable=jbfinEDITABLE;
                  GroupType=Group }

      { 1100525013;3;Field  ;
                  Name=File fin. geg. projecten;
                  SourceExpr=JobFinFileName }

      { 1100525023;2;Group  ;
                  Editable=compEDITABLE;
                  GroupType=Group }

      { 1100525014;3;Field  ;
                  Name=File company gegevens;
                  SourceExpr=CompFileName }

      { 1100525015;2;Field  ;
                  Name=Exporteren4;
                  CaptionML=ENU=Exporteren;
                  SourceExpr=FileBool[5] }

      { 1100525024;2;Group  ;
                  Editable=wipEDITABLE;
                  GroupType=Group }

      { 1100525016;3;Field  ;
                  Name=File WIP gegevens;
                  SourceExpr=WipFileName }

      { 1100525017;2;Field  ;
                  Name=Alle prognose gegevens exporteren;
                  SourceExpr=ExportAllPrognosis }

      { 1100525018;2;Field  ;
                  Name=Vandaag;
                  SourceExpr=TodayOrNot;
                  OnValidate=BEGIN
                               ResetFileName;
                             END;
                              }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      compEDITABLE@1100525004 : Boolean INDATASET;
      trEDITABLE@1100525000 : Boolean INDATASET;
      kpaEDITABLE@1100525001 : Boolean INDATASET;
      jbEDITABLE@1100525002 : Boolean INDATASET;
      jbfinEDITABLE@1100525006 : Boolean INDATASET;
      wipEDITABLE@1100525005 : Boolean INDATASET;
      vervEDITABLE@1100525003 : Boolean INDATASET;
      TryOutFile@1100525053 : File;
      KPAFile@1100525052 : File;
      TryOutSuccFile@1100525051 : File;
      JobFile@1100525050 : File;
      JobFinFile@1100525049 : File;
      CompFile@1100525048 : File;
      WIPFile@1100525047 : File;
      TryOutFileName@1100525046 : Text[250];
      KPAFileName@1100525045 : Text[250];
      TryOutSuccFileName@1100525044 : Text[250];
      TryOutFileDir@1100525043 : Text[250];
      KPAFileDir@1100525042 : Text[250];
      TryOutSuccFileDir@1100525041 : Text[250];
      JobFileDir@1100525040 : Text[250];
      JobFileName@1100525039 : Text[250];
      JobFinFileName@1100525038 : Text[250];
      CompFileName@1100525037 : Text[250];
      WipFileName@1100525036 : Text[250];
      FindTryOutLines@1100525035 : Boolean;
      FindKPALines@1100525034 : Boolean;
      FindTryOutSuccLines@1100525033 : Boolean;
      FindJobs@1100525032 : Boolean;
      OnlyLastDayChanged@1100525031 : Boolean;
      CharConv@1100525030 : Codeunit 11012057;
      TempTryOut@1100525029 : TEMPORARY Record 11012750;
      OnlyJobsLastDayChanged@1100525028 : Boolean;
      FindPrognJobs@1100525027 : Boolean;
      TempJobRec@1100525026 : TEMPORARY Record 11072003;
      TryOutQtFileCreated@1100525025 : Boolean;
      DrempelwaardeFilter@1100525024 : Decimal;
      DrempelwaardeFilter2@1100525023 : Decimal;
      JobFileCreated@1100525022 : Boolean;
      CreateJobFinFile@1100525021 : Boolean;
      FilterString@1100525020 : ARRAY [10] OF Text[250];
      CreateKPAFile@1100525019 : Boolean;
      CreateCompFile@1100525018 : Boolean;
      TryOutSuccFileCreated@1100525017 : Boolean;
      WIPFileCreated@1100525016 : Boolean;
      ExportAllPrognosis@1100525015 : Boolean;
      CompanyArr@1100525014 : ARRAY [10] OF Text[50];
      TempKostenplaatsen@1100525013 : TEMPORARY Record 11072003;
      gCompanyFilter@1100525012 : Text[250];
      FileBool@1100525011 : ARRAY [10] OF Boolean;
      ProjectTypeFilter@1100525010 : Text[250];
      TempTryOuts@1100525009 : TEMPORARY Record 11012750;
      TodayOrNot@1100525008 : Date;

    PROCEDURE FillWhiteSpaces@1000000007(TotLength@1000000000 : Integer;Input@1000000001 : Text[550]) : Text[550];
    BEGIN
      IF STRLEN(Input) < TotLength THEN BEGIN
        REPEAT
          Input := Input + ' ';
        UNTIL STRLEN(Input) = TotLength;
      END;
      EXIT(Input);
    END;

    PROCEDURE Seperator@1000000009() : Text[1];
    BEGIN
      EXIT(';');
    END;

    PROCEDURE FillValue@1000000012(VAR FileVar@1000000000 : File;Value@1000000001 : Text[550];FirstNode@1000000005 : Boolean;EndNode@1000000002 : Boolean);
    BEGIN
      FileVar.WRITE(STRSUBSTNO('%1%2', Value, Seperator));
      FileVar.SEEK(FileVar.POS-2);
      IF (EndNode) AND NOT (FirstNode) THEN
        FileVar.WRITE('');
    END;

    PROCEDURE CRLF@1000000060() ocrlf : Text[2];
    VAR
      cr@1000000001 : Char;
      lf@1000000000 : Char;
    BEGIN
      cr := 13;
      lf := 10;
      ocrlf[1] := cr;
      ocrlf[2] := lf;
    END;

    PROCEDURE GetDirAndFileName@1100409000(TypeInt@1100409000 : Integer) : Text[250];
    VAR
      ExtTextLines@1100409001 : Record 280;
      TempDir@1100409002 : Text[250];
    BEGIN
      //Pad FMI trajecten (regelnr. 20000..50000)
      //Pad FMI kpa (regelnr. 70000..100000)
      //Pad FMI vervolgtrajecten (regelnr. 120000..150000)
      //Pad FMI projecten (regelnr. 170000..200000)
      //Pad FMI projectgeg. (regelnr. 220000..250000)

      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-I');
      CASE TypeInt OF
        1: ExtTextLines.SETFILTER("Line No.",  '20000..30000');
        2: ExtTextLines.SETFILTER("Line No.",  '40000..50000');

        3: ExtTextLines.SETFILTER("Line No.",  '70000..80000');
        4: ExtTextLines.SETFILTER("Line No.",  '90000..100000');

        5: ExtTextLines.SETFILTER("Line No.",  '120000..130000');
        6: ExtTextLines.SETFILTER("Line No.",  '140000..150000');

        7: ExtTextLines.SETFILTER("Line No.",  '170000..180000');
        8: ExtTextLines.SETFILTER("Line No.",  '190000..200000');

        9: ExtTextLines.SETFILTER("Line No.",  '220000..230000');
        10:ExtTextLines.SETFILTER("Line No.",  '240000..250000');

        11:ExtTextLines.SETFILTER("Line No.",  '270000..280000');
        12:ExtTextLines.SETFILTER("Line No.",  '290000..300000');

        13:ExtTextLines.SETFILTER("Line No.",  '320000..330000');
        14:ExtTextLines.SETFILTER("Line No.",  '340000..350000');
      END;
      IF ExtTextLines.FINDSET THEN BEGIN
        REPEAT
          IF TempDir = '' THEN
            TempDir := ExtTextLines.Text
          ELSE
            TempDir := TempDir + ExtTextLines.Text;
        UNTIL ExtTextLines.NEXT = 0;
      END;

      IF USERID <> 'ext-pGbuijk' THEN BEGIN
        CASE TypeInt OF
          1: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_traject')));
          2: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_traject')));
          3: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_KPA')));
          4: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_KPA')));
          5: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_vervolgtraject')));
          6: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_vervolgtraject')));
          7: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projecten')));
          8: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projecten')));
          9: EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projectFinanc')));
          10:EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projectFinanc')));
          11:EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_Companies')));
          12:EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_Companies')));
          13:EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_ProjectFinancien')));
          14:EXIT(STRSUBSTNO('%1%2.csv', TempDir, STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_ProjectFinancien')));
        END;
      END ELSE BEGIN
        CASE TypeInt OF
          1: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_traject')));
          2: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMII_traject')));
          3: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_KPA')));
          4: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMII_KPA')));
          5: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_vervolgtraject')));
          6: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMII_vervolgtraject')));
          7: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projecten')));
          8: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMII_projecten')));
          9: EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_projectFinanc')));
          10:EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMII_projectFinanc')));
          11:EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_Companies')));
          12:EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_Companies')));
          13:EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_ProjectFinancien')));
          14:EXIT(STRSUBSTNO('%1%2.csv', 'H:\Projects Belgie\Export2\', STRSUBSTNO('%1_%2',TodayOrNot, 'FMI_ProjectFinancien')));
        END;
      END;
    END;

    PROCEDURE InsertTempRec@1000000001(TryOutInput@1000000000 : Record 11012750);
    BEGIN
      TempTryOut.INIT;
      TempTryOut := TryOutInput;
      IF TempTryOut.INSERT THEN;
    END;

    PROCEDURE JobNoTest@1000000006(JobNo@1000000000 : Code[20]) : Boolean;
    VAR
      TryOutSucc@1000000001 : Record 11012761;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        TryOutSucc.CHANGECOMPANY(Company.Name);
      TryOutSucc.SETRANGE("Project No.", JobNo);
      IF TryOutSucc.FINDSET THEN BEGIN
        REPEAT
          TempTryOut.RESET;
          TempTryOut.SETRANGE(Code, TryOutSucc."Try-out No.");
          IF TempTryOut.FINDFIRST THEN
            EXIT(FALSE);
        UNTIL TryOutSucc.NEXT = 0;
      END ELSE
        EXIT(TRUE);
    END;

    PROCEDURE Job500K@1000000008(JobNo@1000000000 : Code[20]) : Boolean;
    VAR
      JobRec@1000000001 : Record 11072003;
      AllProjects@1000000002 : Record 11072003;
      TempDec@1000000003 : Decimal;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN BEGIN
        JobRec.CHANGECOMPANY(Company.Name);
        AllProjects.CHANGECOMPANY(Company.Name);
      END;

      JobRec.SETRANGE("No.", JobNo);
      IF JobRec.FINDFIRST THEN;

      CASE JobRec."Single/Main/Sub Project" OF
        JobRec."Single/Main/Sub Project"::"Main Project" :
          AllProjects.SETFILTER("Main Project", JobRec."No.");
        JobRec."Single/Main/Sub Project"::"Sub Project" :
          AllProjects.SETFILTER("Main Project", JobRec."Main Project");
        ELSE
          AllProjects.SETFILTER("No.", JobRec."No.");
      END;
      IF AllProjects.FINDSET THEN BEGIN
        REPEAT
          AllProjects.SETFILTER("Project Filter", AllProjects."No.");
          AllProjects.CALCFIELDS("Extension Contract Amount", "Project Contract Amount");
          TempDec += AllProjects."Extension Contract Amount" + AllProjects."Project Contract Amount";
        UNTIL AllProjects.NEXT = 0;
      END;
      EXIT(TempDec <= DrempelwaardeFilter);
    END;

    PROCEDURE GetBudgetByType@1000000022(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal;MainProj@1000000006 : Boolean);
    VAR
      PrognosisLine@1000000002 : Record 11012035;
      JobRec@1000000004 : Record 11072003;
      CoInt@1000000005 : Integer;
      BudgetLine@1000000007 : Record 11012001;
      Type@1100409000 : Integer;
      Filter@1000000008 : Text[250];
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        BudgetLine.CHANGECOMPANY(Company.Name);
      IF MainProj THEN
        BudgetLine.SETRANGE("Main Project No.", JobNo)
      ELSE
        BudgetLine.SETRANGE("Project No.", JobNo);
      BudgetLine.SETFILTER("Version Date", '..%1', PrognDate);
      Filter := STRSUBSTNO('%1|(>=%2&<%3)',
        FORMAT(BudgetLine."Extension Contract Status"::"Not Applicable"),
        FORMAT(BudgetLine."Extension Contract Status"::Order),
        FORMAT(BudgetLine."Extension Contract Status"::Expired));
      BudgetLine.SETFILTER("Extension Contract Status", Filter);
      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          BudgetLine.SETRANGE("Cost Object");
          CASE Type OF
            1: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Material);
            2: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Plant);
            3: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            4: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            5: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            6: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            7: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          BudgetLine.SETRANGE("Cost Type");
          BudgetLine.SETFILTER(BudgetLine."Cost Object", FilterString[Type]);
        END;
        IF BudgetLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] += BudgetLine.Amount;
          UNTIL BudgetLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetTotalCostsByTypeOld@1000000046(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      PrognosisLine@1000000002 : Record 11012035;
      CoInt@1000000004 : Integer;
      Type@1100409000 : Integer;
      JobRec@1000000005 : Record 11072003;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        PrognosisLine.CHANGECOMPANY(Company.Name);
      PrognosisLine.SETRANGE("Project No.", JobNo);
      PrognosisLine.SETRANGE("Prognosis Date", PrognDate);
      PrognosisLine.SETRANGE("Fix Prognosis Line", TRUE);
      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          PrognosisLine.SETRANGE("Cost Object");
          CASE Type OF
            1: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Material);
            2: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Plant);
            3: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            4: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            5: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            6: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            7: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          PrognosisLine.SETRANGE("Cost Type");
          PrognosisLine.SETFILTER("Cost Object", FilterString[Type]);
        END;
        IF PrognosisLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] += PrognosisLine."Total Cost"
          UNTIL PrognosisLine.NEXT = 0;
        END;
      END;

      IF COMPANYNAME <> Company.Name THEN
        JobRec.CHANGECOMPANY(Company.Name);
      JobRec.GET(JobNo);
      JobRec.SETFILTER("Project Filter", JobRec."No.");
      JobRec.SETFILTER("Cumulation Filter", '..%1', PrognDate);
      JobRec.CALCFIELDS(Revenues);
      Values[9] := JobRec.Revenues;
    END;

    PROCEDURE GetTotalCostsByType@1000000019(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      JobLedgerEntry@1000000002 : Record 11072005;
      CoInt@1000000004 : Integer;
      Type@1100409000 : Integer;
      ControlCostObj@1000000005 : Record 11012047;
      JobRec@1000000006 : Record 11072003;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        ControlCostObj.CHANGECOMPANY(Company.Name);
      ControlCostObj.SETRANGE("Project No.", JobNo);
      ControlCostObj.SETFILTER("Project Filter", JobNo);
      ControlCostObj.SETFILTER("Cumulation Filter", '..%1', PrognDate);
      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          ControlCostObj.SETRANGE("Cost Object");
          CASE Type OF
            1: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Material);
            2: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Plant);
            3: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Labor);
            4: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Subcontracting);
            5: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Labor);
            6: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Subcontracting);
            7: ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
            //9: //ControlCostObj.SETRANGE("Cost Type", ControlCostObj."Cost Type"::Revenues);
          END;
        END ELSE BEGIN
          ControlCostObj.SETRANGE("Cost Type");
          ControlCostObj.SETFILTER("Cost Object", FilterString[Type]);
        END;
        IF ControlCostObj.FINDSET THEN BEGIN
          REPEAT
            ControlCostObj.CALCFIELDS("Actual Costs", "Open (Purchase)", "Open Ovh. Surch. Soft (Purch.)", "Received/Not Invoiced",
                            "Open Ovh. Surch. Firm (Purch.)", "Open Ovh. Surch. (Hours)", "Open Amount (Hours)");
            Values[Type] += ControlCostObj."Actual Costs" + ControlCostObj."Open (Purchase)" +
                            ControlCostObj."Open Ovh. Surch. Soft (Purch.)" + ControlCostObj."Received/Not Invoiced" +
                            ControlCostObj."Open Ovh. Surch. Firm (Purch.)" + ControlCostObj."Open Ovh. Surch. (Hours)" +
                            ControlCostObj."Open Amount (Hours)";
          UNTIL ControlCostObj.NEXT = 0;
        END;
      END;

      IF COMPANYNAME <> Company.Name THEN
        JobRec.CHANGECOMPANY(Company.Name);
      JobRec.GET(JobNo);
      JobRec.SETFILTER("Project Filter", JobRec."No.");
      JobRec.SETFILTER("Cumulation Filter", '..%1', PrognDate);
      JobRec.CALCFIELDS(Revenues);
      Values[9] := JobRec.Revenues;
    END;

    PROCEDURE GetPrognByType@1000000054(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      PrognosisLine@1000000002 : Record 11012035;
      CoInt@1000000004 : Integer;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        PrognosisLine.CHANGECOMPANY(Company.Name);
      PrognosisLine.SETRANGE("Project No.", JobNo);
      PrognosisLine.SETRANGE("Prognosis Date", PrognDate);
      PrognosisLine.SETRANGE("Fix Prognosis Line", TRUE);
      FOR Type := 1 TO 9 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          PrognosisLine.SETRANGE("Cost Object");
          CASE Type OF
            1: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Material);
            2: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Plant);
            3: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            4: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            5: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            6: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            7: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
            9: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Revenue);
          END;
        END ELSE BEGIN
          PrognosisLine.SETRANGE("Cost Type");
          PrognosisLine.SETFILTER("Cost Object", FilterString[Type]);
        END;
        IF PrognosisLine.FINDSET THEN BEGIN
          REPEAT
            IF Type <> 9 THEN
              Values[Type] += PrognosisLine."Amount incl. Surcharge"//PrognosisLine.Amount
            ELSE BEGIN
              //PrognosisLine.CALCFIELDS("Prognosis Revenue");
              Values[Type] += PrognosisLine."Amount Revenue"
              //PrognosisLine."Prognosis Revenue";
            END;
          UNTIL PrognosisLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetBestByTypeOld@1000000071(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      PrognosisLine@1000000002 : Record 11012035;
      CoInt@1000000004 : Integer;
      PrognosisRec@1000000005 : Record 11012034;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        PrognosisLine.CHANGECOMPANY(Company.Name);
      PrognosisLine.SETRANGE("Project No.", JobNo);
      PrognosisLine.SETRANGE("Prognosis Date", PrognDate);
      PrognosisLine.SETRANGE("Fix Prognosis Line", TRUE);
      FOR Type := 1 TO 9 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          PrognosisLine.SETRANGE("Cost Object");
          CASE Type OF
            1: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Material);
            2: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Plant);
            3: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            4: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            5: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            6: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            7: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          PrognosisLine.SETRANGE("Cost Type");
          PrognosisLine.SETFILTER("Cost Object", FilterString[Type]);
        END;
        IF PrognosisLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] +=  PrognosisLine."Actual Costs";
          UNTIL PrognosisLine.NEXT = 0;
        END;
      END;

      //Bypass for revenues
      IF Type = 9 THEN BEGIN
        IF COMPANYNAME <> Company.Name THEN
          PrognosisRec.CHANGECOMPANY(Company.Name);
        IF PrognosisRec.GET(JobNo, PrognDate) THEN BEGIN
          Values[9] := PrognosisRec."Project Invoiced";
        END;
      END;
    END;

    PROCEDURE GetBestByType@1000000010(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      JobLedgerEntry@1000000002 : Record 11072005;
      CoInt@1000000004 : Integer;
      PrognosisRec@1000000005 : Record 11012034;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);

      IF COMPANYNAME <> Company.Name THEN
        JobLedgerEntry.CHANGECOMPANY(Company.Name);
      JobLedgerEntry.SETCURRENTKEY("Job No.","Cost Type","Global Dimension 2 Code","Entry Type","Posting Date");
      JobLedgerEntry.SETRANGE("Job No.", JobNo);
      JobLedgerEntry.SETFILTER("Posting Date", '..%1', PrognDate);
      //JobLedgerEntry.SETRANGE("Fix Prognosis Line", TRUE);
      FOR Type := 1 TO 9 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          JobLedgerEntry.SETRANGE(JobLedgerEntry."Global Dimension 2 Code");
          CASE Type OF
            1: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Material);
            2: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Plant);
            3: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Labor);
            4: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Subcontracting);
            5: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Labor);
            6: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Subcontracting);
            7: JobLedgerEntry.SETRANGE("Cost Type", JobLedgerEntry."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          JobLedgerEntry.SETRANGE("Cost Type");
          JobLedgerEntry.SETFILTER("Global Dimension 2 Code", FilterString[Type]);
        END;
        IF JobLedgerEntry.FINDSET THEN BEGIN
          REPEAT
            Values[Type] +=  JobLedgerEntry."Total Cost (LCY)";
          UNTIL JobLedgerEntry.NEXT = 0;
        END;
      END;

      //Bypass for revenues
      IF Type = 9 THEN BEGIN
        IF COMPANYNAME <> Company.Name THEN
          PrognosisRec.CHANGECOMPANY(Company.Name);
        IF PrognosisRec.GET(JobNo, PrognDate) THEN BEGIN
          Values[9] := PrognosisRec."Project Invoiced";
        END;
      END;
    END;

    PROCEDURE GetPrognEndRByType@1000000072(JobNo@1000000000 : Code[20];PrognDate@1000000001 : Date;VAR Values@1000000003 : ARRAY [10] OF Decimal);
    VAR
      PrognosisLine@1000000002 : Record 11012035;
      CoInt@1000000004 : Integer;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      IF COMPANYNAME <> Company.Name THEN
        PrognosisLine.CHANGECOMPANY(Company.Name);
      PrognosisLine.SETRANGE("Project No.", JobNo);
      PrognosisLine.SETRANGE("Prognosis Date", PrognDate);
      PrognosisLine.SETRANGE("Fix Prognosis Line", TRUE);
      FOR Type := 1 TO 9 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          PrognosisLine.SETRANGE("Cost Object");
          CASE Type OF
            1: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Material);
            2: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Plant);
            3: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            4: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            5: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Labor);
            6: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Subcontracting);
            7: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
            9: PrognosisLine.SETRANGE("Cost Type", PrognosisLine."Cost Type"::Revenue);
          END;
        END ELSE BEGIN
          PrognosisLine.SETRANGE("Cost Type");
          PrognosisLine.SETFILTER("Cost Object", FilterString[Type]);
        END;
        IF PrognosisLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] +=  PrognosisLine."Prognosis End Result";
          UNTIL PrognosisLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetBudgetProj@1000000013(JobNo@1000000002 : Code[20];VAR Values@1000000000 : ARRAY [10] OF Decimal;MainProj@1000000004 : Boolean;PrognDate@1000000006 : Date);
    VAR
      BudgetLine@1000000001 : Record 11012001;
      CoInt@1000000003 : Integer;
      JobRec@1000000005 : Record 11072003;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);

      IF COMPANYNAME <> Company.Name THEN
        JobRec.CHANGECOMPANY(Company.Name);
      JobRec.GET(JobNo);
      IF MainProj THEN
        JobRec.SETRANGE("Project Filter")
      ELSE
        JobRec.SETFILTER("Project Filter", JobRec."No.");

      JobRec.SETFILTER("Cumulation Filter", '..%1', PrognDate);
      JobRec.CALCFIELDS("Project Contract Amount");
      Values[9] := JobRec."Project Contract Amount";

      IF COMPANYNAME <> Company.Name THEN
        BudgetLine.CHANGECOMPANY(Company.Name);

      IF MainProj THEN
        BudgetLine.SETRANGE("Main Project No.", JobNo)
      ELSE
        BudgetLine.SETRANGE("Project No.", JobNo);
      BudgetLine.SETFILTER(Adjustment, '%1', '');
      BudgetLine.SETFILTER("Extension Contract", '%1', '');
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues

      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          BudgetLine.SETRANGE("Cost Object");
          CASE Type OF
            1: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Material);
            2: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Plant);
            3: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            4: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            5: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            6: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            7: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          BudgetLine.SETRANGE("Cost Type");
          BudgetLine.SETFILTER(BudgetLine."Cost Object", FilterString[Type]);
        END;
        IF BudgetLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] += BudgetLine.Amount;
          UNTIL BudgetLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetExtContrBudget@1000000014(JobNo@1000000002 : Code[20];VAR Values@1000000000 : ARRAY [10] OF Decimal;MainProj@1000000004 : Boolean;PrognDate@1000000006 : Date);
    VAR
      BudgetLine@1000000003 : Record 11012001;
      CoInt@1000000001 : Integer;
      JobRec@1000000005 : Record 11072003;
      Type@1100409000 : Integer;
      Filter@1000000007 : Text[250];
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);

      IF COMPANYNAME <> Company.Name THEN
        JobRec.CHANGECOMPANY(Company.Name);
      JobRec.GET(JobNo);
      IF MainProj THEN
        JobRec.SETRANGE("Project Filter")
      ELSE
        JobRec.SETFILTER("Project Filter", JobRec."No.");

      JobRec.SETFILTER("Cumulation Filter", '..%1', PrognDate);
      JobRec.CALCFIELDS("Extension Contract Amount");
      Values[9] := JobRec."Extension Contract Amount";

      IF COMPANYNAME <> Company.Name THEN
        BudgetLine.CHANGECOMPANY(Company.Name);
      IF MainProj THEN
        BudgetLine.SETRANGE("Main Project No.", JobNo)
      ELSE
        BudgetLine.SETRANGE("Project No.", JobNo);
      BudgetLine.SETFILTER(Adjustment, '%1', '');
      BudgetLine.SETFILTER("Extension Contract", '<>%1', '');    //NVT|(>=Opdracht&<Vervallen)
      Filter := STRSUBSTNO('%1|(>=%2&<%3)',
        FORMAT(BudgetLine."Extension Contract Status"::"Not Applicable"),
        FORMAT(BudgetLine."Extension Contract Status"::Order),
        FORMAT(BudgetLine."Extension Contract Status"::Expired));
      BudgetLine.SETFILTER("Extension Contract Status", Filter);
      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          BudgetLine.SETRANGE("Cost Object");
          CASE Type OF
            1: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Material);
            2: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Plant);
            3: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            4: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            5: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            6: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            7: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          BudgetLine.SETRANGE("Cost Type");
          BudgetLine.SETFILTER(BudgetLine."Cost Object", FilterString[Type]);
        END;
        IF BudgetLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] += BudgetLine.Amount;
          UNTIL BudgetLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE GetAdjustments@1000000015(JobNo@1000000002 : Code[20];VAR Values@1000000000 : ARRAY [10] OF Decimal;MainProj@1000000004 : Boolean);
    VAR
      BudgetLine@1000000003 : Record 11012001;
      CoInt@1000000001 : Integer;
      Type@1100409000 : Integer;
    BEGIN
      //1:Mat 2:Plant 3:Dir.Arb. 4:Subc 5: Engineering 6: O.A.Engineering 7: Sundry 8: Dekking 9: Revenues
      CLEAR(Values);
      //Values[9] += BudgetLine.Amount;
      IF COMPANYNAME <> Company.Name THEN
        BudgetLine.CHANGECOMPANY(Company.Name);
      IF MainProj THEN
        BudgetLine.SETRANGE("Main Project No.", JobNo)
      ELSE
        BudgetLine.SETRANGE("Project No.", JobNo);
      BudgetLine.SETFILTER(Adjustment, '<>%1', '');

      FOR Type := 1 TO 8 DO BEGIN
        IF FilterString[Type] = STRSUBSTNO('C%1', Type) THEN BEGIN
          BudgetLine.SETRANGE("Cost Object");
          CASE Type OF
            1: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Material);
            2: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Plant);
            3: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            4: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            5: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Labor);
            6: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Subcontracting);
            7: BudgetLine.SETRANGE("Cost Type", BudgetLine."Cost Type"::Sundry);
            8: ERROR('Niet mogelijk om dekking te definieren als kostensoort');
          END;
        END ELSE BEGIN
          BudgetLine.SETRANGE("Cost Type");
          BudgetLine.SETFILTER(BudgetLine."Cost Object", FilterString[Type]);
        END;
        IF BudgetLine.FINDSET THEN BEGIN
          REPEAT
            Values[Type] += BudgetLine.Amount;
          UNTIL BudgetLine.NEXT = 0;
        END;
      END;
    END;

    PROCEDURE CalcPayedAndToPay@1000000064(JobNo@1000000003 : Code[20];ExtContr@1000000012 : Code[20];VAR RemainingAmnt@1000000007 : Decimal;VAR TotalFact@1000000008 : Decimal;VAR DueAmnt@1210190000 : Decimal;PrognDate@1000000011 : Date;MainJob@1000000014 : Boolean);
    VAR
      jobledgentry@1000000000 : Record 11072005;
      custledgentry@1000000001 : Record 21;
      SalesInvoiceHeader@1000000002 : Record 112;
      SalesCrMemoHeader@1000000006 : Record 114;
      TempInvoiceNo@1000000004 : Code[20];
      Perc@1000000005 : Decimal;
      PostCounter@1000000009 : Integer;
      DaysOfDue@1000000010 : Integer;
      PeilDatum@1000000013 : Date;
    BEGIN
      PeilDatum := PrognDate;
      jobledgentry.SETCURRENTKEY("Document No.","Posting Date");
      IF COMPANYNAME <> Company.Name THEN
        jobledgentry.CHANGECOMPANY(Company.Name);
      IF MainJob THEN
        jobledgentry.SETRANGE("Main Project No.", JobNo)
      ELSE
        jobledgentry.SETRANGE("Job No.",JobNo);
      IF ExtContr <> '' THEN
        jobledgentry.SETRANGE("Extension Contract",ExtContr);
      jobledgentry.SETFILTER("Posting Date", '..%1', PrognDate);
      jobledgentry.SETRANGE("Entry Type",jobledgentry."Entry Type"::Sale);
      IF jobledgentry.FINDSET THEN BEGIN
        REPEAT
          IF jobledgentry."Document No." <> TempInvoiceNo THEN BEGIN
            IF COMPANYNAME <> Company.Name THEN
              custledgentry.CHANGECOMPANY(Company.Name);
            custledgentry.SETRANGE("Document No.",jobledgentry."Document No.");
            custledgentry.SETRANGE("Customer No.",jobledgentry.Principal);
            IF custledgentry.FINDFIRST THEN BEGIN
              Perc := 0;
              //Verkoopfactuur
              IF COMPANYNAME <> Company.Name THEN
                SalesInvoiceHeader.CHANGECOMPANY(Company.Name);
              IF SalesInvoiceHeader.GET(jobledgentry."Document No.") THEN BEGIN
                SalesInvoiceHeader.CALCFIELDS("Amount VAT",Amount);
                Perc := 0;
                IF (SalesInvoiceHeader."Amount VAT" <> 0) THEN
                  Perc := ROUND(100 / (SalesInvoiceHeader.Amount / SalesInvoiceHeader."Amount VAT"),1);
                TotalFact := TotalFact + SalesInvoiceHeader.Amount;
              END;
              //Creditnota's
              IF COMPANYNAME <> Company.Name THEN
                SalesCrMemoHeader.CHANGECOMPANY(Company.Name);
              IF SalesCrMemoHeader.GET(jobledgentry."Document No.") THEN BEGIN
                SalesCrMemoHeader.CALCFIELDS("Amount VAT",Amount);
                Perc := 0;
                IF (SalesCrMemoHeader."Amount VAT" <> 0) THEN
                  Perc := 100 / (SalesCrMemoHeader.Amount / SalesCrMemoHeader."Amount VAT");
                  TotalFact := TotalFact + SalesCrMemoHeader.Amount;
              END;

              custledgentry.CALCFIELDS("Original Amt. (LCY)","Remaining Amt. (LCY)");
              IF Perc <> 0 THEN BEGIN
                RemainingAmnt := RemainingAmnt + ((custledgentry."Remaining Amt. (LCY)") / ((Perc/100) + 1));
                PostCounter := PostCounter + 1;
                IF custledgentry."Due Date" < PeilDatum THEN BEGIN
                  DaysOfDue := DaysOfDue + (PeilDatum - custledgentry."Due Date");
                  DueAmnt := DueAmnt + ((custledgentry."Remaining Amt. (LCY)") / ((Perc/100) + 1));
                END;
              END ELSE BEGIN
                RemainingAmnt := RemainingAmnt + ((custledgentry."Remaining Amt. (LCY)"));
                PostCounter := PostCounter + 1;
                IF custledgentry."Due Date" < PeilDatum THEN BEGIN
                  DaysOfDue := DaysOfDue + (PeilDatum - custledgentry."Due Date");
                  DueAmnt := DueAmnt + custledgentry."Remaining Amt. (LCY)";
                END;
              END;
            END;
          END;
          TempInvoiceNo := jobledgentry."Document No.";
        UNTIL jobledgentry.NEXT = 0;
      END;
    END;

    PROCEDURE GetLastPrognDate@1000000004(JobNo@1000000000 : Code[20]) : Date;
    VAR
      PrognosisRec@1000000001 : Record 11012034;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        PrognosisRec.CHANGECOMPANY(Company.Name);
      PrognosisRec.SETRANGE("Project No.", JobNo);
      PrognosisRec.SETRANGE("Fix Prognosis Line", TRUE);
      IF PrognosisRec.FINDLAST THEN
        EXIT(PrognosisRec."Prognosis Date")
      ELSE
        EXIT(0D);
    END;

    PROCEDURE GetLastDatePrognSubProj@1000000017(MainJobNo@1000000000 : Code[20]) TempDate : Date;
    VAR
      JobRec@1000000001 : Record 11072003;
      PrognRec@1000000002 : Record 11012034;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        JobRec.CHANGECOMPANY(Company.Name);
      JobRec.SETRANGE("Main Project", MainJobNo);
      JobRec.SETRANGE("Single/Main/Sub Project", JobRec."Single/Main/Sub Project"::"Sub Project");
      IF JobRec.FINDSET THEN BEGIN
        REPEAT
          IF COMPANYNAME <> Company.Name THEN
            PrognRec.CHANGECOMPANY(Company.Name);
          PrognRec.SETRANGE("Project No.", JobRec."No.");
          PrognRec.SETRANGE("Fix Prognosis Line", TRUE);
          IF PrognRec.FINDLAST THEN
            IF PrognRec."Prognosis Date" > TempDate THEN
              TempDate := PrognRec."Prognosis Date";
        UNTIL JobRec.NEXT = 0;
      END ELSE
        EXIT(0D);
    END;

    PROCEDURE InsertTempJobs@1000000002(JobNo@1000000000 : Code[20]);
    VAR
      Projecten@1000000001 : Record 11072003;
      Deelprojecten@1000000002 : Record 11072003;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        Projecten.CHANGECOMPANY(Company.Name);
      Projecten.GET(JobNo);
      IF (Projecten."Single/Main/Sub Project" = Projecten."Single/Main/Sub Project"::"Main Project") THEN
        Deelprojecten.SETRANGE("Main Project", Projecten."No.")
      ELSE
        Deelprojecten.SETRANGE("Main Project", Projecten."Main Project");
      IF Deelprojecten.FINDSET THEN BEGIN
        REPEAT
          IF NOT TempJobRec.GET(Deelprojecten."No.") THEN BEGIN
            TempJobRec.INIT;
            TempJobRec."No." := Deelprojecten."No.";
            TempJobRec.INSERT;
          END;
        UNTIL Deelprojecten.NEXT = 0;
      END;
    END;

    PROCEDURE GetFilter@1100409038(VAR ExitDec@1000000002 : Decimal;VAR ExitDec2@1000000000 : Decimal);
    VAR
      ExtTextLines@1100409001 : Record 280;
      i@1000000001 : Integer;
    BEGIN
      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-II');
      IF ExtTextLines.FINDSET THEN BEGIN
        REPEAT
          i += 1;
          CASE i OF
            1: EVALUATE(ExitDec, ExtTextLines.Text);
            2: EVALUATE(ExitDec2, ExtTextLines.Text);
          END;
        UNTIL ExtTextLines.NEXT = 0;
      END;
    END;

    PROCEDURE GetFilterForCostObjects@1100409023();
    VAR
      ExtTextLines@1100409000 : Record 280;
      i@1100409001 : Integer;
      First@1100409002 : Integer;
      Last@1100409003 : Integer;
      Line@1000000000 : Integer;
    BEGIN
      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-III');
      IF ExtTextLines.FINDSET THEN  BEGIN
        i += 1;
        REPEAT
          Line += 1;
          IF Line = 4 THEN BEGIN
            Line := 1;
            i += 1;
          END;
          IF STRPOS(ExtTextLines.Text, '[costtype]') <> 0 THEN
            FilterString[i] += STRSUBSTNO('C%1', i);
          IF STRPOS(ExtTextLines.Text, ']%') <> 0 THEN BEGIN
            First := STRPOS(ExtTextLines.Text, '%[');
            Last :=  STRPOS(ExtTextLines.Text, ']%');
            FilterString[i] += COPYSTR(ExtTextLines.Text, First + 2, Last - (First + 4));
          END;
        UNTIL (ExtTextLines.NEXT = 0) OR (i = 9);
      END;
    END;

    PROCEDURE GetFilterForCompanyStructure@1000000011();
    VAR
      ExtTextLines@1000000004 : Record 280;
      i@1000000003 : Integer;
      First@1000000002 : Integer;
      Last@1000000001 : Integer;
      Line@1000000000 : Integer;
      TempString@1000000005 : Text[250];
      DimensionValue@1000000006 : Record 349;
    BEGIN
      TempKostenplaatsen.RESET;
      TempKostenplaatsen.DELETEALL;

      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-V');
      IF ExtTextLines.FINDSET THEN  BEGIN
        i += 1;
        REPEAT
          Line += 1;
          IF Line = 5 THEN BEGIN
            TempString := '';
            Line := 1;
            i += 1;
          END;
          IF (STRPOS(ExtTextLines.Text, '[') <> 0) AND (STRPOS(ExtTextLines.Text, ']') <> 0) THEN BEGIN
            First := STRPOS(ExtTextLines.Text, '[');    //[12345]     first = 1, last = 7
            Last :=  STRPOS(ExtTextLines.Text, ']');
            CompanyArr[i] := COPYSTR(ExtTextLines.Text, First + 1, Last - (First + 1));
          END ELSE
            IF ExtTextLines.Text <> '' THEN
              TempString := TempString + ExtTextLines.Text;
          IF Line = 4 THEN BEGIN
            DimensionValue.RESET;
            DimensionValue.SETRANGE("Global Dimension No.", 1);
            DimensionValue.SETFILTER(Code, TempString);
            IF DimensionValue.FINDSET THEN BEGIN
              REPEAT
                TempKostenplaatsen.INIT;
                TempKostenplaatsen."No." := DimensionValue.Code;
                TempKostenplaatsen.Description := CompanyArr[i];
                TempKostenplaatsen."Description 2" := STRSUBSTNO('%1', i);
                TempKostenplaatsen.INSERT;
              UNTIL DimensionValue.NEXT = 0;
            END;
          END;
        UNTIL (ExtTextLines.NEXT = 0) OR (i = 7);
      END;
    END;

    PROCEDURE DefineCompany@1000000023(KPL@1000000000 : Code[20]) : Text[50];
    BEGIN
      TempKostenplaatsen.RESET;
      TempKostenplaatsen.SETRANGE("No.", KPL);
      IF TempKostenplaatsen.FINDFIRST THEN
        EXIT(TempKostenplaatsen.Description)
      ELSE
        EXIT('*');
    END;

    PROCEDURE UserIDExist@1000000003(EmplNo@1000000000 : Code[20]) : Boolean;
    VAR
      UserSetup@1000000001 : Record 91;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        UserSetup.CHANGECOMPANY(Company.Name);
      UserSetup.SETRANGE("Employee No.", EmplNo);
      EXIT(UserSetup.FINDFIRST);
    END;

    PROCEDURE GetFilterForNAVCompany@1000000036();
    VAR
      ExtTextLines@1000000004 : Record 280;
      i@1000000003 : Integer;
      First@1000000002 : Integer;
      Last@1000000001 : Integer;
      Line@1000000000 : Integer;
      TempString@1000000005 : Text[250];
      DimensionValue@1000000006 : Record 349;
    BEGIN
      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-IV');
      IF ExtTextLines.FINDSET THEN BEGIN
        REPEAT
          IF gCompanyFilter = '' THEN
            gCompanyFilter := ExtTextLines.Text
          ELSE
            gCompanyFilter := gCompanyFilter + '|' + ExtTextLines.Text;
        UNTIL (ExtTextLines.NEXT = 0);
      END;
    END;

    PROCEDURE IsHoofdTraject@1000000053(TryOutNo@1000000000 : Code[20]) : Boolean;
    VAR
      Traject@1000000001 : Record 11012750;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        Traject.CHANGECOMPANY(Company.Name);
      Traject.SETRANGE(Code, TryOutNo);
      IF Traject.FINDFIRST THEN
        EXIT(Traject."Single/Main/Sub Tryout" = Traject."Single/Main/Sub Tryout"::Main);
    END;

    PROCEDURE GetRealMainTryOut@1000000062(TryOutNo@1000000000 : Code[20]) : Code[20];
    VAR
      Traject@1000000001 : Record 11012750;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        Traject.CHANGECOMPANY(Company.Name);
      Traject.SETRANGE(Code, TryOutNo);
      IF Traject.FINDFIRST THEN
        EXIT(Traject."Main Try-out");
    END;

    PROCEDURE GetFilterForFileConfig@1000000000();
    VAR
      ExtTextLines@1000000004 : Record 280;
      i@1000000003 : Integer;
      First@1000000002 : Integer;
      Last@1000000001 : Integer;
      Line@1000000000 : Integer;
      TempString@1000000005 : Text[250];
      DimensionValue@1000000006 : Record 349;
    BEGIN
      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-VI');
      IF ExtTextLines.FINDSET THEN BEGIN
        REPEAT
          i += 1;
          IF i < 7 THEN BEGIN
            IF STRPOS(ExtTextLines.Text, STRSUBSTNO('%1:', i)) <> 0 THEN
              FileBool[i] := STRPOS(ExtTextLines.Text, '[Ja]') <> 0;
          END;
          IF i = 7 THEN BEGIN
            IF STRPOS(ExtTextLines.Text, STRSUBSTNO('%1:', i)) <> 0 THEN
              IF STRPOS(ExtTextLines.Text, '[Vandaag]') <> 0 THEN BEGIN
                TodayOrNot := TODAY
              END ELSE BEGIN
                IF (STRPOS(ExtTextLines.Text, '[') <> 0) AND (STRPOS(ExtTextLines.Text, ']') <> 0) THEN BEGIN
                  First := STRPOS(ExtTextLines.Text, '[');    //[12345]     first = 1, last = 7
                  Last :=  STRPOS(ExtTextLines.Text, ']');
                  EVALUATE(TodayOrNot, COPYSTR(ExtTextLines.Text, First + 1, Last - (First + 1)));
                END;
              END;
          END;
        UNTIL (ExtTextLines.NEXT = 0) OR (i = 8);
      END;
    END;

    PROCEDURE GetFilterForProjectType@1000000016();
    VAR
      ExtTextLines@1000000004 : Record 280;
      i@1000000003 : Integer;
      First@1000000002 : Integer;
      Last@1000000001 : Integer;
      Line@1000000000 : Integer;
      TempString@1000000005 : Text[250];
      DimensionValue@1000000006 : Record 349;
    BEGIN
      ProjectTypeFilter := '';
      ExtTextLines.SETRANGE("Table Name", ExtTextLines."Table Name"::"Standard Text");
      ExtTextLines.SETRANGE("No.",'PROMIS-VII');
      IF ExtTextLines.FINDSET THEN BEGIN
        REPEAT
          ProjectTypeFilter := ProjectTypeFilter + ExtTextLines.Text;
        UNTIL (ExtTextLines.NEXT = 0) OR (i = 7);
      END;
    END;

    PROCEDURE FillTempTryOut@1000000018(TryOutNo@1000000000 : Code[20]);
    VAR
      TryOutRec@1000000001 : Record 11012750;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        TryOutRec.CHANGECOMPANY(Company.Name);
      IF TryOutRec.GET(TryOutNo) THEN BEGIN
        IF DefineCompany(TryOutRec."Global Dimension 1 Code") = '*' THEN
          EXIT;
        TempTryOut.INIT;
        TempTryOut := TryOutRec;
        IF TempTryOut.INSERT THEN;
      END;
    END;

    PROCEDURE ExportTryOutToFile@1000000028(VAR TryOutRec@1000000000 : TEMPORARY Record 11012750);
    VAR
      SalesPerson@1000000006 : Record 13;
      TryOutLine@1000000005 : Record 11012755;
      TryOutSucc@1000000004 : Record 11012761;
      TempText@1000000003 : Text[500];
      Tr@1000000002 : Record 11012750;
      TRF@1000000001 : Record 11012758;
    BEGIN
      FillValue(TryOutFile, FillWhiteSpaces(20,TryOutRec.Code), TRUE, FALSE);
      TryOutRec.Description := DELCHR(TryOutRec.Description, '=', ';');
      FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(TryOutRec.Description)), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TryOutRec."Order Amount (LCY)")), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT(TryOutRec."Creation Date")), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT( '')), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT(TryOutRec."Expected Starting Date")), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(10,FORMAT(TryOutRec."Expected End Date")), FALSE, FALSE);

      IF COMPANYNAME <> Company.Name THEN
        TRF.CHANGECOMPANY(Company.Name);
      TRF.SETRANGE("Try-out No.", TryOutRec.Code);
      TRF.SETRANGE(Leading, TRUE);
      TRF.SETFILTER("Offered Amount (LCY)", '>%1', DrempelwaardeFilter2);
      IF OnlyLastDayChanged THEN
        TRF.SETRANGE("Change Date", TodayOrNot);
      IF TRF.FINDFIRST THEN BEGIN
        IF DefineCompany(TRF."Global Dimension 1 Code") = '*' THEN
          FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TryOutRec.Status)), FALSE, FALSE)
        ELSE
          FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TRF.Status)), FALSE, FALSE);
      END ELSE
        FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TryOutRec.Status)), FALSE, FALSE);
      //16012015.GB.en

      IF COMPANYNAME <> Company.Name THEN
        TryOutLine.CHANGECOMPANY(Company.Name);
      TryOutLine.SETRANGE("Try-out No.", TryOutRec.Code);
      TryOutLine.SETRANGE("Contact Type", 'EG');
      IF TryOutLine.FINDFIRST THEN BEGIN
        TryOutLine.CALCFIELDS("Contact Name");
        FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(TryOutLine."Contact Name")), FALSE, FALSE)
      END ELSE
        FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT('')), FALSE, FALSE);

      IF COMPANYNAME <> Company.Name THEN
        TryOutLine.CHANGECOMPANY(Company.Name);
      TryOutLine.SETRANGE("Try-out No.", TryOutRec.Code);
      TryOutLine.SETRANGE("Contact Type", 'OG');
      IF TryOutLine.FINDSET THEN BEGIN
        REPEAT
          TryOutLine.CALCFIELDS("Contact Name");
          IF TempText = '' THEN
            TempText := TryOutLine."Contact Name"
          ELSE BEGIN
            IF (STRLEN(TempText) + STRLEN(TryOutLine."Contact Name") + 2) <= 500 THEN
            TempText := TempText + '|' + TryOutLine."Contact Name";
          END;
        UNTIL TryOutLine.NEXT = 0;
      END;
      FillValue(TryOutFile, FillWhiteSpaces(500, FORMAT(TempText)), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TryOutRec."Global Dimension 1 Code")), FALSE, FALSE);
      CASE TryOutRec."Single/Main/Sub Tryout" OF
        TryOutRec."Single/Main/Sub Tryout"::Single:
          FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
        TryOutRec."Single/Main/Sub Tryout"::Main:
          FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
        TryOutRec."Single/Main/Sub Tryout"::"Sub Try-out":
          FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('Hoofdtraject')), FALSE, FALSE);
      END;

      IF IsHoofdTraject(TryOutRec.Code) THEN
        FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('')), FALSE, FALSE)
      ELSE
        FillValue(TryOutFile, FillWhiteSpaces(20, FORMAT('')), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces(20,FORMAT(TryOutRec."Salesperson Code")), FALSE, FALSE);

      IF COMPANYNAME <> Company.Name THEN
        SalesPerson.CHANGECOMPANY(Company.Name);
      SalesPerson.SETRANGE(Code,TryOutRec."Salesperson Code");
      IF SalesPerson.FINDFIRST THEN
        FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(SalesPerson.Name)), FALSE, FALSE)
      ELSE
        FillValue(TryOutFile, FillWhiteSpaces(50,FORMAT(TryOutRec."Salesperson Code")), FALSE, FALSE);
      FillValue(TryOutFile, FillWhiteSpaces( 20, FORMAT(DefineCompany(TryOutRec."Global Dimension 1 Code"))), FALSE, TRUE);
    END;

    PROCEDURE ResetFileName@1000000020();
    BEGIN
      TryOutFileName := GetDirAndFileName(1);
      KPAFileName := GetDirAndFileName(3);
      TryOutSuccFileName := GetDirAndFileName(5);
      JobFileName := GetDirAndFileName(7);
      JobFinFileName := GetDirAndFileName(9);
      //CompFileName := GetDirAndFileName(11);
      WipFileName  := GetDirAndFileName(13);
      CompFileName := GetDirAndFileName(12);
    END;

    PROCEDURE GetUserId@1000000005(EmplNo@1000000000 : Code[20];VAR ID@1000000003 : Code[20]) : Boolean;
    VAR
      UserSetup@1000000001 : Record 91;
      WindLogin@1000000002 : Record 2000000120;
    BEGIN
      IF COMPANYNAME <> Company.Name THEN
        UserSetup.CHANGECOMPANY(Company.Name);
      UserSetup.SETRANGE("Employee No.", EmplNo);      //INL\CKJAPENG
      IF UserSetup.FINDFIRST THEN BEGIN                //123456789112
        WindLogin.SETRANGE("User Name", UserSetup."User ID");
        IF WindLogin.FINDFIRST THEN BEGIN
          IF STRPOS(WindLogin."User Name", '\') > 0 THEN
            ID := COPYSTR(WindLogin."User Name", STRPOS(WindLogin."User Name", '\') + 1,
                    STRLEN(WindLogin."User Name") - STRPOS(WindLogin."User Name", '\'));
            EXIT(TRUE);
        END ELSE
          EXIT(FALSE);
      END;
      EXIT(TRUE);
    END;

    BEGIN
    {
      FMI trajecten
      FMI KPA
      FMI Vervolgtrajecten
      FMI Projecten
    }
    END.
  }
  RDLDATA
  {
  }
}

