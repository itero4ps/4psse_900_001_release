OBJECT Table 11012004 Extension Contract
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Project No.,Contract No.,Description;
    OnInsert=VAR
               SummarySheetLineRec@1100485000 : Record 11012064;
               ExtContractToRecRef@1100285500 : Record 11012004;
               RecRef@1100285501 : RecordRef;
               SymbrioSetup@1000 : Record 11127975;
               lvJob@1100285502 : Record 11072003;
             BEGIN
               TESTFIELD("Contract No."); //C017655

               "Input by" := USERID;
               "Input Date" := TODAY;
               "Version Date" := WORKDATE;
               JobSetUp.GET;
               ProjRec.GET("Project No.");
               "Main Project No." := ProjRec."Main Project";
               // ProjRec.CheckProjectStatus(0); Not here, but test at field project

               //*C-026129.so  Principal not filled yet, and also not of customer but of 'Project Principal'
               // Call 29180.sn
               //IF Customer.GET(Principal) THEN
               //"VAT Prod. Posting Group" := Customer."VAT Prod. Posting Group";
               // Call 29180.en
               //*C-026129.eo

               Revision := ProjRec.Revision;
               "Revision Rule" := ProjRec."Revision Rule";
               "Reference Date Revision" := 0D ;

               "Contract Type" := ProjRec."Contract Type";
               "Department Code" := ProjRec."Global Dimension 1 Code";  //**4PS.n DPA

               IF ProjRec."Summary Sheet Contract" <> '' THEN BEGIN
                 SummarySheetLineRec.CopyTemplate2(ProjRec."Summary Sheet Contract", "Project No.", "Contract No.", '', '', '', '', '', '');
                 SummarySheetLineRec.SETRANGE("Project No.", "Project No.");
                 SummarySheetLineRec.SETRANGE("Contract No.", "Contract No.");
                 SummarySheetLineRec.SETFILTER("Plot No.", '%1', '');
                 SummarySheetLineRec.SETFILTER(Option, '%1', '');
                 IF SummarySheetLineRec.FIND('-') THEN BEGIN
                   SummarySheetLineRec.ReCalcSummaryLines('');
                   SummarySheetLineRec.UpdateBudgetLines(TRUE, '');
                 END;
               END;

               ProjectSiteMgt.LogExtensionContract(1, Rec); //**4PS.n

               IF SymbrioSetup.READPERMISSION THEN BEGIN
               // SYM036 <<
                 IF (lvJob.GET("Project No.")) THEN BEGIN
                    IF ExportToSymbrio.JobIsReadyForExport(lvJob) AND (lvJob."Single/Main/Sub Project" <> lvJob."Single/Main/Sub Project"::"Main Project") THEN BEGIN
               // SYM036 >>
                     //>> IME104
                      IF ExportToSymbrio.ExtensionIsReadyForExport(Rec) THEN BEGIN
                        ExtContractToRecRef := Rec;
                        ExtContractToRecRef.SETRECFILTER;
                        RecRef.GETTABLE(ExtContractToRecRef);
                        //IME156 added "Project No."
                        IF ExportToSymbrio.ExtensionIsReadyForExport(Rec) THEN
                          SymbrioFunctions.AddToSymbrioExportQueue(DATABASE::"Extension Contract",RecRef,"Project No.", "Contract No.",lvJob."Project Status");
                      END; //ExtensionIsReadyForExport
                     //>> IME104
               // SYM036 <<
                   END; //JobIsReadyForExport
               // SYM036 >>
                 END;  //(lvJob.GET("Project No."))
               END;  //readpermission

               "Last Date Modified" := TODAY; // 4PSHM 140131
               "Time Last Modified" := TIME;  // 4PSHM 140131

               //<<ITERO.PR
               VALIDATE(Status,JobSetUp."Default Extension Status");
               //>>ITERO.PR
             END;

    OnModify=VAR
               cuSymbrio@1100285000 : Codeunit 11127975;
               SymbrioSetup@1000 : Record 11127975;
               lvJob@1100285500 : Record 11072003;
             BEGIN
               "Modified by" := USERID;
               "Last Date Modified" := TODAY;
               "Time Last Modified" := TIME; // 4PSHM 140131

               IF "Version Date" <> xRec."Version Date" THEN
                 UpdateBudgetVersionDate;

               IF (Status <> xRec.Status) OR ("Treat like Order" <> xRec."Treat like Order") THEN BEGIN
                 BudgetRec.RESET;
                 BudgetRec.SETRANGE("Project No.","Project No.");
                 //BudgetRec.SETRANGE(Adjustment,'');  //C000494.o
                 //BudgetRec.SETRANGE(Option,'');
                 BudgetRec.SETRANGE("Extension Contract","Contract No.");
                 IF BudgetRec.FINDSET(TRUE, FALSE) THEN
                   REPEAT
                     IF (Status < Status::Order) AND "Treat like Order" THEN
                       BudgetRec."Extension Contract Status" := BudgetRec."Extension Contract Status"::Order
                     ELSE
                       BudgetRec."Extension Contract Status" := Status + 1;
                     BudgetRec.MODIFY;
                   UNTIL BudgetRec.NEXT = 0;
               END;

               IF "Contract Serial No." = '' THEN BEGIN
                 JobSetUp.GET;
                 IF JobSetUp."Extension Contract Nos." <> '' THEN
                   "Contract Serial No." := NoSeriesMgt.GetNextNo(JobSetUp."Extension Contract Nos.",0D,TRUE);
               END;

               ProjectSiteMgt.LogExtensionContract(2, Rec); //**4PS.n

               IF SymbrioSetup.READPERMISSION THEN
               // SYM036 <<
               IF (lvJob.GET("Project No.")) THEN
                  IF ExportToSymbrio.JobIsReadyForExport(lvJob) AND (lvJob."Single/Main/Sub Project" <> lvJob."Single/Main/Sub Project"::"Main Project")
                    THEN
               // SYM036 >>
                 //IME156
                 IF ExportToSymbrio.ExtensionIsReadyForExport(Rec) THEN
                   //>>130610 JOSV
                   cuSymbrio.fnExportExtContr(Rec,xRec);
                   //<<130610 JOSV
             END;

    OnDelete=VAR
               ProjInstalmRec@1210190001 : Record 11012018;
               TenderParagraphByPrincipal@1100525000 : Record 11012470;
               ExportToSymbrio@1100285500 : Codeunit 11127979;
               SymbrioFunctions@1100285501 : Codeunit 11127975;
               lvJob@1100285502 : Record 11072003;
               JobLedgerEntry@1100525001 : Record 11072005;
             BEGIN
               //kkleermaker.sn, 110923, M19415
               IF NOT DeleteCompleteProject THEN
                 TESTFIELD("Extension Fixed", FALSE);
               //kkleermaker.en, 110923, M19415

               //C009985 sn
               IF NOT DeleteCompleteProject THEN BEGIN
                 JobLedgerEntry.RESET;
                 JobLedgerEntry.SETCURRENTKEY("Job No.", "Extension Contract");
                 JobLedgerEntry.SETRANGE("Job No.", "Project No.");
                 JobLedgerEntry.SETRANGE("Extension Contract", "Contract No.");
                 IF JobLedgerEntry.FINDFIRST THEN
                   ERROR(Text011);
               END;
               //C009985 en

               //IF "Installments Generated" THEN BEGIN  //C004714.o
                 ProjInstalmRec.SETRANGE("Project No.","Project No.");
                 ProjInstalmRec.SETRANGE("Extension Contract","Contract No.");
                 IF ProjInstalmRec.FINDSET THEN BEGIN
                   IF ProjRec.GET("Project No.") THEN
                     IF ProjRec."Project Status" < ProjRec."Project Status"::Finished THEN
                       IF CONFIRM(Text008, FALSE) = FALSE THEN
                         ERROR(Text006);
                   IF NOT DeleteCompleteProject THEN BEGIN
                     REPEAT
                       ProjInstalmRec.CALCFIELDS("Invoiced Price (LCY)", "Invoice in Process (LCY)");
                       IF ProjInstalmRec."Invoiced Price (LCY)" + ProjInstalmRec."Invoice in Process (LCY)" <> 0 THEN
                         ERROR(Text007);
                     UNTIL ProjInstalmRec.NEXT = 0;
                   END;
                 END;
               //END;  //C004714.o

               BudgetSummarysheetRec.RESET;
               BudgetSummarysheetRec.SETRANGE("Project No.","Project No.");
               BudgetSummarysheetRec.SETRANGE("Contract No.","Contract No.");
               BudgetSummarysheetRec.DELETEALL;

               TenderParagraphByPrincipal.SETRANGE("Project No.","Project No.");
               TenderParagraphByPrincipal.SETRANGE("Contract No.", "Contract No.");
               TenderParagraphByPrincipal.DELETEALL;

               DELETE;  //db, 25-09-07 (call C-011060)
               BudgetRec.RESET;
               BudgetRec.SETRANGE("Project No.","Project No.");
               //BudgetRec.SETRANGE(Adjustment,'');
               BudgetRec.SETRANGE(Option,'');
               BudgetRec.SETRANGE("Extension Contract","Contract No.");
               BudgetRec.DELETEALL(TRUE);  //update maintable cause of sql-problem
               INSERT;  //db, 25-09-07 (call C-011060)

               ProjectSiteMgt.LogExtensionContract(3, Rec); //**4PS.n

               // SYM036 <<
               IF (lvJob.GET("Project No.")) THEN BEGIN
                  IF ExportToSymbrio.JobIsReadyForExport(lvJob) AND (lvJob."Single/Main/Sub Project" <> lvJob."Single/Main/Sub Project"::"Main Project")
                    THEN BEGIN
                       IF ExportToSymbrio.ExtensionIsReadyForExport(Rec) THEN BEGIN
                          SymbrioFunctions.fnDeleteExtContr(Rec);
                    END;
                 END;
               END;
               // SYM036 >>
             END;

    OnRename=BEGIN
               IF "Project No." <> xRec."Project No." THEN
                 ERROR(Text000);

               "Modified by" := USERID;
               "Last Date Modified" := TODAY;
             END;

    CaptionML=ENU=Extension Contract;
    LookupPageID=Page11012014;
    DrillDownPageID=Page11012014;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                IF "Project No." <> '' THEN BEGIN
                                                                  ProjRec.GET("Project No.");
                                                                  CheckProjStatus;
                                                                END;
                                                                CALCFIELDS("Project Description");
                                                              END;

                                                   CaptionML=ENU=Project No.;
                                                   NotBlank=Yes }
    { 20  ;   ;Contract No.        ;Code10        ;OnValidate=VAR
                                                                lvextno@1100285500 : Integer;
                                                              BEGIN
                                                                //>>141229 SYM045
                                                                IF SymbrioSetup.GET THEN
                                                                  IF SymbrioSetup."Path Project ŽTA" <> '' THEN BEGIN
                                                                    IF STRLEN("Contract No.") <> 4 THEN
                                                                     ERROR(Text011b);
                                                                //<<141229 SYM045
                                                                //>>150108 SYM045
                                                                    IF NOT EVALUATE(lvextno,"Contract No.") THEN
                                                                     ERROR(Text012);
                                                                  END;
                                                                //<<150108 SYM045
                                                              END;

                                                   CaptionML=ENU=Contract No.;
                                                   NotBlank=Yes }
    { 30  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 40  ;   ;Input by            ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Input by;
                                                   Editable=No }
    { 50  ;   ;Input Date          ;Date          ;CaptionML=ENU=Input Date;
                                                   Editable=No }
    { 60  ;   ;Status              ;Option        ;OnValidate=VAR
                                                                lvSalesLineRec@1210190000 : Record 37;
                                                                lvSalesInvLineRec@1210190001 : Record 113;
                                                                lvSalesCrMemLineRec@1100525000 : Record 115;
                                                                lvInvoicePresent@1100525001 : Boolean;
                                                                lvCrMemoPresent@1100525004 : Boolean;
                                                                lvAmtInvoice@1100525002 : Decimal;
                                                                lvAmtCrMemo@1100525003 : Decimal;
                                                              BEGIN
                                                                IF Status = xRec.Status THEN
                                                                  EXIT;

                                                                IF (Status = Status::Expired) OR
                                                                   ((xRec.Status >= xRec.Status::"Invoicing Allowed") AND (Status < Status::"Invoicing Allowed")) THEN BEGIN
                                                                  lvSalesLineRec.SETCURRENTKEY("Document Type","Job No.","Extension Contract");
                                                                  lvSalesLineRec.SETRANGE("Document Type",lvSalesLineRec."Document Type"::Invoice,lvSalesLineRec."Document Type"::"Credit Memo");
                                                                  lvSalesLineRec.SETRANGE("Job No.","Project No.");
                                                                  lvSalesLineRec.SETRANGE("Extension Contract","Contract No.");
                                                                  IF lvSalesLineRec.FINDFIRST THEN
                                                                    ERROR(Text003,"Project No.","Contract No.");

                                                                  { //15739.so
                                                                  lvSalesInvLineRec.SETCURRENTKEY("Job No.","Extension Contract");
                                                                  lvSalesInvLineRec.SETRANGE("Job No.","Project No.");
                                                                  lvSalesInvLineRec.SETRANGE("Extension Contract","Contract No.");
                                                                  IF lvSalesInvLineRec.FINDFIRST THEN
                                                                    ERROR(Text004,"Project No.","Contract No.");
                                                                  } //15739.eo

                                                                  // 15739.sn
                                                                  lvSalesInvLineRec.SETCURRENTKEY("Job No.","Extension Contract");
                                                                  lvSalesInvLineRec.SETRANGE("Job No.","Project No.");
                                                                  lvSalesInvLineRec.SETRANGE("Extension Contract","Contract No.");
                                                                  lvInvoicePresent := lvSalesInvLineRec.FINDFIRST;

                                                                  lvSalesCrMemLineRec.SETCURRENTKEY("Job No.");
                                                                  lvSalesCrMemLineRec.SETRANGE("Job No.","Project No.");
                                                                  lvSalesCrMemLineRec.SETRANGE("Extension Contract","Contract No.");
                                                                  lvCrMemoPresent := lvSalesCrMemLineRec.FINDFIRST;

                                                                  IF lvInvoicePresent OR lvCrMemoPresent THEN BEGIN
                                                                    IF NOT (lvInvoicePresent AND lvCrMemoPresent) THEN
                                                                      ERROR(Text004,"Project No.","Contract No.")
                                                                    ELSE BEGIN
                                                                      lvAmtInvoice := 0;
                                                                      lvAmtCrMemo  := 0;
                                                                      REPEAT
                                                                        lvAmtInvoice := lvAmtInvoice + lvSalesInvLineRec."Amount Including VAT";
                                                                      UNTIL lvSalesInvLineRec.NEXT = 0;
                                                                      REPEAT
                                                                        lvAmtCrMemo := lvAmtCrMemo + lvSalesCrMemLineRec."Amount Including VAT";
                                                                      UNTIL lvSalesCrMemLineRec.NEXT = 0;
                                                                      IF lvAmtInvoice <> lvAmtCrMemo THEN
                                                                        ERROR(Text004,"Project No.","Contract No.");
                                                                    END;
                                                                  END;
                                                                  // 15739.en

                                                                END;

                                                                CheckProjStatus();
                                                                CheckSwitchSummary;  //DP00901

                                                                IF Status >= Status::Order THEN BEGIN
                                                                  "Treat like Order" := FALSE;
                                                                  "Include in Expectation" := FALSE;
                                                                END;
                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Status;
                                                   OptionCaptionML=ENU=Applied,Offered,Order,Invoicing Allowed,Expired;
                                                   OptionString=Applied,Offered,Order,Invoicing Allowed,Expired }
    { 65  ;   ;Department Code     ;Code20        ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=ENU=Department Code;
                                                   Editable=No }
    { 70  ;   ;Contract Amount (LCY);Decimal      ;OnValidate=VAR
                                                                CurrencyDate@1100525001 : Date;
                                                                CurrencyExchangeRateRec@1100525000 : Record 330;
                                                                Currency2@1100528200 : Record 4;
                                                              BEGIN
                                                                IF ("Contract Amount (LCY)" <> xRec."Contract Amount (LCY)") AND "Installments Generated" THEN
                                                                  MESSAGE(Text001);

                                                                Currency2.InitRoundingPrecision;
                                                                IF "Contract Currency Code" <> '' THEN BEGIN
                                                                  CurrencyDate := GetCurrencyDate;  //DP00886
                                                                  "Contract Amount" :=
                                                                  ROUND(
                                                                    CurrencyExchangeRateRec.ExchangeAmtLCYToFCY(
                                                                      1, "Project No.", CurrencyDate, "Contract Currency Code", "Contract Amount (LCY)",
                                                                      CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Contract Currency Code",TRUE),TRUE),
                                                                      Currency2."Amount Rounding Precision");
                                                                END ELSE BEGIN
                                                                  "Contract Amount" := ROUND("Contract Amount (LCY)",Currency2."Amount Rounding Precision");
                                                                END;

                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Contract Amount LCY;
                                                   AutoFormatType=1 }
    { 71  ;   ;Contract Amount     ;Decimal       ;OnValidate=VAR
                                                                CurrencyDate@1100525000 : Date;
                                                                CurrencyExchangeRateRec@1100525001 : Record 330;
                                                                Currency2@1100528200 : Record 4;
                                                                ProjectInstallment@1100525006 : Record 11012018;
                                                                TotalContractInvoiced@1100525005 : Decimal;
                                                                TotalContractInvoicedLCY@1100525004 : Decimal;
                                                                ContractAmountRemaining@1100525003 : Decimal;
                                                                ContractAmountRemainingLCY@1100525002 : Decimal;
                                                              BEGIN
                                                                IF ("Contract Amount" <> xRec."Contract Amount") AND "Installments Generated" THEN
                                                                  MESSAGE(Text001);

                                                                Currency2.InitRoundingPrecision;
                                                                IF "Contract Currency Code" <> '' THEN BEGIN
                                                                  CurrencyDate := GetCurrencyDate;  //DP00886
                                                                  TotalContractInvoiced :=0;
                                                                  TotalContractInvoicedLCY := 0;

                                                                  ProjectInstallment.SETRANGE("Project No.", "Project No.");
                                                                  ProjectInstallment.SETRANGE(Principal, Principal);                  //M26266
                                                                  ProjectInstallment.SETRANGE("Extension Contract", "Contract No.");  //M26266
                                                                  IF ProjectInstallment.FINDSET THEN BEGIN
                                                                    REPEAT
                                                                      ProjectInstallment.CALCFIELDS("Invoice in Process","Invoice in Process (LCY)","Invoiced Price","Invoiced Price (LCY)");
                                                                      IF (ProjectInstallment."Invoice in Process" <> 0) OR (ProjectInstallment."Invoiced Price" <> 0) THEN BEGIN
                                                                        TotalContractInvoiced := TotalContractInvoiced + ProjectInstallment."Invoice in Process" +
                                                                        ProjectInstallment."Invoiced Price";
                                                                        TotalContractInvoicedLCY := TotalContractInvoicedLCY + ProjectInstallment."Invoice in Process (LCY)" +
                                                                        ProjectInstallment."Invoiced Price (LCY)";
                                                                      END;
                                                                    UNTIL ProjectInstallment.NEXT = 0;
                                                                  END;

                                                                  ContractAmountRemaining := "Contract Amount" - TotalContractInvoiced;
                                                                  ContractAmountRemainingLCY :=
                                                                    ROUND(
                                                                      CurrencyExchangeRateRec.ExchangeAmtFCYToLCY(
                                                                        1, "Project No.", CurrencyDate, "Contract Currency Code", ContractAmountRemaining,
                                                                        CurrencyExchangeRateRec.ExchangeRate(1, "Project No.", CurrencyDate, "Contract Currency Code",TRUE),TRUE),
                                                                      Currency2."Amount Rounding Precision");

                                                                  "Contract Amount (LCY)" := ContractAmountRemainingLCY + TotalContractInvoicedLCY;
                                                                END ELSE BEGIN
                                                                  "Contract Amount (LCY)" := ROUND("Contract Amount",Currency2."Amount Rounding Precision");
                                                                END;

                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Contract Amount;
                                                   AutoFormatType=1 }
    { 72  ;   ;Contract Currency Code;Code10      ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                VALIDATE("Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Contract Currency Code }
    { 80  ;   ;Offered Amount      ;Decimal       ;OnValidate=BEGIN
                                                                CheckProjStatus();

                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Offered Amount;
                                                   AutoFormatType=1 }
    { 90  ;   ;Offering Date       ;Date          ;CaptionML=ENU=Offering Date }
    { 95  ;   ;Due Date            ;Date          ;CaptionML=ENU=Due Date }
    { 100 ;   ;Contract Date       ;Date          ;OnValidate=BEGIN
                                                                IF "Contract Date" <> 0D THEN
                                                                  VALIDATE("Version Date", "Contract Date");
                                                              END;

                                                   CaptionML=ENU=Contract Date }
    { 105 ;   ;Generate Installments;Boolean      ;CaptionML=ENU=Generate Installments }
    { 110 ;   ;Installment Scheme  ;Code10        ;TableRelation="Installment Scheme".Code WHERE (Type=CONST(Project));
                                                   CaptionML=ENU=Installment Scheme }
    { 120 ;   ;Text                ;Text250       ;CaptionML=ENU=Text }
    { 130 ;   ;Installments Generated;Boolean     ;InitValue=No;
                                                   CaptionML=ENU=Installments Generated;
                                                   Editable=No }
    { 140 ;   ;Generation Date     ;Date          ;CaptionML=ENU=Generation Date;
                                                   Editable=No }
    { 150 ;   ;Principal           ;Code20        ;TableRelation=Customer;
                                                   OnValidate=VAR
                                                                ProjPrincipRec@1100485000 : Record 11012005;
                                                              BEGIN
                                                                IF (Principal <> xRec.Principal) AND (Principal <> '') THEN BEGIN
                                                                  CheckProjectPrincipal;
                                                                  IF (Principal <> xRec.Principal) AND (Principal <> '') THEN BEGIN  //* Check again Principal can be modified/reset
                                                                                                                                     //* in function 'CheckProjectPrincipal'
                                                                    AddPrincipalToTenderParagraphs;
                                                                    IF ProjPrincipRec.GET("Project No.", Principal) THEN BEGIN
                                                                      "Principal Contact" := ProjPrincipRec."Contact Person No.";
                                                                      "Installm.Motivation Method" := ProjPrincipRec."Installm.Motivation Method";
                                                                      "Number of Points" := ProjPrincipRec."Number of Points";
                                                                      JobSetUp.GET;  //C000055.n
                                                                      IF JobSetUp."Fill Ext.Contr. Inv.Text Prin." THEN BEGIN  //C000055.n
                                                                        // jhoek.240611.begin: call 24517
                                                                        "Invoice Text" := ProjPrincipRec."Invoice Text Installments";
                                                                        "Invoice Text Cost Plus" := ProjPrincipRec."Invoice Text Cost Plus";
                                                                        // jhoek.240611.end
                                                                      END;  //C000055.n
                                                                      //*C-026129.sn
                                                                      IF ProjPrincipRec."VAT Prod. Posting Group" <> '' THEN
                                                                        "VAT Prod. Posting Group" := ProjPrincipRec."VAT Prod. Posting Group";
                                                                      //*C-026129.en
                                                                      VALIDATE("Contract Currency Code", ProjPrincipRec."Currency Code");
                                                                    END;
                                                                  END;
                                                                END;
                                                                IF CurrFieldNo > 0 THEN
                                                                  CALCFIELDS("Principal Name");
                                                              END;

                                                   CaptionML=ENU=Principal }
    { 155 ;   ;Principal Contact   ;Code20        ;OnValidate=VAR
                                                                Cont@1100525000 : Record 5050;
                                                              BEGIN
                                                                IF CurrFieldNo > 0 THEN
                                                                  CALCFIELDS("Principal Contact Name");

                                                                IF "Principal Contact" <> '' THEN BEGIN
                                                                  Cont.GET("Principal Contact");
                                                                  Cont.TESTFIELD(Type, Cont.Type::Person);
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1100485000 : Record 5050;
                                                              ContBusinessRelation@1100485001 : Record 5054;
                                                            BEGIN
                                                              Cont.SETFILTER("Company No.", '<>''''');
                                                              IF Principal <> '' THEN BEGIN
                                                                ContBusinessRelation.SETCURRENTKEY("Link to Table", "No.");
                                                                ContBusinessRelation.SETRANGE("Link to Table", ContBusinessRelation."Link to Table"::Customer);
                                                                ContBusinessRelation.SETRANGE("No.", Principal);
                                                                IF ContBusinessRelation.FINDFIRST THEN
                                                                  Cont.SETRANGE("Company No.", ContBusinessRelation."Contact No.");
                                                              END;

                                                              IF "Principal Contact" <> '' THEN
                                                                IF Cont.GET("Principal Contact") THEN;

                                                              IF PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK THEN
                                                                VALIDATE("Principal Contact", Cont."No.");
                                                            END;

                                                   CaptionML=ENU=Principal Contact }
    { 156 ;   ;Principal Contact Name;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Contact.Name WHERE (No.=FIELD(Principal Contact)));
                                                   CaptionML=ENU=Principal Contact Name;
                                                   Editable=No }
    { 160 ;   ;Project Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=ENU=Project Description;
                                                   Editable=No }
    { 170 ;   ;Installment Scheme Description;Text30;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Installment Scheme".Description WHERE (Code=FIELD(Installment Scheme)));
                                                   CaptionML=ENU=Installment Scheme Description;
                                                   Editable=No }
    { 180 ;   ;Principal Name      ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Principal)));
                                                   CaptionML=ENU=Principal Name;
                                                   Editable=No }
    { 190 ;   ;Version Date        ;Date          ;CaptionML=ENU=Version Date }
    { 200 ;   ;Modified by         ;Code50        ;TableRelation=User."User Name";
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Modified by;
                                                   Editable=No }
    { 210 ;   ;Last Date Modified  ;Date          ;CaptionML=ENU=Last Date Modified;
                                                   Editable=No }
    { 220 ;   ;Hours               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Extension Contract=FIELD(Contract No.)));
                                                   CaptionML=ENU=Hours;
                                                   Editable=No }
    { 230 ;   ;Labor               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Cost Type=CONST(Labor)));
                                                   CaptionML=ENU=Labor;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Material            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Cost Type=CONST(Material)));
                                                   CaptionML=ENU=Material;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Subcontracting      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Cost Type=CONST(Subcontracting)));
                                                   CaptionML=ENU=Subcontracting;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Plant               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Cost Type=CONST(Plant)));
                                                   CaptionML=ENU=Plant;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Sundry              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Cost Type=CONST(Sundry)));
                                                   CaptionML=ENU=Sundry;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Total               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.)));
                                                   CaptionML=ENU=Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 290 ;   ;Finished            ;Boolean       ;CaptionML=ENU=Finished }
    { 300 ;   ;Contract Serial No. ;Code10        ;CaptionML=ENU=Contract Serial No.;
                                                   Editable=No }
    { 310 ;   ;Settlement Method   ;Option        ;CaptionML=ENU=Settlement Method;
                                                   OptionCaptionML=ENU=Fixed Price,Cost Plus;
                                                   OptionString=Fixed Price,Cost Plus }
    { 320 ;   ;Your Reference      ;Text50        ;CaptionML=ENU=Your Reference }
    { 330 ;   ;Invoice Text        ;Text250       ;CaptionML=ENU=Invoice Text Installments }
    { 340 ;   ;Budget Fixed        ;Boolean       ;OnValidate=VAR
                                                                lUserSetup@1100485000 : Record 91;
                                                              BEGIN
                                                                IF "Budget Fixed" <> xRec."Budget Fixed" THEN
                                                                  IF lUserSetup.GET(USERID) THEN
                                                                    IF lUserSetup."No Access Ext. Contract Fixed" THEN
                                                                      ERROR(Text009,FIELDCAPTION("Budget Fixed"));
                                                                IF (NOT "Budget Fixed") AND "Extension Fixed" THEN
                                                                  TESTFIELD("Extension Fixed", FALSE);
                                                              END;

                                                   CaptionML=ENU=Budget Fixed }
    { 341 ;   ;Extension Fixed     ;Boolean       ;OnValidate=BEGIN
                                                                IF "Extension Fixed" THEN BEGIN
                                                                  //"Budget Fixed" := TRUE;
                                                                  IF NOT "Budget Fixed" THEN
                                                                    VALIDATE("Budget Fixed", TRUE);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Extension Fixed }
    { 400 ;   ;Budget              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Version Date=FIELD(Cumulation Filter),
                                                                                               Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Budget;
                                                   Editable=No }
    { 420 ;   ;Budget Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Project No.=FIELD(Project No.),
                                                                                              Extension Contract=FIELD(Contract No.),
                                                                                              Version Date=FIELD(Cumulation Filter),
                                                                                              Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Budget Hours;
                                                   Editable=No }
    { 430 ;   ;Revenues            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Job Ledger Entry"."Total Price (LCY)" WHERE (Job No.=FIELD(Project No.),
                                                                                                                  Extension Contract=FIELD(Contract No.),
                                                                                                                  Entry Type=CONST(Sale),
                                                                                                                  Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Revenues;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 440 ;   ;Revenues Period     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Job Ledger Entry"."Total Price (LCY)" WHERE (Job No.=FIELD(Project No.),
                                                                                                                  Extension Contract=FIELD(Contract No.),
                                                                                                                  Entry Type=CONST(Sale),
                                                                                                                  Posting Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Revenues Period;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 450 ;   ;Open Ovh. Surch. (Inventory);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Surcharge"."Overhead Surcharge Project" WHERE (Job No.=FIELD(Project No.),
                                                                                                                                Extension Contract=FIELD(Contract No.),
                                                                                                                                Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. (Inventory);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 460 ;   ;Open Ovh. Surch. Firm (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Firm" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                  Extension Contract=FIELD(Contract No.),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. Firm Commitments (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 465 ;   ;Open Ovh. Surch. Soft (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Soft" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                  Extension Contract=FIELD(Contract No.),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. Soft Commitments (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 470 ;   ;Actual Costs        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry"."Total Cost (LCY)" WHERE (Job No.=FIELD(Project No.),
                                                                                                                Extension Contract=FIELD(Contract No.),
                                                                                                                Entry Type=CONST(Usage),
                                                                                                                Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Actual Costs;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 480 ;   ;Actual Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry".Quantity WHERE (Job No.=FIELD(Project No.),
                                                                                                      Cost Type=CONST(Labor),
                                                                                                      Extension Contract=FIELD(Contract No.),
                                                                                                      Entry Type=CONST(Usage),
                                                                                                      Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Actual Hours;
                                                   Editable=No }
    { 490 ;   ;Actuals Period      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry"."Total Cost (LCY)" WHERE (Job No.=FIELD(Project No.),
                                                                                                                Extension Contract=FIELD(Contract No.),
                                                                                                                Entry Type=CONST(Usage),
                                                                                                                Posting Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Actuals Period;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 500 ;   ;Actual Hours Period ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry".Quantity WHERE (Job No.=FIELD(Project No.),
                                                                                                      Cost Type=CONST(Labor),
                                                                                                      Extension Contract=FIELD(Contract No.),
                                                                                                      Entry Type=CONST(Usage),
                                                                                                      Posting Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Actual Hours Period;
                                                   Editable=No }
    { 510 ;   ;Purchase Budget     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Project No.=FIELD(Project No.),
                                                                                               Purchase Action Status=FILTER(>=Approved),
                                                                                               Extension Contract=FIELD(Contract No.),
                                                                                               Purch. Action Approval Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Purchase Budget;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 520 ;   ;Purchase            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                         Job No.=FIELD(Project No.),
                                                                                                         Extension Contract=FIELD(Contract No.),
                                                                                                         Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Purchase;
                                                   Editable=No }
    { 525 ;   ;Purchase Period     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                         Job No.=FIELD(Project No.),
                                                                                                         Extension Contract=FIELD(Contract No.),
                                                                                                         Order Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Purchase Period;
                                                   Editable=No }
    { 530 ;   ;Open (Purchase)     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Outstanding Amount" WHERE (Project No.=FIELD(Project No.),
                                                                                                                             Extension Contract=FIELD(Contract No.),
                                                                                                                             Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 540 ;   ;Received/Not Invoiced;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Amt. Rcd. Not Invoiced" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                 Extension Contract=FIELD(Contract No.),
                                                                                                                                 Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Received/Not Invoiced;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 550 ;   ;Risc Coverage       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Risc Coverage Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                                       Job No.=FIELD(Project No.),
                                                                                                                       Extension Contract=FIELD(Contract No.),
                                                                                                                       Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Risc Coverage;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 560 ;   ;Risc Coverage Withdraw;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Release Risc Coverage (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                                        Job No.=FIELD(Project No.),
                                                                                                                        Extension Contract=FIELD(Contract No.),
                                                                                                                        Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Risc Coverage Withdraw;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 570 ;   ;Open (Inventory)    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Line".Amount WHERE (Job No.=FIELD(Project No.),
                                                                                                     Extension Contract=FIELD(Contract No.),
                                                                                                     Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open (Inventory);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 580 ;   ;Open Amount (Hours) ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Amount (LCY)" WHERE (Project No.=FIELD(Project No.),
                                                                                                                Extension Contract=FIELD(Contract No.),
                                                                                                                Posting Date=FIELD(Cumulation Filter),
                                                                                                                Component Type=FIELD(Wage Component Type Filter)));
                                                   CaptionML=ENU=Open Amount (Hours);
                                                   Description=ime155;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 590 ;   ;Open Ovh. Surch. (Hours);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Surcharge"."Overhead Surcharge Project" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                   Extension Contract=FIELD(Contract No.),
                                                                                                                                   Posting Date=FIELD(Cumulation Filter),
                                                                                                                                   Component Type=FIELD(Wage Component Type Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. (Hours);
                                                   Description=ime155;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 600 ;   ;Open Hours          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Total Line" WHERE (Project No.=FIELD(Project No.),
                                                                                                              Extension Contract=FIELD(Contract No.),
                                                                                                              Posting Date=FIELD(Cumulation Filter),
                                                                                                              Component Type=FIELD(Wage Component Type Filter)));
                                                   CaptionML=ENU=Open Hours;
                                                   Description=ime155;
                                                   Editable=No }
    { 610 ;   ;Received/Not Inv. Hours;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Hours Rcd. Not Invoiced" WHERE (Project No.=FIELD(Project No.),
                                                                                                                                  Extension Contract=FIELD(Contract No.),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Received/Not Inv. Hours;
                                                   Editable=No }
    { 700 ;   ;Period Filter       ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Period Filter }
    { 710 ;   ;Cumulation Filter   ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Cumulation Filter }
    { 720 ;   ;Progress Filter     ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Progress Date }
    { 730 ;   ;PrevProgressFilter  ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Previous Progress Date }
    { 740 ;   ;Specific WKA Percentages;Boolean   ;OnValidate=BEGIN
                                                                IF NOT "Specific WKA Percentages" THEN BEGIN
                                                                  "% Labor" := 0;
                                                                  "% to B Account":= 0;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Specific WKA Percentages }
    { 750 ;   ;% Labor             ;Decimal       ;CaptionML=ENU=% Labor;
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   AutoFormatType=1 }
    { 760 ;   ;% to B Account      ;Decimal       ;CaptionML=ENU=% to B Account;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 770 ;   ;Contract Type       ;Option        ;OnValidate=BEGIN
                                                                IF "Contract Type" = "Contract Type"::Maincontracting THEN BEGIN
                                                                  "Specific WKA Percentages" := FALSE;
                                                                   "% Labor" := 0;
                                                                   "% to B Account" := 0;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Contract Type;
                                                   OptionCaptionML=ENU=Maincontracting,Subcontracting;
                                                   OptionString=Maincontracting,Subcontracting }
    { 780 ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=ENU=Main Project No. }
    { 800 ;   ;Installm.Motivation Method;Option  ;OnValidate=BEGIN
                                                                ProjRec.GET("Project No.");
                                                                IF ProjRec.RAW THEN BEGIN
                                                                  IF "Installm.Motivation Method" IN ["Installm.Motivation Method"::Points, "Installm.Motivation Method"::Percentages] THEN
                                                                    FIELDERROR("Installm.Motivation Method", STRSUBSTNO(Text010,"Installm.Motivation Method",ProjRec.FIELDCAPTION(RAW)));
                                                                END;

                                                                IF "Installm.Motivation Method" <> xRec."Installm.Motivation Method" THEN BEGIN
                                                                  CASE "Installm.Motivation Method" OF
                                                                    "Installm.Motivation Method"::Percentages:
                                                                      "Number of Points" := 100;
                                                                    ELSE
                                                                      "Number of Points" := 0;
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Installm.Motivation Method;
                                                   OptionCaptionML=ENU=" ,Points,Percentages,Element Quantity";
                                                   OptionString=[ ,Points,Percentages,Element Quantity];
                                                   Description=Should be equal to options of table 11012005 (field 320) }
    { 810 ;   ;Number of Points    ;Decimal       ;CaptionML=ENU=Number of Points }
    { 820 ;   ;Invoice Installm.Motivation as;Option;
                                                   OnValidate=BEGIN
                                                                IF "Invoice Installm.Motivation as" <> xRec."Invoice Installm.Motivation as" THEN BEGIN
                                                                  IF "Invoice Installm.Motivation as" <> "Invoice Installm.Motivation as"::"Fixed Installment Amounts" THEN BEGIN
                                                                    "Fixed Installment Amount (LCY)" := 0;
                                                                    "Fixed Installment Amount (FCY)" := 0;  //DP00886
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Invoice Installm.Motivation as;
                                                   OptionCaptionML=ENU=Installment per Motivation,Fixed Installment Amounts;
                                                   OptionString=Installment per Motivation,Fixed Installment Amounts }
    { 830 ;   ;Fixed Installment Amount (LCY);Decimal;
                                                   OnValidate=BEGIN
                                                                IF NOT SkipValidateFCY THEN
                                                                  "Fixed Installment Amount (FCY)" := ProjectCurrencyExchangeRate.ExchangeAmtLCYToFCY("Fixed Installment Amount (LCY)", FALSE, FALSE, "Contract Currency Code", "Project No.", Principal, "Contract Date");  //DP00886
                                                              END;

                                                   CaptionML=ENU=Fixed Installment Amount (LCY);
                                                   Description=DP00886 }
    { 831 ;   ;Fixed Installment Amount (FCY);Decimal;
                                                   OnValidate=BEGIN
                                                                //DP00886
                                                                SetSkipValidateFCY(TRUE);
                                                                VALIDATE("Fixed Installment Amount (LCY)", ProjectCurrencyExchangeRate.ExchangeAmtFCYToLCY("Fixed Installment Amount (FCY)", FALSE, FALSE, "Contract Currency Code", "Project No.", Principal, "Contract Date"));
                                                              END;

                                                   CaptionML=ENU=Fixed Installment Amount (FCY);
                                                   Description=DP00886 }
    { 870 ;   ;Revision            ;Boolean       ;CaptionML=ENU=Revision }
    { 871 ;   ;Revision Rule       ;Code20        ;TableRelation="Revision Rule";
                                                   CaptionML=ENU=Revision Rule Formula }
    { 872 ;   ;Reference Date Revision;Date       ;CaptionML=ENU=Reference Date Revision }
    { 880 ;   ;Estimated Amount    ;Decimal       ;OnValidate=BEGIN
                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Estimated Amount }
    { 890 ;   ;Estimate Date       ;Date          ;CaptionML=ENU=Estimate Date }
    { 900 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line Extended" WHERE (Table1 Name=CONST(Job),
                                                                                                    Table1 No.=FIELD(Project No.),
                                                                                                    Table2 Name=CONST(Extension Contract),
                                                                                                    Table2 No.=FIELD(Contract No.)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=No }
    { 910 ;   ;Treat like Order    ;Boolean       ;OnValidate=BEGIN
                                                                IF "Treat like Order" THEN
                                                                  "Include in Expectation" := FALSE;

                                                                VALIDATE("Expected Contract Amount");
                                                              END;

                                                   CaptionML=ENU=Treat like Order }
    { 920 ;   ;Include in Expectation;Boolean     ;CaptionML=ENU=Include in Expectation }
    { 930 ;   ;Expected Contract Amount;Decimal   ;OnValidate=BEGIN
                                                                "Expected Contract Amount" := 0;

                                                                CASE Status OF
                                                                  Status::Applied:
                                                                    IF "Treat like Order" THEN
                                                                      "Expected Contract Amount" := "Estimated Amount";
                                                                  Status::Offered:
                                                                    IF "Treat like Order" THEN
                                                                      "Expected Contract Amount" := "Offered Amount";
                                                                  Status::Order, Status::"Invoicing Allowed":
                                                                    "Expected Contract Amount" := "Contract Amount (LCY)";
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Expected Contract Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 935 ;   ;Expected Order Date ;Date          ;CaptionML=ENU=Expected Order Date }
    { 940 ;   ;VAT Prod. Posting Group;Code10     ;TableRelation="VAT Product Posting Group";
                                                   CaptionML=ENU=VAT Prod. Posting Group }
    { 950 ;   ;Extra Throughput (Days);Decimal    ;CaptionML=ENU=Extra Throughput (Days);
                                                   DecimalPlaces=1:1 }
    { 1010;   ;Invoice Text Cost Plus;Text250     ;CaptionML=ENU=Invoice Text Cost Plus }
    { 11127975;;Export to Symbrio  ;Boolean        }
    { 11128155;;Wage Component Type Filter;Option ;FieldClass=FlowFilter;
                                                   OptionString=Hours,Days,Expenses,Expense hours;
                                                   Description=IME155 }
    { 11128230;;Method Last Installment;Option    ;OnValidate=BEGIN
                                                                // SESB.I022 KD 17.07.2013 >>
                                                                IF "Method Last Installment" <> xRec."Method Last Installment" THEN
                                                                  IF "Method Last Installment" = "Method Last Installment"::" " THEN BEGIN
                                                                    "Withheld Perc. Final Installm." := 0;
                                                                    "Withheld Perc. Contract Amount" := 0;
                                                                  END;
                                                                // SESB.I022 KD 17.07.2013 <<
                                                              END;

                                                   CaptionML=ENU=Method Last Installment;
                                                   OptionCaptionML=ENU=" ,Depot,Guarantee,Final Installment";
                                                   OptionString=[ ,Depot,Guarantee,Final Installment];
                                                   Description=SESB.I022 }
    { 11128231;;Withheld Perc. Final Installm.;Decimal;
                                                   CaptionML=ENU=Withheld Perc. Final Installment;
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=SESB.I022 }
    { 11128232;;Withheld Perc. Contract Amount;Decimal;
                                                   CaptionML=ENU=Withheld Perc. Contract Amount;
                                                   MinValue=0;
                                                   MaxValue=100;
                                                   Description=SESB.I022 }
    { 11128233;;Time Last Modified ;Time          ;CaptionML=ENU=Time Last Modified }
    { 11128234;;Extension Category ;Code10        ;TableRelation="Extension Category"."Extension Category";
                                                   CaptionML=ENU=Extension Category }
    { 11128235;;Internal Reference ;Code20        ;CaptionML=ENU=Internal Reference }
  }
  KEYS
  {
    {    ;Project No.,Contract No.                ;Clustered=Yes }
    {    ;Project No.,Principal,Status,Version Date;
                                                   SumIndexFields=Contract Amount (LCY),Offered Amount }
    {    ;Contract Serial No.                      }
    {    ;Main Project No.,Project No.,Status,Treat like Order,Version Date;
                                                   SumIndexFields=Contract Amount (LCY),Offered Amount,Expected Contract Amount }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@11012004 : TextConst 'ENU=Modify Project not Allowed';
      Text001@11012005 : TextConst 'ENU=Project Installments generated. Change them manually.';
      Text002@11012006 : TextConst 'ENU="Principal for Project not present; create ?"';
      BudgetRec@11012000 : Record 11012001;
      Text003@1210190000 : TextConst 'ENU=Status not allowed, there are sales invoices (or credit memos) present for Project %1, Extension %2.';
      Text004@1210190001 : TextConst 'ENU=Status not allowed, there are posted sales invoices (or credit memos) present for Project %1, Extension %2.';
      JobSetUp@1210190002 : Record 315;
      ProjRec@1210190006 : Record 11072003;
      BudgetSummarysheetRec@1210190010 : Record 11012064;
      NoSeriesMgt@1210190003 : Codeunit 396;
      Text006@1210190009 : TextConst 'ENU=Process stopped';
      Text007@1210190008 : TextConst 'ENU="Installments already invoiced; Process stopped"';
      Text008@1210190007 : TextConst 'ENU="Installments present; continue ?"';
      Text009@1100485000 : TextConst 'ENU=You have no permission to change %1';
      Text010@1100485001 : TextConst 'ENU=''%1'' not allowed on Project with %2';
      DPA_Management@1100000999 : Codeunit 11012783;
      DeleteCompleteProject@1210190004 : Boolean;
      ProjectSiteMgt@1100528300 : Codeunit 11012282;
      Text011@1100525000 : TextConst 'ENU="Project Ledger Entries present; Process stopped"';
      TmpEst@1100528000 : TEMPORARY Record 11012151;
      TmpSubEst@1100528001 : TEMPORARY Record 11072074;
      "*** 4PSSE *"@1100285502 : Integer;
      SymbrioFunctions@1100285500 : Codeunit 11127975;
      ExportToSymbrio@1100285501 : Codeunit 11127979;
      SymbrioSetup@1100285503 : Record 11127975;
      Text011b@1100285504 : TextConst 'ENU=Extension Contract number can only contain 4 characters for export to Symbrio.';
      Text012@1100285505 : TextConst 'ENU=Extension Contract number can only contain numbers for export to Symbrio.';
      Text099@1100525001 : TextConst 'ENU=Replace Summary Sheet %1 by %2?';
      SkipValidateFCY@1100525002 : Boolean;
      ProjectCurrencyExchangeRate@1100525003 : Record 11020628;

    PROCEDURE AssistEdit@2(OldContract@1000 : Record 11012004) : Boolean;
    VAR
      NewContract@1210190000 : Record 11012004;
    BEGIN
      WITH NewContract DO BEGIN
        NewContract := Rec;
        JobSetUp.GET;
        JobSetUp.TESTFIELD("Extension Contract Nos.");
        IF NoSeriesMgt.SelectSeries(JobSetUp."Extension Contract Nos.",
          JobSetUp."Extension Contract Nos.",JobSetUp."Extension Contract Nos.") THEN
        BEGIN
          JobSetUp.GET;
          JobSetUp.TESTFIELD("Extension Contract Nos.");
          NoSeriesMgt.SetSeries("Contract Serial No.");
          Rec := NewContract;
          EXIT(TRUE);
        END;
      END;
    END;

    PROCEDURE CheckProjectPrincipal@1000000000();
    VAR
      ProjPrincipRec@1000000001 : Record 11012005;
      ProjPrincFrm@1000000000 : Page 11012015;
    BEGIN
      IF NOT ProjPrincipRec.GET("Project No.", Principal) THEN BEGIN
        IF CONFIRM(Text002, TRUE) THEN BEGIN
          CLEAR(ProjPrincFrm);
          ProjPrincipRec.FILTERGROUP(7);  //*32583.n  Other project not allowed
          ProjPrincipRec.SETRANGE("Project No.", "Project No.");
          ProjPrincipRec.SETRANGE(Principal, Principal);  //*32583.n  Also in filtergroup 7. Filter on Principal now in
                                                          //*32583.n  2 filtergroups, so not automatically filled in form
          ProjPrincipRec.FILTERGROUP(0);  //*32583.n
          ProjPrincipRec.SETRANGE(Principal, Principal);
          ProjPrincFrm.SetAddPrincipalFromExtContract(Principal);  //*32583.n
          ProjPrincFrm.SETTABLEVIEW(ProjPrincipRec);
          //ProjPrincFrm.SETRECORD(ProjPrincipRec);  //old   not needed, fields empty
          ProjPrincFrm.LOOKUPMODE(TRUE);
          ProjPrincFrm.RUNMODAL;
        END;
        IF NOT ProjPrincipRec.GET("Project No.", Principal) THEN
          IF PAGE.RUNMODAL(PAGE::"Project Principal List",ProjPrincipRec) = ACTION::LookupOK THEN
            Principal := ProjPrincipRec.Principal
          ELSE
            Principal := xRec.Principal;
      END;
    END;

    PROCEDURE CalculateAllowed@6(VAR AllowedAmount@11012000 : Decimal;VAR AllowedHours@11012001 : Decimal;VAR PrevAllowedAmount@11012002 : Decimal;VAR PrevAllowedHours@11012003 : Decimal);
    VAR
      CostObjCostContrRec@11012004 : Record 11020223;
      FiltGroup@11012005 : Integer;
      lAllowAmnt@11012006 : Decimal;
      lAllowedHours@11012007 : Decimal;
      lPrecAllowAmnt@11012008 : Decimal;
      lPrevAllowHours@11012009 : Decimal;
    BEGIN
      AllowedAmount := 0;
      AllowedHours := 0;
      PrevAllowedAmount := 0;
      PrevAllowedHours := 0;

      CostObjCostContrRec.RESET;
      CostObjCostContrRec.SETRANGE("Project No.","Project No.");
      CostObjCostContrRec.SETRANGE("Extension Contract", "Contract No.");
      FOR FiltGroup := 0 TO 4 DO BEGIN
        FILTERGROUP(FiltGroup);
        CostObjCostContrRec.FILTERGROUP(FiltGroup);
        CostObjCostContrRec.SETFILTER("Progress Filter",GETFILTER("Progress Filter"));
        CostObjCostContrRec.SETFILTER("Period Filter",GETFILTER("Period Filter"));
        CostObjCostContrRec.SETFILTER("Cumulation Filter",GETFILTER("Cumulation Filter"));
        CostObjCostContrRec.SETFILTER(PrevProgressFilter,GETFILTER(PrevProgressFilter));
      END;
      FILTERGROUP(0);
      CostObjCostContrRec.FILTERGROUP(0);

      IF CostObjCostContrRec.FIND('-') THEN
        REPEAT
          CostObjCostContrRec.CalculateAllowed(lAllowAmnt,lAllowedHours,lPrecAllowAmnt,lPrevAllowHours);
          AllowedAmount += lAllowAmnt;
          AllowedHours += lAllowedHours;
          PrevAllowedAmount += lPrecAllowAmnt;
          PrevAllowedHours += lPrevAllowHours;
        UNTIL CostObjCostContrRec.NEXT = 0;
    END;

    PROCEDURE AddPrincipalToTenderParagraphs@1100485000();
    VAR
      TenderParagraphByPrincipal@1100485000 : Record 11012470;
      TenderParagraphByPrincipal2@1100485001 : Record 11012470;
    BEGIN
      //because Principal is part of the key, this can take a long time!
      TenderParagraphByPrincipal.SETFILTER("Project No.","Project No.");
      TenderParagraphByPrincipal.SETFILTER("Contract No.","Contract No.");
      TenderParagraphByPrincipal.SETFILTER(Principal,'<>%1',Principal);
      IF TenderParagraphByPrincipal.FINDSET(TRUE,TRUE) THEN
        REPEAT
          TenderParagraphByPrincipal2 := TenderParagraphByPrincipal;
          TenderParagraphByPrincipal2.RENAME(
            "Project No.",Principal,"Contract No.",TenderParagraphByPrincipal."Tender Paragraph OLD",TenderParagraphByPrincipal."No.");
        UNTIL TenderParagraphByPrincipal.NEXT = 0;
    END;

    PROCEDURE CheckProjStatus@1100485001();
    BEGIN
      JobSetUp.GET;
      IF ProjRec.GET("Project No.") THEN
        IF (JobSetUp."Provisions at Closure") THEN
          ProjRec.CheckProjectStatus(-1)
        ELSE
          ProjRec.CheckProjectStatus(0);
    END;

    PROCEDURE SetDeleteCompleteProject@1210190000();
    BEGIN
      //kkleermaker, 110923, M19415
      DeleteCompleteProject := TRUE;
    END;

    PROCEDURE UpdateBudgetVersionDate@1210190001();
    BEGIN
      BudgetRec.RESET;
      BudgetRec.SETRANGE("Project No.","Project No.");
      BudgetRec.SETRANGE(Adjustment,'');
      BudgetRec.SETRANGE(Option,'');
      BudgetRec.SETRANGE("Extension Contract","Contract No.");
      BudgetRec.SETFILTER("Version Date",'<> %1',"Version Date");
      IF BudgetRec.FINDSET(TRUE, FALSE) THEN
        REPEAT
          BudgetRec."Version Date" := "Version Date";
          BudgetRec.MODIFY;
        UNTIL BudgetRec.NEXT = 0;

      BudgetSummarysheetRec.RESET;
      BudgetSummarysheetRec.SETRANGE("Project No.","Project No.");
      BudgetSummarysheetRec.SETRANGE(Option,'');
      BudgetSummarysheetRec.SETRANGE("Contract No.","Contract No.");
      BudgetSummarysheetRec.SETFILTER("Version Date",'<> %1',"Version Date");
      BudgetSummarysheetRec.MODIFYALL("Version Date","Version Date",TRUE);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentFilter@1100000993() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(0);
    END;

    PROCEDURE DPA_GetFiltersFltrGrp@1100000997(FilterGroupNo@1100525000 : Integer) FilterText : Text[250];
    BEGIN
      //**4PS Generated Code - Do Not Change
      FILTERGROUP(FilterGroupNo);
      FilterText := COPYSTR(GETFILTERS, 1, MAXSTRLEN(FilterText));
      FILTERGROUP(0);
    END;

    PROCEDURE DPA_SetFilters@1100000998(Context@1100525000 : Text[30]) : Boolean;
    VAR
      RecRef@1100525003 : RecordRef;
      i@1100525004 : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      RecRef.GETTABLE(Rec);
      DPA_Management.SetDPAFilterFromContext(
        RecRef,
        Context,
        DPA_GetFieldNoDepartmentCode,
        DPA_GetFieldNoDepartmentFilter );

      FOR i := 10 DOWNTO 0 DO BEGIN
        RecRef.FILTERGROUP(i);
        FILTERGROUP(i);
        SETVIEW(RecRef.GETVIEW(FALSE));
      END;

      EXIT(DPA_Management.IsHardFilter);
    END;

    LOCAL PROCEDURE DPA_IsActive@1100000999() : Boolean;
    VAR
      DepartmentAuthorizObject@1100526000 : Record 11012466;
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DepartmentAuthorizObject.READPERMISSION THEN
        EXIT(FALSE);

      IF NOT DPA_Management.AuthorizationActive THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE DPA_FindRecWithDPAFilterAppld@1100000989();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN BEGIN
        FIND;
        EXIT;
      END;

      IF NOT DPA_Management.HasTableHardFilter(11012004) THEN BEGIN
        FIND;
        EXIT;
      END;

      DPA_SetFilters('Table 11012004');
      IF NOT FIND THEN
        DPA_Management.RaiseDPAErrorForTable(TABLECAPTION);
    END;

    PROCEDURE DPA_ChkDepartmentCodeAllowed@1100000990(IsHardFilter@1100526000 : Boolean);
    VAR
      DimensionManagement@1100526001 : Codeunit 408;
    BEGIN
      //**4PS Generated Code - Do Not Change
      DimensionManagement.CheckDepartmAuthWithFilterType(
        DATABASE::"Extension Contract", "Department Code", IsHardFilter);
    END;

    PROCEDURE DPA_GetFieldNoDepartmentCode@1100000994() : Integer;
    BEGIN
      //**4PS Generated Code - Do Not Change
      EXIT(FIELDNO("Department Code"));
    END;

    PROCEDURE DPA_SetDefaultDepartment@1100000996();
    BEGIN
      //**4PS Generated Code - Do Not Change
      IF NOT DPA_IsActive THEN
        EXIT;

      DPA_Management.SetDepartmentCodeUser(TABLENAME, "Department Code");
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      Job@1210190005 : Record 11072003;
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      IF Job.GET("Project No.") THEN BEGIN
        RecRef.GETTABLE(Job);
        DocumentLinkRIDs[2] := RecRef.RECORDID;
      END;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::"Extension Contract"), DocumentLinkRIDs,
        "Department Code", ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE ShowEstimate@1210190012();
    VAR
      EstRec@1210190001 : Record 11012151;
    BEGIN
      //DP00260
      GetEstimate;
      IF TmpEst.FINDSET THEN BEGIN
        REPEAT
          IF EstRec.GET(TmpEst."No.") THEN
            EstRec.MARK(TRUE);
        UNTIL TmpEst.NEXT = 0
      END;
      EstRec.MARKEDONLY(TRUE);

      PAGE.RUN(0, EstRec);
    END;

    PROCEDURE GetEstimate@1210190010() : Code[20];
    VAR
      EstSetup@1100528000 : Record 11012150;
      EstRec@1210190000 : Record 11012151;
      SubEstRec@1210190001 : Record 11072074;
      EstPartRec@1210190002 : Record 11072073;
      NumEst@1210190004 : Integer;
    BEGIN
      //DP00260
      NumEst := 0;
      IF ("Project No." = '') OR ("Contract No." = '') THEN EXIT('');  //C026176

      IF EstRec.READPERMISSION THEN BEGIN
        EstSetup.GET;  //db, 31-03-15: C020148
        TmpEst.RESET;
        TmpEst.DELETEALL;
        //
        EstRec.SETCURRENTKEY("Project No.");
        EstRec.SETRANGE("Project No.", "Project No.");
        EstRec.SETRANGE("Extension Contract", "Contract No.");
        IF EstRec.FINDSET THEN BEGIN
          REPEAT
            IF NOT TmpEst.GET(EstRec."No.") THEN BEGIN
              TmpEst."No." := EstRec."No.";
              TmpEst.INSERT;
            END;
          UNTIL EstRec.NEXT = 0;
        END;
        //
        IF EstSetup.Converted THEN BEGIN
          SubEstRec.SETCURRENTKEY("Project No.");
          SubEstRec.SETRANGE("Project No.", "Project No.");
          SubEstRec.SETRANGE("Extension Contract", "Contract No.");
          IF SubEstRec.FINDSET THEN BEGIN
            REPEAT
              IF NOT TmpEst.GET(SubEstRec."Estimate No.") THEN BEGIN
                TmpEst."No." := SubEstRec."Estimate No.";
                TmpEst.INSERT;
              END;
            UNTIL SubEstRec.NEXT = 0;
          END;
          //db, 06-11-15: project present in part without (sub)estimate is negligible
          //EstPartRec.SETCURRENTKEY("Project No.");
          //EstPartRec.SETRANGE("Project No.", "Project No.");
          //EstPartRec.SETRANGE("Extension Contract", "Contract No.");
          //IF EstPartRec.FINDSET THEN BEGIN
          //  REPEAT
          //    IF NOT TmpEst.GET(EstPartRec."Estimate No.") THEN BEGIN
          //      TmpEst."No." := EstPartRec."Estimate No.";
          //      TmpEst.INSERT;
          //    END;
          //  UNTIL EstPartRec.NEXT = 0;
          //END;
        END ELSE BEGIN
          //extension contract not enable for Old Estimate module
        END;
        IF TmpEst.FINDFIRST THEN
          NumEst := TmpEst.COUNT;
      END;

      IF NumEst = 0 THEN
        EXIT('');

      IF NumEst = 1 THEN
        EXIT(TmpEst."No.");

      IF NumEst > 1 THEN
        EXIT(STRSUBSTNO('[%1]', NumEst));
    END;

    PROCEDURE ShowSubEstimate@1100525002();
    VAR
      SubEstRec@1210190001 : Record 11072074;
    BEGIN
      //DP00260
      GetSubEstimate;
      IF TmpSubEst.FINDSET THEN BEGIN
        REPEAT
          IF SubEstRec.GET(TmpSubEst."Estimate No.", TmpSubEst."Sub-Estimate No.") THEN
            SubEstRec.MARK(TRUE);
        UNTIL TmpSubEst.NEXT = 0
      END;
      SubEstRec.MARKEDONLY(TRUE);

      PAGE.RUN(0, SubEstRec);
    END;

    PROCEDURE GetSubEstimate@1100525000() : Code[20];
    VAR
      EstSetup@1100528000 : Record 11012150;
      EstRec@1100525000 : Record 11012151;
      SubEstRec@1210190001 : Record 11072074;
      EstPartRec@1210190002 : Record 11072073;
      NumSubEst@1210190004 : Integer;
    BEGIN
      //DP00260
      NumSubEst := 0;
      IF ("Project No." = '') OR ("Contract No." = '') THEN EXIT('');  //C026176

      IF EstRec.READPERMISSION THEN BEGIN
        EstSetup.GET;  //db, 31-03-15: C020148
        TmpSubEst.RESET;
        TmpSubEst.DELETEALL;
        //
        IF EstSetup.Converted THEN BEGIN
          SubEstRec.SETCURRENTKEY("Project No.");
          SubEstRec.SETRANGE("Project No.", "Project No.");
          SubEstRec.SETRANGE("Extension Contract", "Contract No.");
          IF SubEstRec.FINDSET THEN BEGIN
            REPEAT
              IF NOT TmpSubEst.GET(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.") THEN BEGIN
                TmpSubEst."Estimate No." := SubEstRec."Estimate No.";
                TmpSubEst."Sub-Estimate No." := SubEstRec."Sub-Estimate No.";
                TmpSubEst.INSERT;
              END;
            UNTIL SubEstRec.NEXT = 0;
          END;
          //
          EstPartRec.SETCURRENTKEY("Project No.");
          EstPartRec.SETRANGE("Project No.", "Project No.");
          EstPartRec.SETRANGE("Extension Contract", "Contract No.");
          IF EstPartRec.FINDSET THEN BEGIN
            REPEAT
              IF NOT TmpSubEst.GET(EstPartRec."Estimate No.", EstPartRec."Sub-Estimate No.") THEN BEGIN
                TmpSubEst."Estimate No." := EstPartRec."Estimate No.";
                TmpSubEst."Sub-Estimate No." := EstPartRec."Sub-Estimate No.";
                TmpSubEst.INSERT;
              END;
            UNTIL EstPartRec.NEXT = 0;
          END;
        END ELSE BEGIN
          //extension contract not enable for Old Estimate module
        END;
        IF TmpSubEst.FINDFIRST THEN
          NumSubEst := TmpSubEst.COUNT;
      END;

      IF NumSubEst = 0 THEN
        EXIT('');

      IF NumSubEst = 1 THEN
        EXIT(TmpSubEst."Sub-Estimate No.");

      IF NumSubEst > 1 THEN
        EXIT(STRSUBSTNO('[%1]', NumSubEst));
    END;

    LOCAL PROCEDURE CheckSwitchSummary@1100525001();
    VAR
      SummarySheetLine@1100525000 : Record 11012064;
    BEGIN
      //DP00901
      ProjRec.GET("Project No.");
      IF ProjRec."Summary Sheet Contract 2" = '' THEN
        EXIT;
      IF ((Status = Status::Order) OR (Status = Status::"Invoicing Allowed")) AND
         ((xRec.Status = Status::Applied) OR (xRec.Status = Status::Offered)) THEN BEGIN
        IF ProjRec."Summary Sheet Contract 2" <> '' THEN BEGIN
          IF NOT CONFIRM(Text099, FALSE, ProjRec."Summary Sheet Contract", ProjRec."Summary Sheet Contract 2") THEN
            EXIT;
          SummarySheetLine.SETRANGE("Project No.", "Project No.");
          SummarySheetLine.SETRANGE("Contract No.", "Contract No.");
          SummarySheetLine.SETFILTER("Plot No.", '%1', '');
          SummarySheetLine.SETFILTER(Option, '%1', '');
          SummarySheetLine.DELETEALL;
          SummarySheetLine.CopyTemplate2(ProjRec."Summary Sheet Contract 2", "Project No.", "Contract No.", '', '', '', '', '', '');
          IF SummarySheetLine.FIND('-') THEN BEGIN
            SummarySheetLine.ReCalcSummaryLines('');
            SummarySheetLine.UpdateBudgetLines(TRUE, '');
          END;
        END;
      END;
      IF ((Status = Status::Applied) OR (Status = Status::Offered)) AND
         ((xRec.Status = Status::Order) OR (xRec.Status = Status::"Invoicing Allowed")) THEN BEGIN
        IF (ProjRec."Summary Sheet Contract" <> '') THEN BEGIN
          IF NOT CONFIRM(Text099, FALSE, ProjRec."Summary Sheet Contract 2", ProjRec."Summary Sheet Contract") THEN
            EXIT;
          SummarySheetLine.SETRANGE("Project No.", "Project No.");
          SummarySheetLine.SETRANGE("Contract No.", "Contract No.");
          SummarySheetLine.SETFILTER("Plot No.", '%1', '');
          SummarySheetLine.SETFILTER(Option, '%1', '');
          SummarySheetLine.DELETEALL;
          SummarySheetLine.CopyTemplate2(ProjRec."Summary Sheet Contract", "Project No.", "Contract No.", '', '', '', '', '', '');
          IF SummarySheetLine.FIND('-') THEN BEGIN
            SummarySheetLine.ReCalcSummaryLines('');
            SummarySheetLine.UpdateBudgetLines(TRUE, '');
          END;
        END;
      END;
    END;

    PROCEDURE SetSkipValidateFCY@1100528603(ISkipValidateFCY@1100528600 : Boolean);
    BEGIN
      //DP00886
      SkipValidateFCY := ISkipValidateFCY;
    END;

    LOCAL PROCEDURE GetCurrencyDate@1100525006() CurrencyDate : Date;
    BEGIN
      //DP00886
      CurrencyDate := "Contract Date";
      IF (CurrencyDate = 0D) THEN
        CurrencyDate := TODAY;
      EXIT(CurrencyDate);
    END;

    BEGIN
    {
      SESB.I022 Final Instalment
         KD 17.07.2013 Field 11128230 "Method Last Instalment" added
         KD 17.07.2013 Field 11128231 "Withheld Perc. Final Instalm." added
         KD 17.07.2013 Field 11128232 "Withheld Perc. Contract Amount" added

      #SYMB1#
      130610 JOSVSTO Call CU to export ŽTA-project OnModify.

      130917 ITERO.DJ Added new Field, Export to Symbrio as Boolean, and set to TRUE OnInsert

      140131 ITERO.MH 4PSHM New field "Time Last Modified" and with triggers on onInsert() and onModify()
      140213 ITERO.LP IME104 Adjustment when exporting to Symbrio.
      140630 ITERO.DL IME156 Symbrio NAS taking 5 minutes to process
      140815 ITERO.DL IME155 exclude "Component Type"::'expense hours' from "Open Amount (Hours)", "Open Ovh. Surch. (Hours)", "Open Hours"
      141229 ITERO.WG SYM045 Added check on Contract No does not exceed 4 karakters
      150108 ITERO.WG SYM045 Added check if Contract No only has numbers
      150204 ITERO.MH SYM036 Added project status criteria of extension contract export
      150218 ITERO.MH SYM036 Changed criteria for export to Symbrio - added deletion entry
      151218 ITERO.PR OnInsert, Status from Job Setup
      151112 ITERO.DL RFC014-2 timingerrors, use JobStatus at modified-time instead of current
      160314 ITERO.SB RAD-201 New fields, "Extension Category" and "Internal Reference"
    }
    END.
  }
}

