OBJECT Table 11012050 Control Proj/Elem/Cost Object
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    OnInsert=VAR
               ProjectRec@1100485000 : Record 11072003;
             BEGIN
               ProjectRec.GET("Project No.");                             //**4PS02.n
               "Main Project No." := ProjectRec."Main Project";           //**4PS02.n
             END;

    CaptionML=ENU=Cost Control Project/Element/Cost Object;
  }
  FIELDS
  {
    { 10  ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   CaptionML=ENU=Project No. }
    { 15  ;   ;Element             ;Code20        ;TableRelation="Project Element".Element WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=ENU=Element }
    { 16  ;   ;Level               ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Level WHERE (Project No.=FIELD(Project No.),
                                                                                                     Element=FIELD(Element)));
                                                   CaptionML=ENU=Level;
                                                   Editable=No }
    { 17  ;   ;Chapter             ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Chapter WHERE (Project No.=FIELD(Project No.),
                                                                                                       Element=FIELD(Element)));
                                                   CaptionML=ENU=Chapter;
                                                   Editable=No }
    { 18  ;   ;Paragraph           ;Code20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project Element".Paragraph WHERE (Project No.=FIELD(Project No.),
                                                                                                         Element=FIELD(Element)));
                                                   CaptionML=ENU=Paragraph;
                                                   Editable=No }
    { 20  ;   ;Cost Object         ;Code20        ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2),
                                                                                               Project Filter=FIELD(Project No.));
                                                   CaptionML=ENU=Cost Object }
    { 30  ;   ;Description         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Code=FIELD(Cost Object),
                                                                                                    Global Dimension No.=CONST(2)));
                                                   CaptionML=ENU=Description;
                                                   Editable=No }
    { 40  ;   ;Original Budget Amount;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Type=FIELD(Cost Type),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Adjustment=FILTER(''),
                                                                                               Extension Contract=FILTER(''),
                                                                                               Option=FILTER(''),
                                                                                               Version Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Original Budget Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 45  ;   ;Original Budget Hours;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                              Project No.=FIELD(Project Filter),
                                                                                              Element=FIELD(Element),
                                                                                              Cost Type=FIELD(Cost Type),
                                                                                              Cost Object=FIELD(Cost Object),
                                                                                              Adjustment=FILTER(''),
                                                                                              Extension Contract=FILTER(''),
                                                                                              Option=FILTER(''),
                                                                                              Version Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Original Budget Hours;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 50  ;   ;Adjustments         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Type=FIELD(Cost Type),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Adjustment=FILTER(<>''),
                                                                                               Version Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Adjustments;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 55  ;   ;Adjustments Hours   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                              Project No.=FIELD(Project Filter),
                                                                                              Element=FIELD(Element),
                                                                                              Cost Type=FIELD(Cost Type),
                                                                                              Cost Object=FIELD(Cost Object),
                                                                                              Adjustment=FILTER(<>''),
                                                                                              Version Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Adjustments Hours;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 60  ;   ;Extension           ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Type=FIELD(Cost Type),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Extension Contract=FILTER(<>''),
                                                                                               Adjustment=FILTER(''),
                                                                                               Version Date=FIELD(Cumulation Filter),
                                                                                               Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Extension;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 65  ;   ;Extension Hours     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                              Project No.=FIELD(Project Filter),
                                                                                              Element=FIELD(Element),
                                                                                              Cost Type=FIELD(Cost Type),
                                                                                              Cost Object=FIELD(Cost Object),
                                                                                              Extension Contract=FILTER(<>''),
                                                                                              Adjustment=FILTER(''),
                                                                                              Version Date=FIELD(Cumulation Filter),
                                                                                              Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Extension Hours;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 70  ;   ;Options             ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Type=FIELD(Cost Type),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Option=FILTER(<>''),
                                                                                               Adjustment=FILTER(''),
                                                                                               Version Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Options;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 80  ;   ;Budget              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Type=FIELD(Cost Type),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Version Date=FIELD(Cumulation Filter),
                                                                                               Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Budget;
                                                   Editable=No }
    { 81  ;   ;Budget Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Hours WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                              Project No.=FIELD(Project Filter),
                                                                                              Element=FIELD(Element),
                                                                                              Cost Type=FIELD(Cost Type),
                                                                                              Cost Object=FIELD(Cost Object),
                                                                                              Version Date=FIELD(Cumulation Filter),
                                                                                              Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Budget Hours;
                                                   Editable=No }
    { 85  ;   ;Budget Surcharge Amount;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line"."Surcharge Amnt from Summary" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                      Project No.=FIELD(Project Filter),
                                                                                                                      Element=FIELD(Element),
                                                                                                                      Cost Type=FIELD(Cost Type),
                                                                                                                      Cost Object=FIELD(Cost Object),
                                                                                                                      Version Date=FIELD(Cumulation Filter),
                                                                                                                      Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Budget Surcharge Amount;
                                                   Editable=No }
    { 90  ;   ;Actual Costs        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry"."Total Cost (LCY)" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                Job No.=FIELD(Project Filter),
                                                                                                                Element=FIELD(Element),
                                                                                                                Global Dimension 2 Code=FIELD(Cost Object),
                                                                                                                Posting Date=FIELD(Cumulation Filter),
                                                                                                                Purchase Action=FIELD(Purchase Action Filter)));
                                                   CaptionML=ENU=Actual Costs;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 91  ;   ;Actual Hours        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry".Quantity WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                      Job No.=FIELD(Project Filter),
                                                                                                      Element=FIELD(Element),
                                                                                                      Cost Type=CONST(Labor),
                                                                                                      Global Dimension 2 Code=FIELD(Cost Object),
                                                                                                      Posting Date=FIELD(Cumulation Filter),
                                                                                                      Entry Type=CONST(Usage)));
                                                   CaptionML=ENU=Actual Hours;
                                                   Editable=No }
    { 120 ;   ;Allowed Costs       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Progress Line"."Allowed Amount" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                           Project No.=FIELD(Project Filter),
                                                                                                           Element=FIELD(Element),
                                                                                                           Cost Object=FIELD(Cost Object),
                                                                                                           Progress Date=FIELD(Progress Filter)));
                                                   CaptionML=ENU=Allowed Costs;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;Allowed Hours       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Progress Line"."Allowed Hours" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                          Project No.=FIELD(Project Filter),
                                                                                                          Element=FIELD(Element),
                                                                                                          Cost Object=FIELD(Cost Object),
                                                                                                          Progress Date=FIELD(Progress Filter)));
                                                   CaptionML=ENU=Allowed Hours;
                                                   Editable=No }
    { 140 ;   ;Project Description ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job.Description WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=ENU=Project Description;
                                                   Editable=No }
    { 150 ;   ;Present in Budget   ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Budget Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                          Project No.=FIELD(Project Filter),
                                                                                          Element=FIELD(Element),
                                                                                          Cost Object=FIELD(Cost Object),
                                                                                          Extension Contract Status=FILTER(Not Applicable|(>=Order&<Expired))));
                                                   CaptionML=ENU=Present in Budget;
                                                   Editable=No }
    { 160 ;   ;Present in Project Ledger;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Job Ledger Entry" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Job No.=FIELD(Project Filter),
                                                                                               Element=FIELD(Element),
                                                                                               Global Dimension 2 Code=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Project Ledger;
                                                   Editable=No }
    { 162 ;   ;Present in Item Surcharges;Boolean ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Item Journal Surcharge" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                     Job No.=FIELD(Project Filter),
                                                                                                     Element=FIELD(Element),
                                                                                                     Shortcut Dimension 2 Code=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Item Surcharges;
                                                   Editable=No }
    { 164 ;   ;Present in Prognosis Lines;Boolean ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Prognosis Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                             Project No.=FIELD(Project Filter),
                                                                                             Element=FIELD(Element),
                                                                                             Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Prognosis Lines;
                                                   Editable=No }
    { 165 ;   ;Present in Purchase Lines;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Purchase Order Control Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                          Project No.=FIELD(Project Filter),
                                                                                                          Element=FIELD(Element),
                                                                                                          Shortcut Dimension 2 Code=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Purchase Lines;
                                                   Editable=No }
    { 166 ;   ;Present in Item Jnl Lines;Boolean  ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Item Journal Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                Job No.=FIELD(Project Filter),
                                                                                                Element=FIELD(Element),
                                                                                                Shortcut Dimension 2 Code=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Item Jnl Lines;
                                                   Editable=No }
    { 167 ;   ;Present in Hour Lines;Boolean      ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Hour Accounting Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                   Project No.=FIELD(Project Filter),
                                                                                                   Element=FIELD(Element),
                                                                                                   Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Hour Lines;
                                                   Editable=No }
    { 168 ;   ;Present in Hour Surcharges;Boolean ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Hour Accounting Surcharge" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                        Project No.=FIELD(Project Filter),
                                                                                                        Element=FIELD(Element),
                                                                                                        Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Hour Surcharges;
                                                   Editable=No }
    { 169 ;   ;Present in Purchase Surcharges;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("Purchase Order Control Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                          Project No.=FIELD(Project Filter),
                                                                                                          Element=FIELD(Element),
                                                                                                          Shortcut Dimension 2 Code=FIELD(Cost Object)));
                                                   CaptionML=ENU=Present in Purchase Surcharges;
                                                   Editable=No }
    { 170 ;   ;Cost Type           ;Option        ;FieldClass=Normal;
                                                   CaptionML=ENU=Cost Type;
                                                   OptionCaptionML=ENU=Labor,Material,Subcontracting,Plant,Sundry;
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry;
                                                   Editable=No }
    { 180 ;   ;Adjustment Filter   ;Code10        ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Adjustment Filter }
    { 190 ;   ;Extension Filter    ;Code10        ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Extension Filter }
    { 200 ;   ;Original Filter     ;Code10        ;CaptionML=ENU=Original Filter }
    { 210 ;   ;Period Filter       ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Period Filter }
    { 220 ;   ;Cumulation Filter   ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Cumulation Filter }
    { 230 ;   ;Progress Filter     ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Progress Date }
    { 235 ;   ;PrevProgressFilter  ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Previous Progress Date }
    { 240 ;   ;Actuals Period      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry"."Total Cost (LCY)" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                Job No.=FIELD(Project Filter),
                                                                                                                Element=FIELD(Element),
                                                                                                                Global Dimension 2 Code=FIELD(Cost Object),
                                                                                                                Posting Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Actuals Period;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Actual Hours Period ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Job Ledger Entry".Quantity WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                      Job No.=FIELD(Project Filter),
                                                                                                      Element=FIELD(Element),
                                                                                                      Cost Type=CONST(Labor),
                                                                                                      Global Dimension 2 Code=FIELD(Cost Object),
                                                                                                      Posting Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Actual Hours Period;
                                                   Editable=No }
    { 260 ;   ;Allowed Previous Period;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Progress Line"."Allowed Amount" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                           Project No.=FIELD(Project Filter),
                                                                                                           Element=FIELD(Element),
                                                                                                           Cost Object=FIELD(Cost Object),
                                                                                                           Progress Date=FIELD(PrevProgressFilter)));
                                                   CaptionML=ENU=Allowed Previous Period;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Allowed Hours Previous Period;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Progress Line"."Allowed Hours" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                          Project No.=FIELD(Project Filter),
                                                                                                          Element=FIELD(Element),
                                                                                                          Cost Object=FIELD(Cost Object),
                                                                                                          Progress Date=FIELD(PrevProgressFilter)));
                                                   CaptionML=ENU=Allowed Hours Previous Period;
                                                   Editable=No }
    { 300 ;   ;Purchase Budget     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Budget Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                               Project No.=FIELD(Project Filter),
                                                                                               Purchase Action Status=FILTER(>=Approved),
                                                                                               Element=FIELD(Element),
                                                                                               Cost Object=FIELD(Cost Object),
                                                                                               Purch. Action Approval Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Purchase Budget;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 310 ;   ;Open (Purchase)     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Outstanding Amount" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                             Project No.=FIELD(Project Filter),
                                                                                                                             Element=FIELD(Element),
                                                                                                                             Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                             Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 311 ;   ;Open Ovh. Surch. Soft (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Soft" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                  Project No.=FIELD(Project Filter),
                                                                                                                                  Element=FIELD(Element),
                                                                                                                                  Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. Soft Commitments (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 315 ;   ;Received/Not Invoiced;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Amt. Rcd. Not Invoiced" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                 Project No.=FIELD(Project Filter),
                                                                                                                                 Element=FIELD(Element),
                                                                                                                                 Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                                 Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Received/Not Invoiced;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 317 ;   ;Open Ovh. Surch. Firm (Purch.);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Overhead Surcharge Firm" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                  Project No.=FIELD(Project Filter),
                                                                                                                                  Element=FIELD(Element),
                                                                                                                                  Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. Firm Commitments (Purchase);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 319 ;   ;Open Ovh. Surch. (Hours);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Surcharge"."Overhead Surcharge Project" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                   Project No.=FIELD(Project Filter),
                                                                                                                                   Element=FIELD(Element),
                                                                                                                                   Cost Object=FIELD(Cost Object),
                                                                                                                                   Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. (Hours);
                                                   Editable=No }
    { 320 ;   ;Risc Coverage       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Risc Coverage Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                                       Main Project No.=FIELD(Main Project No.),
                                                                                                                       Job No.=FIELD(Project Filter),
                                                                                                                       Element=FIELD(Element),
                                                                                                                       Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                       Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Risc Coverage;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 330 ;   ;Risc Coverage Withdraw;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Release Risc Coverage (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                                        Main Project No.=FIELD(Main Project No.),
                                                                                                                        Job No.=FIELD(Project Filter),
                                                                                                                        Element=FIELD(Element),
                                                                                                                        Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                        Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Risc Coverage Withdraw;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 331 ;   ;Open (Inventory)    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Line".Amount WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                     Job No.=FIELD(Project Filter),
                                                                                                     Element=FIELD(Element),
                                                                                                     Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                     Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open (Inventory);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 333 ;   ;Open Ovh. Surch. (Inventory);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Journal Surcharge"."Overhead Surcharge Project" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                Job No.=FIELD(Project Filter),
                                                                                                                                Element=FIELD(Element),
                                                                                                                                Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                                Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Ovh. Surch. (Inventory);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 340 ;   ;Cost Component      ;Code10        ;TableRelation="Cost Component".Code;
                                                   CaptionML=ENU=Cost Component }
    { 350 ;   ;Component Description;Text30       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Cost Component".Description WHERE (Code=FIELD(Cost Component)));
                                                   CaptionML=ENU=Component Description;
                                                   Editable=No }
    { 360 ;   ;Purchase            ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                         Main Project No.=FIELD(Main Project No.),
                                                                                                         Job No.=FIELD(Project Filter),
                                                                                                         Element=FIELD(Element),
                                                                                                         Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                         Order Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Purchase;
                                                   Editable=No }
    { 370 ;   ;Purchase Period     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Line"."Amount (LCY)" WHERE (Document Type=CONST(Order),
                                                                                                         Main Project No.=FIELD(Main Project No.),
                                                                                                         Job No.=FIELD(Project Filter),
                                                                                                         Element=FIELD(Element),
                                                                                                         Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                         Order Date=FIELD(Period Filter)));
                                                   CaptionML=ENU=Purchase Period;
                                                   Editable=No }
    { 400 ;   ;Prognosis           ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                    Project No.=FIELD(Project Filter),
                                                                                                                    Element=FIELD(Element),
                                                                                                                    Cost Object=FIELD(Cost Object),
                                                                                                                    Prognosis Date=FIELD(Prognosis Filter)));
                                                   CaptionML=ENU=Prognosis;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 401 ;   ;Hours Prognosis     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line".Quantity WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                    Project No.=FIELD(Project Filter),
                                                                                                    Element=FIELD(Element),
                                                                                                    Cost Object=FIELD(Cost Object),
                                                                                                    Prognosis Date=FIELD(Prognosis Filter),
                                                                                                    Cost Type=CONST(Labor)));
                                                   CaptionML=ENU=Hours Prognosis;
                                                   Editable=No }
    { 403 ;   ;Prognosis Total Cost;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Prognosis Total Cost" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                  Project No.=FIELD(Project Filter),
                                                                                                                  Element=FIELD(Element),
                                                                                                                  Cost Object=FIELD(Cost Object),
                                                                                                                  Prognosis Date=FIELD(Prognosis Filter)));
                                                   CaptionML=ENU=Prognosis Total Cost;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 405 ;   ;Risc Coverage (Prognosis);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Risc Coverage" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                           Project No.=FIELD(Project Filter),
                                                                                                           Element=FIELD(Element),
                                                                                                           Cost Object=FIELD(Cost Object),
                                                                                                           Prognosis Date=FIELD(Prognosis Filter)));
                                                   CaptionML=ENU=Risc Coverage (Prognosis);
                                                   Editable=No }
    { 410 ;   ;Prognosis Previous Period;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line"."Amount incl. Surcharge" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                    Project No.=FIELD(Project Filter),
                                                                                                                    Element=FIELD(Element),
                                                                                                                    Cost Object=FIELD(Cost Object),
                                                                                                                    Prognosis Date=FIELD(PrevPrognosisFilter)));
                                                   CaptionML=ENU=Prognosis Previous Period;
                                                   Editable=No }
    { 411 ;   ;Prognosis Hours Prev Period;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Prognosis Line".Quantity WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                    Project No.=FIELD(Project Filter),
                                                                                                    Element=FIELD(Element),
                                                                                                    Cost Object=FIELD(Cost Object),
                                                                                                    Prognosis Date=FIELD(PrevPrognosisFilter)));
                                                   CaptionML=ENU=Prognosis Hours Prev Period;
                                                   Editable=No }
    { 420 ;   ;Prognosis Filter    ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Prognosis Filter }
    { 430 ;   ;PrevPrognosisFilter ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=PrevPrognosisFilter }
    { 440 ;   ;Unit Cost Object    ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit Cost Object }
    { 450 ;   ;Project Related Name;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Project - Cost Object".Name WHERE (Project No.=FIELD(Project No.),
                                                                                                          Cost Object=FIELD(Cost Object)));
                                                   CaptionML=ENU=Project Related Name;
                                                   Description=Name Cost Object;
                                                   Editable=No }
    { 460 ;   ;Open Amount (Hours) ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Amount (LCY)" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                Project No.=FIELD(Project Filter),
                                                                                                                Element=FIELD(Element),
                                                                                                                Cost Object=FIELD(Cost Object),
                                                                                                                Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Amount (Hours);
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 470 ;   ;Open Hours          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Hour Accounting Line"."Total Line" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                              Project No.=FIELD(Project Filter),
                                                                                                              Element=FIELD(Element),
                                                                                                              Cost Object=FIELD(Cost Object),
                                                                                                              Posting Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Open Hours;
                                                   Editable=No }
    { 480 ;   ;Received/Not Inv. Hours;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Purchase Order Control Line"."Hours Rcd. Not Invoiced" WHERE (Main Project No.=FIELD(Main Project No.),
                                                                                                                                  Project No.=FIELD(Project Filter),
                                                                                                                                  Element=FIELD(Element),
                                                                                                                                  Shortcut Dimension 2 Code=FIELD(Cost Object),
                                                                                                                                  Date=FIELD(Cumulation Filter)));
                                                   CaptionML=ENU=Received/Not Inv. Hours;
                                                   Editable=No }
    { 490 ;   ;Main Project No.    ;Code20        ;TableRelation=Job;
                                                   CaptionML=ENU=Main Project No. }
    { 500 ;   ;Project Filter      ;Code20        ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Project Filter }
    { 510 ;   ;Single/Main/Sub Project;Option     ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Job."Single/Main/Sub Project" WHERE (No.=FIELD(Project No.)));
                                                   CaptionML=ENU=Single/Main/Sub Project;
                                                   OptionCaptionML=ENU=Single,Main Project,Sub Project;
                                                   OptionString=Single,Main Project,Sub Project }
    { 520 ;   ;Purchase Action Filter;Code10      ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Purchase Action Filter }
  }
  KEYS
  {
    {    ;Project No.,Element,Cost Type,Cost Object;
                                                   Clustered=Yes }
    {    ;Project No.,Cost Component,Cost Object   }
    {    ;Project No.,Cost Type,Cost Object,Element }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      ProjSetup@1100525000 : Record 315;
      DimValRec@11012000 : Record 349;
      DimMgt@11012001 : Codeunit 408;

    PROCEDURE CalculateAllowedAndPrevious@1(VAR AllowedAmount@11012000 : Decimal;VAR AllowedHours@11012001 : Decimal;VAR PrevAllowedAmount@11012002 : Decimal;VAR PrevAllowedHours@11012003 : Decimal);
    BEGIN
      CalculateAllowed(TRUE, AllowedAmount, AllowedHours, PrevAllowedAmount, PrevAllowedHours);
    END;

    PROCEDURE CalculateAllowedOnly@1100525003(VAR AllowedAmount@1100525001 : Decimal;VAR AllowedHours@1100525000 : Decimal);
    VAR
      DummyDec@1100525002 : Decimal;
    BEGIN
      CalculateAllowed(FALSE, AllowedAmount, AllowedHours, DummyDec, DummyDec);
    END;

    PROCEDURE CalculateAllowed@1100525002(ReadPreviousAllowed@1100525009 : Boolean;VAR AllowedAmount@1100525008 : Decimal;VAR AllowedHours@1100525007 : Decimal;VAR PrevAllowedAmount@1100525006 : Decimal;VAR PrevAllowedHours@1100525005 : Decimal);
    VAR
      lvJobRec@1100525004 : Record 11072003;
      lvAllowedAmount@1100525003 : Decimal;
      lvAllowedHours@1100525002 : Decimal;
      lvPrevAllowedAmount@1100525001 : Decimal;
      lvPrevAllowedHours@1100525000 : Decimal;
    BEGIN
      AllowedAmount := 0;
      AllowedHours := 0;
      PrevAllowedAmount := 0;
      PrevAllowedHours := 0;

      DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE,  '');

      IF DimValRec."Record Progress" THEN
        IF (GETFILTER("Progress Filter") = '''''') AND (GETFILTER(PrevProgressFilter) = '''''') THEN
          EXIT;

      ProjSetup.GET;

      CalculateAllowedSingleProject(
        ReadPreviousAllowed, AllowedAmount, AllowedHours, PrevAllowedAmount, PrevAllowedHours,
        "Project No.", DimValRec."Record Progress");

      CALCFIELDS("Single/Main/Sub Project");
      IF "Single/Main/Sub Project" = Rec."Single/Main/Sub Project"::"Main Project" THEN BEGIN
        //This is a main project, also add the allowedamounts/hours of the sub projects
        lvJobRec.RESET;
        lvJobRec.SETCURRENTKEY("Main Project");
        lvJobRec.SETFILTER("Main Project", "Project No.");
        //take filter into account because in some cases we do not want to cumulate over the
        //subprojects
        lvJobRec.SETFILTER("No.", GETFILTER("Project Filter"));
        //skip the main project now
        lvJobRec.SETFILTER("Single/Main/Sub Project",'%1', Rec."Single/Main/Sub Project"::"Sub Project");
        IF lvJobRec.FINDSET(FALSE, FALSE) THEN BEGIN
          REPEAT
            CalculateAllowedSingleProject(
              ReadPreviousAllowed, lvAllowedAmount, lvAllowedHours, lvPrevAllowedAmount,
              lvPrevAllowedHours, lvJobRec."No.", DimValRec."Record Progress");
            AllowedAmount := AllowedAmount + lvAllowedAmount;
            AllowedHours := AllowedHours + lvAllowedHours;
            PrevAllowedAmount := PrevAllowedAmount + lvPrevAllowedAmount;
            PrevAllowedHours := PrevAllowedHours + lvPrevAllowedHours;
          UNTIL lvJobRec.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE CalculateAllowedSingleProject@1100485000(ReadPreviousAllowed@1100525001 : Boolean;VAR AllowedAmount@1100485003 : Decimal;VAR AllowedHours@1100485002 : Decimal;VAR PrevAllowedAmount@1100485001 : Decimal;VAR PrevAllowedHours@1100485000 : Decimal;ProjNo@1100485008 : Code[20];RecordProgress@1100485006 : Boolean);
    VAR
      CostControlRec2@1100485010 : Record 11012050;
      CostContMgt@1100485009 : Codeunit 11012006;
      FiltGroup@1100485005 : Integer;
      PreviousCumulFilter@1100485004 : Text[250];
      TotCostAmnt@1100485012 : Decimal;
      TotHours@1100485011 : Decimal;
    BEGIN
      AllowedAmount := 0;
      AllowedHours := 0;
      PrevAllowedAmount := 0;
      PrevAllowedHours := 0;

      //Check if Cost Control present on SubProject
      IF "Project No." <> ProjNo THEN BEGIN
        CostControlRec2 := Rec;
        CostControlRec2."Project No." := ProjNo;
        IF NOT CostControlRec2.FIND('=') THEN
          EXIT;
      END;
      //

      //Determine Budget
      CostControlRec2.COPY(Rec);
      CostControlRec2.SETRANGE("Project Filter", ProjNo);
      CostControlRec2.CALCFIELDS(Budget, "Budget Hours");

      IF NOT RecordProgress THEN BEGIN
        //Determine Total Cost for Cost Objects where no progress will be recorded for.
        IF CostControlRec2.Budget > 0 THEN
          TotCostAmnt := CostContMgt.TotCostElemCostObj(CostControlRec2,TRUE);
        IF CostControlRec2."Budget Hours" > 0 THEN
          TotHours := CostContMgt.TotHoursElemCostObj(CostControlRec2,TRUE);

        //Determine Allowed
        IF CostControlRec2.Budget < TotCostAmnt THEN
          AllowedAmount := CostControlRec2.Budget
        ELSE
          AllowedAmount := TotCostAmnt;

        IF CostControlRec2."Budget Hours" < TotHours THEN
          AllowedHours := CostControlRec2."Budget Hours"
        ELSE
          AllowedHours := TotHours;

      END ELSE BEGIN
        //Determine Allowed
        CostControlRec2.CALCFIELDS("Allowed Costs", "Allowed Hours");
        AllowedAmount := CostControlRec2."Allowed Costs";
        AllowedHours := CostControlRec2."Allowed Hours";

        IF ProjSetup."Progress Range" < ProjSetup."Progress Range"::"No Progress or Allowed Max." THEN
        BEGIN //Call C-019270
          //Call C-011821: Allowed may not exceed Budget
          IF AllowedAmount > CostControlRec2.Budget THEN
            AllowedAmount := CostControlRec2.Budget;
          IF AllowedHours > CostControlRec2."Budget Hours" THEN
            AllowedHours := CostControlRec2."Budget Hours";
        END;
      END;

      IF AllowedAmount < 0 THEN
        AllowedAmount := 0;
      IF AllowedHours < 0 THEN
        AllowedHours :=0;

      IF NOT ReadPreviousAllowed THEN
        EXIT;

      //Determine Previous Cumulation Filter
      PreviousCumulFilter := '';
      FOR FiltGroup := 4 DOWNTO 0 DO BEGIN
        FILTERGROUP(FiltGroup);
        IF (GETFILTER("Period Filter") <> '') THEN
          PreviousCumulFilter := '<'+FORMAT(GETRANGEMIN("Period Filter"));
      END;
      IF PreviousCumulFilter = '' THEN
        EXIT;

      //Determine previous Budget
      CostControlRec2.SETFILTER("Cumulation Filter", PreviousCumulFilter);
      CostControlRec2.CALCFIELDS(Budget, "Budget Hours");

      IF NOT RecordProgress THEN BEGIN
        //Determine Total Cost previous period for Cost Objects for which no progress will be recorded.
        IF CostControlRec2.Budget > 0 THEN
          TotCostAmnt := CostContMgt.TotCostElemCostObj(CostControlRec2,TRUE);
        IF CostControlRec2."Budget Hours" > 0 THEN
          TotHours := CostContMgt.TotHoursElemCostObj(CostControlRec2,TRUE);

        //Determine Allowed
        IF CostControlRec2.Budget < TotCostAmnt THEN
          PrevAllowedAmount := CostControlRec2.Budget
        ELSE
          PrevAllowedAmount := TotCostAmnt;

        IF CostControlRec2."Budget Hours" < TotHours THEN
          PrevAllowedHours := CostControlRec2."Budget Hours"
        ELSE
          PrevAllowedHours := TotHours;

      END ELSE BEGIN
        //Determine Allowed previous Period
        CostControlRec2.CALCFIELDS("Allowed Previous Period", "Allowed Hours Previous Period");
        PrevAllowedAmount := CostControlRec2."Allowed Previous Period";
        PrevAllowedHours := CostControlRec2."Allowed Hours Previous Period";


        IF ProjSetup."Progress Range" < ProjSetup."Progress Range"::"No Progress or Allowed Max." THEN
        BEGIN //Call C-019270
          //Call C-011821: Allowed may not exceed Budget
          IF PrevAllowedAmount > CostControlRec2.Budget THEN
            PrevAllowedAmount := CostControlRec2.Budget;
          IF PrevAllowedHours > CostControlRec2."Budget Hours" THEN
            PrevAllowedHours := CostControlRec2."Budget Hours";
        END;
      END;

      IF PrevAllowedAmount < 0 THEN
        PrevAllowedAmount := 0;
      IF PrevAllowedHours < 0 THEN
        PrevAllowedHours :=0;
    END;

    PROCEDURE CalculatePurchaseResults@1210190000(AllowedDec@1210190007 : Decimal;VAR PurchaseDec@1210190009 : Decimal;VAR EstimPurchResultDec@1210190003 : Decimal;VAR PurchCostDec@1210190002 : Decimal;VAR ActualPurchResultDec@1210190001 : Decimal;VAR TotPurchResultDec@1210190000 : Decimal);
    VAR
      lControlProjCostObjRec@1210190004 : Record 11012050;
      ProjSetup@1210190005 : Record 315;
      ProjectCostObjectRec@1100485000 : Record 11012065;
      ProjectInProcess@1210190006 : Boolean;
      ProjRec@1100485001 : Record 11072003;
    BEGIN
      //**4PS01.sn
      //customized copy of the homonymous function from table 11012047

      CALCFIELDS("Purchase Budget", Budget, "Actual Costs", Prognosis);

      ProjSetup.GET;

      lControlProjCostObjRec.COPY(Rec);
      lControlProjCostObjRec.CALCFIELDS(Purchase, "Actual Costs");

      PurchaseDec := lControlProjCostObjRec.Purchase;
      EstimPurchResultDec := "Purchase Budget" - lControlProjCostObjRec.Purchase;
      PurchCostDec := lControlProjCostObjRec."Actual Costs";

      IF "Project No." <> ProjRec."No." THEN
        ProjRec.GET("Project No.");

      IF NOT ProjectCostObjectRec.GET("Project No.","Cost Object") THEN
        ProjectCostObjectRec."Technical Finished Date"  := 0D;

      IF ProjectCostObjectRec."Technical Finished Date"  <> 0D THEN
        ProjectInProcess := ProjectCostObjectRec."Technical Finished Date" > GETRANGEMAX("Cumulation Filter")
      ELSE
        ProjectInProcess := ((ProjRec."Technical Finished Date" = 0D) OR
                             (ProjRec."Technical Finished Date" > GETRANGEMAX("Cumulation Filter")));

      IF "Cost Object" <> DimValRec.Code THEN
        DimMgt.GetDimValueRec(2, "Cost Object", DimValRec, FALSE, '');

      IF ProjSetup."Act. purchase result by action" THEN BEGIN
        //ABB
        IF (DimValRec."Record Progress" ) AND (Budget <> 0) THEN
          ActualPurchResultDec := ((Budget - "Purchase Budget") * (AllowedDec / Budget)) -
                                  ("Actual Costs" - lControlProjCostObjRec."Actual Costs")
        ELSE
          ActualPurchResultDec := (Budget - "Purchase Budget") - ("Actual Costs" - lControlProjCostObjRec."Actual Costs");
      END ELSE BEGIN
        //BVR
        IF (DimValRec."Record Progress" ) THEN
          IF Budget <> 0 THEN
            ActualPurchResultDec := AllowedDec - "Actual Costs" - ((AllowedDec / Budget) * EstimPurchResultDec)
          ELSE
            ActualPurchResultDec := AllowedDec - "Actual Costs" - EstimPurchResultDec
        ELSE BEGIN
          ActualPurchResultDec := Budget - "Actual Costs" - EstimPurchResultDec;
          IF ProjectInProcess THEN
            IF (ActualPurchResultDec > 0) THEN
              ActualPurchResultDec := 0;
        END;
      END;

      TotPurchResultDec := EstimPurchResultDec + ActualPurchResultDec - Prognosis;
      //**4PS01.en
    END;

    BEGIN
    {
      4PS02 JD, 19 feb 2007, Project Cost Control forms and reports must give overview of the costs of a mainproject as well.
    }
    END.
  }
}

