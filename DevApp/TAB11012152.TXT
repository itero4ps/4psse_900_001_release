OBJECT Table 11012152 Sub-Estimate OLD
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Sub-Estimate No.,Description;
    OnInsert=BEGIN
               ERROR(Text999);  //db, 14-03-16: old estimate expired in Nav2016
               TESTFIELD("Sub-Estimate No.");
               IF EstRec.GET("Estimate No.") THEN BEGIN
                 EstRec.TESTFIELD("Part Group");
                 "Part Group" := EstRec."Part Group";
               END;

               InitAdjustmentFactor;
               "Object No." := '';  //db, 12-12-07
               "Object Customer" := '';  //db, 31-03-07
             END;

    OnModify=BEGIN
               ERROR(Text999);  //db, 14-03-16: old estimate expired in Nav2016
               EstRec.UpdateLogbook("Estimate No.");
             END;

    OnDelete=BEGIN
               EstRec.UpdateLogbook("Estimate No.");

               CheckFormat(sp1,sp2);
               CurrLevel := Level;
               IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
               IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

               SubEstRec.RESET;
               SubEstRec.SETRANGE("Estimate No.","Estimate No.");
               IF CurrLevel = 0 THEN
                 SubEstRec.SETRANGE(Chapter,"Sub-Estimate No.");
               IF CurrLevel = 1 THEN
                 SubEstRec.SETRANGE(Paragraph,"Sub-Estimate No.");
               IF CurrLevel = 2 THEN
                 SubEstRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");

               IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN
                 REPEAT
                   //db.sn, 18-03-14: C009643
                   EstPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstPartRec.SETFILTER("Excel Estimate Template", '<>%1', '');
                   IF EstPartRec.FINDSET THEN BEGIN
                     REPEAT
                       EstPartRec.DeleteExcelFile(EstPartRec);
                     UNTIL EstPartRec.NEXT = 0;
                   END;
                   EstPartRec.SETRANGE("Excel Estimate Template");
                   //db.en, 18-03-14: C009643

                   EstPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstPartRec.DELETEALL;

                   EstLineRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstLineRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstLineRec.DELETEALL;

                   RcpLineRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   RcpLineRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   RcpLineRec.DELETEALL;

                   TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
                   TextRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   TextRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   TextRec.DELETEALL;

                   EstCodeRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstCodeRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstCodeRec.DELETEALL;

                   ChrgRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ChrgRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ChrgRec.DELETEALL;

                   QuanSheetRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   QuanSheetRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   QuanSheetRec.DELETEALL;

                   QuanModelRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   QuanModelRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   QuanModelRec.DELETEALL;

                   EstFeaturePartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstFeaturePartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstFeaturePartRec.DELETEALL;

                   ConfigPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ConfigPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ConfigPartRec.DELETEALL;

                   ConfigRowQuanRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ConfigRowQuanRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ConfigRowQuanRec.DELETEALL;
                 UNTIL SubEstRec.NEXT = 0;
                 SubEstRec.DELETEALL;
               END;
             END;

    OnRename=BEGIN
               //IF Chapter <> xRec.Chapter THEN  //db, 20-02-14: C013250
                 ERROR(Text000);
             END;

    CaptionML=ENU=Sub-Estimate OLD;
    PasteIsValid=No;
    LookupPageID=Page11012161;
    DrillDownPageID=Page11012161;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Estimate No. }
    { 20  ;   ;Sub-Estimate No.    ;Code20        ;OnValidate=BEGIN
                                                                FormatMgt.FormatSubEstimate("Sub-Estimate No.",Chapter,Paragraph,Level,"Estimate No.",FALSE);
                                                                IF CurrFieldNo = FIELDNO("Sub-Estimate No.") THEN
                                                                  IF (xRec."Sub-Estimate No." <> '') AND (xRec."Sub-Estimate No." <> "Sub-Estimate No.") THEN
                                                                    ERROR(Text000);  //db, 28-08-14: C017149

                                                                CheckCumFreqParent;  //db, 30-09-10
                                                              END;

                                                   CaptionML=ENU=Sub-Estimate No. }
    { 30  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 50  ;   ;Frequency           ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                ProcessFrequency("Estimate No.", "Sub-Estimate No.", TRUE);
                                                              END;

                                                   CaptionML=ENU=Frequency }
    { 51  ;   ;Cumulative Frequency;Decimal       ;InitValue=1;
                                                   CaptionML=ENU=Cumulative Frequency }
    { 60  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Measure }
    { 70  ;   ;Hours               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Hours;
                                                   Editable=No }
    { 80  ;   ;Labor Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Labor Amount;
                                                   Editable=No }
    { 90  ;   ;Material Amount     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Material Amount;
                                                   Editable=No }
    { 91  ;   ;Gross Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Gross Amount;
                                                   Editable=No }
    { 100 ;   ;Subcontracting Amount;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Subcontracting Amount;
                                                   Editable=No }
    { 110 ;   ;Plant Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Plant Amount;
                                                   Editable=No }
    { 120 ;   ;Total Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Total Amount;
                                                   Editable=No }
    { 130 ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=ENU=Estimate Description;
                                                   Editable=No }
    { 140 ;   ;Level               ;Integer       ;CaptionML=ENU=Level }
    { 160 ;   ;Chapter             ;Code20        ;CaptionML=ENU=Chapter }
    { 165 ;   ;Paragraph           ;Code20        ;CaptionML=ENU=Paragraph }
    { 170 ;   ;Hours Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Chapter;
                                                   Editable=No }
    { 171 ;   ;Hours Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Paragraph;
                                                   Editable=No }
    { 180 ;   ;Labor Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Chapter;
                                                   Editable=No }
    { 181 ;   ;Labor Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Paragraph;
                                                   Editable=No }
    { 190 ;   ;Material Chapter    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Chapter;
                                                   Editable=No }
    { 191 ;   ;Gross Price Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Gross Price Chapter;
                                                   Editable=No }
    { 195 ;   ;Material Paragraph  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Paragraph;
                                                   Editable=No }
    { 196 ;   ;Gross Price Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Gross Price Paragraph;
                                                   Editable=No }
    { 200 ;   ;Subcontracting Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Chapter;
                                                   Editable=No }
    { 201 ;   ;Subcontracting Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Paragraph;
                                                   Editable=No }
    { 210 ;   ;Plant Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Chapter;
                                                   Editable=No }
    { 211 ;   ;Plant Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Paragraph;
                                                   Editable=No }
    { 220 ;   ;Total Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Total Chapter;
                                                   Editable=No }
    { 221 ;   ;Total Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Total Paragraph;
                                                   Editable=No }
    { 290 ;   ;Cum. Hours          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Hours;
                                                   Editable=No }
    { 300 ;   ;Cum. Labor          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Labor;
                                                   Editable=No }
    { 310 ;   ;Cum. Material       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Material;
                                                   Editable=No }
    { 311 ;   ;Cum. Gross Price    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Gross Price;
                                                   Editable=No }
    { 320 ;   ;Cum. Subcontracting ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Subcontracting;
                                                   Editable=No }
    { 330 ;   ;Cum. Plant          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Plant;
                                                   Editable=No }
    { 340 ;   ;Cum. Total          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Total;
                                                   Editable=No }
    { 350 ;   ;Cum. Hours Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Hours Chapter;
                                                   Editable=No }
    { 351 ;   ;Cum. Hours Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Hours Paragraph;
                                                   Editable=No }
    { 360 ;   ;Cum. Labor Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Labor Chapter;
                                                   Editable=No }
    { 361 ;   ;Cum. Labor Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Labor Paragraph;
                                                   Editable=No }
    { 370 ;   ;Cum. Material Chapter;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Material Chapter;
                                                   Editable=No }
    { 371 ;   ;Cum. Gross Price Chapter;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Gross Price Chapter;
                                                   Editable=No }
    { 375 ;   ;Cum. Material Paragraph;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Material Paragraph;
                                                   Editable=No }
    { 376 ;   ;Cum. Gross Price Paragraph;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Gross Price Paragraph;
                                                   Editable=No }
    { 380 ;   ;Cum. Subcontracting Chapter;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Subcontracting Chapter;
                                                   Editable=No }
    { 381 ;   ;Cum. Subcontracting Paragraph;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Subcontracting Paragraph;
                                                   Editable=No }
    { 390 ;   ;Cum. Plant Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Plant Chapter;
                                                   Editable=No }
    { 391 ;   ;Cum. Plant Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Plant Paragraph;
                                                   Editable=No }
    { 400 ;   ;Cum. Total Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Total Chapter;
                                                   Editable=No }
    { 401 ;   ;Cum. Total Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Total Paragraph;
                                                   Editable=No }
    { 410 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=ENU=Norm Group }
    { 420 ;   ;Part Group          ;Code10        ;TableRelation="Estimate Group".No. WHERE (Type=CONST(Part));
                                                   OnValidate=VAR
                                                                lvEstPartRec@1100485000 : Record 11012153;
                                                              BEGIN
                                                                IF "Part Group" <> xRec."Part Group" THEN BEGIN
                                                                  lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                  lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                  lvEstPartRec.SETRANGE("Part Group", xRec."Part Group");
                                                                  IF lvEstPartRec.FINDFIRST THEN
                                                                    FIELDERROR("Part Group", Text001);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Part Group }
    { 430 ;   ;Element             ;Code20        ;TableRelation="Base Element".Code;
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Element }
    { 440 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                UpdateProjElem(0);
                                                              END;

                                                   CaptionML=ENU=Project No. }
    { 450 ;   ;Volume              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Volume WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Volume;
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 460 ;   ;Text                ;Text250       ;CaptionML=ENU=Text }
    { 465 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line (Group)" WHERE (Table Name=CONST(Estimate),
                                                                                                   Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FILTER(''),
                                                                                                   Part=FILTER(''),
                                                                                                   Estimate Line No.=CONST(0)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=No }
    { 466 ;   ;Print on Quote      ;Boolean       ;OnValidate=BEGIN
                                                                //X007
                                                                UpdatePartLevel("Estimate No.", "Sub-Estimate No.");
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Print on Quote;
                                                   Description=X007 }
    { 467 ;   ;Extension           ;Boolean       ;OnValidate=BEGIN
                                                                //X007
                                                                UpdatePartLevel("Estimate No.", "Sub-Estimate No.");
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Extension;
                                                   Description=X007 }
    { 470 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1);
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 471 ;   ;Adjustment Factor Material;Decimal ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2);
                                                              END;

                                                   CaptionML=ENU=Material Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 472 ;   ;Adjustment Factor Subcontr.;Decimal;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(3);
                                                              END;

                                                   CaptionML=ENU=Subcontr. Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 473 ;   ;Adjustment Factor Plant;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(4);
                                                              END;

                                                   CaptionML=ENU=Plant Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 474 ;No ;Adjustment Factor Sundry;Decimal   ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(5);
                                                              END;

                                                   CaptionML=ENU=Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0;
                                                   Description=DP00381 }
    { 475 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=ENU=Cum. Hours Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 476 ;   ;Cum. Adj. Factor Material;Decimal  ;CaptionML=ENU=Cum. Material Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 477 ;   ;Cum. Adj. Factor Subcontr.;Decimal ;CaptionML=ENU=Cum. Subcontracting Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 478 ;   ;Cum. Adj. Factor Plant;Decimal     ;CaptionML=ENU=Cum. Plant Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 479 ;No ;Cum. Adj. Factor Sundry;Decimal    ;CaptionML=ENU=Cum. Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   Description=DP00381 }
    { 480 ;   ;Code                ;Code20        ;OnValidate=BEGIN
                                                                EstRec.GET("Estimate No.");
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  FormatMgt.SetSelection(EstRec."Coding System");
                                                                  FormatMgt.FormatElem(Code,4,'');
                                                                  CodeRec.GET(EstRec."Coding System", Code);
                                                                END;

                                                                MODIFY;
                                                                UpdateEst.UpdateCode("Estimate No.", "Sub-Estimate No.", '', Code, TRUE);
                                                              END;

                                                   OnLookup=BEGIN
                                                              EstRec.GET("Estimate No.");
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=ENU=Code }
    { 490 ;   ;Target Hours        ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Amount Labor", 0);
                                                              END;

                                                   CaptionML=ENU=Target Hours }
    { 491 ;   ;Target Amount Labor ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Hours", 0);
                                                              END;

                                                   CaptionML=ENU=Target Amount Labor }
    { 492 ;   ;Target Amount Material;Decimal     ;CaptionML=ENU=Target Amount Material }
    { 493 ;   ;Target Amount Subcontracting;Decimal;
                                                   CaptionML=ENU=Target Amount Subcontracting }
    { 494 ;   ;Target Amount Plant ;Decimal       ;CaptionML=ENU=Target Amount Plant }
    { 495 ;No ;Target Amount Sundry;Decimal       ;CaptionML=ENU=Target Amount Sundry;
                                                   Description=DP00381 }
    { 500 ;   ;Model               ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FILTER(''));
                                                   CaptionML=ENU=Model;
                                                   Editable=No }
    { 505 ;   ;Source Estimate     ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Source Estimate;
                                                   Editable=No }
    { 510 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Condition }
    { 520 ;   ;Transfer to Service ;Option        ;OnValidate=BEGIN
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Transfer to Service;
                                                   OptionCaptionML=ENU=" ,,,Service Order";
                                                   OptionString=[ ,,,ServOrder];
                                                   Description=option ServLoc+Installation cancelled }
    { 525 ;   ;Service Location No.;Code20        ;TableRelation="Service Location".No.;
                                                   OnValidate=VAR
                                                                ServiceLocation@1100525000 : Record 11012801;
                                                              BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  UpdateLowerLevel;
                                                                IF "Language Code" = '' THEN BEGIN
                                                                  ServiceLocation.GET("Service Location No.");
                                                                  "Language Code" := ServiceLocation."Language Code";
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Service Location No. }
    { 530 ;   ;Service Order No.   ;Code20        ;TableRelation="Service Order".No. WHERE (No.=FIELD(Service Order No.));
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  UpdateLowerLevel;

                                                                CheckServiceOrder;  //db, 05-11-13: DP00260 (26541)
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceOrder@1100528600 : Record 11012823;
                                                            BEGIN
                                                              IF "Service Order No." <> '' THEN
                                                                IF ServiceOrder.GET("Service Order No.") THEN;
                                                              IF PAGE.RUNMODAL(0, ServiceOrder) = ACTION::LookupOK THEN
                                                                VALIDATE("Service Order No.", ServiceOrder."No.");
                                                            END;

                                                   CaptionML=ENU=Service Order No. }
    { 540 ;   ;Vendor              ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=ENU=Vendor }
    { 541 ;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=ENU=Vendor Name;
                                                   Editable=No }
    { 550 ;   ;Subcontractor       ;Code20        ;TableRelation=Vendor.No. WHERE (Subcontractor=CONST(Yes));
                                                   CaptionML=ENU=Subcontractor }
    { 551 ;   ;Subcontractor Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=ENU=Subcontractor Name;
                                                   Editable=No }
    { 560 ;   ;Quantity Model Exist;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Model Line Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Quantity Model Exist;
                                                   Editable=No }
    { 570 ;   ;Object No.          ;Code20        ;OnValidate=BEGIN
                                                                TESTFIELD("Object No.", '');
                                                              END;

                                                   CaptionML=ENU=Object No.;
                                                   Description=Do not use }
    { 580 ;   ;Object Customer     ;Code20        ;OnValidate=BEGIN
                                                                TESTFIELD("Object Customer", '');
                                                              END;

                                                   CaptionML=ENU=Object Customer;
                                                   Description=Do not use }
    { 590 ;   ;Estimator           ;Code20        ;TableRelation=Employee.No.;
                                                   CaptionML=ENU=Estimator }
    { 591 ;   ;Name Estimator      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Estimator)));
                                                   CaptionML=ENU=Name Estimator;
                                                   Editable=No }
    { 600 ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   CaptionML=ENU=Language Code }
    { 610 ;   ;Summary (Offer Price);Code10       ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=ENU=Summary (Offer Price) }
    { 611 ;No ;Summary (Cost)      ;Code10        ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Summary Type=CONST(Cost));
                                                   CaptionML=ENU=Summary (Cost);
                                                   Description=DP00381 }
    { 650 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");

                                                                UpdateProjPlanActCode;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Project Planning Activity Code }
    { 660 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=ENU=Extension Contract;
                                                   Description=DP00260 }
    { 700 ;   ;Parts Exist         ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Part OLD" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   OnLookup=VAR
                                                              EstimateManagementRTC@1100525000 : Codeunit 11130010;
                                                            BEGIN
                                                            END;

                                                   CaptionML=ENU=Parts;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 2000;No ;Reserved range DP00381;Text1       ;CaptionML=ENU=Cost Type (Price);
                                                   Description=DP00381: range above 2000 reserved }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.           ;Clustered=Yes }
    {    ;Project No.,Element                      }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstRec@1210190002 : Record 11012151;
      SubEstRec@1210190003 : Record 11012152;
      EstPartRec@11012000 : Record 11012153;
      EstLineRec@11012001 : Record 11012154;
      RcpLineRec@11012002 : Record 11012156;
      EstCodeRec@1210190009 : Record 11012194;
      CodeRec@1210190010 : Record 11012089;
      ChrgRec@11012003 : Record 11012175;
      TextRec@1210190012 : Record 11020595;
      QuanSheetRec@1210190007 : Record 11012186;
      QuanModelRec@1210190011 : Record 11012197;
      ConfigPartRec@11012007 : Record 11012176;
      ConfigRowQuanRec@1210190000 : Record 11012192;
      EstFeaturePartRec@11012008 : Record 11012178;
      Text000@1210190001 : TextConst 'ENU="Rename disabled; use copy function and delete original line afterwards."';
      ElemRec@1210190004 : Record 11012060;
      ProjElemRec@1210190005 : Record 11012010;
      FormatMgt@1210190006 : Codeunit 11012022;
      UpdateEst@1210190008 : Codeunit 11012155;
      Text001@1100485000 : TextConst 'ENU=may not be modfied, there are already estimate parts present';
      sp1@1100485003 : Integer;
      sp2@1100485002 : Integer;
      CurrLevel@1100485001 : Integer;
      Text002@1100525000 : TextConst 'ENU=%1 (%2) from Service Order %4 does not match with %1 (%3) from Estimate.';
      Text999@1100525001 : TextConst 'ENU=Convert Estimate: old Estimate Module is expired';

    PROCEDURE InitAdjustmentFactor@1210190003();
    BEGIN
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Material" = 0 THEN
        "Adjustment Factor Material" := 1;
      IF "Adjustment Factor Subcontr." = 0 THEN
        "Adjustment Factor Subcontr." := 1;
      IF "Adjustment Factor Plant" = 0 THEN
        "Adjustment Factor Plant" := 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF Level = 0 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF Level = 1 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", Chapter);
      IF Level = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", Paragraph);
      IF NOT SubEstRec.FINDFIRST THEN SubEstRec.INIT;

      IF SubEstRec."Cum. Adj. Factor Hours" = 0 THEN
        "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
      ELSE
        "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * SubEstRec."Cum. Adj. Factor Hours";
      IF SubEstRec."Cum. Adj. Factor Material" = 0 THEN
        "Cum. Adj. Factor Material" := "Adjustment Factor Material"
      ELSE
        "Cum. Adj. Factor Material" := "Adjustment Factor Material" * SubEstRec."Cum. Adj. Factor Material";
      IF SubEstRec."Cum. Adj. Factor Subcontr." = 0 THEN
        "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
      ELSE
        "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * SubEstRec."Cum. Adj. Factor Subcontr.";
      IF SubEstRec."Cum. Adj. Factor Plant" = 0 THEN
        "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
      ELSE
        "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * SubEstRec."Cum. Adj. Factor Plant";
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190000(IAdjType@1210190000 : Integer);
    BEGIN
      CASE IAdjType OF
        1:
          IF "Adjustment Factor Hours" = 0 THEN
            "Adjustment Factor Hours" := 1;
        2:
          IF "Adjustment Factor Material" = 0 THEN
            "Adjustment Factor Material" := 1;
        3:
          IF "Adjustment Factor Subcontr." = 0 THEN
            "Adjustment Factor Subcontr." := 1;
        4:
          IF "Adjustment Factor Plant" = 0 THEN
            "Adjustment Factor Plant" := 1;
      END;
      MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter,"Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph,"Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          UpdateEst.ResetAdjustmentFactor(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.",
            '', '', 0, TRUE, 1, IAdjType);
        UNTIL SubEstRec.NEXT = 0;
      END;

      GET("Estimate No.", "Sub-Estimate No.");
    END;

    PROCEDURE ProcessFrequency@1100485000(lvEst@1100485002 : Code[20];lvSubEst@1100485001 : Code[20];CalcLines@1100485000 : Boolean);
    VAR
      lvSubEstRec@1100485003 : Record 11012152;
      lvQuan@1100485005 : Decimal;
    BEGIN
      IF CalcLines THEN //call 30195
        MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", lvEst);
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter, "Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph, "Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN  //call 30195 FALSE FALSE
        REPEAT
          lvQuan := SubEstRec.Frequency;
          CurrLevel := SubEstRec.Level;

          lvSubEstRec.RESET;
          lvSubEstRec.SETRANGE("Estimate No.", SubEstRec."Estimate No.");
          IF CurrLevel = 2 THEN BEGIN
            CurrLevel := CurrLevel - 1;
            lvSubEstRec.SETRANGE("Sub-Estimate No.", SubEstRec.Paragraph);
            IF lvSubEstRec.FINDFIRST THEN
              lvQuan := lvQuan * lvSubEstRec.Frequency;
          END;
          IF CurrLevel = 1 THEN BEGIN
            CurrLevel := CurrLevel - 1;
            lvSubEstRec.SETRANGE("Sub-Estimate No.", SubEstRec.Chapter);
            IF lvSubEstRec.FINDFIRST THEN
              lvQuan := lvQuan * lvSubEstRec.Frequency;
          END;

          IF SubEstRec.Level = Level THEN BEGIN
            IF "Cumulative Frequency" <> lvQuan THEN BEGIN //call 30195
              "Cumulative Frequency" := lvQuan;
              MODIFY;
            END; //call 30195
          END ELSE BEGIN
            IF SubEstRec."Cumulative Frequency" <> lvQuan THEN BEGIN //call 30195
              SubEstRec."Cumulative Frequency" := lvQuan;
              SubEstRec.MODIFY;
            END; //call 30195
          END;

          CalculateEstLines(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.", CalcLines);
        UNTIL SubEstRec.NEXT = 0;
      END;
    END;

    PROCEDURE CalculateEstLines@1(lvEst@1100485000 : Code[20];lvSubEst@1100485001 : Code[20];CalcLines@1100485002 : Boolean);
    VAR
      EstimateLineOriginal@1210190000 : Record 11012154;
    BEGIN
      IF CalcLines = FALSE THEN EXIT;

      EstLineRec.SETRANGE("Estimate No.", lvEst);
      EstLineRec.SETRANGE("Sub-Estimate No.", lvSubEst);
      IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN  //call 30195 FALSE FALSE
        REPEAT
          EstimateLineOriginal := EstLineRec; //call 30195
          EstLineRec.VALIDATE(Quantity);  //incl. CalculateTotal + UpdateRecipeTotal
          IF FORMAT(EstimateLineOriginal) <> FORMAT(EstLineRec) THEN //call 30195
            EstLineRec.MODIFY;
          CheckRecipeTotal;
        UNTIL EstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckRecipeTotal@1210190001();
    BEGIN
      IF EstLineRec.Recipe = '' THEN EXIT;

      RcpLineRec.SETRANGE("Estimate No.", EstLineRec."Estimate No.");
      RcpLineRec.SETRANGE("Sub-Estimate No.", EstLineRec."Sub-Estimate No.");
      RcpLineRec.SETRANGE(Part, EstLineRec.Part);
      RcpLineRec.SETRANGE("Part Group", EstLineRec."Part Group");
      RcpLineRec.SETRANGE("Estimate Line", EstLineRec."Line No.");
      IF RcpLineRec.FINDFIRST THEN
        RcpLineRec.UpdateEstLines;
    END;

    PROCEDURE UpdateProjElem@1100485001(lvAction@1100485000 : Integer);
    VAR
      lvEstPartRec@1100485001 : Record 11012153;
    BEGIN
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF lvAction = 0 THEN
        lvEstPartRec.SETFILTER("Project No.", '%1|%2', '', xRec."Project No.")
      ELSE
        lvEstPartRec.SETFILTER(Element, '%1|%2', '', xRec.Element);
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvAction = 0 THEN
            lvEstPartRec.VALIDATE("Project No.", "Project No.")
          ELSE
            lvEstPartRec.VALIDATE(Element, Element);
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckFormat@16(VAR sp1@1100485002 : Integer;VAR sp2@1100485004 : Integer);
    VAR
      EstSetupRec@11012000 : Record 11012150;
      x@1100485000 : Integer;
      lp@1100485001 : Integer;
      lvText000@1100485003 : TextConst 'ENU=only 3 levels allowed';
    BEGIN
      x := 0;
      sp1 := 0;
      sp2 := 0;

      EstSetupRec.GET();
      EstSetupRec.TESTFIELD("Sub-Estimate Format");
      lp := STRLEN(EstSetupRec."Sub-Estimate Format");

      REPEAT
        x := x + 1;
        IF COPYSTR(EstSetupRec."Sub-Estimate Format",x,1) = '.' THEN BEGIN
          IF sp1 = 0 THEN
            sp1 := x
          ELSE
            IF sp2 = 0 THEN
              sp2 :=x
            ELSE
              ERROR(lvText000);
        END;
      UNTIL x = lp;
    END;

    PROCEDURE UpdateLowerLevel@1100485002();
    VAR
      lvEstLineRec@1100525004 : Record 11012154;
      lvServBudgetRec@1100525002 : Record 11012875;
      lvText001@1100525003 : TextConst 'ENU=Service Order Budget Lines present';
      lvText002@1100525005 : TextConst 'ENU=Estimate Lines present for other Service Orders';
    BEGIN
      IF CurrFieldNo = FIELDNO("Service Order No.") THEN BEGIN
        lvServBudgetRec.SETRANGE("Budget Type", lvServBudgetRec."Budget Type"::Order);
        lvServBudgetRec.SETRANGE("Service Order No.", "Service Order No.");
        IF lvServBudgetRec.FINDFIRST THEN MESSAGE(lvText001);  //db, 13-11-09: M16953 (check moved to codeunit 11012152)

        lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
        lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        lvEstLineRec.SETFILTER("Service Order No.", '<>%1&<>%2', '', "Service Order No.");
        IF lvEstLineRec.FINDFIRST THEN ERROR(lvText002);
      END;

      MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter, "Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph, "Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF SubEstRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CurrFieldNo = FIELDNO("Transfer to Service") THEN
            SubEstRec."Transfer to Service" := "Transfer to Service";
          IF CurrFieldNo = FIELDNO("Service Location No.") THEN
            SubEstRec."Service Location No." := "Service Location No.";
          IF CurrFieldNo = FIELDNO("Service Order No.") THEN
            SubEstRec."Service Order No." := "Service Order No.";
          IF CurrFieldNo = FIELDNO("Print on Quote") THEN BEGIN  //X007
            SubEstRec."Print on Quote" := "Print on Quote";
            UpdatePartLevel(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.");
          END;
          IF CurrFieldNo = FIELDNO(Extension) THEN BEGIN  //X007
            SubEstRec.Extension := Extension;
            UpdatePartLevel(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.");
          END;

          SubEstRec.MODIFY;
        UNTIL SubEstRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckCumFreqParent@1100525000();
    BEGIN
      //db, 30-09-10: get cumulative for initial value frequency
      IF Level = 0 THEN
        "Cumulative Frequency" := Frequency;
      IF Level = 1 THEN
        IF SubEstRec.GET("Estimate No.", Chapter) THEN
          "Cumulative Frequency" := SubEstRec."Cumulative Frequency" * Frequency;
      IF Level = 2 THEN
        IF SubEstRec.GET("Estimate No.", Paragraph) THEN
          "Cumulative Frequency" := SubEstRec."Cumulative Frequency" * Frequency;
    END;

    PROCEDURE UpdatePartLevel@1210190002(iEst@1210190000 : Code[20];iSubEst@1210190001 : Code[20]);
    VAR
      EstPartRec@1210190002 : Record 11012153;
    BEGIN
      //X007
      EstPartRec.SETRANGE("Estimate No.", iEst);
      EstPartRec.SETRANGE("Sub-Estimate No.", iSubEst);
      IF EstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CurrFieldNo = FIELDNO("Print on Quote") THEN
            EstPartRec.VALIDATE("Print on Quote", "Print on Quote");
          IF CurrFieldNo = FIELDNO(Extension) THEN
            EstPartRec.VALIDATE(Extension, Extension);
          EstPartRec.MODIFY;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateProjPlanActCode@1210190022();
    VAR
      lvEstPartRec@1210190000 : Record 11012153;
    BEGIN
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstPartRec.SETFILTER("Project Planning Activity Code", '%1|%2', '', xRec."Project Planning Activity Code");
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstPartRec.VALIDATE("Project Planning Activity Code", "Project Planning Activity Code");
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE InitRecord@1210190004();
    BEGIN
      // 34595.n
      IF EstRec.GET("Estimate No.") THEN BEGIN
        "Project No." := EstRec."Project No.";
        Element := EstRec.Element;
        "Project Planning Activity Code" := EstRec."Project Planning Activity Code";
      END;
    END;

    PROCEDURE GetDataCaption@1100528000() : Text[250];
    BEGIN
      EXIT(STRSUBSTNO('%1 - %2 - %3', "Estimate No.", "Sub-Estimate No.", Description));
    END;

    PROCEDURE CheckServiceOrder@1100525002();
    VAR
      ServOrderRec@1100525000 : Record 11012823;
    BEGIN
      //DP00260
      IF NOT ServOrderRec.GET("Service Order No.") THEN EXIT;
      ServOrderRec.CheckStatus(1);
      EstRec.GET("Estimate No.");
      IF (ServOrderRec."Customer No." <> EstRec."Customer No.") AND
         (ServOrderRec."Customer No." <> '') AND
         (EstRec."Customer No." <> '') THEN
        MESSAGE(Text002, ServOrderRec.FIELDCAPTION("Customer No."),
          ServOrderRec."Customer No.", EstRec."Customer No.",
          "Service Order No.");
      IF (ServOrderRec."Service Contract No." <> EstRec."Service Contract No.") AND
         (ServOrderRec."Service Contract No." <> '') AND
         (EstRec."Service Contract No." <> '') THEN
        MESSAGE(Text002, ServOrderRec.FIELDCAPTION("Service Contract No."),
          ServOrderRec."Service Contract No.", EstRec."Service Contract No.",
          "Service Order No.");
    END;

    BEGIN
    END.
  }
}

