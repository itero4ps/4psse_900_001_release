OBJECT Table 11012153 Estimate Part OLD
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Sub-Estimate No.,Part,Description;
    OnInsert=BEGIN
               ERROR(Text999);  //db, 14-03-16: old estimate expired in Nav2016
               TESTFIELD("Part Group");
               TESTFIELD(Part);

               InitAdjustmentFactor;
               "Object No." := '';  //db, 12-12-07
               "Object Customer" := '';  //db, 31-03-07
             END;

    OnModify=BEGIN
               ERROR(Text999);  //db, 14-03-16: old estimate expired in Nav2016
               EstRec.UpdateLogbook("Estimate No.");
             END;

    OnDelete=VAR
               sp1@1100485001 : Integer;
               sp2@1100485000 : Integer;
               CurrLevel@1100485002 : Integer;
             BEGIN
               DeleteSubPartsLowerLevel; //Call 23762

               EstRec.UpdateLogbook("Estimate No.");

               //mg.sn, 07-12-10: M22588
               IF EstRec.GET("Estimate No.") THEN BEGIN
                 IF EstRec."Estimate Type" = EstRec."Estimate Type"::Sales THEN
                   TESTFIELD("Offer fixed", FALSE);

                 IF EstRec."Full Cost/Sales Price Updated" THEN BEGIN
                   EstRec."Full Cost/Sales Price Updated" := FALSE;
                   EstRec.MODIFY;
                 END;
               END;
               //mg.en, 07-12-10: M22588

               EstLineRec.RESET; //Call 23762
               EstLineRec.SETRANGE("Estimate No.","Estimate No.");
               EstLineRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstLineRec.SETRANGE("Part Group","Part Group");
               EstLineRec.SETRANGE(Part,Part);
               IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                 EstLineRec.DELETEALL;

               RecipeRec.RESET; //Call 23762
               RecipeRec.SETRANGE("Estimate No.","Estimate No.");
               RecipeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               RecipeRec.SETRANGE("Part Group","Part Group");
               RecipeRec.SETRANGE(Part,Part);
               IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                 RecipeRec.DELETEALL;

               TextRec.RESET; //Call 23762
               TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
               TextRec.SETRANGE("Estimate No.","Estimate No.");
               TextRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               TextRec.SETRANGE("Part Group","Part Group");
               TextRec.SETRANGE(Part,Part);
               IF NOT TextRec.ISEMPTY THEN //Call 23762
                 TextRec.DELETEALL;

               EstCodeRec.RESET; //Call 23762
               EstCodeRec.SETRANGE("Estimate No.","Estimate No.");
               EstCodeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstCodeRec.SETRANGE("Part Group","Part Group");
               EstCodeRec.SETRANGE(Part,Part);
               IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                 EstCodeRec.DELETEALL;

               ChrgRec.RESET; //Call 23762
               ChrgRec.SETRANGE("Estimate No.","Estimate No.");
               ChrgRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               ChrgRec.SETRANGE("Part Group","Part Group");
               ChrgRec.SETRANGE(Part,Part);
               IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                 ChrgRec.DELETEALL;

               QuanSheetRec.RESET; //Call 23762
               QuanSheetRec.SETRANGE("Estimate No.","Estimate No.");
               QuanSheetRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanSheetRec.SETRANGE("Part Group","Part Group");
               QuanSheetRec.SETRANGE(Part,Part);
               IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                 QuanSheetRec.DELETEALL;

               QuanModelRec.RESET; //Call 23762
               QuanModelRec.SETRANGE("Estimate No.","Estimate No.");
               QuanModelRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanModelRec.SETRANGE("Part Group","Part Group");
               QuanModelRec.SETRANGE(Part,Part);
               IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                 QuanModelRec.DELETEALL;

               EstPartRec.RESET; //Call 23762
               EstPartRec.SETRANGE("Estimate No.","Estimate No.");
               EstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstPartRec.SETRANGE("Part Group","Part Group");

               EstLineRec.SETRANGE(Part);
               RecipeRec.SETRANGE(Part);
               TextRec.SETRANGE(Part);
               EstCodeRec.SETRANGE(Part);
               ChrgRec.SETRANGE(Part);
               QuanSheetRec.SETRANGE(Part);
               QuanModelRec.SETRANGE(Part);

               CheckFormat(sp1,sp2);
               CurrLevel := Level;
               IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
               IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

               CASE CurrLevel OF
                 0:BEGIN
                     DeleteExcelFile(EstPartRec);
                     IF NOT EstPartRec.ISEMPTY THEN //Call 23762
                       EstPartRec.DELETEALL;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                     IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                       RecipeRec.DELETEALL;
                     IF NOT TextRec.ISEMPTY THEN //Call 23762
                       TextRec.DELETEALL;
                     IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                       EstCodeRec.DELETEALL;
                     IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                       ChrgRec.DELETEALL;
                     IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                       QuanSheetRec.DELETEALL;
                     IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                       QuanModelRec.DELETEALL;
                   END;
                 1:BEGIN
                     EstPartRec.SETRANGE(Chapter,Chapter);
                     DeleteExcelFile(EstPartRec);
                     //Call 23762 EstPartRec.DELETEALL;
                     EstLineRec.SETRANGE(Chapter,Chapter);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                           RecipeRec.DELETEALL(TRUE);  //db, 15-09-08: M12455

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN //Call 23762
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                   END;
                 2:BEGIN
                     EstPartRec.SETRANGE(Paragraph,Paragraph);
                     DeleteExcelFile(EstPartRec);
                     //Call 23762 EstPartRec.DELETEALL;
                     EstLineRec.SETRANGE(Paragraph,Paragraph);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                           RecipeRec.DELETEALL(TRUE);  //db, 15-09-08: M12455

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN //Call 23762
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                   END;
                 3:BEGIN
                     EstPartRec := Rec;
                     EstPartRec.SETRECFILTER;
                     DeleteExcelFile(EstPartRec);
                   END;
               END;
             END;

    OnRename=BEGIN
               ERROR(Text001);
             END;

    CaptionML=ENU=Estimate Part OLD;
    PasteIsValid=No;
    LookupPageID=Page11012162;
    DrillDownPageID=Page11012162;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Estimate No. }
    { 11  ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=ENU=Estimate Description;
                                                   Editable=No }
    { 12  ;   ;Sub-Estimate No.    ;Code20        ;TableRelation="Sub-Estimate OLD"."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=ENU=Sub-Estimate No. }
    { 13  ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sub-Estimate OLD".Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sub-Estimate Description;
                                                   Editable=No }
    { 15  ;   ;Part Group          ;Code10        ;CaptionML=ENU=Part Group }
    { 20  ;   ;Part                ;Code20        ;TableRelation="Estimate Base Part".Code WHERE (Part Group=FIELD(Part Group));
                                                   OnValidate=BEGIN
                                                                FormatMgt.CreateEstPart("Estimate No.","Sub-Estimate No.","Part Group",Part,Chapter,Paragraph,Level,TRUE);
                                                                IF CurrFieldNo = FIELDNO(Part) THEN
                                                                  IF (xRec.Part <> '') AND (xRec.Part <> Part) THEN
                                                                    ERROR(Text001);  //db, 28-08-14: C017149

                                                                IF Part <> xRec.Part THEN
                                                                  IF PartRec.GET("Part Group",Part) THEN BEGIN
                                                                    Description := PartRec.Description;
                                                                    Quantity := PartRec.Quantity;
                                                                    "Unit of Measure" := PartRec."Unit of Measure";
                                                                    IF PartRec.Element <> '' THEN // 34595.n
                                                                      Element := PartRec.Element;
                                                                    IF PartRec."Project Plann. Base Act. Code" <> '' THEN
                                                                      "Project Planning Activity Code" := PartRec."Project Plann. Base Act. Code";
                                                                    "Theoretical Life Span" := PartRec."Theoretical Life Span";
                                                                    VALIDATE("Expected Life Span", PartRec."Expected Life Span");  //db, 27-05-09
                                                                    CopyPartText;  //db, 28-11-11: M30268
                                                                  END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Part }
    { 21  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 22  ;   ;Quantity            ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                ProcessPartQuantity;
                                                              END;

                                                   CaptionML=ENU=Quantity }
    { 23  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Measure }
    { 25  ;   ;Description 2       ;Text50        ;CaptionML=ENU=Description 2;
                                                   Description=DP00686 }
    { 31  ;   ;Chapter             ;Code20        ;CaptionML=ENU=Chapter }
    { 32  ;   ;Paragraph           ;Code20        ;CaptionML=ENU=Paragraph }
    { 40  ;   ;Level               ;Integer       ;CaptionML=ENU=Level }
    { 50  ;   ;Estimated Part      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                     Part Group=FIELD(Part Group),
                                                                                                     Part=FIELD(Part)));
                                                   CaptionML=ENU=Estimated Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 51  ;   ;Cum. Estimated Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Estimated Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 60  ;   ;Estimated Paragraph ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                     Part Group=FIELD(Part Group),
                                                                                                     Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Estimated Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 61  ;   ;Cum. Estimated Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Estimated Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 70  ;   ;Estimated Chapter   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                     Part Group=FIELD(Part Group),
                                                                                                     Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Estimated Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 71  ;   ;Cum. Estimated Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Estimated Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 80  ;   ;Estimated Total     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Amount WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                     Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Estimated Total }
    { 81  ;   ;Cum. Estimated Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Estimated Total }
    { 90  ;   ;Hours Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                    Part Group=FIELD(Part Group),
                                                                                                    Part=FIELD(Part)));
                                                   CaptionML=ENU=Hours Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 95  ;   ;Cum. Hours Part     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Hours Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 100 ;   ;Hours Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                    Part Group=FIELD(Part Group),
                                                                                                    Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 105 ;   ;Cum. Hours Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Hours Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 110 ;   ;Hours Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                    Part Group=FIELD(Part Group),
                                                                                                    Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 115 ;   ;Cum. Hours Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Hours Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 120 ;   ;Hours Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                    Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Hours Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 125 ;   ;Cum. Hours Total    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Hours Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;Labor Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Part=FIELD(Part)));
                                                   CaptionML=ENU=Labor Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 135 ;   ;Cum. Labor Part     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Labor Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 140 ;   ;Labor Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 145 ;   ;Cum. Labor Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Labor Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 150 ;   ;Labor Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 155 ;   ;Cum. Labor Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Labor Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 160 ;   ;Labor Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Labor Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Labor Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 165 ;   ;Cum. Labor Total    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Labor Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Material Part       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group),
                                                                                                                Part=FIELD(Part)));
                                                   CaptionML=ENU=Material Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 171 ;   ;Gross Price Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Part=FIELD(Part)));
                                                   CaptionML=ENU=Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 175 ;   ;Cum. Material Part  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part Group=FIELD(Part Group),
                                                                                                                    Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Material Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 176 ;   ;Cum. Gross Price Part;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Part Group=FIELD(Part Group),
                                                                                                                       Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 180 ;   ;Material Paragraph  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group),
                                                                                                                Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 181 ;   ;Gross Price Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Gross Price Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 185 ;   ;Cum. Material Paragraph;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part Group=FIELD(Part Group),
                                                                                                                    Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Material Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 186 ;   ;Cum. Gross Price Paragraph;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Part Group=FIELD(Part Group),
                                                                                                                       Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Gross Price Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 190 ;   ;Material Chapter    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group),
                                                                                                                Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 191 ;   ;Gross Price Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Gross Price Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 195 ;   ;Cum. Material Chapter;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part Group=FIELD(Part Group),
                                                                                                                    Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Material Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 196 ;   ;Cum. Gross Price Chapter;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Part Group=FIELD(Part Group),
                                                                                                                       Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Gross Price Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 200 ;   ;Material Total      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Material Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Material Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 201 ;   ;Gross Price Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Gross Price Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 205 ;   ;Cum. Material Total ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Material Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 206 ;   ;Cum. Gross Price Total;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Gross Price" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                       Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                       Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Gross Price Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 210 ;   ;Subcontracting Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part Group=FIELD(Part Group),
                                                                                                                      Part=FIELD(Part)));
                                                   CaptionML=ENU=Subcontracting Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 215 ;   ;Cum. Subcontracting Part;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                          Part Group=FIELD(Part Group),
                                                                                                                          Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Subcontracting Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 220 ;   ;Subcontracting Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part Group=FIELD(Part Group),
                                                                                                                      Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 225 ;   ;Cum. Subcontracting Paragraph;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                          Part Group=FIELD(Part Group),
                                                                                                                          Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Subcontracting Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 230 ;   ;Subcontracting Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part Group=FIELD(Part Group),
                                                                                                                      Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 235 ;   ;Cum. Subcontracting Chapter;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                          Part Group=FIELD(Part Group),
                                                                                                                          Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Subcontracting Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Subcontracting Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Subcontracting Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Subcontracting Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 245 ;   ;Cum. Subcontracting Total;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                          Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                          Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Subcontracting Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Plant Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Part=FIELD(Part)));
                                                   CaptionML=ENU=Plant Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 255 ;   ;Cum. Plant Part     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Part=FIELD(Part)));
                                                   CaptionML=ENU=Cum. Plant Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Plant Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 265 ;   ;Cum. Plant Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Plant Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Plant Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group),
                                                                                                             Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 275 ;   ;Cum. Plant Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group),
                                                                                                                 Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Plant Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Plant Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Plant Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                             Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                             Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Plant Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 285 ;   ;Cum. Plant Total    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line OLD"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                 Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                 Part Group=FIELD(Part Group)));
                                                   CaptionML=ENU=Cum. Plant Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 290 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   CaptionML=ENU=Norm Group }
    { 300 ;   ;Element             ;Code20        ;TableRelation="Base Element".Code;
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Element }
    { 305 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                UpdateProjElem(0);
                                                              END;

                                                   CaptionML=ENU=Project No. }
    { 310 ;   ;Text                ;Text250       ;CaptionML=ENU=Text }
    { 315 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line (Group)" WHERE (Table Name=CONST(Estimate),
                                                                                                   Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FIELD(Part Group),
                                                                                                   Part=FIELD(Part),
                                                                                                   Estimate Line No.=CONST(0)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=No }
    { 316 ;   ;Print on Quote      ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11012154;
                                                              BEGIN
                                                                //X007
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE("Print on Quote", "Print on Quote");
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO("Print on Quote"));
                                                              END;

                                                   CaptionML=ENU=Print on Quote;
                                                   Description=X007 }
    { 317 ;   ;Extension           ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11012154;
                                                              BEGIN
                                                                //X007
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE(Extension, Extension);
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO(Extension));
                                                              END;

                                                   CaptionML=ENU=Extension;
                                                   Description=X007 }
    { 320 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1);
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 321 ;   ;Adjustment Factor Material;Decimal ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2);
                                                              END;

                                                   CaptionML=ENU=Material Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 322 ;   ;Adjustment Factor Subcontr.;Decimal;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(3);
                                                              END;

                                                   CaptionML=ENU=Subcontr. Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 323 ;   ;Adjustment Factor Plant;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(4);
                                                              END;

                                                   CaptionML=ENU=Plant Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 324 ;No ;Adjustment Factor Sundry;Decimal   ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(5);
                                                              END;

                                                   CaptionML=ENU=Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0;
                                                   Description=DP00381 }
    { 325 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=ENU=Hours Cum. Adj. Factor Hours;
                                                   DecimalPlaces=0:6 }
    { 326 ;   ;Cum. Adj. Factor Material;Decimal  ;CaptionML=ENU=Material Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 327 ;   ;Cum. Adj. Factor Subcontr.;Decimal ;CaptionML=ENU=Subcontr. Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 328 ;   ;Cum. Adj. Factor Plant;Decimal     ;CaptionML=ENU=Plant Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 329 ;No ;Cum. Adj. Factor Sundry;Decimal    ;CaptionML=ENU=Cum. Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   Description=DP00381 }
    { 330 ;   ;Code                ;Code20        ;OnValidate=BEGIN
                                                                EstRec.GET("Estimate No.");
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  FormatMgt.SetSelection(EstRec."Coding System");
                                                                  FormatMgt.FormatElem(Code,4,'');
                                                                  CodeRec.GET(EstRec."Coding System", Code);
                                                                END;

                                                                MODIFY;
                                                                UpdateEst.UpdateCode("Estimate No.", "Sub-Estimate No.", Part, Code, TRUE);
                                                              END;

                                                   OnLookup=BEGIN
                                                              EstRec.GET("Estimate No.");
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=ENU=Code }
    { 340 ;   ;Target Hours        ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Amount Labor", 0);
                                                              END;

                                                   CaptionML=ENU=Target Hours }
    { 341 ;   ;Target Amount Labor ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Hours", 0);
                                                              END;

                                                   CaptionML=ENU=Target Amount Labor }
    { 342 ;   ;Target Amount Material;Decimal     ;CaptionML=ENU=Target Amount Material }
    { 343 ;   ;Target Amount Subcontracting;Decimal;
                                                   CaptionML=ENU=Target Amount Subcontracting }
    { 344 ;   ;Target Amount Plant ;Decimal       ;CaptionML=ENU=Target Amount Plant }
    { 345 ;No ;Target Amount Sundry;Decimal       ;CaptionML=ENU=Target Amount Sundry;
                                                   Description=DP00381 }
    { 350 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Condition }
    { 360 ;   ;Excel Estimate Template;Text50     ;OnValidate=BEGIN
                                                                IF (xRec."Excel Estimate Template" <> Rec."Excel Estimate Template") AND ExcelFileExists THEN
                                                                  IF CONFIRM(Text005,TRUE,FIELDCAPTION("Excel Estimate Template")) THEN
                                                                    FileMgt.DeleteClientFile4PS(ExcelEstimateMgt.GetPathFileName(Rec), TRUE)
                                                                  ELSE
                                                                    ERROR(Text006,FIELDCAPTION("Excel Estimate Template"));

                                                                IF CheckValidExcelTemplate(TRUE) THEN;
                                                              END;

                                                   OnLookup=VAR
                                                              lvEstimateSetupRec@1100485001 : Record 11012150;
                                                              lvExcelTemplate@1100485002 : Text[250];
                                                              DirectoryName@1100525000 : Text;
                                                              FileAbsPathName@1100525001 : Text;
                                                            BEGIN
                                                              lvEstimateSetupRec.GET;
                                                              DirectoryName := lvEstimateSetupRec."Pathname Excel Est. Template";
                                                              IF FileMgt.SelectFile('xlt', DirectoryName, lvExcelTemplate, FileAbsPathName) THEN
                                                                VALIDATE("Excel Estimate Template",lvExcelTemplate);
                                                            END;

                                                   CaptionML=ENU=Excel Estimate Template }
    { 370 ;   ;Updated form Excel  ;Boolean       ;CaptionML=ENU=Updated form Excel;
                                                   Editable=No }
    { 380 ;   ;Vendor              ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=ENU=Vendor }
    { 381 ;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=ENU=Vendor Name;
                                                   Editable=No }
    { 390 ;   ;Subcontractor       ;Code20        ;TableRelation=Vendor.No. WHERE (Subcontractor=CONST(Yes));
                                                   CaptionML=ENU=Subcontractor }
    { 391 ;   ;Subcontractor Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=ENU=Subcontractor Name;
                                                   Editable=No }
    { 400 ;   ;Quantity Model Exist;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Model Line Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                           Part Group=FIELD(Part Group),
                                                                                                           Part=FIELD(Part)));
                                                   CaptionML=ENU=Quantity Model Exist;
                                                   Editable=No }
    { 410 ;   ;Object No.          ;Code20        ;TableRelation="Standard Object".No.;
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Object No. }
    { 420 ;   ;Object Customer     ;Code20        ;CaptionML=ENU=Object Customer }
    { 450 ;   ;Capacity            ;Decimal       ;CaptionML=ENU=Capacity;
                                                   BlankNumbers=BlankZero }
    { 451 ;   ;Capacity Unit       ;Code10        ;TableRelation="Unit of Measure";
                                                   CaptionML=ENU=Capacity Unit }
    { 452 ;   ;Construction Year   ;Integer       ;OnValidate=BEGIN
                                                                EvaluateExpectedLifeSpan(FIELDNO("Construction Year"));
                                                              END;

                                                   CaptionML=ENU=Construction Year;
                                                   BlankNumbers=BlankZero }
    { 453 ;   ;Theoretical Life Span;DateFormula  ;CaptionML=ENU=Theoretical Life Span }
    { 454 ;   ;Expected Life Span  ;DateFormula   ;OnValidate=BEGIN
                                                                EvaluateExpectedLifeSpan(FIELDNO("Expected Life Span"));
                                                              END;

                                                   CaptionML=ENU=Expected Life Span }
    { 455 ;   ;Desired Condition   ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Desired Condition }
    { 456 ;   ;Actual Condition    ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Actual Condition }
    { 457 ;   ;Use Time            ;Decimal       ;CaptionML=ENU=Use Time (Hours/Week);
                                                   DecimalPlaces=2: }
    { 458 ;   ;Object Type         ;Text30        ;CaptionML=ENU=Object Type }
    { 459 ;   ;Object Brand        ;Text30        ;CaptionML=ENU=Object Brand }
    { 460 ;   ;Investment Year     ;Integer       ;CaptionML=ENU=Investment Year;
                                                   BlankNumbers=BlankZero }
    { 500 ;   ;Settlement Type     ;Option        ;OnValidate=BEGIN
                                                                //validate unit price to recalculate the settlement price
                                                                //VALIDATE("Unit Price");
                                                              END;

                                                   CaptionML=ENU=Settlement Type;
                                                   OptionCaptionML=ENU=" ,Non Settling,Settling,Approved,Reduction,Open";
                                                   OptionString=[ ,Non Settling,Settling,Approved,Reduction,Open] }
    { 510 ;   ;Settlement Status   ;Code10        ;TableRelation="Sub-Estimate Part Status".Status;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Settlement Status Description");
                                                              END;

                                                   CaptionML=ENU=Settlement Status }
    { 511 ;   ;Settlement Status Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sub-Estimate Part Status".Description WHERE (Status=FIELD(Settlement Status)));
                                                   CaptionML=ENU=Settlement Status Description;
                                                   Editable=No }
    { 600 ;   ;Quantity per Unit   ;Decimal       ;CaptionML=ENU=Quantity per Unit;
                                                   Description=DP00686 }
    { 601 ;   ;Unit of Qty per Unit;Code20        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Qty per Unit;
                                                   Description=DP00686 }
    { 610 ;   ;Calculated Amount   ;Decimal       ;CaptionML=ENU=Calculated Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 611 ;   ;Calculated Price    ;Decimal       ;CaptionML=ENU=Calculated Price;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 620 ;   ;Offer Amount        ;Decimal       ;OnValidate=BEGIN
                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN
                                                                  "Offer Price" := "Offer Amount" / CumQuan;
                                                                ProcessSalesOfferPrices;
                                                              END;

                                                   CaptionML=ENU=Offer Amount;
                                                   AutoFormatType=1 }
    { 621 ;   ;Offer Price         ;Decimal       ;OnValidate=BEGIN
                                                                CumQuan := GetPartQuantity;
                                                                "Offer Amount" := CumQuan * "Offer Price";
                                                                ProcessSalesOfferPrices;
                                                              END;

                                                   CaptionML=ENU=Offer Price;
                                                   AutoFormatType=1 }
    { 622 ;   ;Margin %            ;Decimal       ;CaptionML=ENU=Margin % }
    { 623 ;   ;Sales Comment       ;Text250       ;CaptionML=ENU=Sales Comment }
    { 624 ;   ;Transfer to Installment M.;Boolean ;CaptionML=ENU=Transfer to Installment Motivation }
    { 625 ;   ;Offer fixed         ;Boolean       ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Offer fixed"));  //db, 27-05-10
                                                              END;

                                                   CaptionML=ENU=Offer fixed }
    { 626 ;   ;Markup %            ;Decimal       ;CaptionML=ENU=Markup % }
    { 650 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");

                                                                UpdateProjPlanActCode;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Project Planning Activity Code }
    { 660 ;No ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   CaptionML=ENU=Extension Contract;
                                                   Description=DP00260 }
    { 700 ;   ;Lines Exist         ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Line OLD" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                Part Group=FIELD(Part Group),
                                                                                                Part=FIELD(Part)));
                                                   OnLookup=VAR
                                                              EstimateManagementRTC@1100525000 : Codeunit 11130010;
                                                            BEGIN
                                                            END;

                                                   CaptionML=ENU=Lines;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 900 ;   ;Treeview Level      ;Integer       ;CaptionML=ENU=Treeview Level }
    { 1000;   ;OnTempTable         ;Boolean       ;CaptionML=ENU=Temp table;
                                                   Editable=No }
    { 2000;No ;Reserved range DP00381;Text1       ;CaptionML=ENU=Cost Type (Price);
                                                   Description=DP00381: range above 2000 reserved }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part;
                                                   SumIndexFields=Offer Amount,Calculated Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Estimate No.,Sub-Estimate No.,Level,Chapter,Paragraph;
                                                   SumIndexFields=Offer Amount,Calculated Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Element                     ;MaintainSIFTIndex=No }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstRec@11012000 : Record 11012151;
      SubEstRec@1210190002 : Record 11012152;
      EstPartRec@1210190001 : Record 11012153;
      EstLineRec@11012001 : Record 11012154;
      RecipeRec@11012002 : Record 11012156;
      EstCodeRec@1210190013 : Record 11012194;
      CodeRec@1210190014 : Record 11012089;
      ChrgRec@11012004 : Record 11012175;
      TextRec@1210190005 : Record 11020595;
      QuanSheetRec@1210190011 : Record 11012186;
      QuanModelRec@1210190015 : Record 11012197;
      PartRec@11012006 : Record 11012169;
      ElemRec@1210190004 : Record 11012060;
      ProjElemRec@1210190003 : Record 11012010;
      FormatMgt@11012007 : Codeunit 11012022;
      Text001@1210190000 : TextConst 'ENU="Rename disabled; use copy function and delete original line afterwards."';
      UpdateEst@1210190012 : Codeunit 11012155;
      ExcelEstimateMgt@1100485000 : Codeunit 11020203;
      Text003@1100485001 : TextConst 'ENU="A %1 on a lower %2 is present. "';
      Text004@1100485002 : TextConst 'ENU="A %1 on a higher %2 is present. "';
      Text005@1100485003 : TextConst 'ENU=The existing Excelfile doesn''t match %1 anymore, remove Excelfile is removed.';
      Text006@1100485004 : TextConst 'ENU=%1 is not changed.';
      Text007@1100485005 : TextConst 'ENU=%1 %2 doesn''t exist.';
      Text008@1100485007 : TextConst 'ENU=Price is Fixed on level (%1).';
      Text009@1100485008 : TextConst 'ENU=Price is Fixed on level (%1).';
      FileMgt@1100525011 : Codeunit 419;
      CumQuan@1100525000 : Decimal;
      Text999@1100525001 : TextConst 'ENU=Convert Estimate: old Estimate Module is expired';

    PROCEDURE InitAdjustmentFactor@1210190003();
    VAR
      CurrLevel@1210190000 : Integer;
    BEGIN
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Material" = 0 THEN
        "Adjustment Factor Material" := 1;
      IF "Adjustment Factor Subcontr." = 0 THEN
        "Adjustment Factor Subcontr." := 1;
      IF "Adjustment Factor Plant" = 0 THEN
        "Adjustment Factor Plant" := 1;

      CurrLevel := Level;

      IF CurrLevel <> 0 THEN BEGIN
        EstPartRec.RESET;
        EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
        EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstPartRec.SETRANGE("Part Group", "Part Group");
        IF CurrLevel = 3 THEN BEGIN
          EstPartRec.SETRANGE(Part, Paragraph);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 2 THEN BEGIN
          EstPartRec.SETRANGE(Part, Chapter);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 1 THEN BEGIN
          EstPartRec.SETRANGE(Part);
          EstPartRec.SETRANGE(Level, 0);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel <> 0 THEN BEGIN
          IF EstPartRec."Cum. Adj. Factor Hours" = 0 THEN
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
          ELSE
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * EstPartRec."Cum. Adj. Factor Hours";
          IF EstPartRec."Cum. Adj. Factor Material" = 0 THEN
            "Cum. Adj. Factor Material" := "Adjustment Factor Material"
          ELSE
            "Cum. Adj. Factor Material" := "Adjustment Factor Material" * EstPartRec."Cum. Adj. Factor Material";
          IF EstPartRec."Cum. Adj. Factor Subcontr." = 0 THEN
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
          ELSE
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * EstPartRec."Cum. Adj. Factor Subcontr.";
          IF EstPartRec."Cum. Adj. Factor Plant" = 0 THEN
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
          ELSE
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * EstPartRec."Cum. Adj. Factor Plant";
        END;
      END;

      IF CurrLevel = 0 THEN BEGIN
        SubEstRec.GET("Estimate No.","Sub-Estimate No.");
        IF SubEstRec."Cum. Adj. Factor Hours" = 0 THEN
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
        ELSE
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * SubEstRec."Cum. Adj. Factor Hours";
        IF SubEstRec."Cum. Adj. Factor Material" = 0 THEN
          "Cum. Adj. Factor Material" := "Adjustment Factor Material"
        ELSE
          "Cum. Adj. Factor Material" := "Adjustment Factor Material" * SubEstRec."Cum. Adj. Factor Material";
        IF SubEstRec."Cum. Adj. Factor Subcontr." = 0 THEN
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
        ELSE
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * SubEstRec."Cum. Adj. Factor Subcontr.";
        IF SubEstRec."Cum. Adj. Factor Plant" = 0 THEN
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
        ELSE
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * SubEstRec."Cum. Adj. Factor Plant";
      END;
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190001(IAdjType@1210190000 : Integer);
    BEGIN
      CASE IAdjType OF
        1:
          IF "Adjustment Factor Hours" = 0 THEN
            "Adjustment Factor Hours" := 1;
        2:
          IF "Adjustment Factor Material" = 0 THEN
            "Adjustment Factor Material" := 1;
        3:
          IF "Adjustment Factor Subcontr." = 0 THEN
            "Adjustment Factor Subcontr." := 1;
        4:
          IF "Adjustment Factor Plant" = 0 THEN
            "Adjustment Factor Plant" := 1;
      END;
      MODIFY;

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          UpdateEst.ResetAdjustmentFactor(EstPartRec."Estimate No.", EstPartRec."Sub-Estimate No.",
            EstPartRec."Part Group", EstPartRec.Part, 0, TRUE, 2, IAdjType);
        UNTIL EstPartRec.NEXT = 0;
      END;

      GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
    END;

    PROCEDURE ProcessPartQuantity@1210190002();
    BEGIN
      MODIFY;

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          EstLineRec.RESET;
          EstLineRec.SETRANGE("Estimate No.", EstPartRec."Estimate No.");
          EstLineRec.SETRANGE("Sub-Estimate No.", EstPartRec."Sub-Estimate No.");
          EstLineRec.SETRANGE("Part Group", EstPartRec."Part Group");
          EstLineRec.SETRANGE(Part, EstPartRec.Part);
          IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
            REPEAT
              EstLineRec.VALIDATE(Quantity);  //incl. CalculateTotal + UpdateRecipeTotal
              EstLineRec.MODIFY;
            UNTIL EstLineRec.NEXT = 0;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckFormat@1100485000(VAR sp1@1100485004 : Integer;VAR sp2@1100485005 : Integer);
    VAR
      EstSetupRec@11012000 : Record 11012150;
      lvText000@1100485000 : TextConst 'ENU=only 3 levels allowed';
      x@1100485002 : Integer;
      lp@1100485001 : Integer;
    BEGIN
      x := 0;
      sp1 := 0;
      sp2 := 0;

      EstSetupRec.GET();
      EstSetupRec.TESTFIELD("Part Format");
      lp := STRLEN(EstSetupRec."Part Format");

      REPEAT
        x := x + 1;
        IF COPYSTR(EstSetupRec."Part Format",x,1) = '.' THEN BEGIN
          IF sp1 = 0 THEN
            sp1 := x
          ELSE
            IF sp2 = 0 THEN
              sp2 :=x
            ELSE
              ERROR(lvText000);
        END;
      UNTIL x = lp;
    END;

    PROCEDURE ExcelFileExists@1100485001() : Boolean;
    BEGIN
      EXIT(FileMgt.ClientFileExists(ExcelEstimateMgt.GetPathFileName(Rec)));
    END;

    PROCEDURE CheckValidExcelTemplate@1100485003(iUserInteraction@1100485003 : Boolean) rResult : Boolean;
    VAR
      lvExcelEstimateMgt@1100485002 : Codeunit 11020203;
    BEGIN
      IF "Excel Estimate Template" = '' THEN
        EXIT(TRUE);

      IF NOT FileMgt.ClientFileExists(lvExcelEstimateMgt.GetTemplPathFile(Rec)) THEN
        IF iUserInteraction THEN
          ERROR(Text007,FIELDCAPTION("Excel Estimate Template"),lvExcelEstimateMgt.GetTemplPathFile(Rec))
        ELSE
          EXIT(FALSE);

      IF NOT CheckDownWards(iUserInteraction) THEN
        EXIT(FALSE);

      IF NOT CheckUpwards(iUserInteraction) THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckDownWards@1100485002(iUserInteraction@1100485000 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485005 : Record 11012153;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Part Group","Part Group");

      CASE Level OF
        //0: No Filters
        1: lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
        2: lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
        3: lvSubEstimatePartRec.SETRANGE(Part,Part);
      END;

      lvSubEstimatePartRec.SETFILTER(Level,'>%1',Level);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');

      FILTERGROUP(10);
      lvSubEstimatePartRec.SETFILTER(Part,'<>%1',Part);
      FILTERGROUP(0);
      IF lvSubEstimatePartRec.FINDFIRST THEN
        IF iUserInteraction THEN
          ERROR(Text003,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
        ELSE
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckUpwards@1100485004(iUserInteraction@1100485003 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485002 : Record 11012153;
      lvLevel@1100485000 : Integer;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");

      lvSubEstimatePartRec.SETRANGE(Chapter);
      lvSubEstimatePartRec.SETRANGE(Paragraph);
      lvSubEstimatePartRec.SETRANGE(Part);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');
      lvLevel := Level;
      WHILE lvLevel > 0 DO
        BEGIN
          lvLevel -= 1;
          lvSubEstimatePartRec.SETRANGE(Level,lvLevel);
          CASE lvLevel OF
            0:
              BEGIN
                lvSubEstimatePartRec.SETFILTER(Chapter,'%1','');
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            1:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            2:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
              END;
          END;
          IF lvSubEstimatePartRec.FINDFIRST THEN
            IF iUserInteraction THEN
              ERROR(Text004,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
            ELSE
              EXIT(FALSE);
        END;

      EXIT(TRUE);
    END;

    PROCEDURE CheckExcelTemplateFilled@1100485005();
    VAR
      EstSetup@1100485000 : Record 11012150;
      StdPartRec@1100525001 : Record 11012169;
      ExcelTemplate@1100525000 : Text[250];
    BEGIN
      //db, 28-06-10: M17532
      IF "Excel Estimate Template" = '' THEN BEGIN
        EstSetup.GET;
        IF NOT StdPartRec.GET("Part Group", Part) THEN StdPartRec.INIT;
        IF StdPartRec."Excel Estimate Template" <> '' THEN
          ExcelTemplate := StdPartRec."Excel Estimate Template"
        ELSE
          IF Level = 0 THEN  //db, 24-03-15: C016775
            ExcelTemplate := EstSetup."Excel Estimate Template";
        IF CheckValidExcelTemplate(FALSE) THEN
          VALIDATE("Excel Estimate Template", ExcelTemplate)
        ELSE
          "Excel Estimate Template" := '';
      END;
    END;

    PROCEDURE DeleteExcelFile@1100485006(VAR EstPartRec@1100485001 : Record 11012153);
    VAR
      EstPartRec2@1210190000 : Record 11012153;
    BEGIN
      EstPartRec2.COPY(EstPartRec); //call 23762
      WITH EstPartRec2 DO BEGIN  //call 23762
        IF FINDSET(FALSE, FALSE) THEN
          REPEAT
            IF ExcelFileExists THEN
              FileMgt.DeleteClientFile4PS(
                ExcelEstimateMgt.GetPathFileName(EstPartRec2), TRUE);
          UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE GetPartQuantity@1210190007() PartQuan@1210190000 : Decimal;
    VAR
      lvEstPartRec@1210190001 : Record 11012153;
      lvSubEstRec@1100485000 : Record 11012152;
      CurrLevel@1210190002 : Integer;
    BEGIN
      PartQuan := 1;

      IF lvSubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN
        PartQuan := PartQuan * lvSubEstRec."Cumulative Frequency";

      IF lvEstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN BEGIN

        PartQuan := PartQuan * lvEstPartRec.Quantity;
        CurrLevel := lvEstPartRec.Level;

        lvEstPartRec.RESET;
        lvEstPartRec.SETRANGE("Estimate No.", lvEstPartRec."Estimate No.");
        lvEstPartRec.SETRANGE("Sub-Estimate No.", lvEstPartRec."Sub-Estimate No.");
        lvEstPartRec.SETRANGE("Part Group", lvEstPartRec."Part Group");
        IF CurrLevel = 3 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Paragraph);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 2 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Chapter);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 1 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part);
          lvEstPartRec.SETRANGE(Level, 0);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
      END;

      EXIT(PartQuan);
    END;

    PROCEDURE ProcessSalesOfferPrices@1100485007();
    VAR
      lSubEstPartRec@1100485000 : Record 11012153;
      lLevel@1100485001 : Integer;
      lvPartQty@1100485003 : Decimal;
      NewOfferAmount@1210190003 : Decimal;
      OldOfferAmount@1210190001 : Decimal;
      FixedOfferAmount@1210190002 : Decimal;
      DifferenceAmount@1210190004 : Decimal;
      DifferenceFactor@1210190005 : Decimal;
      TotalOfferAmount@1210190006 : Decimal;
    BEGIN
      IF OnTempTable THEN
        EXIT;

      //db.sn, 04-03-11: M22630
      NewOfferAmount := "Offer Amount";
      OldOfferAmount := xRec."Offer Amount";
      DifferenceAmount := NewOfferAmount - OldOfferAmount;

      //mg.so, 04-07-11: M27469
      //lSubEstPartRec2.SETRANGE("Estimate No.", "Estimate No.");
      //lSubEstPartRec2.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      //CASE Level OF
      //  1: lSubEstPartRec2.SETRANGE(Chapter, Part);
      //  2: lSubEstPartRec2.SETRANGE(Paragraph, Part);
      //  3: lSubEstPartRec2.SETRANGE(Part, Part);
      //END;
      //lSubEstPartRec2.SETRANGE(Level, Level+1);
      //lSubEstPartRec2.SETRANGE("Offer fixed",TRUE);
      //IF lSubEstPartRec2.FINDSET THEN BEGIN
      //  REPEAT
      //    FixedOfferAmount := FixedOfferAmount + lSubEstPartRec2."Offer Amount";
      //  UNTIL lSubEstPartRec2.NEXT = 0;
      //mg.eo, 04-07-11: M27469

      GetFixedOfferAmount(Rec, FixedOfferAmount); //mg, 04-07-11: M27469

      NewOfferAmount := "Offer Amount" - FixedOfferAmount;
      OldOfferAmount := xRec."Offer Amount" - FixedOfferAmount;
      //END;

      lSubEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lSubEstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lSubEstPartRec.SETRANGE("Offer fixed",FALSE);
      IF OldOfferAmount <> 0 THEN
        DifferenceFactor := NewOfferAmount / OldOfferAmount
      ELSE
        DifferenceFactor := 0;
      //db.en, 04-03-11: M22630

      IF Level < 3 THEN BEGIN
        //Divide price downwards
        lSubEstPartRec.SETRANGE(Level, Level + 1, 3);
        CASE Level OF
          1: BEGIN
               lSubEstPartRec.SETRANGE(Chapter, Part);
             END;
          2: BEGIN
               lSubEstPartRec.SETRANGE(Chapter, Chapter);
               lSubEstPartRec.SETRANGE(Paragraph, Part);
             END;
        END;
        IF lSubEstPartRec.FINDSET THEN BEGIN
          REPEAT
            IF lSubEstPartRec."Offer fixed" THEN
              ERROR(Text009, lSubEstPartRec.Part);
            //mg.sc, 04-07-11: M27469
            FixedOfferAmount := 0;
            GetFixedOfferAmount(lSubEstPartRec, FixedOfferAmount);
            lSubEstPartRec."Offer Amount" := (lSubEstPartRec."Offer Amount" - FixedOfferAmount) * DifferenceFactor + FixedOfferAmount;
            //mg.ec, 04-07-11: M27469
            lvPartQty := lSubEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
               lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount" / lvPartQty;
            END ELSE BEGIN
            //      lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount";
            //      lSubEstPartRec."Offer Amount" := 0;
            END;
            lSubEstPartRec.MODIFY;
          UNTIL lSubEstPartRec.NEXT = 0;
        END;
      END;

      //mg.sn, 04-07-11: M27469
      IF GetTotalOfferAmount(Rec, TotalOfferAmount) THEN BEGIN
        IF "Offer Amount" <> TotalOfferAmount THEN BEGIN
          CumQuan := GetPartQuantity;
          "Offer Amount" := TotalOfferAmount;
          IF CumQuan <> 0 THEN
            "Offer Price" := "Offer Amount" / CumQuan;
          DifferenceAmount := "Offer Amount" - xRec."Offer Amount";
        END;
      END;
      //mg.en, 04-07-11: M27469

      IF Level > 0 THEN BEGIN
        FOR lLevel := Level DOWNTO 1 DO BEGIN
          lSubEstPartRec.RESET;
          lSubEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          lSubEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          lSubEstPartRec.SETRANGE("Offer fixed",FALSE);
          CASE lLevel OF
            3: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter, Chapter);
                 lSubEstPartRec.SETRANGE(Paragraph, Paragraph);
               END;
            2: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter, Chapter);
                 lSubEstPartRec.SETRANGE(Paragraph);
               END;
            1: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter);
               END;
          END;
          IF lSubEstPartRec.FINDFIRST THEN BEGIN
            IF lSubEstPartRec."Offer fixed" THEN
              ERROR(Text008, lSubEstPartRec.Part);
            lSubEstPartRec."Offer Amount" := lSubEstPartRec."Offer Amount" + DifferenceAmount;
            lvPartQty := lSubEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
              lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount" / lvPartQty;
            END ELSE BEGIN
              lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount";
              lSubEstPartRec."Offer Amount" := 0;
             END;
             lSubEstPartRec.MODIFY;
          END;
        END;
      END;
    END;

    PROCEDURE UpdateProjElem@1100525000(lvAction@1100485000 : Integer);
    VAR
      lvEstLineRec@1100485001 : Record 11012154;
    BEGIN
      //db, 09-10-08: M12124
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      IF lvAction = 0 THEN
        lvEstLineRec.SETFILTER("Project No.", '%1|%2', '', xRec."Project No.")
      ELSE
        lvEstLineRec.SETFILTER(Element, '%1|%2', '', xRec.Element);
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvAction = 0 THEN
            lvEstLineRec.VALIDATE("Project No.", "Project No.")
          ELSE
            lvEstLineRec.VALIDATE(Element, Element);
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetEstLineFilterFromEstPart@1100525001(VAR EstLine@1100525003 : Record 11012154);
    VAR
      SubEst@1100525002 : Record 11012152;
    BEGIN
      SubEst.GET("Estimate No.","Sub-Estimate No.");

      EstLine.RESET;
      EstLine.SETRANGE("Estimate No.",SubEst."Estimate No.");
      EstLine.SETRANGE("Chapter (Sub-Estimate)",SubEst.Chapter);
      IF SubEst.Level >= 1 THEN
        IF SubEst.Paragraph <> '' THEN //workaround for empty paragraph when only two levels are used (e.g.: xxx.xxx)
          EstLine.SETRANGE("Paragraph (Sub-Estimate)",SubEst.Paragraph)
        ELSE
          EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");
      IF SubEst.Level >= 2 THEN
        EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");

      IF Level >= 1 THEN
        EstLine.SETRANGE(Chapter,Chapter);
      IF Level >= 2 THEN
        EstLine.SETRANGE(Paragraph,Paragraph);
      IF Level >= 3 THEN
        EstLine.SETRANGE(Part,Part);
    END;

    PROCEDURE EvaluateExpectedLifeSpan@1100525002(CalledBy@1100525002 : Integer);
    VAR
      lvDate1@1100525000 : Date;
      lvDate2@1100525001 : Date;
    BEGIN
      IF (CalledBy = FIELDNO("Construction Year")) OR
         (CalledBy = FIELDNO("Expected Life Span")) THEN BEGIN
        IF ("Construction Year" = 0) OR (FORMAT("Expected Life Span") = '') THEN EXIT;
        lvDate1 := DMY2DATE(1, 1, "Construction Year");
        lvDate2 := CALCDATE("Expected Life Span", lvDate1);
        "Investment Year" := DATE2DMY(lvDate2,3);
      END;

      IF (CalledBy = FIELDNO("Investment Year")) THEN BEGIN
        //conversion to dateformula may be different for each language
      END;
    END;

    PROCEDURE GetMargin@1100525003(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iOfferPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iOfferPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE GetMarkup@1100525006(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iCostPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iCostPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE ProcessPartFields@1100525004(CalledBy@1100525001 : Integer);
    VAR
      EstPartRec@1100525000 : Record 11012153;
    BEGIN
      //db, 27-05-10: T4776
      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.",Level,Chapter,Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      EstPartRec.SETFILTER(Level, '%1..', Level+1);
      IF EstPartRec.FINDSET THEN BEGIN
        REPEAT
          IF CalledBy = FIELDNO("Offer fixed") THEN BEGIN
            EstPartRec.VALIDATE("Offer fixed", "Offer fixed");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Print on Quote") THEN BEGIN  //X007
            EstPartRec.VALIDATE("Print on Quote", "Print on Quote");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO(Extension) THEN BEGIN  //X007
            EstPartRec.VALIDATE(Extension, Extension);
            EstPartRec.MODIFY;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards@1100525005(iPartRec@1100525001 : Record 11012153);
    BEGIN
      //db, 26-07-10: M20060
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF NOT "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            EstPartRec."Offer fixed" := "Offer fixed";
            EstPartRec.MODIFY;
            CheckOfferFixedUpwards(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards1@1100525007(iPartRec@1100525001 : Record 11012153);
    VAR
      EstPartRec2@1100525000 : Record 11012153;
    BEGIN
      //db, 03-08-10: M22083
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            IF NOT EstPartRec."Offer fixed" THEN BEGIN
              EstPartRec2.RESET;
              EstPartRec2.SETRANGE("Estimate No.", "Estimate No.");
              EstPartRec2.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
              EstPartRec2.SETRANGE("Part Group", "Part Group");
              EstPartRec2.SETFILTER(Part, '<>%1', Part);
              CASE EstPartRec.Level OF
                1: EstPartRec2.SETRANGE(Chapter, EstPartRec.Chapter);
                2: EstPartRec2.SETRANGE(Paragraph, EstPartRec.Paragraph);
              END;
              EstPartRec2.SETRANGE(Level, Level);
              EstPartRec2.SETRANGE("Offer fixed", FALSE);
              IF EstPartRec2.FINDSET THEN BEGIN
                EXIT;
              END ELSE BEGIN
                EstPartRec."Offer fixed" := "Offer fixed";
                EstPartRec.MODIFY;
              END;
            END;
            CheckOfferFixedUpwards1(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE PartHasLowerLevels@1100525008() : Boolean;
    VAR
      SubEstimatePart@1100525000 : Record 11012153;
    BEGIN
      //mg, 07-12-10: M22588
      IF Level = 3 THEN
        EXIT;
      SubEstimatePart.SETRANGE("Estimate No.", "Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      SubEstimatePart.SETRANGE("Part Group", "Part Group");
      SubEstimatePart.SETRANGE(Level, Level +1);
      CASE Level +1 OF
        2:
          SubEstimatePart.SETRANGE(Chapter, Chapter);
        3:
          BEGIN
            SubEstimatePart.SETRANGE(Chapter, Chapter);
            SubEstimatePart.SETRANGE(Paragraph, Part);
          END;
      END;
      EXIT(NOT SubEstimatePart.ISEMPTY);
    END;

    PROCEDURE DeleteSubPartsLowerLevel@1210190000();
    VAR
      SubEstimatePart@1210190000 : Record 11012153;
    BEGIN
      //Call 23762.sn
      IF Level = 3 THEN
        EXIT;

      SubEstimatePart.SETRANGE("Estimate No.", "Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      SubEstimatePart.SETRANGE("Part Group", "Part Group");
      IF Level > 0 THEN
        SubEstimatePart.SETRANGE(Chapter, Chapter);
      IF Level = 2 THEN
        SubEstimatePart.SETRANGE(Paragraph, Paragraph);
      SubEstimatePart.SETRANGE(Level, Level + 1);
      IF SubEstimatePart.FINDSET THEN
        REPEAT
          SubEstimatePart.DELETE(TRUE);
          COMMIT;
        UNTIL SubEstimatePart.NEXT = 0;
      //Call 23762.en
    END;

    PROCEDURE GetFixedOfferAmount@1210190005(ISubEstimatePart@1210190000 : Record 11012153;VAR FixedOfferAmount@1210190001 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190002 : Record 11012153;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      //SubEstimatePart.SETRANGE("Offer fixed",TRUE);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetFixedOfferAmount(SubEstimatePart, FixedOfferAmount) THEN
            IF SubEstimatePart."Offer fixed" THEN
              FixedOfferAmount += SubEstimatePart."Offer Amount";
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE GetTotalOfferAmount@1210190004(ISubEstimatePart@1210190000 : Record 11012153;VAR TotalOfferAmount@1210190002 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190001 : Record 11012153;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetTotalOfferAmount(SubEstimatePart, TotalOfferAmount) THEN
            TotalOfferAmount += SubEstimatePart."Offer Amount";
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE CopyPartText@1210190021();
    VAR
      TextRec@1100485000 : Record 11020595;
      TextRec2@1100485001 : Record 11020595;
      CurrLino@1100525001 : Integer;
    BEGIN
      //db, 28-11-11: M30268
      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETFILTER(Group, '%1', '');
      TextRec.SETFILTER("No.", '%1', '');
      TextRec.SETRANGE("Estimate No.", "Estimate No.");
      TextRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, Part);
      TextRec.SETRANGE("Estimate Line No.", 0);
      IF TextRec.FINDFIRST THEN
        EXIT;

      TextRec.RESET;
      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, Part);
      TextRec.SETFILTER("Estimate No.", '%1', '');
      CurrLino := 0;
      IF TextRec.FINDSET THEN BEGIN
        REPEAT
          TextRec2.COPY(TextRec);
          TextRec2."Created by" := USERID;
          TextRec2."Time Created" := TIME;

          TextRec2."Estimate No." := "Estimate No.";
          TextRec2."Sub-Estimate No." := "Sub-Estimate No.";
          CurrLino := CurrLino + 10000;
          TextRec2."Line No." := CurrLino;
          TextRec2.INSERT;
        UNTIL TextRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateProjPlanActCode@1210190022();
    VAR
      lvEstLineRec@1210190000 : Record 11012154;
    BEGIN
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);

      lvEstLineRec.SETFILTER("Project Planning Activity Code", '%1|%2', '', xRec."Project Planning Activity Code");

      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Project Planning Activity Code", "Project Planning Activity Code");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::Estimate), DocumentLinkRIDs,
        '', ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE InitRecord@1210190006();
    BEGIN
      // 34595.n
      IF SubEstRec.GET("Estimate No.","Sub-Estimate No.") THEN BEGIN
        "Project No." := SubEstRec."Project No.";
        Element := SubEstRec.Element;
        "Project Planning Activity Code" := SubEstRec."Project Planning Activity Code";
        "Part Group" := SubEstRec."Part Group";
      END;
    END;

    PROCEDURE GetDataCaption@1100528000() : Text[250];
    BEGIN
      EXIT(STRSUBSTNO('%1 - %2 - %3 - %4 - %5', "Estimate No.", "Sub-Estimate No.", "Part Group", Part, Description));
    END;

    PROCEDURE GetPreviousPart@1100528001(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      IF Level = 0 THEN
        EXIT;

      SETRANGE("Estimate No.", "Estimate No.");
      SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");

      CASE JumpLevel OF
        0 : EXIT(NEXT(-1) <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDFIRST;
              SETRANGE(Paragraph);
              IF NEXT(-1) = 0 THEN BEGIN
                SETRANGE(Chapter);
                IF NEXT(-1) = 0 THEN
                  EXIT(TRUE);
                SETRANGE(Chapter, Chapter);
              END;

              SETRANGE(Paragraph, Paragraph);
              EXIT(FINDFIRST);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDFIRST;
              SETRANGE(Chapter);
              IF NEXT(-1) = 0 THEN
                EXIT(TRUE)
              ELSE BEGIN
                SETRANGE(Chapter, Chapter);
                EXIT(FINDFIRST);
              END;
            END;
       END;
    END;

    PROCEDURE GetNextPart@1100528002(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      IF Level = 0 THEN
        EXIT(NEXT <> 0);

      SETRANGE("Estimate No.", "Estimate No.");
      SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");

      CASE JumpLevel OF
        0 : EXIT(NEXT <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDLAST;
              SETRANGE(Chapter);
              SETRANGE(Paragraph);
              IF NEXT = 0 THEN;
              EXIT(TRUE);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDLAST;
              SETRANGE(Chapter);
              IF NEXT = 0 THEN;
              EXIT(TRUE)
            END;
      END;
    END;

    BEGIN
    END.
  }
}

