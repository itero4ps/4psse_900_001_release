OBJECT Table 11020421 Unit Price Line
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    OnInsert=VAR
               lvUnitPriceLineRec@1100485000 : Record 11020421;
             BEGIN
               IF "Line No." = 0 THEN BEGIN
                 lvUnitPriceLineRec.SETRANGE("Customer No.", "Customer No.");
                 lvUnitPriceLineRec.SETRANGE("Price List", "Price List");
                 lvUnitPriceLineRec.SETRANGE("Unit Price", "Unit Price");
                 IF lvUnitPriceLineRec.FINDLAST THEN
                   "Line No." := lvUnitPriceLineRec."Line No." + 10000
                 ELSE
                   "Line No." := 10000;
               END;
             END;

    CaptionML=ENU=Unit Price Line;
  }
  FIELDS
  {
    { 10  ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   CaptionML=ENU=Customer }
    { 20  ;   ;Price List          ;Code10        ;TableRelation="Price List".Code WHERE (Customer No.=FIELD(Customer No.));
                                                   CaptionML=ENU=Price List }
    { 30  ;   ;Unit Price          ;Code20        ;CaptionML=ENU=Unit Price }
    { 35  ;   ;Start Date          ;Date          ;CaptionML=ENU=Start Date }
    { 40  ;   ;Line No.            ;Integer       ;CaptionML=ENU=Line No. }
    { 50  ;   ;Cost Object         ;Code20        ;TableRelation=IF (Cost Type=CONST(Labor)) "Dimension Value".Code WHERE (Cost Type=FILTER(Labor),
                                                                                                                           Global Dimension No.=CONST(2))
                                                                                                                           ELSE IF (Cost Type=CONST(Material)) "Dimension Value".Code WHERE (Cost Type=FILTER(Material),
                                                                                                                                                                                             Global Dimension No.=CONST(2))
                                                                                                                                                                                             ELSE IF (Cost Type=CONST(Plant)) "Dimension Value".Code WHERE (Cost Type=FILTER(Plant),
                                                                                                                                                                                                                                                            Global Dimension No.=CONST(2))
                                                                                                                                                                                                                                                            ELSE IF (Cost Type=CONST(Sundry)) "Dimension Value".Code WHERE (Cost Type=FILTER(Sundry),
                                                                                                                                                                                                                                                                                                                            Global Dimension No.=CONST(2))
                                                                                                                                                                                                                                                                                                                            ELSE IF (Cost Type=CONST(Subcontracting)) "Dimension Value".Code WHERE (Cost Type=FILTER(Subcontracting),
                                                                                                                                                                                                                                                                                                                                                                                                    Global Dimension No.=CONST(2));
                                                   OnValidate=BEGIN
                                                                IF "Cost Object" <> '' THEN
                                                                  IF xRec."Cost Object" = '' THEN
                                                                    GetDefaultsCostObject()
                                                                  ELSE
                                                                    IF "Cost Object" <> xRec."Cost Object" THEN
                                                                      IF "Item No." + "Basic Item" + "Trade Item" = '' THEN
                                                                        IF CONFIRM(Text000 + Text001) THEN
                                                                          GetDefaultsCostObject();
                                                              END;

                                                   CaptionML=ENU=Cost Object }
    { 60  ;   ;Cost Type           ;Option        ;OnValidate=BEGIN
                                                                IF "Cost Object" <> '' THEN BEGIN
                                                                  IF "Cost Type" <> xRec."Cost Type" THEN
                                                                    IF CONFIRM(Text004,TRUE) THEN BEGIN
                                                                      "Cost Object" := '';
                                                                      //only fill fields below for cost type plant
                                                                      "Item No." := '';
                                                                      "Basic Item" := '';
                                                                      "Trade Item" := '';
                                                                      Manufacturer := '';
                                                                      "Vendor (Trade Item)" := '';
                                                                      "Gross Price" := 0;
                                                                      "Purchase Discount %" := 0;
                                                                      "Cost Price" := 0;
                                                                      "Sales Price" := 0;
                                                                    END ELSE BEGIN
                                                                      "Cost Type" := xRec."Cost Type";
                                                                      EXIT;
                                                                    END;
                                                                END;

                                                                IF ("Cost Type" <> "Cost Type"::Labor) THEN BEGIN
                                                                  IF ("Gross Price" <> 0) THEN
                                                                    "Cost Price" := Norm * "Gross Price";
                                                                  "Budget Rate Code" := '';
                                                                  "Gross Price" := 0;
                                                                  Norm := 0;
                                                                END;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Cost Type;
                                                   OptionCaptionML=ENU=Labor,Material,Subcontracting,Plant,Sundry;
                                                   OptionString=Labor,Material,Subcontracting,Plant,Sundry }
    { 70  ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=BEGIN
                                                                IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::Item);
                                                                END;
                                                                CheckClearItemData();
                                                              END;

                                                   CaptionML=ENU=Item No. }
    { 80  ;   ;Manufacturer        ;Code15        ;TableRelation="ETIM Vendor (Central Mgt)";
                                                   CaptionML=ENU=Manufacturer }
    { 90  ;   ;Basic Item          ;Code20        ;TableRelation="Basic Item"."Product Code" WHERE (Manufacturer=FIELD(Manufacturer));
                                                   OnValidate=BEGIN
                                                                IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Basic Item");
                                                                END;
                                                                CheckClearItemData();
                                                              END;

                                                   CaptionML=ENU=Basic Item }
    { 100 ;   ;Vendor (Trade Item) ;Code15        ;TableRelation="ETIM Vendor (Central Mgt)";
                                                   OnValidate=VAR
                                                                TradeItemRec@1100525000 : Record 11012317;
                                                                lvExecValidate@1100485000 : Boolean;
                                                              BEGIN
                                                                IF ("Vendor (Trade Item)" <> xRec."Vendor (Trade Item)") AND ("Vendor (Trade Item)" <> '') THEN BEGIN
                                                                  IF "Basic Item" <> '' THEN BEGIN
                                                                    "Trade Item" := '';
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  IF "Trade Item" <> '' THEN BEGIN
                                                                    VALIDATE("Trade Item");
                                                                    lvExecValidate := TRUE;
                                                                  END;
                                                                  //db.sn, 17-12-10: M18021
                                                                  IF lvExecValidate THEN BEGIN
                                                                    IF TradeItemRec.CheckReplaceVendor(
                                                                      xRec."Vendor (Trade Item)", xRec."Trade Item",
                                                                      "Vendor (Trade Item)", "Trade Item") THEN
                                                                      ValidateItem(ItemTypeOpt::"Trade Item")
                                                                    ELSE
                                                                      ValidateItem(ItemTypeOpt::"Trade Vendor");
                                                                  END;
                                                                  //db.en, 17-12-10: M18021
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Vendor (Trade Item) }
    { 110 ;   ;Trade Item          ;Code20        ;TableRelation="Trade Item"."Item Code" WHERE (Vendor=FIELD("Vendor (Trade Item)"));
                                                   OnValidate=BEGIN
                                                                IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
                                                                  ValidateItem(ItemTypeOpt::"Trade Item");
                                                                END;
                                                                CheckClearItemData();
                                                              END;

                                                   CaptionML=ENU=Trade Item }
    { 120 ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 130 ;   ;Description 2       ;Text50        ;CaptionML=ENU=Description 2 }
    { 140 ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 150 ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO("Unit of Measure") THEN BEGIN
                                                                  IF ("Cost Type" = "Cost Type"::Material) THEN
                                                                    IF "Unit of Measure" <>  xRec."Unit of Measure" THEN  //db, 10-02-05
                                                                      CheckItemUnitConversion(Rec, xRec);
                                                                  CalcTotals;
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              HandleLookupUnit;
                                                            END;

                                                   CaptionML=ENU=Unit of Measure }
    { 160 ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN
                                                                  CalcTotals
                                                                ELSE BEGIN
                                                                  MESSAGE(Text002, "Cost Type");
                                                                  Norm := 0;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Norm;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 170 ;   ;Hours               ;Decimal       ;CaptionML=ENU=Hours;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 180 ;   ;Budget Rate Code    ;Code10        ;TableRelation="Budget Rate".Code WHERE (Project Filter=FILTER(''));
                                                   OnValidate=VAR
                                                                lvRateRec@1100485000 : Record 11012000;
                                                              BEGIN
                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
                                                                  "Cost Price" := 0;
                                                                  CALCFIELDS("Reference Date");
                                                                  IF lvRateRec.StandardRate("Budget Rate Code", "Reference Date", "Cost Price") THEN;
                                                                  CalcTotals;
                                                                END ELSE BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Budget Rate Code") THEN
                                                                    MESSAGE(Text003, "Cost Type");
                                                                  "Budget Rate Code" := '';
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Budget Rate Code }
    { 190 ;   ;Hour Rate Code      ;Code10        ;TableRelation="Hour Rate".Code WHERE (Project Filter=FILTER(''),
                                                                                         Principal Filter=FIELD(Customer No.),
                                                                                         Service Contract Filter=FILTER(''));
                                                   OnValidate=BEGIN
                                                                IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
                                                                  "Sales Price" := 0;
                                                                  CALCFIELDS("Reference Date");
                                                                  GetHourRate("Customer No.", "Hour Rate Code", "Reference Date", "Sales Price");
                                                                  CalcTotals;
                                                                END ELSE BEGIN
                                                                  IF CurrFieldNo = FIELDNO("Hour Rate Code") THEN
                                                                    MESSAGE(Text003, "Cost Type");
                                                                  "Hour Rate Code" := '';
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Hour Rate Code }
    { 200 ;   ;Gross Price         ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNettPrice;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Gross Price;
                                                   BlankZero=Yes }
    { 210 ;   ;Purchase Discount % ;Decimal       ;OnValidate=BEGIN
                                                                CalculateNettPrice;
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Purchase Discount %;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 220 ;   ;Cost Price          ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Price;
                                                   BlankZero=Yes;
                                                   AutoFormatType=2 }
    { 230 ;   ;Cost Price Amount   ;Decimal       ;CaptionML=ENU=Amount;
                                                   BlankZero=Yes;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Sales Discount %    ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Sales Discount %;
                                                   BlankZero=Yes }
    { 250 ;   ;Sales Surcharge %   ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Sales Surcharge %;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 260 ;   ;Sales Price         ;Decimal       ;OnValidate=BEGIN
                                                                CalcTotals;
                                                              END;

                                                   CaptionML=ENU=Sales Price;
                                                   BlankZero=Yes }
    { 270 ;   ;Sales Amount        ;Decimal       ;CaptionML=ENU=Sales Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 280 ;   ;Reference Date      ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Unit Price"."Reference Date" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Code=FIELD(Unit Price),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Reference Datet;
                                                   Editable=No }
    { 300 ;   ;Total Cost Price    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price;
                                                   Editable=No }
    { 310 ;   ;Total Sales Price   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price;
                                                   Editable=No }
    { 400 ;   ;Total Cost Price Labor;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Cost Type=CONST(Labor),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price Labor;
                                                   Editable=No }
    { 410 ;   ;Total Sales Price Labor;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Cost Type=CONST(Labor),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price Labor;
                                                   Editable=No }
    { 500 ;   ;Total Cost Price Material;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Cost Type=CONST(Material),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price Material;
                                                   Editable=No }
    { 510 ;   ;Total Sales Price Material;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Cost Type=CONST(Material),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price Material;
                                                   Editable=No }
    { 600 ;   ;Total Cost Price Subc.;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Cost Type=CONST(Subcontracting),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price Subcontracting;
                                                   Editable=No }
    { 610 ;   ;Total Sales Price Subc.;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Cost Type=CONST(Subcontracting),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price Subcontracting;
                                                   Editable=No }
    { 700 ;   ;Total Cost Price Plant;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Cost Type=CONST(Plant),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price Plant;
                                                   Editable=No }
    { 710 ;   ;Total Sales Price Plant;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Cost Type=CONST(Plant),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price Plant;
                                                   Editable=No }
    { 800 ;   ;Total Cost Price Sundry;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Cost Price Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                Price List=FIELD(Price List),
                                                                                                                Unit Price=FIELD(Unit Price),
                                                                                                                Cost Type=CONST(Sundry),
                                                                                                                Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Cost Price Sundry;
                                                   Editable=No }
    { 810 ;   ;Total Sales Price Sundry;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Unit Price Line"."Sales Amount" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                           Price List=FIELD(Price List),
                                                                                                           Unit Price=FIELD(Unit Price),
                                                                                                           Cost Type=CONST(Sundry),
                                                                                                           Start Date=FIELD(Start Date)));
                                                   CaptionML=ENU=Total Sales Price Sundry;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Customer No.,Price List,Unit Price,Start Date,Line No.;
                                                   SumIndexFields=Sales Amount,Cost Price Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Cost Type                               ;SumIndexFields=Sales Amount,Cost Price Amount }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1100485001 : TextConst 'ENU=Copy Data from new Cost Object?\\';
      Text001@1100485000 : TextConst 'ENU=Only empty fields will be filled. Existing data will not be changed.';
      Text002@1100485004 : TextConst 'ENU=Cost Type of Line is %1, input of norm not allowed';
      Text003@1100485005 : TextConst 'ENU=Cost Type of line is %1, input of rate code not allowed.';
      Text004@1100485002 : TextConst 'ENU=Change Cost Type ?';
      ItemTypeOpt@1100485003 : 'Item,Basic Item,Trade Item,Trade Vendor';

    PROCEDURE CalcTotals@1();
    BEGIN
      CASE "Cost Type" OF
        "Cost Type"::Labor:
          BEGIN
            Hours := ROUND(Quantity * Norm);
            "Cost Price Amount" := ROUND(Quantity * Norm * "Cost Price");
            "Sales Amount" := ROUND(Quantity * Norm * "Sales Price" *
               ((100 - "Sales Discount %")/100) * ((100 + "Sales Surcharge %")/100));
          END;
        "Cost Type"::Material:
          BEGIN
            Hours := 0;
            IF NOT (("Item No." = '') AND ("Basic Item" = '') AND ("Trade Item" = '')) THEN BEGIN
              "Cost Price" := ROUND("Gross Price" * ((100 - "Purchase Discount %")/100));
            END;
            "Cost Price Amount" := ROUND(Quantity * "Cost Price");
            "Sales Amount" := ROUND(Quantity * "Sales Price" * ((100 - "Sales Discount %")/100) * ((100 + "Sales Surcharge %")/100));
          END;
        ELSE
          BEGIN
            "Cost Price Amount" := ROUND(Quantity * "Cost Price");
            "Sales Amount" := ROUND(Quantity * "Sales Price"* ((100 - "Sales Discount %")/100) * ((100 + "Sales Surcharge %")/100));
          END;
      END;
    END;

    PROCEDURE ValidateItem@31(LTypeArtOpt@11012000 : 'Item,Basic Item,Trade Item');
    VAR
      lvCustRec@1100485005 : Record 18;
      lvRefDate@11012001 : Date;
      lvDummyDate@1100485000 : Date;
      lvDummyCostComp@1100485002 : Code[20];
      lvDummyDec@1100485006 : Decimal;
      lvValidateCu@1100485003 : Codeunit 11012033;
      lvItemRec@1100485004 : Record 27;
      lvDiscRef1@1100525000 : Code[20];
      lvDiscRef2@1100525001 : Code[20];
    BEGIN
      CALCFIELDS("Reference Date");
      lvRefDate := "Reference Date";

      lvValidateCu.ValidateItem(LTypeArtOpt,"Trade Item","Item No.",Manufacturer,"Vendor (Trade Item)",
                              "Basic Item","Cost Object",Description,"Unit of Measure","Sales Price",
                              "Purchase Discount %",lvDummyDate, "Gross Price","Description 2", lvDummyCostComp,
                              '', '', lvRefDate, '');  //db, 14-07-08

      IF (LTypeArtOpt = LTypeArtOpt::Item) AND (lvItemRec.GET("Item No.")) THEN BEGIN
        lvItemRec.TESTFIELD(Blocked,FALSE);
      END;


      lvCustRec.GET("Customer No.");
      IF lvCustRec."Item Price Unit Price" = lvCustRec."Item Price Unit Price"::GrossPrice THEN BEGIN
        lvValidateCu.GetSalesDiscount(lvCustRec."No.", "Item No.", "Basic Item", "Trade Item",
          Manufacturer, "Vendor (Trade Item)", lvDummyDec, "Sales Discount %", "Gross Price", "Reference Date", '',
          lvDiscRef1,lvDiscRef2,'');  //db, 02-03-09
        VALIDATE("Sales Price", "Gross Price");
      END;

      CalcTotals;
    END;

    PROCEDURE GetDefaultsCostObject@3();
    VAR
      lvDimValRec@1100485002 : Record 349;
      lvDimMgt@1100485000 : Codeunit 408;
      lvRateRec@1100485001 : Record 11012000;
    BEGIN
      lvDimMgt.GetDimValueRec(2, "Cost Object", lvDimValRec, TRUE, '');
      lvDimValRec.TESTFIELD(Blocked, FALSE);

      IF Description = '' THEN
        Description := lvDimValRec.Name;
      IF "Unit of Measure" = '' THEN
        VALIDATE("Unit of Measure", lvDimValRec."Unit of Measure");

      CASE "Cost Type" OF
        "Cost Type"::Labor:
          BEGIN
            IF Norm = 0 THEN
              VALIDATE(Norm, lvDimValRec.Norm);
            IF ("Budget Rate Code" = '') AND ("Cost Price" = 0) THEN BEGIN
              "Budget Rate Code" := lvDimValRec."Rate Code";
              "Cost Price" := 0;
              IF lvRateRec.StandardRate("Budget Rate Code", "Reference Date", "Cost Price") THEN;
            END;
          END;
        ELSE
          IF "Cost Price" = 0 THEN
            "Cost Price" := lvDimValRec.Price;
      END;

      CalcTotals;
    END;

    PROCEDURE CheckItemUnitConversion@1210190010(VAR MainNewRec@1210190006 : Record 11020421;MainOldRec@1210190007 : Record 11020421);
    VAR
      lvItemRec@1210190004 : Record 27;
      lvUnitFactor@1210190005 : Decimal;
      lvUnitFactorOld@1210190003 : Decimal;
      lvUnitFactorNew@1210190002 : Decimal;
      lvUnitControl@1210190001 : Codeunit 5402;
      lvValidateCu@1100485000 : Codeunit 11012033;
    BEGIN
      WITH MainNewRec DO BEGIN
        lvUnitFactorOld := 1;
        lvUnitFactorNew := 1;
        IF "Trade Item" <> '' THEN BEGIN
          lvValidateCu.ValidateUnit(ItemTypeOpt::"Trade Item",
            "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
            Quantity,"Unit of Measure",lvUnitFactorNew);
        END ELSE BEGIN
          IF "Basic Item" <> '' THEN BEGIN
            lvValidateCu.ValidateUnit(ItemTypeOpt::"Basic Item",
              "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
              Quantity,"Unit of Measure",lvUnitFactorNew);
          END ELSE BEGIN  //db, 07-04-08: M10070
            IF "Item No." <> '' THEN BEGIN
              lvItemRec.GET("Item No.");
              lvUnitFactorOld := lvUnitControl.GetQtyPerUnitOfMeasure(lvItemRec, MainOldRec."Unit of Measure");
              lvUnitFactorNew := lvUnitControl.GetQtyPerUnitOfMeasure(lvItemRec, "Unit of Measure");
              lvUnitFactor := lvUnitFactorOld;
              lvValidateCu.ValidateUnit(ItemTypeOpt::Item,
                "Item No.","Basic Item","Trade Item",Manufacturer,"Vendor (Trade Item)",
                Quantity,"Unit of Measure",lvUnitFactor);
            END;
          END;
        END;
        IF (lvUnitFactorNew * lvUnitFactorOld) <> 0 THEN BEGIN
          VALIDATE("Cost Price", ("Cost Price" * lvUnitFactorNew / lvUnitFactorOld));
        END;
      END;
    END;

    PROCEDURE HandleLookupUnit@1210190008();
    VAR
      lvItemUnitRec@1210190000 : Record 5404;
      lvUnit@1210190001 : Code[10];
    BEGIN
      lvUnit := lvItemUnitRec.HandleLookupUnit("Item No.", "Basic Item", "Trade Item", Manufacturer, "Vendor (Trade Item)");
      IF (lvUnit <> '') AND (lvUnit <> "Unit of Measure") THEN BEGIN
        xRec."Unit of Measure" := "Unit of Measure";  //db, 01-07-04: standard bug
        VALIDATE("Unit of Measure", lvUnit);
      END;
    END;

    PROCEDURE GetHourRate@1100485002(iCust@1100485004 : Code[20];iRateCode@1100485005 : Code[10];iRefDate@1100485003 : Date;VAR oRate@1100485000 : Decimal) : Boolean;
    VAR
      lvSalesPriceMgt@1100485006 : Codeunit 11012036;
      lvDummyTxt@1100485007 : Text[250];
    BEGIN
      IF ("Cost Type" <> "Cost Type"::Labor) OR ("Cost Object" = '') THEN
        EXIT(FALSE);

      oRate :=
        lvSalesPriceMgt.GetSalesPrice(
          0,'', '', '', iCust, "Cost Object",
          '', '', '', iRateCode,
          '', '', '', '', iRefDate,
          "Cost Price", lvDummyTxt);

      EXIT(TRUE);
    END;

    PROCEDURE CheckClearItemData@1100485000();
    BEGIN
      IF ("Trade Item" = '') AND ("Item No." = '') AND ("Basic Item" = '')  THEN BEGIN
        Description := '';
        "Unit of Measure" := '';
        "Sales Price" := 0;
        "Purchase Discount %" := 0;
        "Gross Price" := 0;
        "Description 2" := '';
      END;
    END;

    PROCEDURE UpdateSalesRates@1100485001();
    VAR
      lvRateRec@1100485000 : Record 11012000;
      lvHoldDesc2@1100485001 : Text[50];
      lvHoldDesc@1100485002 : Text[50];
    BEGIN
      IF ("Cost Type" = "Cost Type"::Labor) THEN BEGIN
        "Cost Price" := 0;
        CALCFIELDS("Reference Date");
        IF lvRateRec.StandardRate("Budget Rate Code", "Reference Date", "Cost Price") THEN;
        "Sales Price" := 0;
        GetHourRate("Customer No.", "Hour Rate Code", "Reference Date", "Sales Price");
      END;

      lvHoldDesc2 := "Description 2";
      lvHoldDesc := Description;
      IF ("Item No." <> xRec."Item No.") AND ("Item No." <> '') THEN BEGIN
        ValidateItem(ItemTypeOpt::Item);
      END ELSE BEGIN
        IF ("Basic Item" <> xRec."Basic Item") AND ("Basic Item" <> '') THEN BEGIN
          ValidateItem(ItemTypeOpt::"Basic Item");
        END ELSE BEGIN
          IF ("Trade Item" <> xRec."Trade Item") AND ("Trade Item" <> '') THEN BEGIN
            ValidateItem(ItemTypeOpt::"Trade Item");
          END;
        END;
      END;
      CalcTotals;

      "Description 2" := lvHoldDesc2;  //we dont want to overwrite the description again with the desc of the item
      Description := lvHoldDesc;
    END;

    PROCEDURE CalculateNettPrice@13();
    VAR
      lvCustRec@1100485000 : Record 18;
    BEGIN
      IF "Gross Price" <> 0 THEN BEGIN
        lvCustRec.GET("Customer No.");
        IF lvCustRec."Item Price Unit Price" = lvCustRec."Item Price Unit Price"::GrossPrice THEN BEGIN
          "Sales Price" := "Gross Price";
        END ELSE BEGIN
          "Sales Price" := "Gross Price" - (("Gross Price"/100) * "Purchase Discount %");
        END;
      END;
    END;

    BEGIN
    END.
  }
}

