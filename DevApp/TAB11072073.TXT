OBJECT Table 11072073 Estimate Part NEW
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Sub-Estimate No.,Part,Description;
    OnInsert=BEGIN
               TESTFIELD("Part Group");
               TESTFIELD(Part);

               UpdatePartTotal;  //DP00381
               InitAdjustmentFactor;
               "Object No." := '';  //db, 12-12-07
               "Object Customer" := '';  //db, 31-03-07
             END;

    OnModify=BEGIN
               EstRec.UpdateLogbook("Estimate No.");
               UpdatePartTotal;  //DP00381
             END;

    OnDelete=VAR
               sp1@1100485001 : Integer;
               sp2@1100485000 : Integer;
               CurrLevel@1100485002 : Integer;
               EstLineTotal@1100528900 : Record 11072077;
               EstPartTotal@1100525000 : Record 11229767;
             BEGIN
               DeleteSubPartsLowerLevel; //Call 23762

               EstRec.UpdateLogbook("Estimate No.");

               //mg.sn, 07-12-10: M22588
               IF EstRec.GET("Estimate No.") THEN BEGIN
                 IF EstRec."Estimate Type" = EstRec."Estimate Type"::Sales THEN
                   TESTFIELD("Offer fixed", FALSE);

                 IF EstRec."Full Cost/Sales Price Updated" THEN BEGIN
                   EstRec."Full Cost/Sales Price Updated" := FALSE;
                   EstRec.MODIFY;
                 END;
               END;
               //mg.en, 07-12-10: M22588

               IF EstPartTotal.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN
                 EstPartTotal.DELETE;   //DP00381

               EstLineRec.RESET; //Call 23762
               EstLineRec.SETRANGE("Estimate No.","Estimate No.");
               EstLineRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstLineRec.SETRANGE("Part Group","Part Group");
               EstLineRec.SETRANGE(Part,Part);
               IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                 EstLineRec.DELETEALL;

               EstLineTotal.SETRANGE("Estimate No.","Estimate No.");
               EstLineTotal.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstLineTotal.SETRANGE("Part Group","Part Group");
               EstLineTotal.SETRANGE(Part,Part);
               EstLineTotal.DELETEALL;   //DP00381

               RecipeRec.RESET; //Call 23762
               RecipeRec.SETRANGE("Estimate No.","Estimate No.");
               RecipeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               RecipeRec.SETRANGE("Part Group","Part Group");
               RecipeRec.SETRANGE(Part,Part);
               IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                 RecipeRec.DELETEALL;

               TextRec.RESET; //Call 23762
               TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
               TextRec.SETRANGE("Estimate No.","Estimate No.");
               TextRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               TextRec.SETRANGE("Part Group","Part Group");
               TextRec.SETRANGE(Part,Part);
               IF NOT TextRec.ISEMPTY THEN //Call 23762
                 TextRec.DELETEALL;

               EstCodeRec.RESET; //Call 23762
               EstCodeRec.SETRANGE("Estimate No.","Estimate No.");
               EstCodeRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstCodeRec.SETRANGE("Part Group","Part Group");
               EstCodeRec.SETRANGE(Part,Part);
               IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                 EstCodeRec.DELETEALL;

               ChrgRec.RESET; //Call 23762
               ChrgRec.SETRANGE("Estimate No.","Estimate No.");
               ChrgRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               ChrgRec.SETRANGE("Part Group","Part Group");
               ChrgRec.SETRANGE(Part,Part);
               IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                 ChrgRec.DELETEALL;

               QuanSheetRec.RESET; //Call 23762
               QuanSheetRec.SETRANGE("Estimate No.","Estimate No.");
               QuanSheetRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanSheetRec.SETRANGE("Part Group","Part Group");
               QuanSheetRec.SETRANGE(Part,Part);
               IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                 QuanSheetRec.DELETEALL;

               DeleteQuantityRelation("Estimate No.", "Sub-Estimate No.", "Part Group", Part); //DP00686

               QuanModelRec.RESET; //Call 23762
               QuanModelRec.SETRANGE("Estimate No.","Estimate No.");
               QuanModelRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               QuanModelRec.SETRANGE("Part Group","Part Group");
               QuanModelRec.SETRANGE(Part,Part);
               IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                 QuanModelRec.DELETEALL;

               EstPartRec.RESET; //Call 23762
               EstPartRec.SETRANGE("Estimate No.","Estimate No.");
               EstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
               EstPartRec.SETRANGE("Part Group","Part Group");

               EstLineRec.SETRANGE(Part);
               EstLineTotal.SETRANGE(Part);  //DP00381
               RecipeRec.SETRANGE(Part);
               TextRec.SETRANGE(Part);
               EstCodeRec.SETRANGE(Part);
               ChrgRec.SETRANGE(Part);
               QuanSheetRec.SETRANGE(Part);
               QuanModelRec.SETRANGE(Part);

               CheckFormat(sp1,sp2);
               CurrLevel := Level;
               IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
               IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

               CASE CurrLevel OF
                 0:BEGIN
                     DeleteExcelFile(EstPartRec);
                     IF NOT EstPartRec.ISEMPTY THEN //Call 23762
                       EstPartRec.DELETEALL;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                     IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                       RecipeRec.DELETEALL;
                     IF NOT TextRec.ISEMPTY THEN //Call 23762
                       TextRec.DELETEALL;
                     IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                       EstCodeRec.DELETEALL;
                     IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                       ChrgRec.DELETEALL;
                     IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                       QuanSheetRec.DELETEALL;
                     IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                       QuanModelRec.DELETEALL;
                   END;
                 1:BEGIN
                     EstPartRec.SETRANGE(Chapter,Chapter);
                     DeleteExcelFile(EstPartRec);
                     //Call 23762 EstPartRec.DELETEALL;
                     EstLineRec.SETRANGE(Chapter,Chapter);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         EstLineTotal.SETRANGE(Part,EstLineRec.Part);
                         EstLineTotal.SETRANGE("Line No.",EstLineRec."Line No.");
                         EstLineTotal.DELETEALL;  //DP00381

                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                           RecipeRec.DELETEALL(TRUE);  //db, 15-09-08: M12455

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN //Call 23762
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                   END;
                 2:BEGIN
                     EstPartRec.SETRANGE(Paragraph,Paragraph);
                     DeleteExcelFile(EstPartRec);
                     //Call 23762 EstPartRec.DELETEALL;
                     EstLineRec.SETRANGE(Paragraph,Paragraph);
                     IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN
                       REPEAT
                         EstLineTotal.SETRANGE(Part,EstLineRec.Part);
                         EstLineTotal.SETRANGE("Line No.",EstLineRec."Line No.");
                         EstLineTotal.DELETEALL;  //DP00381

                         RecipeRec.SETRANGE(Part,EstLineRec.Part);
                         RecipeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT RecipeRec.ISEMPTY THEN //Call 23762
                           RecipeRec.DELETEALL(TRUE);  //db, 15-09-08: M12455

                         TextRec.SETRANGE(Part,EstLineRec.Part);
                         TextRec.SETRANGE("Estimate Line No.",EstLineRec."Line No.");
                         IF NOT TextRec.ISEMPTY THEN //Call 23762
                           TextRec.DELETEALL;

                         EstCodeRec.SETRANGE(Part,EstLineRec.Part);
                         EstCodeRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT EstCodeRec.ISEMPTY THEN //Call 23762
                           EstCodeRec.DELETEALL;

                         ChrgRec.SETRANGE(Part,EstLineRec.Part);
                         ChrgRec.SETRANGE("Surcharge Line",EstLineRec."Line No.");
                         ChrgRec.SETRANGE("Basic Line");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;
                         ChrgRec.SETRANGE("Surcharge Line");
                         ChrgRec.SETRANGE("Basic Line",EstLineRec."Line No.");
                         IF NOT ChrgRec.ISEMPTY THEN //Call 23762
                           ChrgRec.DELETEALL;

                         QuanSheetRec.SETRANGE(Part,EstLineRec.Part);
                         QuanSheetRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanSheetRec.ISEMPTY THEN //Call 23762
                           QuanSheetRec.DELETEALL;

                         QuanModelRec.SETRANGE(Part,EstLineRec.Part);
                         QuanModelRec.SETRANGE("Estimate Line",EstLineRec."Line No.");
                         IF NOT QuanModelRec.ISEMPTY THEN //Call 23762
                           QuanModelRec.DELETEALL;
                       UNTIL EstLineRec.NEXT = 0;
                     END;
                     IF NOT EstLineRec.ISEMPTY THEN //Call 23762
                       EstLineRec.DELETEALL;
                   END;
                 3:BEGIN
                     EstPartRec := Rec;
                     EstPartRec.SETRECFILTER;
                     DeleteExcelFile(EstPartRec);
                   END;
               END;
             END;

    OnRename=BEGIN
               ERROR(Text001);
             END;

    CaptionML=ENU=Estimate Part;
    PasteIsValid=No;
    LookupPageID=Page11229768;
    DrillDownPageID=Page11229768;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Estimate No. }
    { 11  ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=ENU=Estimate Description;
                                                   Editable=No }
    { 12  ;   ;Sub-Estimate No.    ;Code20        ;TableRelation="Sub-Estimate NEW"."Sub-Estimate No." WHERE (Estimate No.=FIELD(Estimate No.));
                                                   CaptionML=ENU=Sub-Estimate No. }
    { 13  ;   ;Sub-Estimate Description;Text50    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sub-Estimate NEW".Description WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sub-Estimate Description;
                                                   Editable=No }
    { 15  ;   ;Part Group          ;Code10        ;CaptionML=ENU=Part Group }
    { 20  ;   ;Part                ;Code20        ;TableRelation="Estimate Base Part".Code WHERE (Part Group=FIELD(Part Group));
                                                   OnValidate=BEGIN
                                                                FormatMgt.CreateEstPart("Estimate No.","Sub-Estimate No.","Part Group",Part,Chapter,Paragraph,Level,TRUE);
                                                                IF CurrFieldNo = FIELDNO(Part) THEN
                                                                  IF (xRec.Part <> '') AND (xRec.Part <> Part) THEN
                                                                    ERROR(Text001);  //db, 28-08-14: C017149

                                                                IF Part <> xRec.Part THEN
                                                                  IF PartRec.GET("Part Group",Part) THEN BEGIN
                                                                    Description := PartRec.Description;
                                                                    Quantity := PartRec.Quantity;
                                                                    "Unit of Measure" := PartRec."Unit of Measure";
                                                                    IF PartRec.Element <> '' THEN // 34595.n
                                                                      Element := PartRec.Element;
                                                                    IF PartRec."Project Plann. Base Act. Code" <> '' THEN
                                                                      "Project Planning Activity Code" := PartRec."Project Plann. Base Act. Code";
                                                                    "Theoretical Life Span" := PartRec."Theoretical Life Span";
                                                                    VALIDATE("Expected Life Span", PartRec."Expected Life Span");
                                                                    "Unit of Qty per Unit" := PartRec."Unit of Qty per Unit";  //DP00686
                                                                    CopyPartText('','');  //DP00686
                                                                    CopyPartQuantitySheet('','');  //DP00686
                                                                  END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Part }
    { 21  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 22  ;   ;Quantity            ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                ProcessPartQuantity;
                                                              END;

                                                   CaptionML=ENU=Quantity }
    { 23  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Measure }
    { 25  ;   ;Description 2       ;Text50        ;CaptionML=ENU=Description 2 }
    { 31  ;   ;Chapter             ;Code20        ;CaptionML=ENU=Chapter }
    { 32  ;   ;Paragraph           ;Code20        ;CaptionML=ENU=Paragraph }
    { 40  ;   ;Level               ;Integer       ;CaptionML=ENU=Level }
    { 50  ;   ;Estimated Part      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                            Part=FIELD(Part)));
                                                   CaptionML=ENU=Estimated Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 80  ;   ;Estimated Total     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Estimated Total }
    { 90  ;   ;Hours Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Part=FIELD(Part)));
                                                   CaptionML=ENU=Hours Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 100 ;   ;Hours Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 110 ;   ;Hours Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                      Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 120 ;   ;Hours Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Hours Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;Labor Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Part=FIELD(Part)));
                                                   CaptionML=ENU=Labor Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 140 ;   ;Labor Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 150 ;   ;Labor Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 160 ;   ;Labor Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Labor Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 170 ;   ;Material Part       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                     Part=FIELD(Part)));
                                                   CaptionML=ENU=Material Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 171 ;   ;Gross Price Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part=FIELD(Part)));
                                                   CaptionML=ENU=Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 180 ;   ;Material Paragraph  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                     Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 181 ;   ;Gross Price Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Gross Price Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 190 ;   ;Material Chapter    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                     Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 191 ;   ;Gross Price Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Gross Price Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 200 ;   ;Material Total      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Material Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 201 ;   ;Gross Price Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Gross Price Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 210 ;   ;Subcontracting Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                           Part=FIELD(Part)));
                                                   CaptionML=ENU=Subcontracting Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 220 ;   ;Subcontracting Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                           Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 230 ;   ;Subcontracting Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                           Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 240 ;   ;Subcontracting Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Subcontracting Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 250 ;   ;Plant Part          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Part=FIELD(Part)));
                                                   CaptionML=ENU=Plant Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 260 ;   ;Plant Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 270 ;   ;Plant Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                  Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 280 ;   ;Plant Total         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Plant Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 290 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroup;  //DP00686
                                                              END;

                                                   CaptionML=ENU=Norm Group }
    { 300 ;   ;Element             ;Code20        ;TableRelation="Base Element".Code;
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Element }
    { 305 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                UpdateProjElem(0);
                                                              END;

                                                   CaptionML=ENU=Project No. }
    { 310 ;   ;Text                ;Text250       ;CaptionML=ENU=Text }
    { 315 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line (Group)" WHERE (Table Name=CONST(Estimate),
                                                                                                   Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FIELD(Part Group),
                                                                                                   Part=FIELD(Part),
                                                                                                   Estimate Line No.=CONST(0)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=No }
    { 316 ;   ;Print on Quote      ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11072072;
                                                              BEGIN
                                                                //X007
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE("Print on Quote", "Print on Quote");
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO("Print on Quote"));
                                                              END;

                                                   CaptionML=ENU=Print on Quote }
    { 317 ;   ;Extension           ;Boolean       ;OnValidate=VAR
                                                                EstLineRec@1210190000 : Record 11072072;
                                                              BEGIN
                                                                //X007
                                                                EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstLineRec.SETRANGE("Part Group", "Part Group");
                                                                EstLineRec.SETRANGE(Part, Part);
                                                                IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
                                                                  REPEAT
                                                                    EstLineRec.VALIDATE(Extension, Extension);
                                                                    EstLineRec.MODIFY;
                                                                  UNTIL EstLineRec.NEXT = 0;
                                                                END;

                                                                ProcessPartFields(FIELDNO(Extension));
                                                              END;

                                                   CaptionML=ENU=Extension }
    { 320 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 321 ;   ;Adjustment Factor Material;Decimal ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Material Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 322 ;   ;Adjustment Factor Subcontr.;Decimal;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(3,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Subcontr. Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 323 ;   ;Adjustment Factor Plant;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(4,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Plant Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 324 ;   ;Adjustment Factor Sundry;Decimal   ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(5,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 325 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=ENU=Hours Cum. Adj. Factor Hours;
                                                   DecimalPlaces=0:6 }
    { 326 ;   ;Cum. Adj. Factor Material;Decimal  ;CaptionML=ENU=Material Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 327 ;   ;Cum. Adj. Factor Subcontr.;Decimal ;CaptionML=ENU=Subcontr. Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 328 ;   ;Cum. Adj. Factor Plant;Decimal     ;CaptionML=ENU=Plant Cum. Adj. Factor;
                                                   DecimalPlaces=0:6 }
    { 329 ;   ;Cum. Adj. Factor Sundry;Decimal    ;CaptionML=ENU=Cum. Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 330 ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                CodingSystem@1100525000 : Record 11012088;
                                                              BEGIN
                                                                EstRec.GET("Estimate No.");
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  CodingSystem.GET(EstRec."Coding System");
                                                                  IF CodingSystem."Deviant Code allowed" = FALSE THEN BEGIN  //db, 26-06-15
                                                                    FormatMgt.SetSelection(EstRec."Coding System");
                                                                    FormatMgt.FormatElem(Code,4,'');
                                                                    CodeRec.GET(EstRec."Coding System", Code);
                                                                  END;
                                                                END;

                                                                MODIFY;
                                                                UpdateMgt.UpdateCode("Estimate No.", "Sub-Estimate No.", Part, Code);  //DP00381
                                                              END;

                                                   OnLookup=BEGIN
                                                              EstRec.GET("Estimate No.");
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=ENU=Code }
    { 340 ;   ;Target Hours        ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Amount Labor", 0);
                                                              END;

                                                   CaptionML=ENU=Target Hours }
    { 341 ;   ;Target Amount Labor ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Hours", 0);
                                                              END;

                                                   CaptionML=ENU=Target Amount Labor }
    { 342 ;   ;Target Amount Material;Decimal     ;CaptionML=ENU=Target Amount Material }
    { 343 ;   ;Target Amount Subcontracting;Decimal;
                                                   CaptionML=ENU=Target Amount Subcontracting }
    { 344 ;   ;Target Amount Plant ;Decimal       ;CaptionML=ENU=Target Amount Plant }
    { 345 ;   ;Target Amount Sundry;Decimal       ;CaptionML=ENU=Target Amount Sundry }
    { 350 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Condition }
    { 360 ;   ;Excel Estimate Template;Text50     ;OnValidate=BEGIN
                                                                IF (xRec."Excel Estimate Template" <> Rec."Excel Estimate Template") AND ExcelFileExists THEN
                                                                  IF CONFIRM(Text005,TRUE,FIELDCAPTION("Excel Estimate Template")) THEN
                                                                    FileMgt.DeleteClientFile4PS(ExcelEstimateMgt.GetPathFileName(Rec), TRUE)
                                                                  ELSE
                                                                    ERROR(Text006,FIELDCAPTION("Excel Estimate Template"));

                                                                IF CheckValidExcelTemplate(TRUE) THEN;
                                                              END;

                                                   OnLookup=VAR
                                                              lvEstimateSetupRec@1100528904 : Record 11012150;
                                                              lvExcelTemplate@1100528902 : Text[250];
                                                              DirectoryName@1100528901 : Text;
                                                              FileAbsPathName@1100528900 : Text;
                                                            BEGIN
                                                              lvEstimateSetupRec.GET;
                                                              DirectoryName := lvEstimateSetupRec."Pathname Excel Est. Template";
                                                              IF FileMgt.SelectFile('xlt', DirectoryName, lvExcelTemplate, FileAbsPathName) THEN
                                                                VALIDATE("Excel Estimate Template",lvExcelTemplate);
                                                            END;

                                                   CaptionML=ENU=Excel Estimate Template }
    { 370 ;   ;Updated form Excel  ;Boolean       ;CaptionML=ENU=Updated form Excel;
                                                   Editable=No }
    { 380 ;   ;Vendor              ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=ENU=Vendor }
    { 381 ;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=ENU=Vendor Name;
                                                   Editable=No }
    { 390 ;   ;Subcontractor       ;Code20        ;TableRelation=Vendor.No. WHERE (Subcontractor=CONST(Yes));
                                                   CaptionML=ENU=Subcontractor }
    { 391 ;   ;Subcontractor Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=ENU=Subcontractor Name;
                                                   Editable=No }
    { 400 ;   ;Quantity Model Exist;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Model Line Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                           Part Group=FIELD(Part Group),
                                                                                                           Part=FIELD(Part)));
                                                   CaptionML=ENU=Quantity Model Exist;
                                                   Editable=No }
    { 410 ;   ;Object No.          ;Code20        ;TableRelation="Standard Object".No.;
                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=Object No. }
    { 420 ;   ;Object Customer     ;Code20        ;CaptionML=ENU=Object Customer }
    { 450 ;   ;Capacity            ;Decimal       ;CaptionML=ENU=Capacity;
                                                   BlankNumbers=BlankZero }
    { 451 ;   ;Capacity Unit       ;Code10        ;TableRelation="Unit of Measure";
                                                   CaptionML=ENU=Capacity Unit }
    { 452 ;   ;Construction Year   ;Integer       ;OnValidate=BEGIN
                                                                EvaluateExpectedLifeSpan(FIELDNO("Construction Year"));
                                                              END;

                                                   CaptionML=ENU=Construction Year;
                                                   BlankNumbers=BlankZero }
    { 453 ;   ;Theoretical Life Span;DateFormula  ;CaptionML=ENU=Theoretical Life Span }
    { 454 ;   ;Expected Life Span  ;DateFormula   ;OnValidate=BEGIN
                                                                EvaluateExpectedLifeSpan(FIELDNO("Expected Life Span"));
                                                              END;

                                                   CaptionML=ENU=Expected Life Span }
    { 455 ;   ;Desired Condition   ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Desired Condition }
    { 456 ;   ;Actual Condition    ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Actual Condition }
    { 457 ;   ;Use Time            ;Decimal       ;CaptionML=ENU=Use Time (Hours/Week);
                                                   DecimalPlaces=2: }
    { 458 ;   ;Object Type         ;Text30        ;CaptionML=ENU=Object Type }
    { 459 ;   ;Object Brand        ;Text30        ;CaptionML=ENU=Object Brand }
    { 460 ;   ;Investment Year     ;Integer       ;CaptionML=ENU=Investment Year;
                                                   BlankNumbers=BlankZero }
    { 500 ;   ;Settlement Type     ;Option        ;OnValidate=BEGIN
                                                                //validate unit price to recalculate the settlement price
                                                                //VALIDATE("Unit Price");
                                                              END;

                                                   CaptionML=ENU=Settlement Type;
                                                   OptionCaptionML=ENU=" ,Non Settling,Settling,Approved,Reduction,Open";
                                                   OptionString=[ ,Non Settling,Settling,Approved,Reduction,Open] }
    { 510 ;   ;Settlement Status   ;Code10        ;TableRelation="Sub-Estimate Part Status".Status;
                                                   OnValidate=BEGIN
                                                                CALCFIELDS("Settlement Status Description");
                                                              END;

                                                   CaptionML=ENU=Settlement Status }
    { 511 ;   ;Settlement Status Description;Text50;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sub-Estimate Part Status".Description WHERE (Status=FIELD(Settlement Status)));
                                                   CaptionML=ENU=Settlement Status Description;
                                                   Editable=No }
    { 600 ;   ;Quantity per Unit   ;Decimal       ;OnValidate=VAR
                                                                EstQuanSheetHeader@1100409001 : Record 11020462;
                                                                EstQuanSheetLine@1100409000 : Record 11020464;
                                                              BEGIN
                                                                //DP00686
                                                                EstQuanSheetHeader.SETRANGE("Estimate No.", "Estimate No.");
                                                                EstQuanSheetHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                EstQuanSheetHeader.SETRANGE(Part, Part);
                                                                IF EstQuanSheetHeader.FINDSET THEN BEGIN
                                                                  REPEAT
                                                                    EstQuanSheetLine.SETRANGE("Estimate No.", EstQuanSheetHeader."Estimate No.");
                                                                    EstQuanSheetLine.SETRANGE("Quantity Sheet", EstQuanSheetHeader.Code);
                                                                    EstQuanSheetLine.SETRANGE("Related to Part Quantity", TRUE);
                                                                    IF EstQuanSheetLine.FINDSET THEN BEGIN
                                                                      IF EstQuanSheetLine."Related to Column" = EstQuanSheetLine."Related to Column"::Quantity THEN BEGIN
                                                                        EstQuanSheetLine.VALIDATE(Quantity, "Quantity per Unit");
                                                                        EstQuanSheetLine.MODIFY;
                                                                      END;
                                                                    END;
                                                                    EstQuanSheetHeader.ProcessSheet(EstQuanSheetHeader."Estimate No.",EstQuanSheetHeader.Code);  //db, 20-01-15
                                                                    EstQuanSheetHeader.WriteDataFromSheetToEstimate(EstQuanSheetHeader."Estimate No.",EstQuanSheetHeader.Code);
                                                                  UNTIL EstQuanSheetHeader.NEXT = 0;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Quantity per Unit }
    { 601 ;   ;Unit of Qty per Unit;Code20        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Qty per Unit }
    { 610 ;   ;Calculated Cost Amount;Decimal     ;CaptionML=ENU=Calculated Cost Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 611 ;   ;Calculated Cost Price;Decimal      ;CaptionML=ENU=Calculated Cost Price;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 620 ;   ;Offer Amount        ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Amount (FCY)" := ExchangeAmtLCYToFCY("Offer Amount", FALSE);
                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN BEGIN
                                                                  "Offer Price" := "Offer Amount" / CumQuan;
                                                                  "Offer Price (FCY)" := "Offer Amount (FCY)" / CumQuan;
                                                                END;
                                                                ProcessSalesOfferPrices(FALSE);
                                                              END;

                                                   CaptionML=ENU=Offer Amount;
                                                   AutoFormatType=1 }
    { 621 ;   ;Offer Price         ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Price (FCY)" := ExchangeAmtLCYToFCY("Offer Price", TRUE);
                                                                CumQuan := GetPartQuantity;
                                                                "Offer Amount" := CumQuan * "Offer Price";
                                                                "Offer Amount (FCY)" := CumQuan * "Offer Price (FCY)";
                                                                ProcessSalesOfferPrices(FALSE);
                                                              END;

                                                   CaptionML=ENU=Offer Price;
                                                   AutoFormatType=1 }
    { 622 ;   ;Margin %            ;Decimal       ;CaptionML=ENU=Margin % }
    { 623 ;   ;Sales Comment       ;Text250       ;CaptionML=ENU=Sales Comment }
    { 624 ;   ;Transfer to Installment M.;Boolean ;CaptionML=ENU=Transfer to Installment Motivation }
    { 625 ;   ;Offer fixed         ;Boolean       ;OnValidate=BEGIN
                                                                ProcessPartFields(FIELDNO("Offer fixed"));  //db, 27-05-10
                                                              END;

                                                   CaptionML=ENU=Offer fixed }
    { 626 ;   ;Markup %            ;Decimal       ;CaptionML=ENU=Markup % }
    { 650 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");

                                                                UpdateProjPlanActCode;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Project Planning Activity Code }
    { 660 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                UpdateExtensionContract;  //DP00260
                                                              END;

                                                   CaptionML=ENU=Extension Contract }
    { 700 ;   ;Lines Exist         ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Line NEW" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                Part Group=FIELD(Part Group),
                                                                                                Part=FIELD(Part)));
                                                   OnLookup=VAR
                                                              EstimateManagementRTC@1100525000 : Codeunit 11130010;
                                                            BEGIN
                                                            END;

                                                   CaptionML=ENU=Lines;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 900 ;   ;Treeview Level      ;Integer       ;CaptionML=ENU=Treeview Level }
    { 1000;   ;OnTempTable         ;Boolean       ;CaptionML=ENU=Temp table;
                                                   Editable=No }
    { 2000;   ;Sundry Part         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part=FIELD(Part)));
                                                   CaptionML=ENU=Sundry Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2010;   ;Sundry Paragraph    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Sundry Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2020;   ;Sundry Chapter      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Sundry Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2030;   ;Sundry Total        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sundry Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2040;   ;Gross Price Part (Subc);Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                            Part=FIELD(Part)));
                                                   CaptionML=ENU=Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2045;   ;Gross Price Part (Plant);Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part=FIELD(Part)));
                                                   CaptionML=ENU=Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2050;   ;Gross Price Part (Sundry);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part=FIELD(Part)));
                                                   CaptionML=ENU=Gross Price Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2060;   ;Hours Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Part=FIELD(Part)));
                                                   CaptionML=ENU=Hours Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2061;   ;Hours Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2062;   ;Hours Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2063;   ;Hours Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Hours Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2070;   ;Labor Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part=FIELD(Part)));
                                                   CaptionML=ENU=Labor Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2071;   ;Labor Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2072;   ;Labor Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2073;   ;Labor Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Labor Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2100;   ;Material Sales Part ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Part=FIELD(Part)));
                                                   CaptionML=ENU=Material Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2110;   ;Material Sales Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2120;   ;Material Sales Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                      Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2130;   ;Material Sales Total;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Material Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2140;   ;Subcontracting Sales Part;Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                            Part=FIELD(Part)));
                                                   CaptionML=ENU=Subcontracting Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2150;   ;Subcontracting Sales Paragraph;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                            Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2160;   ;Subcontracting Sales Chapter;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                            Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2170;   ;Subcontracting Sales Total;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Subcontracting Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2180;   ;Plant Sales Part    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Part=FIELD(Part)));
                                                   CaptionML=ENU=Plant Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2190;   ;Plant Sales Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2200;   ;Plant Sales Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                   Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2210;   ;Plant Sales Total   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Plant Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2220;   ;Sundry Sales Part   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Part=FIELD(Part)));
                                                   CaptionML=ENU=Sundry Sales Part;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2230;   ;Sundry Sales Paragraph;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Paragraph=FIELD(Paragraph)));
                                                   CaptionML=ENU=Sundry Sales Paragraph;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2240;   ;Sundry Sales Chapter;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                                    Chapter=FIELD(Chapter)));
                                                   CaptionML=ENU=Sundry Sales Chapter;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2250;   ;Sundry Sales Total  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Sales Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sundry Sales Total;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2300;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(0);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Labor;
                                                   BlankZero=Yes }
    { 2301;   ;Surcharge % Material;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(1);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Material;
                                                   BlankZero=Yes }
    { 2302;   ;Surcharge % Subcontracting;Decimal ;OnValidate=BEGIN
                                                                UpdateSurcharge(2);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Subcontracting;
                                                   BlankZero=Yes }
    { 2303;   ;Surcharge % Plant   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(3);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Plant;
                                                   BlankZero=Yes }
    { 2304;   ;Surcharge % Sundry  ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(4);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Sundry;
                                                   BlankZero=Yes }
    { 2310;   ;Calculated Sales Amount;Decimal    ;CaptionML=ENU=Calculated Sales Amount;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2315;   ;Calculated Sales Price;Decimal     ;CaptionML=ENU=Calculated Sales Price;
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 2320;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroupSales;  //DP00686
                                                              END;

                                                   CaptionML=ENU=Norm Group (Sales) }
    { 2330;   ;Adj. Factor Hours (Sales);Decimal  ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,2);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 2340;   ;Cum. Adj. Factor Hours (Sales);Decimal;
                                                   CaptionML=ENU=Cum. Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6 }
    { 2350;   ;Currency Code       ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate."Report Currency Code" WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=ENU=Currency Code;
                                                   Editable=No }
    { 2360;   ;Offer Amount (FCY)  ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Amount" := ExchangeAmtFCYToLCY("Offer Amount (FCY)", FALSE);
                                                                CumQuan := GetPartQuantity;
                                                                IF CumQuan <> 0 THEN BEGIN
                                                                  "Offer Price (FCY)" := "Offer Amount (FCY)" / CumQuan;
                                                                  "Offer Price" := "Offer Amount" / CumQuan;
                                                                END;
                                                                ProcessSalesOfferPrices(TRUE);
                                                              END;

                                                   CaptionML=ENU=Offer Amount (FCY);
                                                   AutoFormatType=1 }
    { 2370;   ;Offer Price (FCY)   ;Decimal       ;OnValidate=BEGIN
                                                                "Offer Price" := ExchangeAmtFCYToLCY("Offer Price (FCY)", TRUE);
                                                                CumQuan := GetPartQuantity;
                                                                "Offer Amount (FCY)" := CumQuan * "Offer Price (FCY)";
                                                                "Offer Amount" := CumQuan * "Offer Price";
                                                                ProcessSalesOfferPrices(TRUE);
                                                              END;

                                                   CaptionML=ENU=Offer Price (FCY);
                                                   AutoFormatType=1 }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.,Part Group,Part;
                                                   SumIndexFields=Offer Amount,Calculated Cost Amount,Calculated Sales Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Estimate No.,Sub-Estimate No.,Level,Chapter,Paragraph;
                                                   SumIndexFields=Offer Amount,Calculated Cost Amount,Calculated Sales Amount;
                                                   MaintainSIFTIndex=No }
    {    ;Project No.,Element                     ;MaintainSIFTIndex=No }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstRec@11012000 : Record 11012151;
      SubEstRec@1210190002 : Record 11072074;
      EstPartRec@1210190001 : Record 11072073;
      EstLineRec@11012001 : Record 11072072;
      RecipeRec@11012002 : Record 11072075;
      EstCodeRec@1210190013 : Record 11229772;
      CodeRec@1210190014 : Record 11012089;
      ChrgRec@11012004 : Record 11229771;
      TextRec@1210190005 : Record 11020595;
      QuanSheetRec@1210190011 : Record 11012186;
      QuanModelRec@1210190015 : Record 11012197;
      PartRec@11012006 : Record 11012169;
      ElemRec@1210190004 : Record 11012060;
      ProjElemRec@1210190003 : Record 11012010;
      FormatMgt@11012007 : Codeunit 11012022;
      Text001@1210190000 : TextConst 'ENU="Rename disabled; use copy function and delete original line afterwards."';
      UpdateMgt@1210190012 : Codeunit 11012229;
      ExcelEstimateMgt@1100485000 : Codeunit 11012231;
      Text003@1100485001 : TextConst 'ENU="A %1 on a lower %2 is present. "';
      Text004@1100485002 : TextConst 'ENU="A %1 on a higher %2 is present. "';
      Text005@1100485003 : TextConst 'ENU=The existing Excelfile doesn''t match %1 anymore, remove Excelfile is removed.';
      Text006@1100485004 : TextConst 'ENU=%1 is not changed.';
      Text007@1100485005 : TextConst 'ENU=%1 %2 doesn''t exist.';
      Text008@1100485007 : TextConst 'ENU=Price is Fixed on level (%1).';
      Text009@1100485008 : TextConst 'ENU=Price is Fixed on level (%1).';
      FileMgt@1100528900 : Codeunit 419;
      CumQuan@1100525000 : Decimal;
      WarningLevelIllegalCodeTest@1100409000 : 'Warning,Error';

    PROCEDURE InitAdjustmentFactor@1210190003();
    VAR
      CurrLevel@1210190000 : Integer;
    BEGIN
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Material" = 0 THEN
        "Adjustment Factor Material" := 1;
      IF "Adjustment Factor Subcontr." = 0 THEN
        "Adjustment Factor Subcontr." := 1;
      IF "Adjustment Factor Plant" = 0 THEN
        "Adjustment Factor Plant" := 1;
      IF "Adjustment Factor Sundry" = 0 THEN  //DP00381
        "Adjustment Factor Sundry" := 1;

      IF "Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
        "Adj. Factor Hours (Sales)" := 1;

      CurrLevel := Level;

      IF CurrLevel <> 0 THEN BEGIN
        EstPartRec.RESET;
        EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
        EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstPartRec.SETRANGE("Part Group", "Part Group");
        IF CurrLevel = 3 THEN BEGIN
          EstPartRec.SETRANGE(Part, Paragraph);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 2 THEN BEGIN
          EstPartRec.SETRANGE(Part, Chapter);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel = 1 THEN BEGIN
          EstPartRec.SETRANGE(Part);
          EstPartRec.SETRANGE(Level, 0);
          IF NOT EstPartRec.FINDFIRST THEN
            CurrLevel := CurrLevel - 1;
        END;
        IF CurrLevel <> 0 THEN BEGIN
          IF EstPartRec."Cum. Adj. Factor Hours" = 0 THEN
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
          ELSE
            "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * EstPartRec."Cum. Adj. Factor Hours";
          IF EstPartRec."Cum. Adj. Factor Material" = 0 THEN
            "Cum. Adj. Factor Material" := "Adjustment Factor Material"
          ELSE
            "Cum. Adj. Factor Material" := "Adjustment Factor Material" * EstPartRec."Cum. Adj. Factor Material";
          IF EstPartRec."Cum. Adj. Factor Subcontr." = 0 THEN
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
          ELSE
            "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * EstPartRec."Cum. Adj. Factor Subcontr.";
          IF EstPartRec."Cum. Adj. Factor Plant" = 0 THEN
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
          ELSE
            "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * EstPartRec."Cum. Adj. Factor Plant";
          IF EstPartRec."Cum. Adj. Factor Sundry" = 0 THEN  //DP00381
            "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry"
          ELSE
            "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry" * EstPartRec."Cum. Adj. Factor Sundry";

          IF EstPartRec."Cum. Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
            "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
          ELSE
            "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * EstPartRec."Cum. Adj. Factor Hours (Sales)";
        END;
      END;

      IF CurrLevel = 0 THEN BEGIN
        IF NOT SubEstRec.GET("Estimate No.","Sub-Estimate No.") THEN SubEstRec.INIT;  //db, 13-12-13: T004062
        IF SubEstRec."Cum. Adj. Factor Hours" = 0 THEN
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
        ELSE
          "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * SubEstRec."Cum. Adj. Factor Hours";
        IF SubEstRec."Cum. Adj. Factor Material" = 0 THEN
          "Cum. Adj. Factor Material" := "Adjustment Factor Material"
        ELSE
          "Cum. Adj. Factor Material" := "Adjustment Factor Material" * SubEstRec."Cum. Adj. Factor Material";
        IF SubEstRec."Cum. Adj. Factor Subcontr." = 0 THEN
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
        ELSE
          "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * SubEstRec."Cum. Adj. Factor Subcontr.";
        IF SubEstRec."Cum. Adj. Factor Plant" = 0 THEN
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
        ELSE
          "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * SubEstRec."Cum. Adj. Factor Plant";
        IF SubEstRec."Cum. Adj. Factor Sundry" = 0 THEN  //DP00381
          "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry"
        ELSE
          "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry" * SubEstRec."Cum. Adj. Factor Sundry";

        IF SubEstRec."Cum. Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
        ELSE
          "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * SubEstRec."Cum. Adj. Factor Hours (Sales)";
      END;
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190001(IAdjType@1210190000 : Integer;IEstType@1100525001 : Integer);
    BEGIN
      IF (IEstType = 0) OR (IEstType = 2) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adj. Factor Hours (Sales)" = 0 THEN
              "Adj. Factor Hours (Sales)" := 1;
        END;
      END;
      IF (IEstType = 0) OR (IEstType = 1) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adjustment Factor Hours" = 0 THEN
              "Adjustment Factor Hours" := 1;
          2:
            IF "Adjustment Factor Material" = 0 THEN
              "Adjustment Factor Material" := 1;
          3:
            IF "Adjustment Factor Subcontr." = 0 THEN
              "Adjustment Factor Subcontr." := 1;
          4:
            IF "Adjustment Factor Plant" = 0 THEN
              "Adjustment Factor Plant" := 1;
          5:  //DP00381
            IF "Adjustment Factor Sundry" = 0 THEN
              "Adjustment Factor Sundry" := 1;
        END;
      END;
      MODIFY;

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          UpdateMgt.ResetAdjustmentFactor(EstPartRec."Estimate No.", EstPartRec."Sub-Estimate No.",
            EstPartRec."Part Group", EstPartRec.Part, 0, TRUE, 2, IAdjType, IEstType);  //DP00555
        UNTIL EstPartRec.NEXT = 0;
      END;

      GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part);
    END;

    PROCEDURE ProcessPartQuantity@1210190002();
    BEGIN
      MODIFY;
      VALIDATE("Offer Price");

      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.", "Sub-Estimate No.", Level, Chapter, Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      IF EstPartRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          EstLineRec.RESET;
          EstLineRec.SETRANGE("Estimate No.", EstPartRec."Estimate No.");
          EstLineRec.SETRANGE("Sub-Estimate No.", EstPartRec."Sub-Estimate No.");
          EstLineRec.SETRANGE("Part Group", EstPartRec."Part Group");
          EstLineRec.SETRANGE(Part, EstPartRec.Part);
          IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
            REPEAT
              EstLineRec.VALIDATE(Quantity);  //incl. CalculateTotal + UpdateRecipeTotal
              EstLineRec.MODIFY;
            UNTIL EstLineRec.NEXT = 0;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckFormat@1100485000(VAR sp1@1100485004 : Integer;VAR sp2@1100485005 : Integer);
    VAR
      EstSetupRec@11012000 : Record 11012150;
      lvText000@1100485000 : TextConst 'ENU=only 3 levels allowed';
      x@1100485002 : Integer;
      lp@1100485001 : Integer;
    BEGIN
      x := 0;
      sp1 := 0;
      sp2 := 0;

      EstSetupRec.GET();
      EstSetupRec.TESTFIELD("Part Format");
      lp := STRLEN(EstSetupRec."Part Format");

      REPEAT
        x := x + 1;
        IF COPYSTR(EstSetupRec."Part Format",x,1) = '.' THEN BEGIN
          IF sp1 = 0 THEN
            sp1 := x
          ELSE
            IF sp2 = 0 THEN
              sp2 :=x
            ELSE
              ERROR(lvText000);
        END;
      UNTIL x = lp;
    END;

    PROCEDURE ExcelFileExists@1100485001() : Boolean;
    BEGIN
      EXIT(FileMgt.ClientFileExists(ExcelEstimateMgt.GetPathFileName(Rec)));
    END;

    PROCEDURE CheckValidExcelTemplate@1100485003(iUserInteraction@1100485003 : Boolean) rResult : Boolean;
    BEGIN
      IF "Excel Estimate Template" = '' THEN
        EXIT(TRUE);

      IF NOT FileMgt.ClientFileExists(ExcelEstimateMgt.GetTemplPathFile(Rec)) THEN
        IF iUserInteraction THEN
          ERROR(Text007,FIELDCAPTION("Excel Estimate Template"),ExcelEstimateMgt.GetTemplPathFile(Rec))
        ELSE
          EXIT(FALSE);

      IF NOT CheckDownWards(iUserInteraction) THEN
        EXIT(FALSE);

      IF NOT CheckUpwards(iUserInteraction) THEN
        EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckDownWards@1100485002(iUserInteraction@1100485000 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485005 : Record 11072073;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Part Group","Part Group");

      CASE Level OF
        //0: No Filters
        1: lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
        2: lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
        3: lvSubEstimatePartRec.SETRANGE(Part,Part);
      END;

      lvSubEstimatePartRec.SETFILTER(Level,'>%1',Level);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');

      FILTERGROUP(10);
      lvSubEstimatePartRec.SETFILTER(Part,'<>%1',Part);
      FILTERGROUP(0);
      IF lvSubEstimatePartRec.FINDFIRST THEN
        IF iUserInteraction THEN
          ERROR(Text003,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
        ELSE
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    PROCEDURE CheckUpwards@1100485004(iUserInteraction@1100485003 : Boolean) : Boolean;
    VAR
      lvSubEstimatePartRec@1100485002 : Record 11072073;
      lvLevel@1100485000 : Integer;
    BEGIN
      lvSubEstimatePartRec.SETRANGE("Estimate No.","Estimate No.");
      lvSubEstimatePartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");

      lvSubEstimatePartRec.SETRANGE(Chapter);
      lvSubEstimatePartRec.SETRANGE(Paragraph);
      lvSubEstimatePartRec.SETRANGE(Part);
      lvSubEstimatePartRec.SETFILTER("Excel Estimate Template",'<>%1','');
      lvLevel := Level;
      WHILE lvLevel > 0 DO
        BEGIN
          lvLevel -= 1;
          lvSubEstimatePartRec.SETRANGE(Level,lvLevel);
          CASE lvLevel OF
            0:
              BEGIN
                lvSubEstimatePartRec.SETFILTER(Chapter,'%1','');
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            1:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETFILTER(Paragraph,'%1','');
              END;
            2:
              BEGIN
                lvSubEstimatePartRec.SETRANGE(Chapter,Chapter);
                lvSubEstimatePartRec.SETRANGE(Paragraph,Paragraph);
              END;
          END;
          IF lvSubEstimatePartRec.FINDFIRST THEN
            IF iUserInteraction THEN
              ERROR(Text004,FIELDCAPTION("Excel Estimate Template"),FIELDCAPTION(Level))
            ELSE
              EXIT(FALSE);
        END;

      EXIT(TRUE);
    END;

    PROCEDURE CheckExcelTemplateFilled@1100485005();
    VAR
      EstSetup@1100485000 : Record 11012150;
      StdPartRec@1100525001 : Record 11012169;
      ExcelTemplate@1100525000 : Text[250];
    BEGIN
      //db, 28-06-10: M17532
      IF "Excel Estimate Template" = '' THEN BEGIN
        EstSetup.GET;
        IF NOT StdPartRec.GET("Part Group", Part) THEN StdPartRec.INIT;
        IF StdPartRec."Excel Estimate Template" <> '' THEN
          ExcelTemplate := StdPartRec."Excel Estimate Template"
        ELSE
          IF Level = 0 THEN  //db, 24-03-15: C016775
            ExcelTemplate := EstSetup."Excel Estimate Template";
        IF CheckValidExcelTemplate(FALSE) THEN
          VALIDATE("Excel Estimate Template", ExcelTemplate)
        ELSE
          "Excel Estimate Template" := '';
      END;
    END;

    PROCEDURE DeleteExcelFile@1100485006(VAR EstPartRec@1100485001 : Record 11072073);
    VAR
      EstPartRec2@1210190000 : Record 11072073;
    BEGIN
      EstPartRec2.COPY(EstPartRec); //call 23762
      WITH EstPartRec2 DO BEGIN  //call 23762
        IF FINDSET(FALSE, FALSE) THEN
          REPEAT
            IF ExcelFileExists THEN
              FileMgt.DeleteClientFile4PS(
                ExcelEstimateMgt.GetPathFileName(EstPartRec2), TRUE);
          UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE GetPartQuantity@1210190007() PartQuan@1210190000 : Decimal;
    VAR
      lvEstPartRec@1210190001 : Record 11072073;
      lvSubEstRec@1100485000 : Record 11072074;
      CurrLevel@1210190002 : Integer;
    BEGIN
      PartQuan := 1;

      IF lvSubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN
        PartQuan := PartQuan * lvSubEstRec."Cumulative Frequency";

      IF lvEstPartRec.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN BEGIN

        PartQuan := PartQuan * lvEstPartRec.Quantity;
        CurrLevel := lvEstPartRec.Level;

        lvEstPartRec.RESET;
        lvEstPartRec.SETRANGE("Estimate No.", lvEstPartRec."Estimate No.");
        lvEstPartRec.SETRANGE("Sub-Estimate No.", lvEstPartRec."Sub-Estimate No.");
        lvEstPartRec.SETRANGE("Part Group", lvEstPartRec."Part Group");
        IF CurrLevel = 3 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Paragraph);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 2 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part, lvEstPartRec.Chapter);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
        IF CurrLevel = 1 THEN BEGIN
          CurrLevel := CurrLevel - 1;
          lvEstPartRec.SETRANGE(Part);
          lvEstPartRec.SETRANGE(Level, 0);
          IF lvEstPartRec.FINDFIRST THEN BEGIN
            PartQuan := PartQuan * lvEstPartRec.Quantity;
            CurrLevel := lvEstPartRec.Level;
          END;
        END;
      END;

      EXIT(PartQuan);
    END;

    PROCEDURE ProcessSalesOfferPrices@1100485007(IFCYChanged@1100528600 : Boolean);
    VAR
      lSubEstPartRec@1100485000 : Record 11072073;
      lSubEstPartRec2@1210190000 : Record 11072073;
      lLevel@1100485001 : Integer;
      lvPartQty@1100485003 : Decimal;
      NewOfferAmount@1210190003 : Decimal;
      OldOfferAmount@1210190001 : Decimal;
      FixedOfferAmount@1210190002 : Decimal;
      DifferenceAmount@1210190004 : Decimal;
      DifferenceFactor@1210190005 : Decimal;
      TotalOfferAmount@1210190006 : Decimal;
    BEGIN
      IF OnTempTable THEN
        EXIT;

      //db.sn, 04-03-11: M22630
      IF NOT IFCYChanged THEN BEGIN
        NewOfferAmount := "Offer Amount";
        OldOfferAmount := xRec."Offer Amount";
        DifferenceAmount := NewOfferAmount - OldOfferAmount;
      END ELSE BEGIN
        NewOfferAmount := "Offer Amount (FCY)";
        OldOfferAmount := xRec."Offer Amount (FCY)";
        DifferenceAmount := NewOfferAmount - OldOfferAmount;
      END;

      GetFixedOfferAmount(Rec, IFCYChanged, FixedOfferAmount);

      NewOfferAmount -= FixedOfferAmount;
      OldOfferAmount -= FixedOfferAmount;

      lSubEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lSubEstPartRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      lSubEstPartRec.SETRANGE("Offer fixed",FALSE);
      IF OldOfferAmount <> 0 THEN
        DifferenceFactor := NewOfferAmount / OldOfferAmount
      ELSE
        DifferenceFactor := 0;
      //db.en, 04-03-11: M22630

      IF Level < 3 THEN BEGIN
        //Distribute amount downwards.
        lSubEstPartRec.SETRANGE(Level, Level + 1, 3);
        CASE Level OF
          1: BEGIN
               lSubEstPartRec.SETRANGE(Chapter, Part);
             END;
          2: BEGIN
               lSubEstPartRec.SETRANGE(Chapter, Chapter);
               lSubEstPartRec.SETRANGE(Paragraph, Part);
             END;
        END;
        IF lSubEstPartRec.FINDSET THEN BEGIN
          REPEAT
            IF lSubEstPartRec."Offer fixed" THEN
              ERROR(Text009, lSubEstPartRec.Part);
            FixedOfferAmount := 0;
            GetFixedOfferAmount(lSubEstPartRec, IFCYChanged, FixedOfferAmount);
            IF NOT IFCYChanged THEN BEGIN
              lSubEstPartRec."Offer Amount" := (lSubEstPartRec."Offer Amount" - FixedOfferAmount) * DifferenceFactor + FixedOfferAmount;
              lSubEstPartRec."Offer Amount (FCY)" := ExchangeAmtLCYToFCY(lSubEstPartRec."Offer Amount", FALSE);
            END ELSE BEGIN
              lSubEstPartRec."Offer Amount (FCY)" := (lSubEstPartRec."Offer Amount (FCY)" - FixedOfferAmount) * DifferenceFactor + FixedOfferAmount;
              lSubEstPartRec."Offer Amount" := ExchangeAmtFCYToLCY(lSubEstPartRec."Offer Amount (FCY)", FALSE);
            END;
            lvPartQty := lSubEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
              lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount" / lvPartQty;
              lSubEstPartRec."Offer Price (FCY)" := lSubEstPartRec."Offer Amount (FCY)" / lvPartQty;
            END;
            lSubEstPartRec.MODIFY;
          UNTIL lSubEstPartRec.NEXT = 0;
        END;
      END;

      IF GetTotalOfferAmount(Rec, IFCYChanged, TotalOfferAmount) THEN BEGIN
        IF (NOT IFCYChanged AND ("Offer Amount" <> TotalOfferAmount)) OR
           (IFCYChanged AND ("Offer Amount (FCY)" <> TotalOfferAmount))
        THEN BEGIN
          CumQuan := GetPartQuantity;
          IF NOT IFCYChanged THEN BEGIN
            "Offer Amount" := TotalOfferAmount;
            "Offer Amount (FCY)" := ExchangeAmtLCYToFCY("Offer Amount", FALSE);
          END ELSE BEGIN
            "Offer Amount (FCY)" := TotalOfferAmount;
            "Offer Amount" := ExchangeAmtFCYToLCY("Offer Amount (FCY)", FALSE);
          END;
          IF CumQuan <> 0 THEN BEGIN
            "Offer Price" := "Offer Amount" / CumQuan;
            "Offer Price (FCY)" := "Offer Amount (FCY)" / CumQuan;
          END;
          IF NOT IFCYChanged THEN
            DifferenceAmount := "Offer Amount" - xRec."Offer Amount"
          ELSE
            DifferenceAmount := "Offer Amount (FCY)" - xRec."Offer Amount (FCY)";
        END;
      END;

      IF Level > 0 THEN BEGIN
        FOR lLevel := Level DOWNTO 1 DO BEGIN
          lSubEstPartRec.RESET;
          lSubEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          lSubEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          lSubEstPartRec.SETRANGE("Offer fixed",FALSE);
          CASE lLevel OF
            3: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter, Chapter);
                 lSubEstPartRec.SETRANGE(Paragraph, Paragraph);
               END;
            2: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter, Chapter);
                 lSubEstPartRec.SETRANGE(Paragraph);
               END;
            1: BEGIN
                 lSubEstPartRec.SETRANGE(Level, lLevel - 1);
                 lSubEstPartRec.SETRANGE(Chapter);
               END;
          END;
          IF lSubEstPartRec.FINDFIRST THEN BEGIN
            IF lSubEstPartRec."Offer fixed" THEN
              ERROR(Text008, lSubEstPartRec.Part);
            IF NOT IFCYChanged THEN BEGIN
              lSubEstPartRec."Offer Amount" := lSubEstPartRec."Offer Amount" + DifferenceAmount;
              lSubEstPartRec."Offer Amount (FCY)" := ExchangeAmtLCYToFCY(lSubEstPartRec."Offer Amount", FALSE);
            END ELSE BEGIN
              lSubEstPartRec."Offer Amount (FCY)" := lSubEstPartRec."Offer Amount (FCY)" + DifferenceAmount;
              lSubEstPartRec."Offer Amount" := ExchangeAmtFCYToLCY(lSubEstPartRec."Offer Amount (FCY)", FALSE);
            END;
            lvPartQty := lSubEstPartRec.GetPartQuantity();
            IF lvPartQty <> 0 THEN BEGIN
              lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount" / lvPartQty;
              lSubEstPartRec."Offer Price (FCY)" := lSubEstPartRec."Offer Amount (FCY)" / lvPartQty;
            END ELSE BEGIN
              lSubEstPartRec."Offer Price" := lSubEstPartRec."Offer Amount";
              lSubEstPartRec."Offer Amount" := 0;
              lSubEstPartRec."Offer Price (FCY)" := lSubEstPartRec."Offer Amount (FCY)";
              lSubEstPartRec."Offer Amount (FCY)" := 0;
             END;
             lSubEstPartRec.MODIFY;
          END;
        END;
      END;
    END;

    PROCEDURE UpdateProjElem@1100525000(lvAction@1100485000 : Integer);
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
    BEGIN
      IF "Project No." = '' THEN
        "Extension Contract" := '';  //DP00260

      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      IF lvAction = 0 THEN
        lvEstLineRec.SETFILTER("Project No.", '%1|%2', '', xRec."Project No.")
      ELSE
        lvEstLineRec.SETFILTER(Element, '%1|%2', '', xRec.Element);
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvAction = 0 THEN
            lvEstLineRec.VALIDATE("Project No.", "Project No.")
          ELSE
            lvEstLineRec.VALIDATE(Element, Element);
          IF "Project No."= '' THEN
            lvEstLineRec."Extension Contract" := '';  //DP00260
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetEstLineFilterFromEstPart@1100525001(VAR EstLine@1100525003 : Record 11072072);
    VAR
      SubEst@1100525002 : Record 11072074;
    BEGIN
      SubEst.GET("Estimate No.","Sub-Estimate No.");

      EstLine.RESET;
      EstLine.SETRANGE("Estimate No.",SubEst."Estimate No.");
      EstLine.SETRANGE("Chapter (Sub-Estimate)",SubEst.Chapter);
      IF SubEst.Level >= 1 THEN
        IF SubEst.Paragraph <> '' THEN //workaround for empty paragraph when only two levels are used (e.g.: xxx.xxx)
          EstLine.SETRANGE("Paragraph (Sub-Estimate)",SubEst.Paragraph)
        ELSE
          EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");
      IF SubEst.Level >= 2 THEN
        EstLine.SETRANGE("Sub-Estimate No.",SubEst."Sub-Estimate No.");

      IF Level >= 1 THEN
        EstLine.SETRANGE(Chapter,Chapter);
      IF Level >= 2 THEN
        EstLine.SETRANGE(Paragraph,Paragraph);
      IF Level >= 3 THEN
        EstLine.SETRANGE(Part,Part);
    END;

    PROCEDURE EvaluateExpectedLifeSpan@1100525002(CalledBy@1100525002 : Integer);
    VAR
      lvDate1@1100525000 : Date;
      lvDate2@1100525001 : Date;
    BEGIN
      IF (CalledBy = FIELDNO("Construction Year")) OR
         (CalledBy = FIELDNO("Expected Life Span")) THEN BEGIN
        IF ("Construction Year" = 0) OR (FORMAT("Expected Life Span") = '') THEN EXIT;
        lvDate1 := DMY2DATE(1, 1, "Construction Year");
        lvDate2 := CALCDATE("Expected Life Span", lvDate1);
        "Investment Year" := DATE2DMY(lvDate2,3);
      END;

      IF (CalledBy = FIELDNO("Investment Year")) THEN BEGIN
        //conversion to dateformula may be different for each language
      END;
    END;

    PROCEDURE GetMargin@1100525003(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iOfferPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iOfferPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE GetMarkup@1100525006(iOfferPrice@1100525000 : Decimal;iCostPrice@1100525001 : Decimal) Result : Decimal;
    BEGIN
      IF (iCostPrice <> 0)  THEN
        Result := ROUND(100*(iOfferPrice - iCostPrice)/iCostPrice)
      ELSE
        Result := 0;

      EXIT(Result);
    END;

    PROCEDURE ProcessPartFields@1100525004(CalledBy@1100525001 : Integer);
    VAR
      EstPartRec@1100525000 : Record 11072073;
    BEGIN
      //db, 27-05-10: T4776
      EstPartRec.RESET;
      EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.",Level,Chapter,Paragraph);
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      CASE Level OF
        1: EstPartRec.SETRANGE(Chapter, Chapter);
        2: EstPartRec.SETRANGE(Paragraph, Paragraph);
        3: EstPartRec.SETRANGE(Part, Part);
      END;
      EstPartRec.SETFILTER(Level, '%1..', Level+1);
      IF EstPartRec.FINDSET THEN BEGIN
        REPEAT
          IF CalledBy = FIELDNO("Offer fixed") THEN BEGIN
            EstPartRec.VALIDATE("Offer fixed", "Offer fixed");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO("Print on Quote") THEN BEGIN  //X007
            EstPartRec.VALIDATE("Print on Quote", "Print on Quote");
            EstPartRec.MODIFY;
          END;
          IF CalledBy = FIELDNO(Extension) THEN BEGIN  //X007
            EstPartRec.VALIDATE(Extension, Extension);
            EstPartRec.MODIFY;
          END;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards@1100525005(iPartRec@1100525001 : Record 11072073);
    BEGIN
      //db, 26-07-10: M20060
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF NOT "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            EstPartRec."Offer fixed" := "Offer fixed";
            EstPartRec.MODIFY;
            CheckOfferFixedUpwards(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE CheckOfferFixedUpwards1@1100525007(iPartRec@1100525001 : Record 11072073);
    VAR
      EstPartRec2@1100525000 : Record 11072073;
    BEGIN
      //db, 03-08-10: M22083
      WITH iPartRec DO BEGIN
        IF Level = 0 THEN EXIT;
        IF "Offer fixed" THEN BEGIN
          EstPartRec.RESET;
          EstPartRec.SETCURRENTKEY("Estimate No.","Sub-Estimate No.", "Part Group", Part);
          EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
          EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
          EstPartRec.SETRANGE("Part Group", "Part Group");
          CASE Level OF
            1: EstPartRec.SETRANGE(Level, 0);
            2: EstPartRec.SETRANGE(Part, Chapter);
            3: EstPartRec.SETRANGE(Part, Paragraph);
          END;
          IF EstPartRec.FINDSET THEN BEGIN
            IF NOT EstPartRec."Offer fixed" THEN BEGIN
              EstPartRec2.RESET;
              EstPartRec2.SETRANGE("Estimate No.", "Estimate No.");
              EstPartRec2.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
              EstPartRec2.SETRANGE("Part Group", "Part Group");
              EstPartRec2.SETFILTER(Part, '<>%1', Part);
              CASE EstPartRec.Level OF
                1: EstPartRec2.SETRANGE(Chapter, EstPartRec.Chapter);
                2: EstPartRec2.SETRANGE(Paragraph, EstPartRec.Paragraph);
              END;
              EstPartRec2.SETRANGE(Level, Level);
              EstPartRec2.SETRANGE("Offer fixed", FALSE);
              IF EstPartRec2.FINDSET THEN BEGIN
                EXIT;
              END ELSE BEGIN
                EstPartRec."Offer fixed" := "Offer fixed";
                EstPartRec.MODIFY;
              END;
            END;
            CheckOfferFixedUpwards1(EstPartRec);
          END;
        END;
      END;
    END;

    PROCEDURE PartHasLowerLevels@1100525008() : Boolean;
    VAR
      SubEstimatePart@1100525000 : Record 11072073;
    BEGIN
      //mg, 07-12-10: M22588
      IF Level = 3 THEN
        EXIT;
      SubEstimatePart.SETRANGE("Estimate No.", "Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      SubEstimatePart.SETRANGE("Part Group", "Part Group");
      SubEstimatePart.SETRANGE(Level, Level +1);
      CASE Level +1 OF
        2:
          SubEstimatePart.SETRANGE(Chapter, Chapter);
        3:
          BEGIN
            SubEstimatePart.SETRANGE(Chapter, Chapter);
            SubEstimatePart.SETRANGE(Paragraph, Part);
          END;
      END;
      EXIT(NOT SubEstimatePart.ISEMPTY);
    END;

    PROCEDURE DeleteSubPartsLowerLevel@1210190000();
    VAR
      EstPartRec@1210190000 : Record 11072073;
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //Call 23762.sn
      IF Level = 3 THEN
        EXIT;

      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstPartRec.SETRANGE("Part Group", "Part Group");
      IF Level > 0 THEN
        EstPartRec.SETRANGE(Chapter, Chapter);
      IF Level = 2 THEN
        EstPartRec.SETRANGE(Paragraph, Paragraph);
      EstPartRec.SETRANGE(Level, Level + 1);
      IF EstPartRec.FINDSET THEN
        REPEAT
          EstPartRec.DELETE(TRUE);
          IF EstPartTotal.GET(EstPartRec."Estimate No.",EstPartRec."Sub-Estimate No.",EstPartRec."Part Group",EstPartRec.Part) THEN
            EstPartTotal.DELETE;   //DP00381
          COMMIT;
        UNTIL EstPartRec.NEXT = 0;
      //Call 23762.en
    END;

    PROCEDURE GetFixedOfferAmount@1210190005(ISubEstimatePart@1210190000 : Record 11072073;IUseFCY@1100528600 : Boolean;VAR FixedOfferAmount@1210190001 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190002 : Record 11072073;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      //SubEstimatePart.SETRANGE("Offer fixed",TRUE);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetFixedOfferAmount(SubEstimatePart, IUseFCY, FixedOfferAmount) THEN
            IF SubEstimatePart."Offer fixed" THEN
              IF NOT IUseFCY THEN
                FixedOfferAmount += SubEstimatePart."Offer Amount"
              ELSE
                FixedOfferAmount += SubEstimatePart."Offer Amount (FCY)"
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE GetTotalOfferAmount@1210190004(ISubEstimatePart@1210190000 : Record 11072073;IUseFCY@1100528600 : Boolean;VAR TotalOfferAmount@1210190002 : Decimal) : Boolean;
    VAR
      SubEstimatePart@1210190001 : Record 11072073;
    BEGIN
      IF ISubEstimatePart.Level = 3 THEN
        EXIT(FALSE);

      SubEstimatePart.SETRANGE("Estimate No.", ISubEstimatePart."Estimate No.");
      SubEstimatePart.SETRANGE("Sub-Estimate No.", ISubEstimatePart."Sub-Estimate No.");
      CASE ISubEstimatePart.Level OF
        1: SubEstimatePart.SETRANGE(Chapter, ISubEstimatePart.Part);
        2: SubEstimatePart.SETRANGE(Paragraph, ISubEstimatePart.Part);
        3: SubEstimatePart.SETRANGE(Part, ISubEstimatePart.Part);
      END;
      SubEstimatePart.SETRANGE(Level, ISubEstimatePart.Level +1);
      IF SubEstimatePart.FINDSET THEN BEGIN
        REPEAT
          IF NOT GetTotalOfferAmount(SubEstimatePart, IUseFCY, TotalOfferAmount) THEN
            IF NOT IUseFCY THEN
              TotalOfferAmount += SubEstimatePart."Offer Amount"
            ELSE
              TotalOfferAmount += SubEstimatePart."Offer Amount (FCY)";
        UNTIL SubEstimatePart.NEXT = 0;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE);
    END;

    PROCEDURE CopyPartText@1210190021(OrigPart@1100528900 : Code[20];DestPart@1100528901 : Code[20]);
    VAR
      TextRec@1100485000 : Record 11020595;
      TextRec2@1100485001 : Record 11020595;
      CurrLino@1100525001 : Integer;
    BEGIN
      //db, 28-11-11: M30268
      IF OrigPart = '' THEN OrigPart := Part;      //DP00686
      IF DestPart = '' THEN DestPart := OrigPart;  //DP00686

      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETFILTER(Group, '%1', '');
      TextRec.SETFILTER("No.", '%1', '');
      TextRec.SETRANGE("Estimate No.", "Estimate No.");
      TextRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, DestPart);  //DP00686
      TextRec.SETRANGE("Estimate Line No.", 0);
      TextRec.SETRANGE("Source Table", TextRec."Source Table"::Part);
      TextRec.DELETEALL;

      TextRec.SETRANGE("Source Table");
      IF TextRec.FINDLAST THEN
        CurrLino := TextRec."Line No."
      ELSE
        CurrLino := 0;

      TextRec.RESET;
      TextRec.SETRANGE("Table Name", TextRec."Table Name"::Estimate);
      TextRec.SETRANGE("Part Group", "Part Group");
      TextRec.SETRANGE(Part, OrigPart);  //DP00686
      TextRec.SETRANGE("Part Line No.", 0);  //skip comment lines: see CopyPartLines
      TextRec.SETFILTER("Estimate No.", '%1', '');
      TextRec.SETRANGE("Source Table", TextRec."Source Table"::" ");  //db, 26-01-15
      IF TextRec.FINDSET THEN BEGIN
        REPEAT
          TextRec2.COPY(TextRec);
          TextRec2."Source Table" := TextRec2."Source Table"::Part;
          TextRec2."Created by" := USERID;
          TextRec2."Time Created" := TIME;

          TextRec2."Estimate No." := "Estimate No.";
          TextRec2."Sub-Estimate No." := "Sub-Estimate No.";
          TextRec2.Part := DestPart;  //DP00686
          CurrLino := CurrLino + 10000;
          TextRec2."Line No." := CurrLino;
          TextRec2.INSERT;
        UNTIL TextRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateProjPlanActCode@1210190022();
    VAR
      lvEstLineRec@1210190000 : Record 11072072;
    BEGIN
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER("Project Planning Activity Code", '%1|%2', '', xRec."Project Planning Activity Code");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Project Planning Activity Code", "Project Planning Activity Code");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateExtensionContract@1100525013();
    VAR
      lvEstLineRec@1210190000 : Record 11072072;
    BEGIN
      //db, 12-11-13: DP00260 (13440)
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER("Extension Contract", '%1|%2', '', xRec."Extension Contract");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvEstLineRec."Project No." <> '' THEN
            lvEstLineRec.VALIDATE("Extension Contract", "Extension Contract");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE EditDocuments@1100528702(ContactNo@1210190003 : Code[20];ContactPersonNo@1210190004 : Code[20];SendMail@1210190002 : Boolean;Recipient@1100528700 : Text[120]);
    VAR
      DocumentTemplate@1210190001 : Record 11012401;
      DocumentMailing@1210190000 : Codeunit 11012278;
      RecRef@1100525000 : RecordRef;
      DocumentLinkRIDs@1100525001 : ARRAY [5] OF RecordID;
    BEGIN
      RecRef.GETTABLE(Rec);
      DocumentLinkRIDs[1] := RecRef.RECORDID;

      DocumentMailing.EditDocuments(
        STRSUBSTNO('%1', DocumentTemplate.Type::Estimate), DocumentLinkRIDs,
        '', ContactNo, ContactPersonNo, SendMail, Recipient);
    END;

    PROCEDURE InitRecord@1210190006();
    BEGIN
      // 34595.n
      IF SubEstRec.GET("Estimate No.","Sub-Estimate No.") THEN BEGIN
        "Project No." := SubEstRec."Project No.";
        Element := SubEstRec.Element;
        IF "Project No." <> '' THEN
          "Extension Contract" := SubEstRec."Extension Contract";  //DP00260
        "Project Planning Activity Code" := SubEstRec."Project Planning Activity Code";
        "Part Group" := SubEstRec."Part Group";
      END;
      InitSurcharge;  //DP00381
    END;

    PROCEDURE GetDataCaption@1100528000() : Text[250];
    BEGIN
      EXIT(STRSUBSTNO('%1 - %2 - %3 - %4 - %5', "Estimate No.", "Sub-Estimate No.", "Part Group", Part, Description + ' ' + "Description 2"));  //db, 17-02-15: DP00686
    END;

    PROCEDURE GetPreviousPart@1100528001(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      SETRANGE("Estimate No.", "Estimate No.");  //DP00909
      IF Level = 0 THEN
        EXIT(NEXT(-1) <> 0);  //DP00909

      //DP00909.so
      //SETRANGE("Estimate No.", "Estimate No.");
      //SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");  //db, 27-11-15: T006328
      //DP00909.eo

      CASE JumpLevel OF
        0 : EXIT(NEXT(-1) <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDFIRST;
              SETRANGE(Paragraph);
              IF NEXT(-1) = 0 THEN BEGIN
                SETRANGE(Chapter);
                IF NEXT(-1) = 0 THEN
                  EXIT(TRUE);
                SETRANGE(Chapter, Chapter);
              END;

              SETRANGE(Paragraph, Paragraph);
              EXIT(FINDFIRST);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDFIRST;
              SETRANGE(Chapter);
              IF NEXT(-1) = 0 THEN
                EXIT(TRUE)
              ELSE BEGIN
                SETRANGE(Chapter, Chapter);
                EXIT(FINDFIRST);
              END;
            END;
       END;
    END;

    PROCEDURE GetNextPart@1100528002(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      SETRANGE("Estimate No.", "Estimate No.");  //DP00909
      IF Level = 0 THEN
        EXIT(NEXT <> 0);

      //DP00909.so
      //SETRANGE("Estimate No.", "Estimate No.");
      //SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");  //db, 27-11-15: T006328
      //DP00909.eo

      CASE JumpLevel OF
        0 : EXIT(NEXT <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDLAST;
              SETRANGE(Chapter);
              SETRANGE(Paragraph);
              IF NEXT = 0 THEN;
              EXIT(TRUE);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDLAST;
              SETRANGE(Chapter);
              IF NEXT = 0 THEN;
              EXIT(TRUE)
            END;
      END;
    END;

    PROCEDURE UpdateSurcharge@1100528900(CostType@1100485000 : Integer);
    VAR
      EstLineRec@1100485001 : Record 11072072;
      RcpLineRec@1100528900 : Record 11072075;
    BEGIN
      //DP00381
      EstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      EstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      EstLineRec.SETRANGE("Part Group", "Part Group");
      EstLineRec.SETRANGE(Part, Part);
      EstLineRec.SETRANGE("Surcharge Type", EstLineRec."Surcharge Type"::" ");
      EstLineRec.SETFILTER(Recipe, '%1', '');
      IF CostType = 0 THEN
        EstLineRec.SETFILTER("Surcharge % Labor", '%1|%2', 0, xRec."Surcharge % Labor");
      IF CostType = 1 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Material");
      IF CostType = 2 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Subcontracting");
      IF CostType = 3 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Plant");
      IF CostType = 4 THEN
        EstLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Sundry");
      IF EstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CostType = 0 THEN
            EstLineRec.VALIDATE("Surcharge % Labor", "Surcharge % Labor");
          IF CostType = 1 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Material THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Material");
          IF CostType = 2 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Subcontracting THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Subcontracting");
          IF CostType = 3 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Plant THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Plant");
          IF CostType = 4 THEN
            IF EstLineRec."Cost Type (Price)" = EstLineRec."Cost Type (Price)"::Sundry THEN
              EstLineRec.VALIDATE("Surcharge % Price", "Surcharge % Sundry");
          EstLineRec.MODIFY;
        UNTIL EstLineRec.NEXT = 0;
      END;

      RcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      RcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      RcpLineRec.SETRANGE("Part Group", "Part Group");
      RcpLineRec.SETRANGE(Part, Part);
      RcpLineRec.SETRANGE("Surcharge Type", RcpLineRec."Surcharge Type"::" ");
      IF CostType = 0 THEN
        RcpLineRec.SETFILTER("Surcharge % Labor", '%1|%2', 0, xRec."Surcharge % Labor");
      IF CostType = 1 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Material");
      IF CostType = 2 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Subcontracting");
      IF CostType = 3 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Plant");
      IF CostType = 4 THEN
        RcpLineRec.SETFILTER("Surcharge % Price", '%1|%2', 0, xRec."Surcharge % Sundry");
      IF RcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CostType = 0 THEN
            RcpLineRec.VALIDATE("Surcharge % Labor", "Surcharge % Labor");
          IF CostType = 1 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Material THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Material");
          IF CostType = 2 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Subcontracting THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Subcontracting");
          IF CostType = 3 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Plant THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Plant");
          IF CostType = 4 THEN
            IF RcpLineRec."Cost Type (Price)" = RcpLineRec."Cost Type (Price)"::Sundry THEN
              RcpLineRec.VALIDATE("Surcharge % Price", "Surcharge % Sundry");
          RcpLineRec.MODIFY;
        UNTIL RcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE InitSurcharge@1100528911();
    BEGIN
      //DP00381
      IF SubEstRec.GET("Estimate No.", "Sub-Estimate No.") THEN BEGIN
        "Surcharge % Labor" := SubEstRec."Surcharge % Labor";
        "Surcharge % Material" := SubEstRec."Surcharge % Material";
        "Surcharge % Subcontracting" := SubEstRec."Surcharge % Subcontracting";
        "Surcharge % Plant" := SubEstRec."Surcharge % Plant";
        "Surcharge % Sundry" := SubEstRec."Surcharge % Sundry";
      END;
    END;

    PROCEDURE GetTotals@1100528901(VAR CostHours@1100528903 : Decimal;VAR CostLabor@1100528904 : Decimal;VAR CostMat@1100528905 : Decimal;VAR CostSubc@1100528907 : Decimal;VAR CostPlant@1100528908 : Decimal;VAR CostSundry@1100528909 : Decimal;VAR SalesHours@1100528924 : Decimal;VAR SalesLabor@1100528923 : Decimal;VAR SalesMat@1100528922 : Decimal;VAR SalesSubc@1100528921 : Decimal;VAR SalesPlant@1100528920 : Decimal;VAR SalesSundry@1100528919 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
      sp1@1100528901 : Integer;
      sp2@1100528902 : Integer;
    BEGIN
      //DP00381
      CheckFormat(sp1,sp2);

      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

      CASE CurrLevel OF
        0:BEGIN
            CALCFIELDS("Hours Total", "Labor Total", "Material Total",
              "Subcontracting Total", "Plant Total", "Sundry Total");
            CostHours := "Hours Total";
            CostLabor := "Labor Total";
            CostMat := "Material Total";
            CostSubc := "Subcontracting Total";
            CostPlant := "Plant Total";
            CostSundry := "Sundry Total";

            CALCFIELDS(
              "Hours Sales Total", "Labor Sales Total", "Material Sales Total",
              "Subcontracting Sales Total", "Plant Sales Total", "Sundry Sales Total");
            SalesHours := "Hours Sales Total";
            SalesLabor := "Labor Sales Total";
            SalesMat := "Material Sales Total";
            SalesSubc := "Subcontracting Sales Total";
            SalesPlant := "Plant Sales Total";
            SalesSundry := "Sundry Sales Total";
          END;
        1:BEGIN
            CALCFIELDS("Hours Chapter", "Labor Chapter", "Material Chapter",
              "Subcontracting Chapter", "Plant Chapter", "Sundry Chapter");
            CostHours := "Hours Chapter";
            CostLabor := "Labor Chapter";
            CostMat := "Material Chapter";
            CostSubc := "Subcontracting Chapter";
            CostPlant := "Plant Chapter";
            CostSundry := "Sundry Chapter";

            CALCFIELDS(
              "Hours Sales Chapter", "Labor Sales Chapter", "Material Sales Chapter",
              "Subcontracting Sales Chapter", "Plant Sales Chapter", "Sundry Sales Chapter");
            SalesHours := "Hours Sales Chapter";
            SalesLabor := "Labor Sales Chapter";
            SalesMat := "Material Sales Chapter";
            SalesSubc := "Subcontracting Sales Chapter";
            SalesPlant := "Plant Sales Chapter";
            SalesSundry := "Sundry Sales Chapter";
          END;
        2:BEGIN
            CALCFIELDS("Hours Paragraph", "Labor Paragraph", "Material Paragraph",
              "Subcontracting Paragraph", "Plant Paragraph", "Sundry Paragraph");
            CostHours := "Hours Paragraph";
            CostLabor := "Labor Paragraph";
            CostMat := "Material Paragraph";
            CostSubc := "Subcontracting Paragraph";
            CostPlant := "Plant Paragraph";
            CostSundry := "Sundry Paragraph";

            CALCFIELDS(
              "Hours Sales Paragraph", "Labor Sales Paragraph", "Material Sales Paragraph",
              "Subcontracting Sales Paragraph", "Plant Sales Paragraph", "Sundry Sales Paragraph");
            SalesHours := "Hours Sales Paragraph";
            SalesLabor := "Labor Sales Paragraph";
            SalesMat := "Material Sales Paragraph";
            SalesSubc := "Subcontracting Sales Paragraph";
            SalesPlant := "Plant Sales Paragraph";
            SalesSundry := "Sundry Sales Paragraph";
          END;
        3:BEGIN
            CALCFIELDS("Hours Part", "Labor Part", "Material Part",
              "Subcontracting Part", "Plant Part", "Sundry Part");
            CostHours := "Hours Part";
            CostLabor := "Labor Part";
            CostMat := "Material Part";
            CostSubc := "Subcontracting Part";
            CostPlant := "Plant Part";
            CostSundry := "Sundry Part";

            CALCFIELDS("Hours Sales Part", "Labor Sales Part", "Material Sales Part",
              "Subcontracting Sales Part", "Plant Sales Part", "Sundry Sales Part");
            SalesHours := "Hours Sales Part";
            SalesLabor := "Labor Sales Part";
            SalesMat := "Material Sales Part";
            SalesSubc := "Subcontracting Sales Part";
            SalesPlant := "Plant Sales Part";
            SalesSundry := "Sundry Sales Part";
          END;
      END;
    END;

    PROCEDURE GetCumTotals@1100525011(VAR CostHours@1100528903 : Decimal;VAR CostLabor@1100528904 : Decimal;VAR CostMat@1100528905 : Decimal;VAR CostSubc@1100528907 : Decimal;VAR CostPlant@1100528908 : Decimal;VAR CostSundry@1100528909 : Decimal;VAR SalesHours@1100528924 : Decimal;VAR SalesLabor@1100528923 : Decimal;VAR SalesMat@1100528922 : Decimal;VAR SalesSubc@1100528921 : Decimal;VAR SalesPlant@1100528920 : Decimal;VAR SalesSundry@1100528919 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
      sp1@1100528901 : Integer;
      sp2@1100528902 : Integer;
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //DP00381
      CheckFormat(sp1,sp2);

      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 2) THEN CurrLevel := CurrLevel + 1;

      IF NOT EstPartTotal.GET("Estimate No.", "Sub-Estimate No.", "Part Group", Part) THEN
        EstPartTotal.INIT;

      WITH EstPartTotal DO BEGIN
        CASE CurrLevel OF
          0:BEGIN
              CALCFIELDS("Cum. Hours Total", "Cum. Labor Total", "Cum. Material Total",
                "Cum. Subcontracting Total", "Cum. Plant Total", "Cum. Sundry Total");
              CostHours := "Cum. Hours Total";
              CostLabor := "Cum. Labor Total";
              CostMat := "Cum. Material Total";
              CostSubc := "Cum. Subcontracting Total";
              CostPlant := "Cum. Plant Total";
              CostSundry := "Cum. Sundry Total";

              CALCFIELDS("Cum. Hours Total (Sales)", "Cum. Labor Total (Sales)", "Cum. Mat. Total (Sales)",
                "Cum. Subc. Total (Sales)", "Cum. Plant Total (Sales)", "Cum. Sundry Total (Sales)");
              SalesHours := "Cum. Hours Total (Sales)";
              SalesLabor := "Cum. Labor Total (Sales)";
              SalesMat := "Cum. Mat. Total (Sales)";
              SalesSubc := "Cum. Subc. Total (Sales)";
              SalesPlant := "Cum. Plant Total (Sales)";
              SalesSundry := "Cum. Sundry Total (Sales)";
            END;
          1:BEGIN
              CALCFIELDS("Cum. Hours Chapter", "Cum. Labor Chapter", "Cum. Material Chapter",
                "Cum. Subcontracting Chapter", "Cum. Plant Chapter", "Cum. Sundry Chapter");
              CostHours := "Cum. Hours Chapter";
              CostLabor := "Cum. Labor Chapter";
              CostMat := "Cum. Material Chapter";
              CostSubc := "Cum. Subcontracting Chapter";
              CostPlant := "Cum. Plant Chapter";
              CostSundry := "Cum. Sundry Chapter";

              CALCFIELDS("Cum. Hours Chapter (Sales)", "Cum. Labor Chapter (Sales)", "Cum. Mat. Chapter (Sales)",
                "Cum. Subc. Chapter (Sales)", "Cum. Plant Chapter (Sales)", "Cum. Sundry Chapter (Sales)");
              SalesHours := "Cum. Hours Chapter (Sales)";
              SalesLabor := "Cum. Labor Chapter (Sales)";
              SalesMat := "Cum. Mat. Chapter (Sales)";
              SalesSubc := "Cum. Subc. Chapter (Sales)";
              SalesPlant := "Cum. Plant Chapter (Sales)";
              SalesSundry := "Cum. Sundry Chapter (Sales)";
            END;
          2:BEGIN
              CALCFIELDS("Cum. Hours Paragraph", "Cum. Labor Paragraph", "Cum. Material Paragraph",
                "Cum. Subcontracting Paragraph", "Cum. Plant Paragraph", "Cum. Sundry Paragraph");
              CostHours := "Cum. Hours Paragraph";
              CostLabor := "Cum. Labor Paragraph";
              CostMat := "Cum. Material Paragraph";
              CostSubc := "Cum. Subcontracting Paragraph";
              CostPlant := "Cum. Plant Paragraph";
              CostSundry := "Cum. Sundry Paragraph";

              CALCFIELDS("Cum. Hours Paragraph (Sales)", "Cum. Labor Paragraph (Sales)", "Cum. Mat. Paragraph (Sales)",
                "Cum. Subc. Paragraph (Sales)", "Cum. Plant Paragraph (Sales)", "Cum. Sundry Paragraph (Sales)");
              SalesHours := "Cum. Hours Paragraph (Sales)";
              SalesLabor := "Cum. Labor Paragraph (Sales)";
              SalesMat := "Cum. Mat. Paragraph (Sales)";
              SalesSubc := "Cum. Subc. Paragraph (Sales)";
              SalesPlant := "Cum. Plant Paragraph (Sales)";
              SalesSundry := "Cum. Sundry Paragraph (Sales)";
            END;
          3:BEGIN
              CALCFIELDS("Cum. Hours Part", "Cum. Labor Part", "Cum. Material Part",
                "Cum. Subcontracting Part", "Cum. Plant Part", "Cum. Sundry Part");
              CostHours := "Cum. Hours Part";
              CostLabor := "Cum. Labor Part";
              CostMat := "Cum. Material Part";
              CostSubc := "Cum. Subcontracting Part";
              CostPlant := "Cum. Plant Part";
              CostSundry := "Cum. Sundry Part";

              CALCFIELDS("Cum. Hours Part (Sales)", "Cum. Labor Part (Sales)", "Cum. Mat. Part (Sales)",
                "Cum. Subc. Part (Sales)", "Cum. Plant Part (Sales)", "Cum. Sundry Part (Sales)");
              SalesHours := "Cum. Hours Part (Sales)";
              SalesLabor := "Cum. Labor Part (Sales)";
              SalesMat := "Cum. Mat. Part (Sales)";
              SalesSubc := "Cum. Subc. Part (Sales)";
              SalesPlant := "Cum. Plant Part (Sales)";
              SalesSundry := "Cum. Sundry Part (Sales)";
            END;
        END;
      END;
    END;

    PROCEDURE UpdatePartTotal@1100525012();
    VAR
      EstPartTotal@1100525000 : Record 11229767;
    BEGIN
      //DP00381
      IF NOT EstPartTotal.GET("Estimate No.","Sub-Estimate No.","Part Group",Part) THEN BEGIN
        EstPartTotal.INIT;
        EstPartTotal."Estimate No." := "Estimate No.";
        EstPartTotal."Sub-Estimate No." := "Sub-Estimate No.";
        EstPartTotal."Part Group" := "Part Group";
        EstPartTotal.Part := Part;
        EstPartTotal.INSERT;
      END;
      EstPartTotal.Chapter := Chapter;
      EstPartTotal.Paragraph := Paragraph;
      EstPartTotal.MODIFY;
    END;

    PROCEDURE CopyPartQuantitySheet@1100409000(OrigPart@1100528900 : Code[20];DestPart@1100528901 : Code[20]);
    VAR
      BasePartQuantitySheet@1100409000 : Record 11020459;
      BasePartQuantityRow@1100409001 : Record 11020460;
      EstimateQuantitySheet@1100409003 : Record 11020462;
      EstimateQuantityRow@1100409002 : Record 11020464;
      EstSetup@1100409006 : Record 11012150;
      NoSeriesMgt@1100409005 : Codeunit 396;
      NewSheet@1100409004 : Code[20];
    BEGIN
      //DP00686
      IF OrigPart = '' THEN OrigPart := Part;      //DP00686
      IF DestPart = '' THEN DestPart := OrigPart;  //DP00686

      //copy relations based on option CopyPartLines (function table Estimate Lines)
      BasePartQuantitySheet.SETRANGE("Part Group", "Part Group");
      BasePartQuantitySheet.SETRANGE(Part, OrigPart);  //DP00686
      IF BasePartQuantitySheet.FINDSET THEN BEGIN
        REPEAT
          EstSetup.GET;
          NewSheet := NoSeriesMgt.GetNextNo(EstSetup."Quantity Sheet Nos.",0D,TRUE);

          EstimateQuantitySheet.INIT;
          EstimateQuantitySheet."Estimate No." := "Estimate No.";
          EstimateQuantitySheet."Sub-Estimate No." := "Sub-Estimate No.";
          EstimateQuantitySheet."Part Group" := "Part Group";
          EstimateQuantitySheet.Part := DestPart;  //DP00686
          EstimateQuantitySheet.Code := NewSheet;
          EstimateQuantitySheet."Source Type" := EstimateQuantitySheet."Source Type"::Part;
          EstimateQuantitySheet."Source Group" := BasePartQuantitySheet."Part Group";
          EstimateQuantitySheet."Source Code" := BasePartQuantitySheet.Part;
          EstimateQuantitySheet."Source Sheet" := BasePartQuantitySheet.Code;
          EstimateQuantitySheet.Description := BasePartQuantitySheet.Description;
          EstimateQuantitySheet.INSERT;

          BasePartQuantityRow.SETRANGE("Part Group", BasePartQuantitySheet."Part Group");
          BasePartQuantityRow.SETRANGE(Part, BasePartQuantitySheet.Part);
          BasePartQuantityRow.SETRANGE("Quantity Sheet", BasePartQuantitySheet.Code);
          IF BasePartQuantityRow.FINDSET THEN BEGIN
            REPEAT
              EstimateQuantityRow.INIT;
              EstimateQuantityRow."Estimate No." := "Estimate No.";
              EstimateQuantityRow."Quantity Sheet" := NewSheet;
              EstimateQuantityRow."Row No." := BasePartQuantityRow."Row No.";
              EstimateQuantityRow.Total := BasePartQuantityRow.Total;
              EstimateQuantityRow.Quantity := BasePartQuantityRow.Quantity;
              EstimateQuantityRow.Length := BasePartQuantityRow.Length;
              EstimateQuantityRow.Width := BasePartQuantityRow.Width;
              EstimateQuantityRow.Height := BasePartQuantityRow.Height;
              EstimateQuantityRow.Result := BasePartQuantityRow.Result;
              EstimateQuantityRow.Description := BasePartQuantityRow.Description;
              EstimateQuantityRow.Formula := BasePartQuantityRow.Formula;
              EstimateQuantityRow.Totaling := BasePartQuantityRow.Totaling;
              EstimateQuantityRow."Total Length" := BasePartQuantityRow."Total Length";
              EstimateQuantityRow."Total Width" := BasePartQuantityRow."Total Width";
              EstimateQuantityRow."Total Height" := BasePartQuantityRow."Total Height";
              EstimateQuantityRow.Feature := BasePartQuantityRow.Feature;
              EstimateQuantityRow."Related to Column" := BasePartQuantityRow."Related to Column";
              EstimateQuantityRow."Related to Part Quantity" := BasePartQuantityRow."Related to Part Quantity";  //db, 13-01-15
              EstimateQuantityRow.INSERT;
            UNTIL BasePartQuantityRow.NEXT = 0;
          END;
        UNTIL BasePartQuantitySheet.NEXT = 0;
      END;
    END;

    PROCEDURE DeleteQuantityRelation@1100409001(lvEst@1100409000 : Code[20];lvSubEst@1100409001 : Code[20];lvPartGrp@1100409002 : Code[20];lvPart@1100409003 : Code[20]);
    VAR
      QuanHeader@1100409006 : Record 11020462;
      QuanRelation@1100409005 : Record 11020463;
      QuanLine@1100409004 : Record 11020464;
    BEGIN
      //DP00686
      QuanHeader.SETRANGE("Estimate No.", "Estimate No.");
      QuanHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      QuanHeader.SETRANGE("Part Group", "Part Group");
      QuanHeader.SETRANGE(Part, Part);
      IF QuanHeader.FINDSET THEN BEGIN
        REPEAT
          QuanLine.SETRANGE("Estimate No.", QuanHeader."Estimate No.");
          QuanLine.SETRANGE("Quantity Sheet", QuanHeader.Code);
          QuanLine.DELETEALL;
        UNTIL QuanHeader.NEXT = 0;
        QuanHeader.DELETEALL;
      END;

      QuanRelation.SETRANGE("Estimate No.", "Estimate No.");
      QuanRelation.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      QuanRelation.SETRANGE("Part Group", "Part Group");
      QuanRelation.SETRANGE(Part, Part);
      QuanRelation.DELETEALL;
    END;

    PROCEDURE UpdateNormGroup@1100409002();
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
      lvRcpLineRec@1100409000 : Record 11072075;
    BEGIN
      //DP00686
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER(Recipe, '%1', '');  //db, 20-01-15
      lvEstLineRec.SETFILTER("Norm Group", '%1|%2', '', xRec."Norm Group");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Norm Group", "Norm Group");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;

      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvRcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvRcpLineRec.SETRANGE("Part Group", "Part Group");
      lvRcpLineRec.SETRANGE(Part, Part);
      lvRcpLineRec.SETFILTER("Norm Group", '%1|%2', '', xRec."Norm Group");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvRcpLineRec.VALIDATE("Norm Group", "Norm Group");
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateNormGroupSales@1100525009();
    VAR
      lvEstLineRec@1100485001 : Record 11072072;
      lvRcpLineRec@1100409000 : Record 11072075;
    BEGIN
      //DP00686
      lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstLineRec.SETRANGE("Part Group", "Part Group");
      lvEstLineRec.SETRANGE(Part, Part);
      lvEstLineRec.SETFILTER(Recipe, '%1', '');  //db, 20-01-15
      lvEstLineRec.SETFILTER("Norm Group (Sales)", '%1|%2', '', xRec."Norm Group (Sales)");
      IF lvEstLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstLineRec.VALIDATE("Norm Group (Sales)", "Norm Group (Sales)");
          lvEstLineRec.MODIFY;
        UNTIL lvEstLineRec.NEXT = 0;
      END;

      lvRcpLineRec.SETRANGE("Estimate No.", "Estimate No.");
      lvRcpLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvRcpLineRec.SETRANGE("Part Group", "Part Group");
      lvRcpLineRec.SETRANGE(Part, Part);
      lvRcpLineRec.SETFILTER("Norm Group (Sales)", '%1|%2', '', xRec."Norm Group (Sales)");
      IF lvRcpLineRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvRcpLineRec.VALIDATE("Norm Group (Sales)", "Norm Group (Sales)");
          lvRcpLineRec.MODIFY;
        UNTIL lvRcpLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetCurrencyFactor@1100528601() : Decimal;
    VAR
      CurrencyExchangeRate@1100528601 : Record 330;
    BEGIN
      CALCFIELDS("Currency Code");
      EXIT(CurrencyExchangeRate.ExchangeRate(2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", TRUE));
    END;

    PROCEDURE ExchangeAmtLCYToFCY@1100528602(IAmount@1100528601 : Decimal;IUsePriceRounding@1100528605 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
      CurrencyCode@1100528606 : Code[10];
    BEGIN
      CALCFIELDS("Currency Code");
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      Amount := CurrencyExchangeRate.ExchangeAmtLCYToFCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", IAmount, GetCurrencyFactor, TRUE);
      IF NOT Currency.GET(CurrencyCode) THEN
        Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    PROCEDURE ExchangeAmtFCYToLCY@1100528600(IAmount@1100528601 : Decimal;IUsePriceRounding@1100528605 : Boolean) : Decimal;
    VAR
      CurrencyExchangeRate@1100528600 : Record 330;
      Currency@1100528604 : Record 4;
      Amount@1100528603 : Decimal;
    BEGIN
      CALCFIELDS("Currency Code");
      IF "Currency Code" = '' THEN
        EXIT(IAmount);
      Amount := CurrencyExchangeRate.ExchangeAmtFCYToLCY(
        2, "Estimate No.", EstRec."Reference Date (Rate)", "Currency Code", IAmount, GetCurrencyFactor, TRUE);
      Currency.InitRoundingPrecision;
      IF IUsePriceRounding THEN
        Amount := ROUND(Amount, Currency."Unit-Amount Rounding Precision")
      ELSE
        Amount := ROUND(Amount, Currency."Amount Rounding Precision");
      EXIT(Amount);
    END;

    BEGIN
    END.
  }
}

