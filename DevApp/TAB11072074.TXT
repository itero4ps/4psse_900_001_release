OBJECT Table 11072074 Sub-Estimate NEW
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    DataCaptionFields=Estimate No.,Sub-Estimate No.,Description;
    OnInsert=BEGIN
               TESTFIELD("Sub-Estimate No.");
               IF EstRec.GET("Estimate No.") THEN BEGIN
                 EstRec.TESTFIELD("Part Group");
                 "Part Group" := EstRec."Part Group";
               END;

               InitAdjustmentFactor;
             END;

    OnModify=BEGIN
               EstRec.UpdateLogbook("Estimate No.");
             END;

    OnDelete=VAR
               EstLineTotal@1100528900 : Record 11072077;
               EstPartTotal@1100525000 : Record 11229767;
             BEGIN
               EstRec.UpdateLogbook("Estimate No.");

               CheckFormat(sp1,sp2);
               CurrLevel := Level;
               IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
               IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

               SubEstRec.RESET;
               SubEstRec.SETRANGE("Estimate No.","Estimate No.");
               IF CurrLevel = 0 THEN
                 SubEstRec.SETRANGE(Chapter,"Sub-Estimate No.");
               IF CurrLevel = 1 THEN
                 SubEstRec.SETRANGE(Paragraph,"Sub-Estimate No.");
               IF CurrLevel = 2 THEN
                 SubEstRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");

               IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN
                 REPEAT
                   //db.sn, 18-03-14: C009643
                   EstPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstPartRec.SETFILTER("Excel Estimate Template", '<>%1', '');
                   IF EstPartRec.FINDSET THEN BEGIN
                     REPEAT
                       EstPartRec.DeleteExcelFile(EstPartRec);
                     UNTIL EstPartRec.NEXT = 0;
                   END;
                   EstPartRec.SETRANGE("Excel Estimate Template");
                   //db.en, 18-03-14: C009643

                   EstPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstPartRec.DELETEALL;

                   EstPartTotal.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstPartTotal.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstPartTotal.DELETEALL;   //DP00381

                   EstLineRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstLineRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstLineRec.DELETEALL;

                   EstLineTotal.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstLineTotal.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstLineTotal.DELETEALL;   //DP00381

                   RcpLineRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   RcpLineRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   RcpLineRec.DELETEALL;

                   TextRec.SETRANGE("Table Name",TextRec."Table Name"::Estimate);
                   TextRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   TextRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   TextRec.DELETEALL;

                   EstCodeRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstCodeRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstCodeRec.DELETEALL;

                   ChrgRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ChrgRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ChrgRec.DELETEALL;

                   DeleteQuantityRelation(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No."); //DP00686

                   QuanSheetRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   QuanSheetRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   QuanSheetRec.DELETEALL;

                   QuanModelRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   QuanModelRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   QuanModelRec.DELETEALL;

                   EstFeaturePartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   EstFeaturePartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   EstFeaturePartRec.DELETEALL;

                   ConfigPartRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ConfigPartRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ConfigPartRec.DELETEALL;

                   ConfigRowQuanRec.SETRANGE("Estimate No.",SubEstRec."Estimate No.");
                   ConfigRowQuanRec.SETRANGE("Sub-Estimate No.",SubEstRec."Sub-Estimate No.");
                   ConfigRowQuanRec.DELETEALL;
                 UNTIL SubEstRec.NEXT = 0;
                 SubEstRec.DELETEALL;
               END;
             END;

    OnRename=BEGIN
               //IF Chapter <> xRec.Chapter THEN  //db, 20-02-14: C013250
                 ERROR(Text000);
             END;

    CaptionML=ENU=Sub-Estimate;
    PasteIsValid=No;
    LookupPageID=Page11229767;
    DrillDownPageID=Page11229767;
  }
  FIELDS
  {
    { 10  ;   ;Estimate No.        ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Estimate No. }
    { 20  ;   ;Sub-Estimate No.    ;Code20        ;OnValidate=BEGIN
                                                                FormatMgt.FormatSubEstimate("Sub-Estimate No.",Chapter,Paragraph,Level,"Estimate No.",FALSE);
                                                                IF CurrFieldNo = FIELDNO("Sub-Estimate No.") THEN
                                                                  IF (xRec."Sub-Estimate No." <> '') AND (xRec."Sub-Estimate No." <> "Sub-Estimate No.") THEN
                                                                    ERROR(Text000);  //db, 28-08-14: C017149

                                                                CheckCumFreqParent;  //db, 30-09-10
                                                                CheckPartLevelZeroExist;  //DP00381
                                                              END;

                                                   CaptionML=ENU=Sub-Estimate No. }
    { 30  ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 50  ;   ;Frequency           ;Decimal       ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                ProcessFrequency("Estimate No.", "Sub-Estimate No.", TRUE);
                                                              END;

                                                   CaptionML=ENU=Frequency }
    { 51  ;   ;Cumulative Frequency;Decimal       ;InitValue=1;
                                                   CaptionML=ENU=Cumulative Frequency;
                                                   Editable=No }
    { 60  ;   ;Unit of Measure     ;Code10        ;TableRelation="Unit of Measure".Code;
                                                   CaptionML=ENU=Unit of Measure }
    { 70  ;   ;Hours               ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Hours;
                                                   Editable=No }
    { 80  ;   ;Labor Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Labor Amount;
                                                   Editable=No }
    { 90  ;   ;Material Amount     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Material Amount;
                                                   Editable=No }
    { 91  ;   ;Gross Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Gross Amount;
                                                   Editable=No }
    { 100 ;   ;Subcontracting Amount;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Subcontracting Amount;
                                                   Editable=No }
    { 110 ;   ;Plant Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Plant Amount;
                                                   Editable=No }
    { 120 ;   ;Total Amount        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Total Amount;
                                                   Editable=No }
    { 130 ;   ;Estimate Description;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Estimate.Description WHERE (No.=FIELD(Estimate No.)));
                                                   CaptionML=ENU=Estimate Description;
                                                   Editable=No }
    { 140 ;   ;Level               ;Integer       ;CaptionML=ENU=Level }
    { 160 ;   ;Chapter             ;Code20        ;CaptionML=ENU=Chapter }
    { 165 ;   ;Paragraph           ;Code20        ;CaptionML=ENU=Paragraph }
    { 170 ;   ;Hours Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Hours Chapter;
                                                   Editable=No }
    { 171 ;   ;Hours Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW".Hours WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                    Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Hours Paragraph;
                                                   Editable=No }
    { 180 ;   ;Labor Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Labor Chapter;
                                                   Editable=No }
    { 181 ;   ;Labor Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Labor Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Labor Paragraph;
                                                   Editable=No }
    { 190 ;   ;Material Chapter    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Material Chapter;
                                                   Editable=No }
    { 191 ;   ;Gross Price Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Gross Price Chapter;
                                                   Editable=No }
    { 195 ;   ;Material Paragraph  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                     Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Material Paragraph;
                                                   Editable=No }
    { 196 ;   ;Gross Price Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Material Gross Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Gross Price Paragraph;
                                                   Editable=No }
    { 200 ;   ;Subcontracting Chapter;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Subcontracting Chapter;
                                                   Editable=No }
    { 201 ;   ;Subcontracting Paragraph;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Subcontracting Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Subcontracting Paragraph;
                                                   Editable=No }
    { 210 ;   ;Plant Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Plant Chapter;
                                                   Editable=No }
    { 211 ;   ;Plant Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Plant Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                  Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Plant Paragraph;
                                                   Editable=No }
    { 220 ;No ;Total Chapter       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Total Chapter;
                                                   Description=DP00381: expired;
                                                   Editable=No }
    { 221 ;No ;Total Paragraph     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                            Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Total Paragraph;
                                                   Description=DP00381: expired;
                                                   Editable=No }
    { 290 ;   ;Cum. Hours          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Hours;
                                                   Editable=No }
    { 300 ;   ;Cum. Labor          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Labor;
                                                   Editable=No }
    { 310 ;   ;Cum. Material       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Material;
                                                   Editable=No }
    { 320 ;   ;Cum. Subcontracting ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Subcontracting;
                                                   Editable=No }
    { 330 ;   ;Cum. Plant          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Plant;
                                                   Editable=No }
    { 340 ;   ;Cum. Total          ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Total;
                                                   Editable=No }
    { 350 ;   ;Cum. Hours Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Hours Chapter;
                                                   Editable=No }
    { 351 ;   ;Cum. Hours Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Hours Paragraph;
                                                   Editable=No }
    { 360 ;   ;Cum. Labor Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Labor Chapter;
                                                   Editable=No }
    { 361 ;   ;Cum. Labor Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Labor Paragraph;
                                                   Editable=No }
    { 370 ;   ;Cum. Material Chapter;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Material Chapter;
                                                   Editable=No }
    { 375 ;   ;Cum. Material Paragraph;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                      Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Material Paragraph;
                                                   Editable=No }
    { 380 ;   ;Cum. Subcontracting Chapter;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Subcontracting Chapter;
                                                   Editable=No }
    { 381 ;   ;Cum. Subcontracting Paragraph;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontracting" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Subcontracting Paragraph;
                                                   Editable=No }
    { 390 ;   ;Cum. Plant Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Plant Chapter;
                                                   Editable=No }
    { 391 ;   ;Cum. Plant Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Plant Paragraph;
                                                   Editable=No }
    { 400 ;No ;Cum. Total Chapter  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Total Chapter;
                                                   Description=DP00381: expired;
                                                   Editable=No }
    { 401 ;No ;Cum. Total Paragraph;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Total" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Total Paragraph;
                                                   Description=DP00381: expired;
                                                   Editable=No }
    { 410 ;   ;Norm Group          ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroup;  //DP00686
                                                              END;

                                                   CaptionML=ENU=Norm Group }
    { 420 ;   ;Part Group          ;Code10        ;TableRelation="Estimate Group".No. WHERE (Type=CONST(Part));
                                                   OnValidate=VAR
                                                                lvEstPartRec@1100485000 : Record 11072073;
                                                                lvEstLineRec@1100528900 : Record 11072072;
                                                              BEGIN
                                                                IF "Part Group" <> xRec."Part Group" THEN BEGIN
                                                                  lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
                                                                  lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
                                                                  lvEstPartRec.SETRANGE("Part Group", xRec."Part Group");
                                                                  lvEstPartRec.SETFILTER(Level, '>%1', 0);  //DP00381
                                                                  IF lvEstPartRec.FINDFIRST THEN
                                                                    FIELDERROR("Part Group", Text001);
                                                                  //DP00381.sn
                                                                  lvEstPartRec.SETRANGE(Level, 0);
                                                                  IF lvEstPartRec.FINDSET THEN BEGIN
                                                                    lvEstLineRec.SETRANGE("Estimate No.", lvEstPartRec."Estimate No.");
                                                                    lvEstLineRec.SETRANGE("Sub-Estimate No.", lvEstPartRec."Sub-Estimate No.");
                                                                    lvEstLineRec.SETRANGE("Part Group", lvEstPartRec."Part Group");
                                                                    lvEstLineRec.SETRANGE(Part, lvEstPartRec.Part);
                                                                    lvEstLineRec.DELETEALL(TRUE);  //db, 22-01-15: C020407
                                                                    //IF lvEstLineRec.FINDFIRST THEN
                                                                    //  FIELDERROR("Part Group", Text001);
                                                                    lvEstPartRec.DELETE;
                                                                  END;
                                                                  CheckPartLevelZeroExist;
                                                                  //DP00381.en
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Part Group }
    { 430 ;   ;Element             ;Code20        ;TableRelation="Base Element".Code;
                                                   OnValidate=BEGIN
                                                                FormatMgt.FormatElem(Element,2,'');
                                                                IF Element <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjElemRec.GET("Project No.", Element) THEN
                                                                      ElemRec.GET(Element);
                                                                  END ELSE
                                                                    ElemRec.GET(Element);

                                                                UpdateProjElem(1);
                                                              END;

                                                   OnLookup=BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjElemRec.SETRANGE("Project No.", "Project No.");
                                                                ProjElemRec.Element := Element;
                                                                IF PAGE.RUNMODAL(PAGE::"Project Element List", ProjElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ProjElemRec.Element);
                                                              END ELSE BEGIN
                                                                ElemRec.Code := Element;
                                                                IF PAGE.RUNMODAL(PAGE::Elements, ElemRec) = ACTION::LookupOK THEN
                                                                  VALIDATE(Element, ElemRec.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Element }
    { 440 ;   ;Project No.         ;Code20        ;TableRelation=Job.No.;
                                                   OnValidate=BEGIN
                                                                UpdateProjElem(0);
                                                              END;

                                                   CaptionML=ENU=Project No. }
    { 450 ;   ;Volume              ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW".Volume WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                     Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Volume;
                                                   DecimalPlaces=2:;
                                                   Editable=No }
    { 460 ;   ;Text                ;Text250       ;CaptionML=ENU=Text }
    { 465 ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Comment Line (Group)" WHERE (Table Name=CONST(Estimate),
                                                                                                   Estimate No.=FIELD(Estimate No.),
                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.),
                                                                                                   Part Group=FILTER(''),
                                                                                                   Part=FILTER(''),
                                                                                                   Estimate Line No.=CONST(0)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=No }
    { 466 ;   ;Print on Quote      ;Boolean       ;OnValidate=BEGIN
                                                                //X007
                                                                UpdatePartLevel("Estimate No.", "Sub-Estimate No.");
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Print on Quote }
    { 467 ;   ;Extension           ;Boolean       ;OnValidate=BEGIN
                                                                //X007
                                                                UpdatePartLevel("Estimate No.", "Sub-Estimate No.");
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Extension }
    { 470 ;   ;Adjustment Factor Hours;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 471 ;   ;Adjustment Factor Material;Decimal ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(2,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Material Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 472 ;   ;Adjustment Factor Subcontr.;Decimal;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(3,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Subcontr. Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 473 ;   ;Adjustment Factor Plant;Decimal    ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(4,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Plant Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 474 ;   ;Adjustment Factor Sundry;Decimal   ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(5,1);  //DP00555
                                                              END;

                                                   CaptionML=ENU=Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 475 ;   ;Cum. Adj. Factor Hours;Decimal     ;CaptionML=ENU=Cum. Hours Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 476 ;   ;Cum. Adj. Factor Material;Decimal  ;CaptionML=ENU=Cum. Material Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 477 ;   ;Cum. Adj. Factor Subcontr.;Decimal ;CaptionML=ENU=Cum. Subcontracting Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 478 ;   ;Cum. Adj. Factor Plant;Decimal     ;CaptionML=ENU=Cum. Plant Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 479 ;   ;Cum. Adj. Factor Sundry;Decimal    ;CaptionML=ENU=Cum. Sundry Adjustment Factor;
                                                   DecimalPlaces=0:6 }
    { 480 ;   ;Code                ;Code20        ;OnValidate=VAR
                                                                CodingSystem@1100525000 : Record 11012088;
                                                              BEGIN
                                                                EstRec.GET("Estimate No.");
                                                                EstRec.TESTFIELD("Coding System");

                                                                IF Code <> '' THEN BEGIN
                                                                  CodingSystem.GET(EstRec."Coding System");
                                                                  IF CodingSystem."Deviant Code allowed" = FALSE THEN BEGIN  //db, 26-06-15
                                                                    FormatMgt.SetSelection(EstRec."Coding System");
                                                                    FormatMgt.FormatElem(Code,4,'');
                                                                    CodeRec.GET(EstRec."Coding System", Code);
                                                                  END;
                                                                END;

                                                                MODIFY;
                                                                UpdateMgt.UpdateCode("Estimate No.", "Sub-Estimate No.", '', Code);  //DP00381
                                                              END;

                                                   OnLookup=BEGIN
                                                              EstRec.GET("Estimate No.");
                                                              EstRec.TESTFIELD("Coding System");
                                                              CodeRec.SETRANGE("Coding System", EstRec."Coding System");
                                                              CodeRec.Code := Code;
                                                              IF PAGE.RUNMODAL(PAGE::"Codes per Coding System", CodeRec) = ACTION::LookupOK THEN
                                                                VALIDATE(Code, CodeRec.Code);
                                                            END;

                                                   CaptionML=ENU=Code }
    { 490 ;   ;Target Hours        ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Amount Labor", 0);
                                                              END;

                                                   CaptionML=ENU=Target Hours }
    { 491 ;   ;Target Amount Labor ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Target Hours", 0);
                                                              END;

                                                   CaptionML=ENU=Target Amount Labor }
    { 492 ;   ;Target Amount Material;Decimal     ;CaptionML=ENU=Target Amount Material }
    { 493 ;   ;Target Amount Subcontracting;Decimal;
                                                   CaptionML=ENU=Target Amount Subcontracting }
    { 494 ;   ;Target Amount Plant ;Decimal       ;CaptionML=ENU=Target Amount Plant }
    { 495 ;   ;Target Amount Sundry;Decimal       ;CaptionML=ENU=Target Amount Sundry }
    { 500 ;   ;Model               ;Code20        ;TableRelation="House Model".Model WHERE (Project No.=FILTER(''));
                                                   CaptionML=ENU=Model;
                                                   Editable=No }
    { 505 ;   ;Source Estimate     ;Code20        ;TableRelation=Estimate.No.;
                                                   CaptionML=ENU=Source Estimate;
                                                   Editable=No }
    { 510 ;   ;Condition           ;Code10        ;TableRelation=Condition.Code;
                                                   CaptionML=ENU=Condition }
    { 520 ;   ;Transfer to Service ;Option        ;OnValidate=VAR
                                                                ServiceSetup@1100528600 : Record 11012800;
                                                              BEGIN
                                                                UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Transfer to Service;
                                                   OptionCaptionML=ENU=" ,,,Service Order,Modification";
                                                   OptionString=[ ,,,ServOrder,Modification];
                                                   Description=option ServLoc+Installation cancelled }
    { 525 ;   ;Service Location No.;Code20        ;TableRelation="Service Location".No.;
                                                   OnValidate=VAR
                                                                ServiceLocation@1100525000 : Record 11012801;
                                                              BEGIN
                                                                IF CurrFieldNo <> 0 THEN
                                                                  UpdateLowerLevel;
                                                                //**4PS.sn
                                                                IF "Language Code" = '' THEN BEGIN
                                                                  ServiceLocation.GET("Service Location No.");
                                                                  "Language Code" := ServiceLocation."Language Code";
                                                                END;
                                                                //**4PS.en
                                                              END;

                                                   CaptionML=ENU=Service Location No. }
    { 527 ;   ;Object Modification No.;Code10     ;TableRelation="Object Modification";
                                                   OnValidate=BEGIN
                                                                IF "Object Modification No." <> '' THEN
                                                                  TESTFIELD("Transfer to Service", "Transfer to Service"::Modification);
                                                                IF CurrFieldNo <> 0 THEN
                                                                  UpdateLowerLevel;
                                                              END;

                                                   CaptionML=ENU=Object Modification No. }
    { 530 ;   ;Service Order No.   ;Code20        ;TableRelation="Service Order".No. WHERE (No.=FIELD(Service Order No.));
                                                   OnValidate=BEGIN
                                                                IF "Service Order No." <> '' THEN
                                                                  TESTFIELD("Transfer to Service", "Transfer to Service"::ServOrder);

                                                                IF CurrFieldNo <> 0 THEN
                                                                  UpdateLowerLevel;

                                                                CheckServiceOrder;  //db, 05-11-13: DP00260 (26541)
                                                              END;

                                                   OnLookup=VAR
                                                              ServiceSetup@1100528601 : Record 11012800;
                                                              ServiceOrder@1100528600 : Record 11012823;
                                                            BEGIN
                                                              ServiceSetup.GET;
                                                              IF "Service Order No." <> '' THEN
                                                                IF ServiceOrder.GET("Service Order No.") THEN;
                                                              IF PAGE.RUNMODAL(0, ServiceOrder) = ACTION::LookupOK THEN
                                                                VALIDATE("Service Order No.", ServiceOrder."No.");
                                                            END;

                                                   CaptionML=ENU=Service Order No. }
    { 540 ;   ;Vendor              ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=ENU=Vendor }
    { 541 ;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor)));
                                                   CaptionML=ENU=Vendor Name;
                                                   Editable=No }
    { 550 ;   ;Subcontractor       ;Code20        ;TableRelation=Vendor.No. WHERE (Subcontractor=CONST(Yes));
                                                   CaptionML=ENU=Subcontractor }
    { 551 ;   ;Subcontractor Name  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Subcontractor)));
                                                   CaptionML=ENU=Subcontractor Name;
                                                   Editable=No }
    { 560 ;   ;Quantity Model Exist;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Model Line Quantity" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Quantity Model Exist;
                                                   Editable=No }
    { 590 ;   ;Estimator           ;Code20        ;TableRelation=Employee.No.;
                                                   CaptionML=ENU=Estimator }
    { 591 ;   ;Name Estimator      ;Text100       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Employee."Full Name" WHERE (No.=FIELD(Estimator)));
                                                   CaptionML=ENU=Name Estimator;
                                                   Editable=No }
    { 600 ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   CaptionML=ENU=Language Code }
    { 610 ;   ;Summary (Sales)     ;Code10        ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Summary Type=CONST(Sales));
                                                   CaptionML=ENU=Summary (Sales) }
    { 611 ;   ;Summary (Cost)      ;Code10        ;TableRelation="Summary Sheet".Summary WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Summary Type=CONST(Cost));
                                                   CaptionML=ENU=Summary (Cost) }
    { 650 ;   ;Project Planning Activity Code;Code10;
                                                   TableRelation="Project Planning Base Activity";
                                                   OnValidate=VAR
                                                                ProjectPlanningActivity@1100528402 : Record 11012431;
                                                                ProjectPlanningBaseActivity@1100528401 : Record 11012434;
                                                                FormatManagement@1100528400 : Codeunit 11012022;
                                                              BEGIN
                                                                FormatManagement.FormatElem("Project Planning Activity Code", 20, '');
                                                                IF "Project Planning Activity Code" <> '' THEN
                                                                  IF "Project No." <> '' THEN BEGIN
                                                                    IF NOT ProjectPlanningActivity.GET("Project No." + "Project Planning Activity Code") THEN
                                                                      ProjectPlanningBaseActivity.GET("Project Planning Activity Code");
                                                                  END ELSE
                                                                    ProjectPlanningBaseActivity.GET("Project Planning Activity Code");

                                                                UpdateProjPlanActCode;
                                                              END;

                                                   OnLookup=VAR
                                                              ProjectPlanningActivity@1100528401 : Record 11012431;
                                                              ProjectPlanningBaseActivity@1100528400 : Record 11012434;
                                                            BEGIN
                                                              IF "Project No." <> '' THEN BEGIN
                                                                ProjectPlanningActivity.SETRANGE("Project No.", "Project No.");
                                                                ProjectPlanningActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Project Planning Activity List", ProjectPlanningActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningActivity.Code);
                                                              END ELSE BEGIN
                                                                ProjectPlanningBaseActivity.Code := "Project Planning Activity Code";
                                                                IF PAGE.RUNMODAL(PAGE::"Proj. Planning Base Activities", ProjectPlanningBaseActivity) = ACTION::LookupOK THEN
                                                                  VALIDATE("Project Planning Activity Code", ProjectPlanningBaseActivity.Code);
                                                              END;
                                                            END;

                                                   ValidateTableRelation=No;
                                                   CaptionML=ENU=Project Planning Activity Code }
    { 660 ;   ;Extension Contract  ;Code10        ;TableRelation="Extension Contract"."Contract No." WHERE (Project No.=FIELD(Project No.));
                                                   OnValidate=BEGIN
                                                                UpdateExtensionContract;  //DP00260
                                                              END;

                                                   CaptionML=ENU=Extension Contract }
    { 700 ;   ;Parts Exist         ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Estimate Part NEW" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   OnLookup=VAR
                                                              EstimateManagementRTC@1100525000 : Codeunit 11130010;
                                                            BEGIN
                                                            END;

                                                   CaptionML=ENU=Parts;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 2000;   ;Sundry Amount       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Sundry Amount;
                                                   Editable=No }
    { 2001;   ;Sundry Chapter      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Sundry Chapter;
                                                   Editable=No }
    { 2002;   ;Sundry Paragraph    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line NEW"."Sundry Cost Amount" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                   Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Sundry Paragraph;
                                                   Editable=No }
    { 2005;   ;Cum. Sundry         ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Sundry;
                                                   Editable=No }
    { 2006;   ;Cum. Sundry Chapter ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Sundry Chapter;
                                                   Editable=No }
    { 2007;   ;Cum. Sundry Paragraph;Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                    Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Sundry Paragraph;
                                                   Editable=No }
    { 2010;   ;Surcharge % Labor   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(0);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Labor;
                                                   BlankZero=Yes }
    { 2011;   ;Surcharge % Material;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(1);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Material;
                                                   BlankZero=Yes }
    { 2012;   ;Surcharge % Subcontracting;Decimal ;OnValidate=BEGIN
                                                                UpdateSurcharge(2);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Subcontracting;
                                                   BlankZero=Yes }
    { 2013;   ;Surcharge % Plant   ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(3);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Plant;
                                                   BlankZero=Yes }
    { 2014;   ;Surcharge % Sundry  ;Decimal       ;OnValidate=BEGIN
                                                                UpdateSurcharge(4);
                                                              END;

                                                   CaptionML=ENU=Surcharge % Sundry;
                                                   BlankZero=Yes }
    { 2020;   ;Cum. Hours (Sales)  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Hours (Sales);
                                                   Editable=No }
    { 2021;   ;Cum. Labor (Sales)  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Labor (Sales);
                                                   Editable=No }
    { 2022;   ;Cum. Material (Sales);Decimal      ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                              Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Material (Sales);
                                                   Editable=No }
    { 2023;   ;Cum. Subcontracting (Sales);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontr. (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                               Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Subcontracting (Sales);
                                                   Editable=No }
    { 2024;   ;Cum. Plant (Sales)  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Plant (Sales);
                                                   Editable=No }
    { 2025;   ;Cum. Sundry (Sales) ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Sundry (Sales);
                                                   Editable=No }
    { 2030;   ;Cum. Total (Sales)  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Total (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Sub-Estimate No.=FIELD(Sub-Estimate No.)));
                                                   CaptionML=ENU=Cum. Total;
                                                   Editable=No }
    { 2040;   ;Cum. Hours Chapter (Sales);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Hours Chapter (Sales);
                                                   Editable=No }
    { 2041;   ;Cum. Hours Paragraph (Sales);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Hours (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Hours Paragraph (Sales);
                                                   Editable=No }
    { 2050;   ;Cum. Labor Chapter (Sales);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Labor Chapter (Sales);
                                                   Editable=No }
    { 2051;   ;Cum. Labor Paragraph (Sales);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Labor (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Labor Paragraph (Sales);
                                                   Editable=No }
    { 2060;   ;Cum. Mat. Chapter (Sales);Decimal  ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                              Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Material Chapter (Sales);
                                                   Editable=No }
    { 2061;   ;Cum. Mat. Paragraph (Sales);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Material (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                              Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Material Paragraph (Sales);
                                                   Editable=No }
    { 2070;   ;Cum. Subc. Chapter (Sales);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontr. (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                               Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Subcontracting (Sales);
                                                   Editable=No }
    { 2071;   ;Cum. Subc. Paragraph (Sales);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Subcontr. (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                               Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Subcontracting Paragraph (Sales);
                                                   Editable=No }
    { 2080;   ;Cum. Plant Chapter (Sales);Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Plant Chapter (Sales);
                                                   Editable=No }
    { 2081;   ;Cum. Plant Paragraph (Sales);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Plant (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                           Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Plant Paragraph (Sales);
                                                   Editable=No }
    { 2090;   ;Cum. Sundry Chapter (Sales);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Chapter (Sub-Estimate)=FIELD(Chapter)));
                                                   CaptionML=ENU=Cum. Sundry Chapter (Sales);
                                                   Editable=No }
    { 2091;   ;Cum. Sundry Paragraph (Sales);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Estimate Line Total"."Cumulative Sundry (Sales)" WHERE (Estimate No.=FIELD(Estimate No.),
                                                                                                                            Paragraph (Sub-Estimate)=FIELD(Paragraph)));
                                                   CaptionML=ENU=Cum. Sundry Paragraph (Sales);
                                                   Editable=No }
    { 2100;   ;Norm Group (Sales)  ;Code10        ;TableRelation="Norm Group".Code;
                                                   OnValidate=BEGIN
                                                                UpdateNormGroupSales;  //DP00686
                                                              END;

                                                   CaptionML=ENU=Norm Group (Sales) }
    { 2110;   ;Adj. Factor Hours (Sales);Decimal  ;OnValidate=BEGIN
                                                                ProcessAdjustmentFactor(1,2);   //DP00555
                                                              END;

                                                   CaptionML=ENU=Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6;
                                                   MinValue=0 }
    { 2120;   ;Cum. Adj. Factor Hours (Sales);Decimal;
                                                   CaptionML=ENU=Cum. Hours Adjustment Factor (Sales);
                                                   DecimalPlaces=0:6 }
  }
  KEYS
  {
    {    ;Estimate No.,Sub-Estimate No.           ;Clustered=Yes }
    {    ;Project No.,Element                      }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      EstRec@1210190002 : Record 11012151;
      SubEstRec@1210190003 : Record 11072074;
      EstPartRec@11012000 : Record 11072073;
      EstLineRec@11012001 : Record 11072072;
      RcpLineRec@11012002 : Record 11072075;
      EstCodeRec@1210190009 : Record 11229772;
      CodeRec@1210190010 : Record 11012089;
      ChrgRec@11012003 : Record 11229771;
      TextRec@1210190012 : Record 11020595;
      QuanSheetRec@1210190007 : Record 11012186;
      QuanModelRec@1210190011 : Record 11012197;
      ConfigPartRec@11012007 : Record 11012176;
      ConfigRowQuanRec@1210190000 : Record 11012192;
      EstFeaturePartRec@11012008 : Record 11012178;
      Text000@1210190001 : TextConst 'ENU="Rename disabled; use copy function and delete original line afterwards."';
      ElemRec@1210190004 : Record 11012060;
      ProjElemRec@1210190005 : Record 11012010;
      FormatMgt@1210190006 : Codeunit 11012022;
      UpdateMgt@1210190008 : Codeunit 11012229;
      Text001@1100485000 : TextConst 'ENU=may not be modfied, there are already estimate parts present';
      sp1@1100485003 : Integer;
      sp2@1100485002 : Integer;
      CurrLevel@1100485001 : Integer;
      Text002@1100525000 : TextConst 'ENU=%1 (%2) from Service Order %4 does not match with %1 (%3) from Estimate.';
      Text003@1100528600 : TextConst 'ENU=Estimate Lines present for other Object Modifications';

    PROCEDURE InitAdjustmentFactor@1210190003();
    BEGIN
      IF "Adjustment Factor Hours" = 0 THEN
        "Adjustment Factor Hours" := 1;
      IF "Adjustment Factor Material" = 0 THEN
        "Adjustment Factor Material" := 1;
      IF "Adjustment Factor Subcontr." = 0 THEN
        "Adjustment Factor Subcontr." := 1;
      IF "Adjustment Factor Plant" = 0 THEN
        "Adjustment Factor Plant" := 1;
      IF "Adjustment Factor Sundry" = 0 THEN  //DP00381
        "Adjustment Factor Sundry" := 1;

      IF "Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
        "Adj. Factor Hours (Sales)" := 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF Level = 0 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF Level = 1 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", Chapter);
      IF Level = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", Paragraph);
      IF NOT SubEstRec.FINDFIRST THEN SubEstRec.INIT;

      IF SubEstRec."Cum. Adj. Factor Hours" = 0 THEN
        "Cum. Adj. Factor Hours" := "Adjustment Factor Hours"
      ELSE
        "Cum. Adj. Factor Hours" := "Adjustment Factor Hours" * SubEstRec."Cum. Adj. Factor Hours";
      IF SubEstRec."Cum. Adj. Factor Material" = 0 THEN
        "Cum. Adj. Factor Material" := "Adjustment Factor Material"
      ELSE
        "Cum. Adj. Factor Material" := "Adjustment Factor Material" * SubEstRec."Cum. Adj. Factor Material";
      IF SubEstRec."Cum. Adj. Factor Subcontr." = 0 THEN
        "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr."
      ELSE
        "Cum. Adj. Factor Subcontr." := "Adjustment Factor Subcontr." * SubEstRec."Cum. Adj. Factor Subcontr.";
      IF SubEstRec."Cum. Adj. Factor Plant" = 0 THEN
        "Cum. Adj. Factor Plant" := "Adjustment Factor Plant"
      ELSE
        "Cum. Adj. Factor Plant" := "Adjustment Factor Plant" * SubEstRec."Cum. Adj. Factor Plant";
      IF SubEstRec."Cum. Adj. Factor Sundry" = 0 THEN  //DP00381
        "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry"
      ELSE
        "Cum. Adj. Factor Sundry" := "Adjustment Factor Sundry" * SubEstRec."Cum. Adj. Factor Sundry";

      IF SubEstRec."Cum. Adj. Factor Hours (Sales)" = 0 THEN  //DP00555
        "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)"
      ELSE
        "Cum. Adj. Factor Hours (Sales)" := "Adj. Factor Hours (Sales)" * SubEstRec."Cum. Adj. Factor Hours (Sales)";
    END;

    PROCEDURE ProcessAdjustmentFactor@1210190000(IAdjType@1210190000 : Integer;IEstType@1100525000 : Integer);
    BEGIN
      IF (IEstType = 0) OR (IEstType = 2) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adj. Factor Hours (Sales)" = 0 THEN
              "Adj. Factor Hours (Sales)" := 1;
        END;
      END;
      IF (IEstType = 0) OR (IEstType = 1) THEN BEGIN  //DP00555 (0=both, 1=cost, 2=sales)
        CASE IAdjType OF
          1:
            IF "Adjustment Factor Hours" = 0 THEN
              "Adjustment Factor Hours" := 1;
          2:
            IF "Adjustment Factor Material" = 0 THEN
              "Adjustment Factor Material" := 1;
          3:
            IF "Adjustment Factor Subcontr." = 0 THEN
              "Adjustment Factor Subcontr." := 1;
          4:
            IF "Adjustment Factor Plant" = 0 THEN
              "Adjustment Factor Plant" := 1;
          5:  //DP00381
            IF "Adjustment Factor Sundry" = 0 THEN
              "Adjustment Factor Sundry" := 1;
        END;
      END;
      MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter,"Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph,"Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.","Sub-Estimate No.");
      IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN
        REPEAT
          UpdateMgt.ResetAdjustmentFactor(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.",
            '', '', 0, TRUE, 1, IAdjType, IEstType);  //DP00555
        UNTIL SubEstRec.NEXT = 0;
      END;

      GET("Estimate No.", "Sub-Estimate No.");
    END;

    PROCEDURE ProcessFrequency@1100485000(lvEst@1100485002 : Code[20];lvSubEst@1100485001 : Code[20];CalcLines@1100485000 : Boolean);
    VAR
      lvSubEstRec@1100485003 : Record 11072074;
      lvQuan@1100485005 : Decimal;
    BEGIN
      IF CalcLines THEN //call 30195
        MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", lvEst);
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter, "Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph, "Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF SubEstRec.FINDSET(FALSE, FALSE) THEN BEGIN  //call 30195 FALSE FALSE
        REPEAT
          lvQuan := SubEstRec.Frequency;
          CurrLevel := SubEstRec.Level;

          lvSubEstRec.RESET;
          lvSubEstRec.SETRANGE("Estimate No.", SubEstRec."Estimate No.");
          IF CurrLevel = 2 THEN BEGIN
            CurrLevel := CurrLevel - 1;
            lvSubEstRec.SETRANGE("Sub-Estimate No.", SubEstRec.Paragraph);
            IF lvSubEstRec.FINDFIRST THEN
              lvQuan := lvQuan * lvSubEstRec.Frequency;
          END;
          IF CurrLevel = 1 THEN BEGIN
            CurrLevel := CurrLevel - 1;
            lvSubEstRec.SETRANGE("Sub-Estimate No.", SubEstRec.Chapter);
            IF lvSubEstRec.FINDFIRST THEN
              lvQuan := lvQuan * lvSubEstRec.Frequency;
          END;

          IF SubEstRec.Level = Level THEN BEGIN
            IF "Cumulative Frequency" <> lvQuan THEN BEGIN //call 30195
              "Cumulative Frequency" := lvQuan;
              MODIFY;
            END; //call 30195
          END ELSE BEGIN
            IF SubEstRec."Cumulative Frequency" <> lvQuan THEN BEGIN //call 30195
              SubEstRec."Cumulative Frequency" := lvQuan;
              SubEstRec.MODIFY;
            END; //call 30195
          END;

          UpdatePartTotals(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.");  //DP00381
          CalculateEstLines(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.", CalcLines);
        UNTIL SubEstRec.NEXT = 0;
      END;
    END;

    PROCEDURE CalculateEstLines@1(lvEst@1100485000 : Code[20];lvSubEst@1100485001 : Code[20];CalcLines@1100485002 : Boolean);
    VAR
      EstimateLineOriginal@1210190000 : Record 11072072;
    BEGIN
      IF CalcLines = FALSE THEN EXIT;

      EstLineRec.SETRANGE("Estimate No.", lvEst);
      EstLineRec.SETRANGE("Sub-Estimate No.", lvSubEst);
      IF EstLineRec.FINDSET(FALSE, FALSE) THEN BEGIN  //call 30195 FALSE FALSE
        REPEAT
          EstimateLineOriginal := EstLineRec; //call 30195
          EstLineRec.VALIDATE(Quantity);  //incl. CalculateTotal + UpdateRecipeTotal
          IF FORMAT(EstimateLineOriginal) <> FORMAT(EstLineRec) THEN //call 30195
            EstLineRec.MODIFY;
          CheckRecipeTotal;
        UNTIL EstLineRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckRecipeTotal@1210190001();
    BEGIN
      IF EstLineRec.Recipe = '' THEN EXIT;

      RcpLineRec.SETRANGE("Estimate No.", EstLineRec."Estimate No.");
      RcpLineRec.SETRANGE("Sub-Estimate No.", EstLineRec."Sub-Estimate No.");
      RcpLineRec.SETRANGE(Part, EstLineRec.Part);
      RcpLineRec.SETRANGE("Part Group", EstLineRec."Part Group");
      RcpLineRec.SETRANGE("Estimate Line", EstLineRec."Line No.");
      IF RcpLineRec.FINDFIRST THEN
        RcpLineRec.UpdateEstLines;
    END;

    PROCEDURE UpdateProjElem@1100485001(lvAction@1100485000 : Integer);
    VAR
      lvEstPartRec@1100485001 : Record 11072073;
    BEGIN
      IF "Project No." = '' THEN
        "Extension Contract" := '';  //DP00260

      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF lvAction = 0 THEN
        lvEstPartRec.SETFILTER("Project No.", '%1|%2', '', xRec."Project No.")
      ELSE
        lvEstPartRec.SETFILTER(Element, '%1|%2', '', xRec.Element);
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvAction = 0 THEN
            lvEstPartRec.VALIDATE("Project No.", "Project No.")
          ELSE
            lvEstPartRec.VALIDATE(Element, Element);
          IF "Project No."= '' THEN
            lvEstPartRec."Extension Contract" := '';  //DP00260
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckFormat@16(VAR sp1@1100485002 : Integer;VAR sp2@1100485004 : Integer);
    VAR
      EstSetupRec@11012000 : Record 11012150;
      x@1100485000 : Integer;
      lp@1100485001 : Integer;
      lvText000@1100485003 : TextConst 'ENU=only 3 levels allowed';
    BEGIN
      x := 0;
      sp1 := 0;
      sp2 := 0;

      EstSetupRec.GET();
      EstSetupRec.TESTFIELD("Sub-Estimate Format");
      lp := STRLEN(EstSetupRec."Sub-Estimate Format");

      REPEAT
        x := x + 1;
        IF COPYSTR(EstSetupRec."Sub-Estimate Format",x,1) = '.' THEN BEGIN
          IF sp1 = 0 THEN
            sp1 := x
          ELSE
            IF sp2 = 0 THEN
              sp2 :=x
            ELSE
              ERROR(lvText000);
        END;
      UNTIL x = lp;
    END;

    PROCEDURE UpdateLowerLevel@1100485002();
    VAR
      lvEstLineRec@1100525004 : Record 11072072;
      lvText000@1100525001 : TextConst 'ENU=Installation Lines present';
      lvServBudgetRec@1100525002 : Record 11012875;
      lvText001@1100525003 : TextConst 'ENU=Service Order Budget Lines present';
      lvText002@1100525005 : TextConst 'ENU=Estimate Lines present for other Service Orders';
    BEGIN
      IF CurrFieldNo = FIELDNO("Service Order No.") THEN BEGIN
        lvServBudgetRec.SETRANGE("Budget Type", lvServBudgetRec."Budget Type"::Order);
        lvServBudgetRec.SETRANGE("Service Order No.", "Service Order No.");
        IF lvServBudgetRec.FINDFIRST THEN MESSAGE(lvText001);  //db, 13-11-09: M16953 (check moved to codeunit 11012152)

        lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
        lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        lvEstLineRec.SETFILTER("Service Order No.", '<>%1&<>%2', '', "Service Order No.");
        IF lvEstLineRec.FINDFIRST THEN ERROR(lvText002);
      END;

      IF CurrFieldNo = FIELDNO("Object Modification No.") THEN BEGIN
        lvServBudgetRec.SETRANGE("Budget Type", lvServBudgetRec."Budget Type"::Order);
        lvServBudgetRec.SETRANGE("Service Order No.", "Service Order No.");
        IF lvServBudgetRec.FINDFIRST THEN MESSAGE(lvText001);  //db, 13-11-09: M16953 (check moved to codeunit 11012152)

        lvEstLineRec.SETRANGE("Estimate No.", "Estimate No.");
        lvEstLineRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        lvEstLineRec.SETFILTER("Object Modification No.", '<>%1&<>%2', '', "Object Modification No.");
        IF lvEstLineRec.FINDFIRST THEN ERROR(Text003);
      END;

      MODIFY;

      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      SubEstRec.RESET;
      SubEstRec.SETRANGE("Estimate No.", "Estimate No.");
      IF CurrLevel = 0 THEN
        SubEstRec.SETRANGE(Chapter, "Sub-Estimate No.");
      IF CurrLevel = 1 THEN
        SubEstRec.SETRANGE(Paragraph, "Sub-Estimate No.");
      IF CurrLevel = 2 THEN
        SubEstRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF SubEstRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CurrFieldNo = FIELDNO("Transfer to Service") THEN
            SubEstRec."Transfer to Service" := "Transfer to Service";
          IF CurrFieldNo = FIELDNO("Service Location No.") THEN
            SubEstRec."Service Location No." := "Service Location No.";
          IF CurrFieldNo = FIELDNO("Service Order No.") THEN
            SubEstRec."Service Order No." := "Service Order No.";
          IF CurrFieldNo = FIELDNO("Object Modification No.") THEN
            SubEstRec."Object Modification No." := "Object Modification No.";
          IF CurrFieldNo = FIELDNO("Print on Quote") THEN BEGIN  //X007
            SubEstRec."Print on Quote" := "Print on Quote";
            UpdatePartLevel(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.");
          END;
          IF CurrFieldNo = FIELDNO(Extension) THEN BEGIN  //X007
            SubEstRec.Extension := Extension;
            UpdatePartLevel(SubEstRec."Estimate No.", SubEstRec."Sub-Estimate No.");
          END;

          SubEstRec.MODIFY;
        UNTIL SubEstRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckCumFreqParent@1100525000();
    BEGIN
      //db, 30-09-10: get cumulative for initial value frequency
      IF Level = 0 THEN
        "Cumulative Frequency" := Frequency;
      IF Level = 1 THEN
        IF SubEstRec.GET("Estimate No.", Chapter) THEN
          "Cumulative Frequency" := SubEstRec."Cumulative Frequency" * Frequency;
      IF Level = 2 THEN
        IF SubEstRec.GET("Estimate No.", Paragraph) THEN
          "Cumulative Frequency" := SubEstRec."Cumulative Frequency" * Frequency;
    END;

    PROCEDURE UpdatePartLevel@1210190002(iEst@1210190000 : Code[20];iSubEst@1210190001 : Code[20]);
    VAR
      EstPartRec@1210190002 : Record 11072073;
    BEGIN
      //X007
      EstPartRec.SETRANGE("Estimate No.", iEst);
      EstPartRec.SETRANGE("Sub-Estimate No.", iSubEst);
      IF EstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CurrFieldNo = FIELDNO("Print on Quote") THEN
            EstPartRec.VALIDATE("Print on Quote", "Print on Quote");
          IF CurrFieldNo = FIELDNO(Extension) THEN
            EstPartRec.VALIDATE(Extension, Extension);
          EstPartRec.MODIFY;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateProjPlanActCode@1210190022();
    VAR
      lvEstPartRec@1210190000 : Record 11072073;
    BEGIN
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstPartRec.SETFILTER("Project Planning Activity Code", '%1|%2', '', xRec."Project Planning Activity Code");
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstPartRec.VALIDATE("Project Planning Activity Code", "Project Planning Activity Code");
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateExtensionContract@1100525003();
    VAR
      lvEstPartRec@1210190000 : Record 11072073;
    BEGIN
      //db, 12-11-13: DP00260 (13440)
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstPartRec.SETFILTER("Extension Contract", '%1|%2', '', xRec."Extension Contract");
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF lvEstPartRec."Project No." <> '' THEN
            lvEstPartRec.VALIDATE("Extension Contract", "Extension Contract");
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE InitRecord@1210190004();
    BEGIN
      // 34595.n
      IF EstRec.GET("Estimate No.") THEN BEGIN
        "Project No." := EstRec."Project No.";
        Element := EstRec.Element;
        IF "Project No." <> '' THEN
          "Extension Contract" := EstRec."Extension Contract";  //DP00260
        "Project Planning Activity Code" := EstRec."Project Planning Activity Code";
      END;
      InitSurcharge;  //DP00381
    END;

    PROCEDURE GetDataCaption@1100528000() : Text[250];
    BEGIN
      EXIT(STRSUBSTNO('%1 - %2 - %3', "Estimate No.", "Sub-Estimate No.", Description));
    END;

    PROCEDURE UpdateSurcharge@1100528900(CostType@1100485000 : Integer);
    VAR
      EstPartRec@1100485001 : Record 11072073;
    BEGIN
      //DP00381
      EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF CostType = 0 THEN
        EstPartRec.SETFILTER("Surcharge % Labor", '%1|%2', 0, xRec."Surcharge % Labor");
      IF CostType = 1 THEN
        EstPartRec.SETFILTER("Surcharge % Material", '%1|%2', 0, xRec."Surcharge % Material");
      IF CostType = 2 THEN
        EstPartRec.SETFILTER("Surcharge % Subcontracting", '%1|%2', 0, xRec."Surcharge % Subcontracting");
      IF CostType = 3 THEN
        EstPartRec.SETFILTER("Surcharge % Plant", '%1|%2', 0, xRec."Surcharge % Plant");
      IF CostType = 4 THEN
        EstPartRec.SETFILTER("Surcharge % Sundry", '%1|%2', 0, xRec."Surcharge % Sundry");
      IF EstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          IF CostType = 0 THEN
            EstPartRec.VALIDATE("Surcharge % Labor", "Surcharge % Labor");
          IF CostType = 1 THEN
            EstPartRec.VALIDATE("Surcharge % Material", "Surcharge % Material");
          IF CostType = 2 THEN
            EstPartRec.VALIDATE("Surcharge % Subcontracting", "Surcharge % Subcontracting");
          IF CostType = 3 THEN
            EstPartRec.VALIDATE("Surcharge % Plant", "Surcharge % Plant");
          IF CostType = 4 THEN
            EstPartRec.VALIDATE("Surcharge % Sundry", "Surcharge % Sundry");
          EstPartRec.MODIFY;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE SetOptionToCreatePartLevelZero@1100525004();
    BEGIN
      //db, 30-06-14: T005094
      CurrFieldNo := FIELDNO("Sub-Estimate No.");
    END;

    PROCEDURE CheckPartLevelZeroExist@1100528901();
    VAR
      EstPartRec@1100528900 : Record 11072073;
      BasePartRec@1100528901 : Record 11012169;
    BEGIN
      //DP00381
      IF (CurrFieldNo = FIELDNO("Sub-Estimate No.")) THEN BEGIN
        EstPartRec.SETRANGE("Estimate No.", "Estimate No.");
        EstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
        EstPartRec.SETFILTER(Level, '<>%1', 0);  //db, 22-01-15: C020407
        IF EstPartRec.FINDFIRST THEN EXIT;

        EstRec.GET("Estimate No.");  //get defaults from Estimate
        "Part Group" := EstRec."Part Group";

        BasePartRec.SETRANGE("Part Group", "Part Group");
        BasePartRec.SETRANGE(Level, 0);
        IF NOT BasePartRec.FINDFIRST THEN EXIT;

        EstPartRec."Estimate No." := "Estimate No.";
        EstPartRec."Sub-Estimate No." := "Sub-Estimate No.";
        EstPartRec."Part Group":= BasePartRec."Part Group";
        EstPartRec.VALIDATE(Part, BasePartRec.Code);
        //copy from function InitSurcharge
        EstPartRec."Surcharge % Labor" :=  EstRec."Surcharge % Labor";
        EstPartRec."Surcharge % Material" :=  EstRec."Surcharge % Material";
        EstPartRec."Surcharge % Subcontracting" :=  EstRec."Surcharge % Subcontracting";
        EstPartRec."Surcharge % Plant" :=  EstRec."Surcharge % Plant";
        EstPartRec."Surcharge % Sundry" :=  EstRec."Surcharge % Sundry";
        //copy from function InitRecord
        IF EstPartRec."Project No." = '' THEN
          EstPartRec."Project No." := EstRec."Project No.";
        IF EstPartRec.Element = '' THEN
          EstPartRec.Element := EstRec.Element;
        IF EstPartRec."Extension Contract" = '' THEN
          IF EstPartRec."Project No." <> '' THEN
            EstPartRec."Extension Contract" := EstRec."Extension Contract";
        IF EstPartRec."Project Planning Activity Code" = '' THEN
          EstPartRec."Project Planning Activity Code" := EstRec."Project Planning Activity Code";
        EstPartRec.InitAdjustmentFactor;
        EstPartRec.INSERT;
        EstPartRec.UpdatePartTotal;
      END;

      IF (CurrFieldNo = FIELDNO("Part Group")) THEN BEGIN
        BasePartRec.SETRANGE("Part Group", "Part Group");
        BasePartRec.SETRANGE(Level, 0);
        IF NOT BasePartRec.FINDFIRST THEN EXIT;

        //get defaults from Sub-Estimate
        EstPartRec."Estimate No." := "Estimate No.";
        EstPartRec."Sub-Estimate No." := "Sub-Estimate No.";
        EstPartRec."Part Group":= BasePartRec."Part Group";
        EstPartRec.VALIDATE(Part, BasePartRec.Code);
        //copy from function InitSurcharge
        EstPartRec."Surcharge % Labor" := "Surcharge % Labor";
        EstPartRec."Surcharge % Material" := "Surcharge % Material";
        EstPartRec."Surcharge % Subcontracting" := "Surcharge % Subcontracting";
        EstPartRec."Surcharge % Plant" := "Surcharge % Plant";
        EstPartRec."Surcharge % Sundry" := "Surcharge % Sundry";
        //copy from function InitRecord
        IF EstPartRec."Project No." = '' THEN
          EstPartRec."Project No." := "Project No.";
        IF EstPartRec.Element = '' THEN
          EstPartRec.Element := Element;
        IF EstPartRec."Extension Contract" = '' THEN
          IF EstPartRec."Project No." <> '' THEN
            EstPartRec."Extension Contract" := "Extension Contract";
        IF EstPartRec."Project Planning Activity Code" = '' THEN
          EstPartRec."Project Planning Activity Code" := "Project Planning Activity Code";
        EstPartRec.InitAdjustmentFactor;
        EstPartRec.INSERT;
        EstPartRec.UpdatePartTotal;
      END;
    END;

    PROCEDURE InitSurcharge@1100528911();
    BEGIN
      //DP00381
      IF EstRec.GET("Estimate No.") THEN BEGIN
        "Surcharge % Labor" := EstRec."Surcharge % Labor";
        "Surcharge % Material" := EstRec."Surcharge % Material";
        "Surcharge % Subcontracting" := EstRec."Surcharge % Subcontracting";
        "Surcharge % Plant" := EstRec."Surcharge % Plant";
        "Surcharge % Sundry" := EstRec."Surcharge % Sundry";
      END;
    END;

    PROCEDURE GetTotals@1100528902(VAR HoursDec@1100528901 : Decimal;VAR LaborDec@1100528902 : Decimal;VAR MatDec@1100528903 : Decimal;VAR SubcDec@1100528904 : Decimal;VAR PlantDec@1100528905 : Decimal;VAR SundryDec@1100528906 : Decimal;VAR TotalDec@1100528913 : Decimal;VAR CumHoursDec@1100528912 : Decimal;VAR CumLaborDec@1100528911 : Decimal;VAR CumMatDec@1100528910 : Decimal;VAR CumSubcDec@1100528909 : Decimal;VAR CumPlantDec@1100528908 : Decimal;VAR CumSundryDec@1100528907 : Decimal;VAR CumTotalDec@1100528914 : Decimal);
    VAR
      CurrLevel@1100528900 : Integer;
    BEGIN
      //DP00381
      CheckFormat(sp1,sp2);
      CurrLevel := Level;
      IF (sp1 = 0) AND (CurrLevel = 0) THEN CurrLevel := CurrLevel + 1;
      IF (sp2 = 0) AND (CurrLevel = 1) THEN CurrLevel := CurrLevel + 1;

      CASE CurrLevel OF
        0:BEGIN
            CALCFIELDS("Hours Chapter","Labor Chapter","Material Chapter",
                       "Subcontracting Chapter","Plant Chapter","Sundry Chapter");
            HoursDec := "Hours Chapter";
            LaborDec := "Labor Chapter";
            MatDec := "Material Chapter";
            SubcDec := "Subcontracting Chapter";
            PlantDec := "Plant Chapter";
            SundryDec := "Sundry Chapter";

            CALCFIELDS("Cum. Hours Chapter","Cum. Labor Chapter","Cum. Material Chapter",
                       "Cum. Subcontracting Chapter","Cum. Plant Chapter", "Cum. Sundry Chapter");
            CumHoursDec := "Cum. Hours Chapter";
            CumLaborDec := "Cum. Labor Chapter";
            CumMatDec := "Cum. Material Chapter";
            CumSubcDec := "Cum. Subcontracting Chapter";
            CumPlantDec := "Cum. Plant Chapter";
            CumSundryDec := "Cum. Sundry Chapter";
          END;
        1:BEGIN
            CALCFIELDS("Hours Paragraph","Labor Paragraph","Material Paragraph",
                       "Subcontracting Paragraph","Plant Paragraph","Sundry Paragraph");
            HoursDec := "Hours Paragraph";
            LaborDec := "Labor Paragraph";
            MatDec := "Material Paragraph";
            SubcDec := "Subcontracting Paragraph";
            PlantDec := "Plant Paragraph";
            SundryDec := "Sundry Paragraph";

            CALCFIELDS("Cum. Hours Paragraph","Cum. Labor Paragraph","Cum. Material Paragraph",
                       "Cum. Subcontracting Paragraph","Cum. Plant Paragraph","Cum. Sundry Paragraph");
            CumHoursDec := "Cum. Hours Paragraph";
            CumLaborDec := "Cum. Labor Paragraph";
            CumMatDec := "Cum. Material Paragraph";
            CumSubcDec := "Cum. Subcontracting Paragraph";
            CumPlantDec := "Cum. Plant Paragraph";
            CumSundryDec := "Cum. Sundry Paragraph";
          END;
        2:BEGIN
            CALCFIELDS(Hours,"Labor Amount","Material Amount",
                       "Subcontracting Amount","Plant Amount","Sundry Amount");
            HoursDec := Hours;
            LaborDec := "Labor Amount";
            MatDec := "Material Amount";
            SubcDec := "Subcontracting Amount";
            PlantDec := "Plant Amount";
            SundryDec := "Sundry Amount";

            CALCFIELDS("Cum. Hours","Cum. Labor","Cum. Material",
                       "Cum. Subcontracting","Cum. Plant","Cum. Sundry");
            CumHoursDec := "Cum. Hours";
            CumLaborDec := "Cum. Labor";
            CumMatDec := "Cum. Material";
            CumSubcDec := "Cum. Subcontracting";
            CumPlantDec := "Cum. Plant";
            CumSundryDec := "Cum. Sundry";
          END;
      END;

      TotalDec := LaborDec + MatDec + SubcDec + PlantDec + SundryDec;
      CumTotalDec := CumLaborDec + CumMatDec + CumSubcDec + CumPlantDec + CumSundryDec;
    END;

    PROCEDURE UpdatePartTotals@1100525001(iEst@1100525000 : Code[20];iSubEst@1100525001 : Code[20]);
    BEGIN
      //DP00381
      EstPartRec.SETRANGE("Estimate No.", iEst);
      EstPartRec.SETRANGE("Sub-Estimate No.", iSubEst);
      IF EstPartRec.FINDSET THEN BEGIN
        REPEAT
          EstPartRec.UpdatePartTotal;
        UNTIL EstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE CheckServiceOrder@1100525002();
    VAR
      ServOrderRec@1100525000 : Record 11012823;
    BEGIN
      //DP00260
      IF NOT ServOrderRec.GET("Service Order No.") THEN EXIT;
      ServOrderRec.CheckStatus(1);
      EstRec.GET("Estimate No.");
      IF (ServOrderRec."Customer No." <> EstRec."Customer No.") AND
         (ServOrderRec."Customer No." <> '') AND
         (EstRec."Customer No." <> '') THEN
        MESSAGE(Text002, ServOrderRec.FIELDCAPTION("Customer No."),
          ServOrderRec."Customer No.", EstRec."Customer No.",
          "Service Order No.");
      IF (ServOrderRec."Service Contract No." <> EstRec."Service Contract No.") AND
         (ServOrderRec."Service Contract No." <> '') AND
         (EstRec."Service Contract No." <> '') THEN
        MESSAGE(Text002, ServOrderRec.FIELDCAPTION("Service Contract No."),
          ServOrderRec."Service Contract No.", EstRec."Service Contract No.",
          "Service Order No.");
    END;

    PROCEDURE DeleteQuantityRelation@1100409001(lvEst@1100409000 : Code[20];lvSubEst@1100409001 : Code[20]);
    VAR
      QuanHeader@1100409006 : Record 11020462;
      QuanRelation@1100409005 : Record 11020463;
      QuanLine@1100409004 : Record 11020464;
    BEGIN
      //DP00686
      QuanHeader.SETRANGE("Estimate No.", "Estimate No.");
      QuanHeader.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      IF QuanHeader.FINDSET THEN BEGIN
        REPEAT
          QuanLine.SETRANGE("Estimate No.", QuanHeader."Estimate No.");
          QuanLine.SETRANGE("Quantity Sheet", QuanHeader.Code);
          QuanLine.DELETEALL;

          QuanRelation.SETRANGE("Estimate No.", QuanHeader."Estimate No.");
          QuanRelation.SETRANGE("Sub-Estimate No.", QuanHeader."Sub-Estimate No.");
          QuanRelation.SETRANGE("Quantity Sheet", QuanHeader.Code);
          QuanRelation.DELETEALL;
        UNTIL QuanHeader.NEXT = 0;
        QuanHeader.DELETEALL;
      END;
    END;

    PROCEDURE UpdateNormGroup@1100409000();
    VAR
      lvEstPartRec@1100485001 : Record 11072073;
    BEGIN
      //DP00686
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstPartRec.SETFILTER("Norm Group", '%1|%2', '', xRec."Norm Group");
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstPartRec.VALIDATE("Norm Group", "Norm Group");
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE UpdateNormGroupSales@1100525005();
    VAR
      lvEstPartRec@1100485001 : Record 11072073;
    BEGIN
      //DP00686
      lvEstPartRec.SETRANGE("Estimate No.", "Estimate No.");
      lvEstPartRec.SETRANGE("Sub-Estimate No.", "Sub-Estimate No.");
      lvEstPartRec.SETFILTER("Norm Group (Sales)", '%1|%2', '', xRec."Norm Group (Sales)");
      IF lvEstPartRec.FINDSET(TRUE, FALSE) THEN BEGIN
        REPEAT
          lvEstPartRec.VALIDATE("Norm Group (Sales)", "Norm Group (Sales)");
          lvEstPartRec.MODIFY;
        UNTIL lvEstPartRec.NEXT = 0;
      END;
    END;

    PROCEDURE GetPreviousPart@1100528001(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      //DP00909
      SETRANGE("Estimate No.", "Estimate No.");
      IF Level = 0 THEN
        EXIT(NEXT(-1) <> 0);

      CASE JumpLevel OF
        0 : EXIT(NEXT(-1) <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDFIRST;
              SETRANGE(Paragraph);
              IF NEXT(-1) = 0 THEN BEGIN
                SETRANGE(Chapter);
                IF NEXT(-1) = 0 THEN
                  EXIT(TRUE);
                SETRANGE(Chapter, Chapter);
              END;

              SETRANGE(Paragraph, Paragraph);
              EXIT(FINDFIRST);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDFIRST;
              SETRANGE(Chapter);
              IF NEXT(-1) = 0 THEN
                EXIT(TRUE)
              ELSE BEGIN
                SETRANGE(Chapter, Chapter);
                EXIT(FINDFIRST);
              END;
            END;
       END;
    END;

    PROCEDURE GetNextPart@1100528002(JumpLevel@1100528000 : 'Part,Paragraph,Chapter') : Boolean;
    BEGIN
      //DP00909
      SETRANGE("Estimate No.", "Estimate No.");
      IF Level = 0 THEN
        EXIT(NEXT <> 0);

      CASE JumpLevel OF
        0 : EXIT(NEXT <> 0);
        1 : BEGIN
              SETRANGE(Chapter, Chapter);
              SETRANGE(Paragraph, Paragraph);
              FINDLAST;
              SETRANGE(Chapter);
              SETRANGE(Paragraph);
              IF NEXT = 0 THEN;
              EXIT(TRUE);
            END;

        2 : BEGIN
              SETRANGE(Chapter, Chapter);
              FINDLAST;
              SETRANGE(Chapter);
              IF NEXT = 0 THEN;
              EXIT(TRUE)
            END;
      END;
    END;

    BEGIN
    {
      4PS01 HBK 06-08-09: Field added "Language Code"
    }
    END.
  }
}

