OBJECT Table 11125781 Glazing Service Call Activity
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               UpdateVatProdPostingGrp;  //RFC 547
             END;

    CaptionML=ENU=Glazing Service Call Activity;
    LookupPageID=Page11125797;
    DrillDownPageID=Page11125797;
  }
  FIELDS
  {
    { 1   ;   ;Glazing Service Call No.;Code20    ;TableRelation="Glazing Service Call";
                                                   OnValidate=VAR
                                                                GlazingServiceCall@1100525000 : Record 11125777;
                                                              BEGIN
                                                                IF NOT GlazingServiceCall.GET("Glazing Service Call No.") THEN
                                                                  GlazingServiceCall.INIT;

                                                                "Price Reference Date" := GlazingServiceCall.Date;
                                                                VALIDATE("Rate Code", GlazingServiceCall."Default Rate Code");
                                                              END;

                                                   CaptionML=ENU=Glazing Service Call No.;
                                                   NotBlank=Yes }
    { 2   ;   ;Glazing Service Call Line No.;Integer;
                                                   TableRelation="Glazing Service Call Line"."Line No." WHERE (Glazing Service Call No.=FIELD(Glazing Service Call No.));
                                                   OnValidate=VAR
                                                                GlazingServiceCallLine@1100525000 : Record 11125778;
                                                              BEGIN
                                                                IF NOT GlazingServiceCallLine.GET("Glazing Service Call No.", "Glazing Service Call Line No.") THEN
                                                                  GlazingServiceCallLine.INIT;

                                                                // jhoek.200410.begin
                                                                "Surface Area" := GlazingServiceCallLine."Surface Area (m2)";
                                                                "Linear Meters" := GlazingServiceCallLine."Linear Meters";
                                                                "Call Line Quantity" := GlazingServiceCallLine.Quantity;
                                                                "Height Surcharge" := GlazingServiceCallLine."Height Surcharge";
                                                                "No. of Glaziers" := GlazingServiceCallLine."No. of Glaziers";
                                                                // jhoek.200410.end
                                                              END;

                                                   CaptionML=ENU=Glazing Service Call Line No.;
                                                   NotBlank=Yes }
    { 3   ;   ;Line No.            ;Integer       ;CaptionML=ENU=Line No. }
    { 10  ;   ;Type                ;Option        ;CaptionML=ENU=Type;
                                                   OptionCaptionML=ENU=" ,Removal,Mounting";
                                                   OptionString=[ ,Removal,Mounting];
                                                   NotBlank=Yes;
                                                   Editable=No }
    { 30  ;   ;Cost Driver         ;Option        ;OnValidate=BEGIN
                                                                IF "Cost Driver" = "Cost Driver"::" " THEN
                                                                  "Qty. per Unit of Measure" := 0
                                                                ELSE
                                                                  "Qty. per Unit of Measure" := 1; // jhoek.170510

                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Cost Driver;
                                                   OptionCaptionML=ENU=" ,,,,,Surface Area,,,,,Linear Meters,,,,,,,,,,Height Surcharge,,,,,No. of Glaziers,,,,,Quantity of Call Line";
                                                   OptionString=[ ,,,,,Surface Area,,,,,Linear Meters,,,,,,,,,,Height Surcharge,,,,,No. of Glaziers,,,,,Qty. of Call Line] }
    { 40  ;   ;Item No.            ;Code20        ;TableRelation=Item;
                                                   OnValidate=VAR
                                                                Item@1100525000 : Record 27;
                                                              BEGIN
                                                                IF NOT Item.GET("Item No.") THEN
                                                                  Item.INIT
                                                                //mg.sn, 13-12-11: M31429
                                                                ELSE BEGIN
                                                                  Item.TESTFIELD(Blocked, FALSE);
                                                                END;
                                                                //mg.en, 13-12-11: M31429

                                                                IF Item."Global Dimension 2 Code" <> '' THEN
                                                                  "Cost Object Code Material" := Item."Global Dimension 2 Code";
                                                                "Material Price" := Item."Standard Cost";

                                                                IF Description = '' THEN
                                                                  Description := Item.Description;

                                                                UpdateVatProdPostingGrp;  //RFC 547
                                                                UpdateTotals; //mg, 25-01-12: M32523
                                                              END;

                                                   CaptionML=ENU=Item No. }
    { 41  ;   ;Item Description    ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item.Description WHERE (No.=FIELD(Item No.)));
                                                   CaptionML=ENU=Item Description;
                                                   Editable=No }
    { 50  ;   ;Cost Object Code Labor;Code20      ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Labor),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimensionValue@1100525000 : Record 349;
                                                              BEGIN
                                                                DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
                                                                DimensionValue.SETRANGE(Code, "Cost Object Code Labor");
                                                                DimensionValue.SETRANGE("Global Dimension No.", 2);

                                                                IF NOT DimensionValue.FINDFIRST THEN
                                                                  DimensionValue.INIT;

                                                                IF DimensionValue.Name <> '' THEN
                                                                  IF Description = '' THEN
                                                                    Description := DimensionValue.Name;

                                                                UpdateVatProdPostingGrp;  //RFC 547

                                                                VALIDATE(Norm, 0); // jhoek.100910
                                                              END;

                                                   CaptionML=ENU=Cost Object Code Labor }
    { 51  ;   ;Cost Object Name Labor;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Global Dimension No.=CONST(2),
                                                                                                    Cost Type=CONST(Labor),
                                                                                                    Code=FIELD(Cost Object Code Labor)));
                                                   CaptionML=ENU=Cost Object Name Labor;
                                                   Editable=No }
    { 60  ;   ;Cost Object Code Material;Code20   ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Material),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimensionValue@1100525000 : Record 349;
                                                              BEGIN
                                                                DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
                                                                DimensionValue.SETRANGE(Code, "Cost Object Code Material");
                                                                DimensionValue.SETRANGE("Global Dimension No.", 2);

                                                                IF NOT DimensionValue.FINDFIRST THEN
                                                                  DimensionValue.INIT;

                                                                UpdateVatProdPostingGrp;  //RFC 547

                                                                IF "Item No." = '' THEN
                                                                  VALIDATE("Material Price", DimensionValue.Price);

                                                                IF DimensionValue.Name <> '' THEN
                                                                  IF Description = '' THEN
                                                                    Description := DimensionValue.Name;
                                                              END;

                                                   CaptionML=ENU=Cost Object Code Material }
    { 61  ;   ;Cost Object Name Material;Text50   ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Global Dimension No.=CONST(2),
                                                                                                    Cost Type=CONST(Material),
                                                                                                    Code=FIELD(Cost Object Code Material)));
                                                   CaptionML=ENU=Cost Object Name Material;
                                                   Editable=No }
    { 70  ;   ;Cost Object Code Subcontr.;Code20  ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Subcontracting),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimensionValue@1100525000 : Record 349;
                                                              BEGIN
                                                                DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
                                                                DimensionValue.SETRANGE(Code, "Cost Object Code Subcontr.");
                                                                DimensionValue.SETRANGE("Global Dimension No.", 2);

                                                                IF NOT DimensionValue.FINDFIRST THEN
                                                                  DimensionValue.INIT;

                                                                UpdateVatProdPostingGrp;  //RFC 547

                                                                VALIDATE("Subcontracting Price", DimensionValue.Price);

                                                                IF DimensionValue.Name <> '' THEN
                                                                  IF Description = '' THEN
                                                                    Description := DimensionValue.Name;
                                                              END;

                                                   CaptionML=ENU=Cost Object Code Subcontr. }
    { 71  ;   ;Cost Object Name Subcontr.;Text50  ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Global Dimension No.=CONST(2),
                                                                                                    Cost Type=CONST(Subcontracting),
                                                                                                    Code=FIELD(Cost Object Code Subcontr.)));
                                                   CaptionML=ENU=Cost Object Name Subcontr.;
                                                   Editable=No }
    { 80  ;   ;Cost Object Code Plant;Code20      ;TableRelation="Dimension Value".Code WHERE (Cost Type=CONST(Plant),
                                                                                               Global Dimension No.=CONST(2));
                                                   OnValidate=VAR
                                                                DimensionValue@1100525000 : Record 349;
                                                              BEGIN
                                                                DimensionValue.SETCURRENTKEY(Code, "Global Dimension No.");
                                                                DimensionValue.SETRANGE(Code, "Cost Object Code Plant");
                                                                DimensionValue.SETRANGE("Global Dimension No.", 2);

                                                                IF NOT DimensionValue.FINDFIRST THEN
                                                                  DimensionValue.INIT;

                                                                UpdateVatProdPostingGrp;  //RFC 547

                                                                VALIDATE("Plant Price", DimensionValue.Price);

                                                                IF DimensionValue.Name <> '' THEN
                                                                  IF Description = '' THEN
                                                                    Description := DimensionValue.Name;
                                                              END;

                                                   CaptionML=ENU=Cost Object Code Plant }
    { 81  ;   ;Cost Object Name Plant;Text50      ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Dimension Value".Name WHERE (Global Dimension No.=CONST(2),
                                                                                                    Cost Type=CONST(Plant),
                                                                                                    Code=FIELD(Cost Object Code Plant)));
                                                   CaptionML=ENU=Cost Object Name Plant;
                                                   Editable=No }
    { 100 ;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 200 ;   ;Surface Area        ;Decimal       ;OnValidate=BEGIN
                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Surface Area;
                                                   Editable=No }
    { 210 ;   ;Linear Meters       ;Decimal       ;OnValidate=BEGIN
                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Linear Meters;
                                                   Editable=No }
    { 220 ;   ;Call Line Quantity  ;Decimal       ;OnValidate=BEGIN
                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Call Line Quantity;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 230 ;   ;Height Surcharge    ;Decimal       ;OnValidate=BEGIN
                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Height Surcharge;
                                                   Editable=No }
    { 240 ;   ;No. of Glaziers     ;Decimal       ;OnValidate=BEGIN
                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=No. of Glaziers;
                                                   Editable=No }
    { 300 ;   ;Qty. per Unit of Measure;Decimal   ;InitValue=1;
                                                   OnValidate=BEGIN
                                                                IF "Qty. per Unit of Measure" <> 0 THEN
                                                                  IF ("Cost Driver" = "Cost Driver"::" ") OR ("Cost Driver" = "Cost Driver"::"Qty. of Call Line") THEN
                                                                    FIELDERROR("Qty. per Unit of Measure", STRSUBSTNO(Text000, FIELDCAPTION("Cost Driver")));

                                                                UpdateQuantity;
                                                              END;

                                                   CaptionML=ENU=Qty. per Unit of Measure }
    { 310 ;   ;Quantity            ;Decimal       ;OnValidate=BEGIN
                                                                IF CurrFieldNo = FIELDNO(Quantity) THEN
                                                                  IF Quantity <> 0 THEN
                                                                    TESTFIELD("Cost Driver", "Cost Driver"::" ");

                                                                UpdateHours;
                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 320 ;   ;Unit of Measure Code;Code10        ;TableRelation="Unit of Measure";
                                                   CaptionML=ENU=Unit of Measure Code }
    { 330 ;   ;Norm                ;Decimal       ;OnValidate=BEGIN
                                                                IF Norm <> 0 THEN
                                                                  TESTFIELD("Cost Object Code Labor"); // jhoek.100910

                                                                UpdateHours;
                                                              END;

                                                   CaptionML=ENU=Norm;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes }
    { 340 ;   ;Rate Code           ;Code10        ;TableRelation="Budget Rate".Code;
                                                   OnValidate=BEGIN
                                                                UpdateRate;
                                                              END;

                                                   CaptionML=ENU=Rate Code }
    { 345 ;   ;Price Reference Date;Date          ;OnValidate=BEGIN
                                                                UpdateRate;
                                                              END;

                                                   CaptionML=ENU=Price Reference Date;
                                                   Editable=No }
    { 350 ;   ;Rate                ;Decimal       ;OnValidate=BEGIN
                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Rate;
                                                   BlankZero=Yes }
    { 360 ;   ;Hours               ;Decimal       ;OnValidate=BEGIN
                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Hours;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 361 ;   ;Total Hours         ;Decimal       ;CaptionML=ENU=Total Hours;
                                                   Editable=No }
    { 370 ;   ;Material Price      ;Decimal       ;OnValidate=BEGIN
                                                                IF "Material Price" <> 0 THEN
                                                                  TESTFIELD("Cost Object Code Material"); // jhoek.100910

                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Material Price;
                                                   BlankZero=Yes }
    { 380 ;   ;Subcontracting Price;Decimal       ;OnValidate=BEGIN
                                                                IF "Subcontracting Price" <> 0 THEN
                                                                  TESTFIELD("Cost Object Code Subcontr."); // jhoek.100910

                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Subcontracting Price;
                                                   BlankZero=Yes }
    { 390 ;   ;Plant Price         ;Decimal       ;OnValidate=BEGIN
                                                                IF "Plant Price" <> 0 THEN
                                                                  TESTFIELD("Cost Object Code Plant"); // jhoek.100910

                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Plant Price;
                                                   BlankZero=Yes }
    { 400 ;   ;Labor Amount        ;Decimal       ;CaptionML=ENU=Labor Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 410 ;   ;Material Amount     ;Decimal       ;CaptionML=ENU=Material Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 420 ;   ;Subcontracting Amount;Decimal      ;CaptionML=ENU=Subcontracting Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 430 ;   ;Plant Amount        ;Decimal       ;CaptionML=ENU=Plant Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 500 ;   ;Cost Amount         ;Decimal       ;CaptionML=ENU=Cost Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 510 ;   ;Surcharge %         ;Decimal       ;OnValidate=BEGIN
                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Surcharge %;
                                                   BlankZero=Yes }
    { 511 ;   ;Surcharge           ;Decimal       ;CaptionML=ENU=Surcharge;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 520 ;   ;Profit/Risk %       ;Decimal       ;OnValidate=BEGIN
                                                                UpdateTotals;
                                                              END;

                                                   CaptionML=ENU=Profit/Risk %;
                                                   BlankZero=Yes }
    { 521 ;   ;Profit/Risk         ;Decimal       ;CaptionML=ENU=Profit/Risk;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 530 ;   ;Sales Amount        ;Decimal       ;CaptionML=ENU=Sales Amount;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 600 ;   ;Service Order No.   ;Code20        ;CaptionML=ENU=Service Order No.;
                                                   Editable=No }
    { 700 ;   ;Total Cost Amount   ;Decimal       ;CaptionML=ENU=Total Cost Amount;
                                                   Editable=No }
    { 710 ;   ;Total Sales Amount  ;Decimal       ;CaptionML=ENU=Total Sales Amount;
                                                   Editable=No }
    { 1001;   ;Labor Sales Amount  ;Decimal       ;CaptionML=ENU=Labor Sales Amount;
                                                   Editable=No }
    { 1002;   ;Material Sales Amount;Decimal      ;CaptionML=ENU=Material Sales Amount;
                                                   Editable=No }
    { 1003;   ;Subcontr. Sales Amount;Decimal     ;CaptionML=ENU=Subcontracting Sales Amount;
                                                   Editable=No }
    { 1004;   ;Plant Sales Amount  ;Decimal       ;CaptionML=ENU=Plant Sales Amount;
                                                   Editable=No }
    { 1051;   ;Labor VAT Prod. Post. Grp;Code10   ;TableRelation="VAT Product Posting Group".Code;
                                                   CaptionML=ENU=VAT Prod. Posting Group Labor;
                                                   Editable=No }
    { 1052;   ;Material VAT Prod. Post. Grp;Code10;TableRelation="VAT Product Posting Group".Code;
                                                   CaptionML=ENU=Material VAT Prod. Posting Group;
                                                   Editable=No }
    { 1053;   ;Subcontr. VAT Prod. Post. Grp;Code10;
                                                   TableRelation="VAT Product Posting Group".Code;
                                                   CaptionML=ENU=Subcontracting VAT Prod. Posting Group;
                                                   Editable=No }
    { 1054;   ;Plant VAT Prod. Post. Grp;Code10   ;TableRelation="VAT Product Posting Group".Code;
                                                   CaptionML=ENU=Plant VAT Prod. Posting Group;
                                                   Editable=No }
    { 1061;   ;Labor VAT %         ;Decimal       ;CaptionML=ENU=Labor VAT %;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1062;   ;Material VAT %      ;Decimal       ;CaptionML=ENU=Material VAT %;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1063;   ;Subcontr. VAT %     ;Decimal       ;CaptionML=ENU=Subcontracting VAT %;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1064;   ;Plant VAT %         ;Decimal       ;CaptionML=ENU=Plant VAT %;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 1070;   ;Total Sales VAT Amt ;Decimal       ;CaptionML=ENU=Total Sales VAT Amount;
                                                   Editable=No }
    { 1071;   ;Labor Sales VAT Amt ;Decimal       ;CaptionML=ENU=Labor Sales VAT Amount;
                                                   Editable=No }
    { 1072;   ;Material Sales VAT Amt;Decimal     ;CaptionML=ENU=Material Sales VAT Amount;
                                                   Editable=No }
    { 1073;   ;Subcontr. Sales VAT Amt;Decimal    ;CaptionML=ENU=Subcontracting Sales VAT Amount;
                                                   Editable=No }
    { 1074;   ;Plant Sales VAT Amt ;Decimal       ;CaptionML=ENU=Plant Sales VAT Amount;
                                                   Editable=No }
    { 1080;   ;Tot Sls Amt incl. VAT;Decimal      ;CaptionML=ENU=Total Sales Amount incl. VAT;
                                                   Editable=No }
    { 1081;   ;Labor Sls Amt incl. VAT;Decimal    ;CaptionML=ENU=Labor Sales Amount incl. VAT;
                                                   Editable=No }
    { 1082;   ;Material Sls Amt incl. VAT;Decimal ;CaptionML=ENU=Material Sales Amount incl. VAT;
                                                   Editable=No }
    { 1083;   ;Subc. Sls Amt incl. VAT;Decimal    ;CaptionML=ENU=Subcontracting Sales Amount incl. VAT;
                                                   Editable=No }
    { 1084;   ;Plant Sls Amt incl. VAT;Decimal    ;CaptionML=ENU=Plant Sales Amount incl. VAT;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Glazing Service Call No.,Glazing Service Call Line No.,Type,Line No.;
                                                   SumIndexFields=Hours,Total Hours,Cost Amount,Sales Amount,Total Cost Amount,Total Sales Amount,Tot Sls Amt incl. VAT,Total Sales VAT Amt;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Labor VAT Prod. Post. Grp,Material VAT Prod. Post. Grp,Subcontr. VAT Prod. Post. Grp,Plant VAT Prod. Post. Grp;
                                                   SumIndexFields=Labor Sales Amount,Labor Sales VAT Amt,Material Sales Amount,Material Sales VAT Amt,Subcontr. Sales Amount,Subcontr. Sales VAT Amt,Plant Sales Amount,Plant Sales VAT Amt,Labor Sls Amt incl. VAT,Material Sls Amt incl. VAT,Subc. Sls Amt incl. VAT,Plant Sls Amt incl. VAT }
    {    ;Plant VAT Prod. Post. Grp,Labor VAT Prod. Post. Grp,Material VAT Prod. Post. Grp,Subcontr. VAT Prod. Post. Grp;
                                                   SumIndexFields=Labor Amount,Material Amount,Subcontracting Amount,Plant Amount }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1100525000 : TextConst 'ENU=cannot be set if %1 is blank of ''Quantity of Call Line"';

    PROCEDURE UpdateQuantity@1100525001();
    BEGIN
      CASE "Cost Driver" OF
      //  "Cost Driver"::" ": VALIDATE(Quantity, 0);
        "Cost Driver"::"Surface Area": VALIDATE(Quantity, "Qty. per Unit of Measure" * "Surface Area");
        "Cost Driver"::"Linear Meters": VALIDATE(Quantity, "Qty. per Unit of Measure" * "Linear Meters");
        "Cost Driver"::"Height Surcharge": VALIDATE(Quantity, "Qty. per Unit of Measure" * "Height Surcharge");
        "Cost Driver"::"No. of Glaziers": VALIDATE(Quantity, "Qty. per Unit of Measure" * "No. of Glaziers");
        "Cost Driver"::"Qty. of Call Line": VALIDATE(Quantity, "Qty. per Unit of Measure" * "Call Line Quantity");
      END;
    END;

    PROCEDURE UpdateHours@1100525002();
    BEGIN
      VALIDATE(Hours, Quantity * Norm);
    END;

    PROCEDURE UpdateTotals@1100525003();
    BEGIN
      IF "Cost Driver" <> "Cost Driver"::"Qty. of Call Line" THEN BEGIN
        "Labor Amount" := Rate * Hours;
        "Material Amount" := "Material Price" * Quantity;
        "Subcontracting Amount" := "Subcontracting Price" * Quantity;
        "Plant Amount" := "Plant Price" * Quantity;
      END ELSE BEGIN
        "Labor Amount" := Rate * Norm;
        "Material Amount" := "Material Price";
        "Subcontracting Amount" := "Subcontracting Price";
        "Plant Amount" := "Plant Price";
      END;

      "Cost Amount" := "Labor Amount" + "Material Amount" + "Subcontracting Amount" + "Plant Amount";
      Surcharge := ("Surcharge %" / 100) * "Cost Amount";
      "Profit/Risk" := ("Profit/Risk %" / 100) * "Cost Amount";
      "Sales Amount" := "Cost Amount" + Surcharge + "Profit/Risk";

      CASE "Cost Driver" OF
        "Cost Driver"::" ":
          BEGIN
            "Total Cost Amount" := "Cost Amount";
            "Total Sales Amount" := "Sales Amount";
            "Total Hours" := Hours;
          END;
        "Cost Driver"::"Qty. of Call Line":
          BEGIN
            "Total Cost Amount" := "Cost Amount" * "Call Line Quantity";
            "Total Sales Amount" := "Sales Amount" * "Call Line Quantity";
            "Total Hours" := Hours;
          END;
        ELSE BEGIN
          "Total Cost Amount" := "Cost Amount" * "Call Line Quantity";
          "Total Sales Amount" := "Sales Amount" * "Call Line Quantity";
          "Total Hours" := Hours * "Call Line Quantity";
        END;
      END;

      CalcVATAmount;  //RFC 547
    END;

    PROCEDURE UpdateRate@1100525008();
    BEGIN
      VALIDATE(Rate, GetRate("Rate Code", "Price Reference Date"));
    END;

    PROCEDURE GetRate@1100525013(RateCode@1100525000 : Code[10];ReferenceDate@1100525001 : Date) : Decimal;
    VAR
      BudgetRate@1100525004 : Record 11012000;
    BEGIN
      BudgetRate.SETRANGE(Code, RateCode);
      BudgetRate.SETFILTER("Starting Date", '<=%1', ReferenceDate);
      BudgetRate.FINDLAST;

      EXIT(BudgetRate.Rate);
    END;

    PROCEDURE CallLineQtyForBudget@1100525000() : Decimal;
    BEGIN
      CASE "Cost Driver" OF
        "Cost Driver"::" ",
        "Cost Driver"::"Qty. of Call Line": //mg, 09-11-11: M30503
        // "Cost Driver"::"No. of Glaziers": jhoek.071210
          EXIT(1);
      ELSE
        EXIT("Call Line Quantity");
      END;
    END;

    PROCEDURE UpdateVatProdPostingGrp@1100525018();
    VAR
      ServiceSetup@1100525001 : Record 11012800;
      ItemRec@1100525002 : Record 27;
      ServLocRec@1100525003 : Record 11012801;
      GlazingServiceCall@1100525004 : Record 11125777;
      Customer@1100525005 : Record 18;
      DimValRec@1100525006 : Record 349;
      DimMgt@1100525000 : Codeunit 408;
    BEGIN
      // RFC 547
      GlazingServiceCall.GET("Glazing Service Call No.");
      ServiceSetup.GET;
      IF NOT ServLocRec.GET(GlazingServiceCall."Service Location No.") THEN
        ServLocRec.INIT;
      IF NOT Customer.GET(GlazingServiceCall."Customer No.") THEN
        Customer.INIT;

      //Material
      "Material VAT Prod. Post. Grp" := '';
      IF (ServiceSetup."Source VAT Prod. Posting Group" =
          ServiceSetup."Source VAT Prod. Posting Group"::"Item/CostObject") THEN
      BEGIN
        IF NOT ItemRec.GET("Item No.") THEN
          ItemRec.INIT;
        IF (ItemRec."VAT Prod. Posting Group" <> '') THEN
        BEGIN
          "Material VAT Prod. Post. Grp" := ItemRec."VAT Prod. Posting Group";
        END;
        IF "Material VAT Prod. Post. Grp" = '' THEN BEGIN
          DimMgt.GetDimValueRec(2,"Cost Object Code Material",DimValRec,FALSE,'');
          IF (DimValRec."VAT Prod. Posting Group" <> '') THEN
          BEGIN
            "Material VAT Prod. Post. Grp" := DimValRec."VAT Prod. Posting Group";
          END;
        END;
      END;
      IF "Material VAT Prod. Post. Grp" = '' THEN
          "Material VAT Prod. Post. Grp" := ServLocRec."VAT Prod. Posting Group";
      IF "Material VAT Prod. Post. Grp" = '' THEN
          "Material VAT Prod. Post. Grp" := Customer."VAT Prod. Posting Group";
      IF "Material VAT Prod. Post. Grp" = '' THEN
        "Material VAT Prod. Post. Grp" := ServiceSetup."VAT Prod. Posting Group";

      //Labor
      "Labor VAT Prod. Post. Grp" := '';
      IF (ServiceSetup."Source VAT Prod. Posting Group" =
          ServiceSetup."Source VAT Prod. Posting Group"::"Item/CostObject") THEN
      BEGIN
        DimMgt.GetDimValueRec(2,"Cost Object Code Labor",DimValRec,FALSE,'');
        IF (DimValRec."VAT Prod. Posting Group" <> '') THEN
        BEGIN
          "Labor VAT Prod. Post. Grp" := DimValRec."VAT Prod. Posting Group";
        END;
      END;
      IF "Labor VAT Prod. Post. Grp" = '' THEN
        "Labor VAT Prod. Post. Grp" := ServLocRec."VAT Prod. Posting Group";
      IF "Labor VAT Prod. Post. Grp" = '' THEN
        "Labor VAT Prod. Post. Grp" := Customer."VAT Prod. Posting Group";
      IF "Labor VAT Prod. Post. Grp" = '' THEN
        "Labor VAT Prod. Post. Grp":= ServiceSetup."VAT Prod. Posting Group";

      //Subcontracting
      "Subcontr. VAT Prod. Post. Grp" := '';
      IF (ServiceSetup."Source VAT Prod. Posting Group" =
          ServiceSetup."Source VAT Prod. Posting Group"::"Item/CostObject") THEN
      BEGIN
        DimMgt.GetDimValueRec(2,"Cost Object Code Subcontr.",DimValRec,FALSE,'');
        IF (DimValRec."VAT Prod. Posting Group" <> '') THEN
        BEGIN
          "Subcontr. VAT Prod. Post. Grp" := DimValRec."VAT Prod. Posting Group";
        END;
      END;
      IF "Subcontr. VAT Prod. Post. Grp" = '' THEN
        "Subcontr. VAT Prod. Post. Grp" := ServLocRec."VAT Prod. Posting Group";
      IF "Subcontr. VAT Prod. Post. Grp" = '' THEN
        "Subcontr. VAT Prod. Post. Grp" := Customer."VAT Prod. Posting Group";
      IF "Subcontr. VAT Prod. Post. Grp" = '' THEN
        "Subcontr. VAT Prod. Post. Grp":= ServiceSetup."VAT Prod. Posting Group";

      //Plant
      "Plant VAT Prod. Post. Grp" := '';
      IF (ServiceSetup."Source VAT Prod. Posting Group" =
          ServiceSetup."Source VAT Prod. Posting Group"::"Item/CostObject") THEN
      BEGIN
        DimMgt.GetDimValueRec(2,"Cost Object Code Plant",DimValRec,FALSE,'');
        IF (DimValRec."VAT Prod. Posting Group" <> '') THEN
        BEGIN
          "Plant VAT Prod. Post. Grp" := DimValRec."VAT Prod. Posting Group";
        END;
      END;
      IF "Plant VAT Prod. Post. Grp" = '' THEN
        "Plant VAT Prod. Post. Grp" := ServLocRec."VAT Prod. Posting Group";
      IF "Plant VAT Prod. Post. Grp" = '' THEN
        "Plant VAT Prod. Post. Grp" := Customer."VAT Prod. Posting Group";
      IF "Plant VAT Prod. Post. Grp" = '' THEN
        "Plant VAT Prod. Post. Grp":= ServiceSetup."VAT Prod. Posting Group";
    END;

    PROCEDURE CalcVATAmount@1100525019();
    VAR
      GlazingServiceCall@1100525001 : Record 11125777;
    BEGIN
      // RFC 547
      GlazingServiceCall.GET("Glazing Service Call No.");
      CalcVATAmount2(GlazingServiceCall);
    END;

    PROCEDURE CalcVATAmount2@1100525004(GlazingServiceCall@1100525001 : Record 11125777);
    VAR
      VATPostingSetup@1100525000 : Record 325;
      Currency@1100525002 : Record 4;
    BEGIN
      // RFC 547
      Currency.InitRoundingPrecision;

      IF "Cost Amount" <> 0 THEN BEGIN
        "Material Sales Amount" := ROUND(
          "Total Sales Amount" * ("Material Amount"/"Cost Amount"),
          Currency."Unit-Amount Rounding Precision");
        "Labor Sales Amount" := ROUND(
          "Total Sales Amount" * ("Labor Amount"/"Cost Amount"),
          Currency."Unit-Amount Rounding Precision");
        "Subcontr. Sales Amount" := ROUND(
          "Total Sales Amount" * ("Subcontracting Amount"/"Cost Amount"),
          Currency."Unit-Amount Rounding Precision");
        "Plant Sales Amount" := ROUND(
          "Total Sales Amount" * ("Plant Amount"/"Cost Amount"),
          Currency."Unit-Amount Rounding Precision");
      END ELSE BEGIN
        "Material Sales Amount" := 0;
        "Labor Sales Amount" := 0;
        "Subcontr. Sales Amount" := 0;
        "Plant Sales Amount" := 0;
      END;

      IF NOT VATPostingSetup.GET(GlazingServiceCall."VAT Bus. Posting Group",
                                 "Material VAT Prod. Post. Grp")
      THEN
        VATPostingSetup.INIT;

      "Material VAT %" := 0;
      "Material Sales VAT Amt" := 0;
      "Material Sls Amt incl. VAT" := "Material Sales Amount";
      IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Normal VAT" THEN BEGIN
        "Material VAT %" := VATPostingSetup."VAT %";
        "Material Sls Amt incl. VAT" := ROUND(
           "Material Sales Amount" * (100 + "Material VAT %") /100,
           Currency."Unit-Amount Rounding Precision");
        "Material Sales VAT Amt" := "Material Sls Amt incl. VAT" - "Material Sales Amount";
      END;

      IF NOT VATPostingSetup.GET(GlazingServiceCall."VAT Bus. Posting Group",
                                 "Labor VAT Prod. Post. Grp")
      THEN
        VATPostingSetup.INIT;

      "Labor VAT %" := 0;
      "Labor Sales VAT Amt" := 0;
      "Labor Sls Amt incl. VAT" := "Labor Sales Amount";
      IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Normal VAT" THEN BEGIN
        "Labor VAT %" := VATPostingSetup."VAT %";
        "Labor Sls Amt incl. VAT" := ROUND(
           "Labor Sales Amount" * (100 + "Labor VAT %") /100,
           Currency."Unit-Amount Rounding Precision");
        "Labor Sales VAT Amt" := "Labor Sls Amt incl. VAT" - "Labor Sales Amount";
      END;

      IF NOT VATPostingSetup.GET(GlazingServiceCall."VAT Bus. Posting Group",
                                 "Subcontr. VAT Prod. Post. Grp")
      THEN
        VATPostingSetup.INIT;

      "Subcontr. VAT %" := 0;
      "Subcontr. Sales VAT Amt" := 0;
      "Subc. Sls Amt incl. VAT" := "Subcontr. Sales Amount";
      IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Normal VAT" THEN BEGIN
        "Subcontr. VAT %" := VATPostingSetup."VAT %";
        "Subc. Sls Amt incl. VAT" := ROUND(
           "Subcontr. Sales Amount" * (100 + "Subcontr. VAT %") /100,
           Currency."Unit-Amount Rounding Precision");
        "Subcontr. Sales VAT Amt" := "Subc. Sls Amt incl. VAT" - "Subcontr. Sales Amount";
      END;

      IF NOT VATPostingSetup.GET(GlazingServiceCall."VAT Bus. Posting Group",
                                 "Plant VAT Prod. Post. Grp")
      THEN
        VATPostingSetup.INIT;

      "Plant VAT %" := 0;
      "Plant Sales VAT Amt" := 0;
      "Plant Sls Amt incl. VAT" := "Plant Sales Amount";
      IF VATPostingSetup."VAT Calculation Type" = VATPostingSetup."VAT Calculation Type"::"Normal VAT" THEN BEGIN
        "Plant VAT %" := VATPostingSetup."VAT %";
        "Plant Sls Amt incl. VAT" := ROUND(
           "Plant Sales Amount" * (100 + "Plant VAT %") /100,
           Currency."Unit-Amount Rounding Precision");
        "Plant Sales VAT Amt" := "Plant Sls Amt incl. VAT" - "Plant Sales Amount";
      END;

      "Total Sales VAT Amt" :=
        "Plant Sales VAT Amt" + "Subcontr. Sales VAT Amt" +
       "Labor Sales VAT Amt" + "Material Sales VAT Amt";
      "Tot Sls Amt incl. VAT" :=
        "Plant Sls Amt incl. VAT" + "Subc. Sls Amt incl. VAT" +
        "Labor Sls Amt incl. VAT" + "Material Sls Amt incl. VAT";
    END;

    BEGIN
    END.
  }
}

