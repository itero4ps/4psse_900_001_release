OBJECT XMLport 11012005 Import/Export Budget
{
  OBJECT-PROPERTIES
  {
    Date=;
    Time=;
    Version List=4PS9.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Import/Export Budget;
    DefaultFieldsValidation=No;
    PreserveWhiteSpace=Yes;
    OnPreXMLport=BEGIN
                   ProjectCode := "Budget Line".GETFILTER("Project No.");

                   IF currXMLport.IMPORTFILE THEN
                     Job.GET(ProjectCode);
                 END;

    OnPostXMLport=VAR
                    BudgetSummarySheet@1100409000 : Record 11012064;
                  BEGIN
                    //C021015.sn
                    IF currXMLport.IMPORTFILE THEN BEGIN
                      BudgetSummarySheet."Project No." := ProjectCode;
                      BudgetSummarySheet.ReCalcSummaryLines('');
                      BudgetSummarySheet.UpdateBudgetLines(TRUE,'');
                    END;
                    //C021015.en
                  END;

    Format=Variable Text;
  }
  ELEMENTS
  {
    { [{01A8AC87-65E0-49D6-B998-D49C50F6D9AA}];  ;Root                ;Element ;Text     }

    { [{98B1AF3A-A78B-41D7-AB4E-66C58F133906}];1 ;BudgetLine          ;Element ;Table   ;
                                                  SourceTable=Table11012001;
                                                  Import::OnBeforeInsertRecord=VAR
                                                                                 BudgetLine@1100525000 : Record 11012001;
                                                                               BEGIN
                                                                                 //C021015.sn
                                                                                 IF "Budget Line"."Budget Summary Line" THEN
                                                                                   currXMLport.SKIP;
                                                                                 //C021015.en

                                                                                 "Budget Line"."Project No." := ProjectCode;
                                                                                 "Budget Line"."Main Project No." := Job."Main Project";

                                                                                 //mg.sn, 23-11-10: M23401
                                                                                 IF ("Budget Line"."Cost Object" <> '') AND ValidateCostObject THEN
                                                                                   "Budget Line".GetDefaultsCostObject(FALSE);
                                                                                 //mg.en, 23-11-10: M23401

                                                                                 //SR.sn, 12-12-14: W114045
                                                                                 IF BudgetLine.BudgetFixed("Budget Line") THEN
                                                                                   GiveErrorMessage("Budget Line");
                                                                                 //SR.en, 12-12-14: W114045

                                                                                 RecRef.GETTABLE("Budget Line");
                                                                                 XMLportStatusDialogMgt.ShowImportStatus(RecRef);

                                                                                 IF BudgetLine.GET(
                                                                                   "Budget Line"."Project No.",
                                                                                   "Budget Line".Adjustment,
                                                                                   "Budget Line"."Extension Contract",
                                                                                   "Budget Line".Option,
                                                                                   "Budget Line"."Line No.")
                                                                                 THEN BEGIN
                                                                                   UpdateBudgetLine(BudgetLine, "Budget Line");
                                                                                   currXMLport.SKIP;
                                                                                 END;
                                                                               END;

                                                  Export::OnAfterGetRecord=BEGIN
                                                                             "Budget Line".Description := CONVERTSTR("Budget Line".Description, '"', ''''); //change " (= fieldseperator) to '
                                                                             "Budget Line"."Description 2" := CONVERTSTR("Budget Line"."Description 2", '"', ''''); //mg, 23-11-10: M23401

                                                                             RecRef.GETTABLE("Budget Line");
                                                                             XMLportStatusDialogMgt.ShowExportStatus(RecRef);
                                                                           END;
                                                                            }

    { [{843CA324-DD44-43D6-8144-8219F548EE25}];2 ;ProjectNo           ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Project No.;
                                                  MinOccurs=Zero }

    { [{09412B0B-3DC8-40CC-9949-68865D0769AB}];2 ;Element             ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Element;
                                                  MinOccurs=Zero }

    { [{344471AC-B66F-4FDC-A420-A42274661EFE}];2 ;CostObject          ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Cost Object;
                                                  MinOccurs=Zero }

    { [{55D2B003-04A5-464B-A59C-21B8DCE73EF8}];2 ;Description         ;Element ;Field   ;
                                                  DataType=Text;
                                                  SourceField=Budget Line::Description;
                                                  MinOccurs=Zero }

    { [{F6A8D69C-3F0A-4602-A266-C62C157B60BE}];2 ;Quantity            ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Quantity;
                                                  MinOccurs=Zero }

    { [{A3F95291-BAD1-4BE9-A00F-D184AE6E79E5}];2 ;UnitOfMeasure       ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Unit of Measure;
                                                  MinOccurs=Zero }

    { [{D9D84424-5595-4111-B415-6898BCC22A28}];2 ;Norm                ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Norm;
                                                  MinOccurs=Zero }

    { [{E2B0DCD6-3A2A-4294-9B6E-BF20299CBADE}];2 ;RateCode            ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Rate Code;
                                                  MinOccurs=Zero }

    { [{71033B66-CB4A-4053-BE4D-FF5B86B13F17}];2 ;Rate                ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Rate;
                                                  MinOccurs=Zero }

    { [{C560CCE4-5620-4703-BCF3-E3A6114FB0E8}];2 ;Hours               ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Hours;
                                                  MinOccurs=Zero }

    { [{D1C38E50-9FB6-4151-B9AF-EB1D0F8E0611}];2 ;Amount              ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Amount;
                                                  MinOccurs=Zero }

    { [{2E40F1B8-492F-4E8D-8EBC-1C3737D734EA}];2 ;LineNo              ;Element ;Field   ;
                                                  DataType=Integer;
                                                  SourceField=Budget Line::Line No.;
                                                  MinOccurs=Zero }

    { [{E4BC4F58-CC20-4E16-B0D4-E5A846519B63}];2 ;CostType            ;Element ;Field   ;
                                                  DataType=Option;
                                                  SourceField=Budget Line::Cost Type;
                                                  MinOccurs=Zero }

    { [{2B7800A2-F3D6-4BDF-9C07-3C942644899B}];2 ;Price               ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Price;
                                                  MinOccurs=Zero }

    { [{C86B5EE4-9012-4B6D-B16D-9830995D5E6A}];2 ;TimeQuantity        ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Budget Line::Time Quantity;
                                                  MinOccurs=Zero }

    { [{460E89AE-1B9B-4EAE-B752-20CB340C04FA}];2 ;UnitOfTime          ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Unit of Time;
                                                  MinOccurs=Zero }

    { [{3CBD2E5D-4C44-42F3-903E-5E56A841DBCE}];2 ;Adjustment          ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Adjustment;
                                                  MinOccurs=Zero }

    { [{37E8DC9B-CE90-4845-AC52-B26F9C68AF4E}];2 ;ExtensionContract   ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Extension Contract;
                                                  MinOccurs=Zero }

    { [{999C735F-9F81-4553-BDDC-E339807EB5D0}];2 ;Option              ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Option;
                                                  MinOccurs=Zero }

    { [{13110C73-2721-480D-986C-621CA05180E9}];2 ;Description2        ;Element ;Field   ;
                                                  DataType=Text;
                                                  SourceField=Budget Line::Description 2;
                                                  MinOccurs=Zero }

    { [{666ABE63-D650-46A2-BCBD-3950705BC868}];2 ;CostComponent       ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Budget Line::Cost Component }

    { [{F508A7E4-DF02-4037-A226-104FEDBCC7C0}];2 ;BudgetSummaryLine   ;Element ;Field   ;
                                                  DataType=Boolean;
                                                  SourceField=Budget Line::Budget Summary Line }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      OnOpenPage=BEGIN
                   EnableFields; //mg, 23-11-10: M23401
                 END;

    }
    CONTROLS
    {
      { 1210190003;0;Container;
                  ContainerType=ContentArea }

      { 1210190000;1;Group  ;
                  CaptionML=ENU=Options }

      { 1210190002;2;Field  ;
                  CaptionML=ENU=Direction;
                  OptionCaptionML=ENU=Import,Export;
                  SourceExpr=Direction;
                  OnValidate=BEGIN
                               //mg.sn, 23-11-10: M23401
                               currXMLport.IMPORTFILE(Direction = Direction::Import);
                               EnableFields;
                               //mg.en, 23-11-10: M23401
                             END;
                              }

      { 1210190001;2;Field  ;
                  Name=cbValidateCostObject;
                  CaptionML=ENU=Validate Cost Object;
                  SourceExpr=ValidateCostObject;
                  Editable=cbValidateCostObjectEditable }

    }
  }
  CODE
  {
    VAR
      Job@1100525000 : Record 11072003;
      RecRef@1100525002 : RecordRef;
      XMLportStatusDialogMgt@1100525003 : Codeunit 11130006;
      ProjectCode@1100525001 : Code[20];
      ValidateCostObject@1210190000 : Boolean;
      Direction@1210190001 : 'Import,Export';
      cbValidateCostObjectEditable@1210190002 : Boolean INDATASET;

    PROCEDURE EnableFields@1210190005();
    BEGIN
      cbValidateCostObjectEditable := (Direction = Direction::Import); //mg, 23-11-10: M23401
    END;

    PROCEDURE UpdateBudgetLine@1100525000(VAR BudgetLine@1100525000 : Record 11012001;BudgetLineImport@1100525001 : Record 11012001);
    BEGIN
      BudgetLine.Element := BudgetLineImport.Element;
      BudgetLine."Cost Object" := BudgetLineImport."Cost Object";
      BudgetLine.Description := BudgetLineImport.Description;
      BudgetLine.Quantity := BudgetLineImport.Quantity;
      BudgetLine."Unit of Measure" := BudgetLineImport."Unit of Measure";
      BudgetLine.Norm := BudgetLineImport.Norm;
      BudgetLine."Rate Code" := BudgetLineImport."Rate Code";
      BudgetLine.Rate := BudgetLineImport.Rate;
      BudgetLine.Hours := BudgetLineImport.Hours;
      BudgetLine.Amount := BudgetLineImport.Amount;
      BudgetLine."Cost Type" := BudgetLineImport."Cost Type";
      BudgetLine.Price := BudgetLineImport.Price;
      BudgetLine."Time Quantity" := BudgetLineImport."Time Quantity";
      BudgetLine."Unit of Time" := BudgetLineImport."Unit of Time";
      BudgetLine."Description 2" := BudgetLineImport."Description 2";

      BudgetLine.MODIFY;
    END;

    LOCAL PROCEDURE GiveErrorMessage@8(BudgetLine@1100485001 : Record 11012001);
    VAR
      BudgetAdjustment@1100525001 : Record 11012003;
      ExtensionContract@1100525000 : Record 11012004;
      Job@1100529100 : Record 11072003;
    BEGIN
      CASE TRUE OF
        BudgetLine.Adjustment <> '':
          BEGIN
            BudgetAdjustment.GET(BudgetLine."Project No.",BudgetLine.Adjustment);
            BudgetAdjustment.TESTFIELD("Budget Correction Fixed",FALSE);
          END;
        BudgetLine."Extension Contract" <> '':
          BEGIN
            ExtensionContract.GET(BudgetLine."Project No.",BudgetLine."Extension Contract");
            ExtensionContract.TESTFIELD("Budget Fixed",FALSE);
          END;
        BudgetLine."Project No." <> '':
          BEGIN
            Job.GET(BudgetLine."Project No.");
            Job.TESTFIELD("Budget Fixed",FALSE);
          END;
      END;
    END;

    BEGIN
    {
      CC: Dataport 11012001
    }
    END.
  }
}

